"use strict";(self.webpackChunkarcgis_node=self.webpackChunkarcgis_node||[]).push([[5039,5390],{99248:(e,t,i)=>{i.d(t,{A:()=>m});var n=i(82392),s=(i(3313),i(5347)),r=i(14755),o=i(80575),a=i(84977),l=i(81482),c=i(77380),u=(i(67498),i(6273),i(26325)),d=i(8636),h=i(1912);let p=class extends((0,a.Te)(r.P)){constructor(e){super(e),this.type="length",this.startPoint=null,this.endPoint=null,this.measureType=s.L.Direct,this.offset=0,this.orientation=0}};(0,n._)([(0,l.MZ)({type:["length"],json:{write:{isRequired:!0}}})],p.prototype,"type",void 0),(0,n._)([(0,l.MZ)({type:h.A,json:{write:!0}})],p.prototype,"startPoint",void 0),(0,n._)([(0,l.MZ)({type:h.A,json:{write:!0}})],p.prototype,"endPoint",void 0),(0,n._)([(0,l.MZ)({type:s.h,nonNullable:!0,json:{write:{isRequired:!0}}})],p.prototype,"measureType",void 0),(0,n._)([(0,l.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],p.prototype,"offset",void 0),(0,n._)([(0,l.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,c.w)((e=>o.ie.normalize((0,d.GB)(e),0,!0)))],p.prototype,"orientation",void 0),p=(0,n._)([(0,u.$)("esri.analysis.LengthDimension")],p);const m=p},5347:(e,t,i)=>{var n;i.d(t,{L:()=>n,h:()=>s}),function(e){e.Horizontal="horizontal",e.Vertical="vertical",e.Direct="direct"}(n||(n={}));const s=[n.Horizontal,n.Vertical,n.Direct]},2296:(e,t,i)=>{i.d(t,{I:()=>g,b:()=>f});var n=i(77788),s=i(29592),r=i(31790),o=i(65630),a=i(78546),l=i(83660),c=i(21586),u=i(19635),d=i(41014),h=i(92624),p=i(19778),m=i(7782),_=i(33763);function f(e){const t=new h.N5,{vertex:i,fragment:f}=t;return(0,c.NB)(i,e),t.include(r.d,e),t.attributes.add(_.r.POSITION,"vec3"),t.attributes.add(_.r.UV0,"vec2"),e.perspectiveInterpolation&&t.attributes.add(_.r.PERSPECTIVEDIVIDE,"float"),t.varyings.add("vpos","vec3"),e.multipassEnabled&&t.varyings.add("depth","float"),i.code.add(d.H`
    void main(void) {
      vpos = position;
      ${e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0;
      gl_Position = transformPosition(proj, view, vpos);

      ${e.perspectiveInterpolation?"gl_Position *= perspectiveDivide;":""}
    }
  `),t.include(s.HQ,e),t.include(o.Q,e),f.uniforms.add(new p.N("tex",(e=>e.texture)),new u.m("opacity",(e=>e.opacity))),t.varyings.add("vTexCoord","vec2"),e.transparencyPassType===m.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),f.include(l.a),f.code.add(d.H`
    void main() {
      discardBySlice(vpos);
      ${e.multipassEnabled?"terrainDepthTest(depth);":""}
      fragColor = texture(tex, vTexCoord) * opacity;

      if (fragColor.a < ${d.H.float(a.H)}) {
        discard;
      }

      fragColor = highlightSlice(fragColor, vpos);
      ${e.transparencyPassType===m.y.ColorAlpha?d.H`
              fragColor = premultiplyAlpha(fragColor);
              fragAlpha = fragColor.a;`:""}
      ${e.output===n.V.ObjectAndLayerIdColor?d.H`
              fragColor = vec4(0,0,0,1);`:""}
    }
    `),t}const g=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}))},53357:(e,t,i)=>{function n(){return new Float32Array(4)}function s(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function r(e,t,i,n){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=n,s}function o(){return n()}function a(){return r(1,1,1,1)}function l(){return r(1,0,0,0)}function c(){return r(0,1,0,0)}function u(){return r(0,0,1,0)}function d(){return r(0,0,0,1)}i.d(t,{fA:()=>r,o8:()=>s});const h=o(),p=a(),m=l(),_=c(),f=u(),g=d();Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_W:g,UNIT_X:m,UNIT_Y:_,UNIT_Z:f,ZEROS:h,clone:s,create:n,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:r,ones:a,unitW:d,unitX:l,unitY:c,unitZ:u,zeros:o},Symbol.toStringTag,{value:"Module"}))},37902:(e,t,i)=>{i.d(t,{Ee:()=>l,Jd:()=>v,Nk:()=>h,OM:()=>g,Oo:()=>f,W4:()=>c,ix:()=>m,rJ:()=>p,t_:()=>d,tr:()=>u,yh:()=>_,zJ:()=>o});var n=i(80575),s=i(7743),r=i(59491);function o(e,t,i,n=2,o="abbr"){return(0,r.zJ)(e,(0,s.kM)(t,i).value,i,n,o)}function a(e,t,i,n=2,o="abbr"){return(0,r.nD)(e,(0,s.kM)(t,i).value,i,n,o)}function l(e,t,i=2,n="abbr"){return(0,r.Ee)(e,t.value,t.unit,i,n)}function c(e,t,i=2,n="abbr"){return(0,r.W4)(e,t.value,t.unit,i,n)}function u(e,t,i=2,n="abbr"){return(0,r.tr)(e,t.value,t.unit,i,n)}function d(e,t,i=2,n="abbr"){return(0,r.t_)(e,t.value,t.unit,i,n)}function h(e,t,i,s=n.ie,o=!0){return(0,r.Me)(e.value,e.unit,e.rotationType,t,i,s,o)}function p(e,t,i){return(0,r.cs)(e.value,e.unit,e.rotationType,t,i)}function m(e,t,i,n,s="abbr"){switch(n=n??2,i){case"imperial":return u(e,t,n,s);case"metric":return l(e,t,n,s);default:return o(e,t,i,n,s)}}function _(e,t,i,n=2,s="abbr"){switch(i){case"imperial":return function(e,t,i=2,n="abbr"){return(0,r.J1)(e,t.value,t.unit,i,n)}(e,t,n,s);case"metric":return function(e,t,i=2,n="abbr"){return(0,r.Mm)(e,t.value,t.unit,i,n)}(e,t,n,s);default:return a(e,t,i,n,s)}}function f(e,t,i,n=2,s="abbr"){switch(i){case"imperial":return d(e,t,n,s);case"metric":return c(e,t,n,s);default:return o(e,t,i,n,s)}}function g(e,t,i,n=2,s="abbr"){switch(i){case"imperial":return function(e,t,i=2,n="abbr"){return(0,r.LF)(e,t.value,t.unit,i,n)}(e,t,n,s);case"metric":return function(e,t,i=2,n="abbr"){return(0,r.e_)(e,t.value,t.unit,i,n)}(e,t,n,s);default:return a(e,t,i,n,s)}}function v(e,t,i,n=2,s="abbr"){switch(i){case"imperial":return function(e,t,i=2,n="abbr"){return(0,r.Sz)(e,t.value,t.unit,i,n)}(e,t,n,s);case"metric":return function(e,t,i=2,n="abbr"){return(0,r.zq)(e,t.value,t.unit,i,n)}(e,t,n,s);default:return o(e,t,i,n,s)}}},14793:(e,t,i)=>{i.d(t,{P:()=>l});var n=i(82392),s=i(70214),r=i(71004),o=i(81482),a=(i(6273),i(80861),i(67498),i(26325));const l=e=>{let t=class extends((0,r.g)(e)){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(e){this._userInteractive=e}get updating(){return!1}get visible(){return null==this.parent||this.parent.visible&&!this.parent.suspended}set visible(e){this._overrideIfSome("visible",e)}forceInteractiveForViewModel(){return this._interactiveViewModelCount++,(0,s.hA)((()=>this._interactiveViewModelCount--))}};return(0,n._)([(0,o.MZ)({constructOnly:!0})],t.prototype,"parent",void 0),(0,n._)([(0,o.MZ)({constructOnly:!0})],t.prototype,"view",void 0),(0,n._)([(0,o.MZ)({type:Boolean})],t.prototype,"interactive",null),(0,n._)([(0,o.MZ)()],t.prototype,"_userInteractive",void 0),(0,n._)([(0,o.MZ)({readOnly:!0})],t.prototype,"updating",null),(0,n._)([(0,o.MZ)()],t.prototype,"visible",null),(0,n._)([(0,o.MZ)()],t.prototype,"_interactiveViewModelCount",void 0),t=(0,n._)([(0,a.$)("esri.views.3d.analysis.AnalysisView3D")],t),t}},16747:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Bt});var n,s=i(82392),r=i(73783),o=i(70214),a=(i(6273),i(80861)),l=i(57725),c=i(61985),u=i(81482),d=(i(67498),i(26325)),h=i(14793),p=i(5347),m=i(5262),_=i(92174),f=i(4506),g=i(7743),v=i(25336),y=i(26110),w=i(80347),S=i(19913),M=i(60929),b=i(11631),P=i(82320),C=i(96124),O=i(58274),D=i(49970),x=i(68489),T=i(7540);function A(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i,dimension:{offset:n,measureType:s,orientation:r}}=e;return{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i,offset:n,measureType:s,orientation:r}}function R({elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,offset:i,measureType:n,orientation:s},r,o=null){if(null==e||null==t)return null;const a=I(o?.directSegment??new O.C,{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t},r),l=o?.primaryOffsetAxis??(0,S.vt)();H(l,{measureType:n,elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,directSegment:a,orientation:s,renderCoordsHelper:r});const c=o?.dimensionSegment??new O.C;return V({elevationAlignedStartPoint:e,elevationAlignedEndPoint:t})&&n===p.L.Vertical?((0,w.c)(c.startRenderSpace,a.startRenderSpace),(0,w.c)(c.endRenderSpace,a.endRenderSpace)):Z(c,{offsetAxis:l,offset:i,relativeToSegment:a,renderCoordsHelper:r}),{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,directSegment:a,dimensionSegment:c,primaryOffsetAxis:l,spatialReference:r.spatialReference}}function z(e,t,i,s){return t===n.Start?((0,w.c)(e.startRenderSpace,i.startRenderSpace),(0,w.c)(e.endRenderSpace,s.startRenderSpace)):((0,w.c)(e.startRenderSpace,i.endRenderSpace),(0,w.c)(e.endRenderSpace,s.endRenderSpace)),e}function E(e,t,i,n){switch(t){case p.L.Direct:return I(e,i,n);case p.L.Horizontal:case p.L.Vertical:{const{elevationAlignedStartPoint:s,elevationAlignedEndPoint:r,dimension:o,geometry:a}=i;let l;o.measureType===p.L.Direct?(l=function(e,t){const i=e.directSegment.eval(.5,b.rq.get()),n=t.worldUpAtPosition(i,b.rq.get()),s=e.dimensionSegment.eval(.5,b.rq.get()),r=(0,w.z)(b.rq.get(),s,i);return!(0,w.G)(r,S.uY)&&(0,w.m)(r,n)>0}(a,n)===s.z>r.z,t===p.L.Horizontal&&(l=!l)):l=!function(e){const{startRenderSpace:t,endRenderSpace:i}=e.dimensionSegment,{startRenderSpace:n,endRenderSpace:s}=e.directSegment;return(0,w.w)(n,t)<(0,w.w)(s,i)}(a);const[c,u]=l?[s,r]:[r,s],d=(0,C.EL)(u,L);return t===p.L.Horizontal?d.z=c.z:(d.x=c.x,d.y=c.y),n.toRenderCoords(c,e.startRenderSpace),n.toRenderCoords(d,e.endRenderSpace),e}}}function I(e,t,i){return i.toRenderCoords(t.elevationAlignedStartPoint,e.startRenderSpace),i.toRenderCoords(t.elevationAlignedEndPoint,e.endRenderSpace),e}!function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(n||(n={}));const L=(0,P.T)(0,0,0,null);const k=new O.C;function H(e,t){const{measureType:i,elevationAlignedStartPoint:n,elevationAlignedEndPoint:s,directSegment:{startRenderSpace:r,endRenderSpace:o},directSegment:a,renderCoordsHelper:l}=t,c=a.eval(.5,b.rq.get()),u=l.worldUpAtPosition(c,b.rq.get()),d=l.worldBasisAtPosition(c,M._.Y,b.rq.get());switch(i){case p.L.Horizontal:(0,w.c)(e,u);break;case p.L.Vertical:(0,w.m)(r,u)<(0,w.m)(o,u)?(0,w.z)(e,o,r):(0,w.z)(e,r,o),(0,w.b)(e,e,u),(0,w.b)(e,e,u);break;case p.L.Direct:{const i=t.orientation??0;if(V({elevationAlignedStartPoint:n,elevationAlignedEndPoint:s}))(0,v.$0)(G,-(0,f.kU)(i),u),(0,w.h)(e,d,G);else{const t=(0,w.z)(b.rq.get(),o,r),n=(0,w.b)(b.rq.get(),t,u);(0,w.b)(n,n,t),(0,v.$0)(G,(0,f.kU)(i),t),(0,w.h)(e,n,G)}break}}return(0,w.G)(e,S.uY)?(0,w.c)(e,d):(0,w.n)(e,e)}const G=(0,y.vt)();function V({elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}){return null!=e&&null!=t&&e.x===t.x&&e.y===t.y}function Z(e,t){const{offsetAxis:i,offset:n,relativeToSegment:{startRenderSpace:s,endRenderSpace:r},relativeToSegment:o,renderCoordsHelper:a}=t,l=n/a.unitInMeters,[c,u]=function(e,t,i,n=0){const s=(0,w.m)(t,i),r=(0,w.m)(e,i),o=Math.abs(s-r)+n;return s>r?[o,n]:[n,o]}(s,r,i,l);return(0,w.r)(e.startRenderSpace,o.startRenderSpace,i,c),(0,w.r)(e.endRenderSpace,o.endRenderSpace,i,u),e}function F(e,t,i){const n=t.directSegment.eval(.5,b.rq.get());return i.worldUpAtPosition(n,e)}function j(e,t){const{startRenderSpace:i,endRenderSpace:n}=t.directSegment;return(0,w.z)(e,n,i)}function N(e,t,i={invert:!1}){const{startRenderSpace:n,endRenderSpace:s}=t.dimensionSegment;return i.invert?(0,w.z)(e,n,s):(0,w.z)(e,s,n)}function U(e,t){const i=e.directSegment.eval(.5,b.rq.get());return t.headingAtPosition(i,e.primaryOffsetAxis)}const B=(0,S.vt)();function q(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i}=e;if(null==t||null==i)return!1;const n=(0,x.Ce)(t,i);return null!=n&&(0,g.kM)(n,"meters").value>T.U7}function W(e){return null!=e.geometry}let $=class extends r.A{constructor(e){super(e)}initialize(){const e=(0,c.LF)((()=>this.analysisViewData.computations),(({computation:e})=>this._watchComputation(e)));this.addHandles((0,o.DQ)(e))}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return(0,_.c)(this.view)}_watchComputation(e){return(0,c.wB)((()=>A(e)),(t=>{const{measureType:i}=t;if(q(t)&&i!==p.L.Direct){const t=Math.round((0,m.oU)(T.U7,"meters","kilometers"));return a.A.getLogger(this).warnOnce(`A ${i} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${t} km. Update the measureType of the affected dimension to "direct" to display it.`),void(e.geometry=null)}const n=R(t,this.view.renderCoordsHelper,e.geometry);e.geometry=n,e.result.length=function(e,t,i){if(null==e)return null;let n;if(t===p.L.Horizontal)n=(0,D.Kt)(e.elevationAlignedStartPoint,e.elevationAlignedEndPoint);else{const{startRenderSpace:t,endRenderSpace:i}=e.dimensionSegment;n=(0,x.vp)(t,i,e.spatialReference)}if(null==n)return null;const s=t===p.L.Vertical?(0,m.jE)(n.value,n.unit,i):(0,m.Vs)(n.value,n.unit,i);return(0,g.kM)(n,s)}(n,i,this._defaultUnit)}),c.pc)}};(0,s._)([(0,u.MZ)({constructOnly:!0})],$.prototype,"analysisViewData",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],$.prototype,"view",void 0),(0,s._)([(0,u.MZ)()],$.prototype,"analysis",null),(0,s._)([(0,u.MZ)()],$.prototype,"_defaultUnit",null),$=(0,s._)([(0,d.$)("esri.views.3d.analysis.Dimension.DimensionController")],$);i(3313);var Y=i(84807),X=i(93814),Q=i(80575),J=i(23572),K=i(76982),ee=i(87368),te=i(60861);function ie(e){return(0,te._L)(e.accentColor,.5)}const ne=new X.A([127,127,127,.5]),se=6,re=5;var oe=i(12014),ae=i(59484),le=i(49190),ce=i(61506),ue=i(4498),de=i(10941),he=i(53633),pe=i(74316),me=i(31272),_e=i(33763),fe=i(75390),ge=i(16596),ve=i(66019),ye=i(10715),we=i(1912);class Se{constructor(e){this.start=e.start,this.end=e.end,this.offset=e.offset,this.heading=e.heading,this.rotation=e.rotation,this.direct=e.direct,this.horizontal=e.horizontal,this.vertical=e.vertical}manipulatorName(e){return Object.keys(this).find((t=>this.hasOwnProperty(t)&&e===this[t]))}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(e){for(const t of p.h)e(this.manipulatorForMeasureType(t),t)}manipulatorForMeasureType(e){switch(e){case p.L.Direct:return this.direct;case p.L.Horizontal:return this.horizontal;case p.L.Vertical:return this.vertical}}}class Me extends oe.q{constructor(e,t){const i=(0,ae.UM)(X.A.toUnitRGBA(ie(e.effectiveTheme))),n=[new le.M((0,pe.CM)(i,1,32,32),Ve)];super({view:e,renderObjects:n,metadata:t.metadata,available:!1,grabCursor:"crosshair",radius:5,collisionPriority:1}),this._themeHandle=(0,c.wB)((()=>({color:X.A.toUnitRGBA(ie(e.effectiveTheme))})),(e=>i.setParameters(e)))}destroy(){this._themeHandle.remove(),super.destroy()}}class be extends oe.q{constructor(e,{lineSizePt:t,material:i,metadata:n}){super({view:e,autoScaleRenderObjects:!1,collisionPriority:1,metadata:n}),this._options={calloutColor:(0,K.vt)(),lineSizePt:t,material:i},this._themeHandle=(0,c.wB)((()=>X.A.toUnitRGBA(ie(e.effectiveTheme))),(e=>{this._options.calloutColor=e,Ge(this,Pe({...this._options,metadata:this.metadata}))}),c.Vh)}update({lineSizePt:e,material:t}){this._options.lineSizePt=e,this._options.material=t,Ge(this,Pe({...this._options,metadata:this.metadata}))}destroy(){this._themeHandle.remove(),super.destroy()}}function Pe({calloutColor:e,lineSizePt:t,material:i,metadata:n}){return{calloutLength:.25*ue.PV*.8*(0,J.Lz)(t)+18,calloutColor:e,calloutWidth:2,customStateMask:Ve,discScale:.3,focusMultiplier:2,material:i,metadata:n}}function Ce(e,{computation:t,view:i}){return[(0,ve.Xt)(e,((e,n,s)=>{Oe({cancel:s,computation:t,settingHeading:!1,steps:n,view:i})})),e.events.on("immediate-click",(e=>{!function(e,t,i){const{dimension:n,geometry:s}=t;if(90===n.orientation||270===n.orientation)return n.orientation=0,void e.stopPropagation();if(null==s)return;const{renderCoordsHelper:r}=i,o=R({...A(t),orientation:90},r),a=R({...A(t),orientation:270},r);if(null==o||null==a)return;const l=U(o,r),c=U(a,r),u=Te(s,i),d=Q.ie.shortestSignedDiff(u,l),h=Q.ie.shortestSignedDiff(u,c);n.orientation=Math.abs(d)<Math.abs(h)?90:270,e.stopPropagation()}(e,t,i)}))]}function Oe(e){const{cancel:t,computation:i,settingHeading:n,steps:s,view:r}=e;if(!W(i))return;const{renderCoordsHelper:o}=r,{dimension:a,geometry:l}=i,c=(0,S.vt)(),u=Ee((0,S.vt)(),l,l.directSegment,o),d=Ie(b.rq.get(),{forHeading:n,geometry:l,renderCoordsHelper:o}),h=(0,ee.O_)(u,d,(0,ee.vt)()),p=n?a.orientation??U(l,r.renderCoordsHelper):a.orientation??0;s.next((0,ce.AA)(r,h)).next((e=>{"start"===e.action&&(0,w.c)(c,e.renderStart);const t=(0,ee.Qj)(h),i=(0,ae.FY)(c,e.renderEnd,u,t);let s=p-(0,f.KJ)(i);n||(s=function(e){const t=Q.ie.normalize(e)%90;return t<re?e-t:90-t<re?e+(90-t):e}(s)),a.orientation=s})),t.next((0,ve.VG)(a,["orientation"]))}function De(e,{computation:t,manipulatorMeasureType:i,view:n}){let s=p.L.Direct,r=0,o=0;return[e.events.on("grab-changed",(a=>{if("start"!==a.action||!W(t))return;const{dimension:l,geometry:c}=t;s=l.measureType,r=l.offset,o=l.orientation;const u=(0,w.c)(b.rq.get(),e.renderLocation);l.measureType=i,l.offset=function(e,t,i,n){const{directSegment:s}=i,r=H(b.rq.get(),{measureType:t,directSegment:s,renderCoordsHelper:n}),o=Z(k,{offsetAxis:r,offset:0,relativeToSegment:s,renderCoordsHelper:n}).eval(.5,b.rq.get()),a=(0,w.z)(b.rq.get(),e,o);return(0,w.m)(a,r)*n.unitInMeters}(u,i,c,n.renderCoordsHelper),l.orientation=0})),(0,ve.Xt)(e,((e,a,l)=>{if(!W(t))return;const{geometry:c,dimension:u}=t,{renderCoordsHelper:d}=n,h=E(Ne,i,t,d),p=H(b.rq.get(),{measureType:i,directSegment:c.directSegment,renderCoordsHelper:d}),m=(0,ce.z7)(e);a.next(m).next(xe(n,u,h,p)),l.next(m).next((e=>(u.measureType=s,u.offset=r,u.orientation=o,e)))}))]}function xe(e,t,i,n){const s=(0,w.f)(b.rq.get(),i.endRenderSpace,i.startRenderSpace);(0,w.b)(s,s,n);const r=(0,ee.O_)(i.startRenderSpace,s,(0,ee.vt)()),o=(0,ee.O_)(i.startRenderSpace,n,(0,ee.vt)()),a=t.offset;let l,c=0;const u=new ve.rh;return u.next((0,ce.AA)(e,r)).next((i=>{"start"===i.action&&(c=(0,ee.mN)(o,i.renderStart));const n=((0,ee.mN)(o,i.renderEnd)-c)*e.renderCoordsHelper.unitInMeters;t.offset=a+n,l=i})),e=>(u.execute(e),l)}function Te(e,t){const{directSegment:i}=e,{renderCoordsHelper:n}=t,s=F(b.rq.get(),e,n),r=j(b.rq.get(),e),o=(0,w.b)(b.rq.get(),r,s),{viewForward:a}=t.state.camera;(0,w.m)(o,a)>0&&(0,w.j)(o,o,-1);const l=i.eval(.5,b.rq.get());return n.headingAtPosition(l,o)}function Ae(e,t,i,{forHeading:n}){const{dimension:s,geometry:r}=t,{primaryOffsetAxis:o}=r,a=(0,w.j)(Re,o,s.offset>=0?1:-1),l=Ie(ze,{forHeading:n,geometry:r,renderCoordsHelper:i});(0,w.b)(l,l,a);const c=(0,ae.wQ)(a,l,S.uY,je);e.modelTransform=c,e.renderLocation=Ee(Ze,r,r.dimensionSegment,i)}const Re=(0,S.vt)(),ze=(0,S.vt)();function Ee(e,t,i,n){const{startRenderSpace:s,endRenderSpace:r}=i,o=function(e,t){const i=j(Le,e),n=F(ke,e,t);return(0,w.m)(i,n)>0}(t,n)?s:r;return(0,w.c)(e,o)}function Ie(e,{forHeading:t,geometry:i,renderCoordsHelper:n}){return t?F(e,i,n):N(e,i,{invert:!0})}const Le=(0,S.vt)(),ke=(0,S.vt)();function He(e){return(0,J.Lz)(e)+se}function Ge(e,t){const i=t.material??new fe.r({transparent:!0,writeDepth:!1,textureId:t.texture?.id,renderOccluded:me.m$.Opaque,isDecoration:!0}),n=t.focusMultiplier??ae.eO.focusMultiplier,s=t.calloutLength??ae.eO.calloutLength,r=ae.eO.discRadius*(t.discScale??1),o=r*n,a=(e,t)=>{const i=[0,1,2,2,3,0];return new he.V(t,[[_e.r.POSITION,new de.n([s-e,-e,0,s+e,-e,0,s+e,e,0,s-e,e,0],i,3,!0)],[_e.r.UV0,new de.n([0,0,1,0,1,1,0,1],i,2,!0)]])},l=t.calloutWidth??ae.eO.calloutWidth,c=new ge.W({width:l,color:t.calloutColor,renderOccluded:me.m$.OccludeAndTransparent,isDecoration:!0}),u=(0,pe.Z8)(c,[[0,0,0],[s-r,0,0]]),d=(0,pe.Z8)(c,[[0,0,0],[s-o,0,0]]),h=t.customStateMask??ye.SJ.None;e.collisionType={type:"disc",direction:[0,0,1],offset:[s,0,0]},e.focusMultiplier=n,e.metadata=t.metadata,e.radius=r,e.renderObjects=[new le.M(a(r,i),ye.p7.Unfocused|h),new le.M(u,ye.p7.Unfocused|h),new le.M(a(o,i),ye.p7.Focused|h),new le.M(d,ye.p7.Focused|h)]}const Ve=ye.SJ.Custom1,Ze=(0,S.vt)(),Fe=(0,S.vt)(),je=(0,y.vt)(),Ne=new O.C;var Ue,Be=i(99248),qe=i(56802),We=i(15565),$e=i(36329),Ye=i(37623),Xe=i(68660);function Qe(e,t,i){const{constraint:n,elevationAlignedStartPoint:s,elevationAlignedEndPoint:r,unconstrainedGeometry:o,view:a}=i,{dimension:l,previousConstraint:c,preConstraintProperties:u}=e;if(null==s||null==r)return;const d=()=>{"startPoint"in t?l.startPoint=t.startPoint:"endPoint"in t&&(l.endPoint=t.endPoint)};if(null==n)d(),null!=c&&null!=u&&(l.measureType=u.measureType,l.orientation=u.orientation);else switch(l.measureType=p.L.Direct,n){case Ue.Horizontal:if(n!==c&&(l.orientation=0),"startPoint"in t){const e=t.startPoint;null!=e&&(e.z=r.z),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;null!=e&&(e.z=s.z),l.endPoint=e}break;case Ue.Vertical:if(n!==c&&(l.orientation=Te(o,a)),"startPoint"in t){const e=t.startPoint;null!=e&&(e.x=r.x,e.y=r.y),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;null!=e&&(e.x=s.x,e.y=s.y),l.endPoint=e}break;case Ue.Direct:n!==c&&null!=u&&(l.orientation=u.orientation),d()}e.previousConstraint=n,e.unconstrainedGeometry=o}!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Direct=2]="Direct"}(Ue||(Ue={}));var Je=i(52789),Ke=i(8035),et=i(9921),tt=i(45101),it=i(51310),nt=i(19793),st=i(17071),rt=i(13243),ot=i(28535),at=i(51720),lt=i(54500),ct=i(15797),ut=i(53981);let dt=class extends r.A{constructor(e){super(e),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new qe.A,this._orientationManipulatorTexture=null,this._updatingHandles=new Xe.U,this._getSnappingContext=(0,$e.B)((e=>new ot.e({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new rt.p(new st.ZE("point",(0,nt.BV)(!0,!1,this.view.spatialReference)),this.view.state.viewingMode),visualizer:new Ke.s})));const{view:t}=e;this._snappingManagerResult=(0,lt.X)(t),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._focusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,it.wk)(2)}),this._constraintSnappingIndicator=new et.t({view:t,attached:!0,width:1,renderOccluded:me.m$.OccludeAndTransparent,stipplePattern:(0,it.wk)(5),isDecoration:!0});const i=X.A.toUnitRGBA(ne);this._stagedStartIndicator=new tt.I({view:t,attached:!1,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:e.view.renderCoordsHelper.spatialReference,color:i,size:10,outlineSize:0,renderOccluded:me.m$.OccludeAndTransparent,isDecoration:!0})}initialize(){const{view:e}=this;this._snappingOperation=new ct.O({view:e});const t=!e._stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this._orientationManipulatorMaterial=new fe.r({transparent:!0,writeDepth:!1,renderOccluded:me.m$.Opaque,isDecoration:!0}),this.addHandles((0,c.wB)((()=>{return{accentColor:ie(e.effectiveTheme),contrastColor:(t=e.effectiveTheme,(0,te.bJ)(t.accentColor))};var t}),(({accentColor:i,contrastColor:n})=>{const s=this._orientationManipulatorTexture,r=(0,Je.t)(e.textures,{accentColor:i,contrastColor:n,preMultiplyAlpha:t});this._orientationManipulatorMaterial.setParameters({textureId:r.texture.id}),this._orientationManipulatorTexture=r,s?.release();const o=X.A.toUnitRGBA(i);this._unfocusedOffsetManipulatorMaterial.setParameters({color:o}),this._focusedOffsetManipulatorMaterial.setParameters({color:o}),this._thinOffsetManipulatorMaterial.setParameters({color:o}),this._constraintSnappingIndicator.color=o}),c.Vh));const i=(0,c.LF)((()=>this.analysisViewData.computations),(({computation:e})=>this._createManipulators(e)));this.addHandles((0,o.DQ)(i)),this.addHandles([(0,c.wB)((()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation})),(({stagedPoint:e,stagedComputation:t})=>{if(null==t||null==e)return;const i=(0,C.EL)(e,new we.A);this._applyPointUpdate(t,{endPoint:i})}),c.OH),(0,c.wB)((()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator})),((e,t)=>{const{stagedDimension:i,selectedComputation:n,firstGrabbedManipulator:s}=e;if(i===t?.stagedDimension&&s===t?.firstGrabbedManipulator){for(const i of[n,t?.selectedComputation])if(null!=i){const t=this._computationManipulators.get(i);null!=t&&this._updateManipulators(i,t,e)}}else for(const[t,i]of this._computationManipulators)this._updateManipulators(t,i,e)}),c.pc),(0,c.wB)((()=>this.analysis.style.lineSize),(e=>{this._updateManipulatorStyle(e)}),c.Vh),(0,c.wB)((()=>this.view.state.camera),(()=>{null!=this._stagedComputation&&this._updateStagedDimensionOffset(this._stagedComputation)})),(0,c.wB)((()=>{const e=this._stagedComputation;if(!e)return null;const t=e.elevationAlignedStartPoint,i=(0,S.vt)();return null!=t&&this.view.renderCoordsHelper.toRenderCoords(t,i)?i:null}),(e=>{null!=e?(this._stagedStartIndicator.vertices=[e],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1}))]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),(0,ut.BY)(this,(()=>{const e=this._activeComputation,t=this._stagedComputation;if(null==e||null!=t){const e=this.view.inputManager.latestPointerType??"mouse",t=this._getSnappingContext(e);this._updatingHandles.addPromise((0,Ye.QZ)(this._snappingOperation.snapAgainNearPreviousMapPoint(this._snappingManager,t)))}if(null!=e){const{start:t,end:i}=this._computationManipulators.get(e);if(t.grabbing||i.grabbing){!function(e,t,{constraint:i,view:n}){const{unconstrainedGeometry:s}=e;if(null==s)return;const{renderCoordsHelper:r,spatialReference:o}=n,{startRenderSpace:a,endRenderSpace:l}=s.directSegment,c=r.fromRenderCoords(a,new we.A({spatialReference:o})),u=r.fromRenderCoords(l,new we.A({spatialReference:o}));let d;d="start"===t?{startPoint:c}:{endPoint:u},Qe(e,d,{constraint:i,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,unconstrainedGeometry:s,view:n})}(e,t.grabbing?"start":"end",{constraint:this._computeConstraint(e),view:this.view})}}}))}destroy(){this._snappingOperation=(0,l.pR)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),this._orientationManipulatorTexture?.release()}get updating(){return this._updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get snappingOptions(){return this._snappingManager.options}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if(null!=this._stagedComputation)return this._stagedComputation;const{selectedComputation:e}=this.analysisViewData;return this.hasGrabbedManipulators&&null!=e?e:null}get _stagedComputation(){const e=this._stagedDimension,t=this.analysisViewData.computations.at(-1)?.computation;return null==e||null==t||t.dimension!==e?null:t}get _constraintHandles(){return[(0,c.z7)((()=>this.analysisViewData.selectedComputation),(e=>{e.previousConstraint=this._computeConstraint(e)}),{...c.pc,equals:We.aI}),(0,c.wB)((()=>{const e=this._activeComputation;if(null==e)return null;const{measureType:t,orientation:i}=e.dimension;return{measureType:t,orientation:i,computation:e}}),((e,t)=>{if(null!=e&&null==t){const{measureType:t,orientation:i,computation:n}=e;switch(n.previousConstraint){case Ue.Horizontal:n.preConstraintProperties={measureType:p.L.Horizontal,orientation:0};break;case Ue.Vertical:n.preConstraintProperties={measureType:p.L.Vertical,orientation:0};break;case Ue.Direct:n.preConstraintProperties={measureType:p.L.Direct,orientation:i};break;default:n.preConstraintProperties={measureType:t,orientation:i}}}null==e&&null!=t&&(t.computation.preConstraintProperties=null)}),c.OH)]}get _snappingIndicatorHandles(){const e="snapping-indicator-event-handles";return[(0,c.wB)((()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation})),(({stagedComputation:t,activeComputation:i})=>{const n=this._constraintSnappingIndicator;if(this.removeHandles(e),null!=i)if(i===t)n.attached=!0;else{const{start:t,end:s}=this._computationManipulators.get(i),r=()=>{n.attached=t.grabbing||s.grabbing};r(),this.addHandles([t.events.on("grab-changed",r),s.events.on("grab-changed",r)],e)}else n.attached=!1})),(0,c.wB)((()=>{const e=this._activeComputation;return null!=e?{geometry:e.geometry,constraint:e.previousConstraint}:{}}),(({geometry:e,constraint:t})=>{const i=this._constraintSnappingIndicator;null!=e&&null!=t&&t!==Ue.Direct?(i.visible=!0,i.setGeometryFromSegment(e.directSegment)):i.visible=!1}))]}removeStaged(){return null!=this._stagedDimension&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(e){const{_stagedDimension:t}=this;if(null==t){const t=this._onUnstagedClick(e);return this.analysis.dimensions.add(t),null}return this._onStagedClick(e),t}onPointerMove({mapPoint:e,pointerType:t}){if("touch"===t)return;const i=this._getSnappingContext(t);this._updatingHandles.addPromise((0,Ye.QZ)(this._snappingOperation.snap({point:e},this._snappingManager,i)))}onManipulatorSelectionChanged(){null!=this.analysisViewData.selectedComputation&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick({mapPoint:e,pointerType:t}){let i=e;if("mouse"===t){const n=this._getSnappingContext(t);i=this._snappingManager.update({point:e,context:n})}const n=new Be.A({startPoint:(0,C.EL)(i,new we.A),endPoint:null,measureType:p.L.Horizontal});return this._stagedDimension=n,this._resetSnappingState(),n}_onStagedClick({mapPoint:e,pointerType:t}){const i=this._stagedComputation;if(null==i)return;let n=e;if("mouse"===t){const i=this._getSnappingContext(t);n=this._snappingManager.update({point:e,context:i})}const s=(0,C.EL)(n,new we.A);this._applyPointUpdate(i,{endPoint:s}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_createManipulators(e){const t=this._setupPointManipulator(e,{isStart:!0}),i=this._setupPointManipulator(e,{isStart:!1}),n=this._setupOffsetManipulator(e),s=this._setupHeadingManipulator(e),r=this._setupRotationManipulator(e),o=this._setupMeasureTypeManipulator(e,p.L.Direct),a=this._setupMeasureTypeManipulator(e,p.L.Horizontal),l=this._setupMeasureTypeManipulator(e,p.L.Vertical),c=new Se({start:t,end:i,offset:n,heading:s,rotation:r,direct:o,horizontal:a,vertical:l});return this._setupComputationToManipulatorsSync(e,c),this._computationManipulators.set(e,c),this.manipulators.addMany(c.values()),{manipulators:c,remove:()=>{this._computationHandles.remove(e),this._computationManipulators.delete(e);for(const e of c.values())this.manipulators.remove(e)}}}_setupComputationToManipulatorsSync(e,t){this._computationHandles.add([(0,c.wB)((()=>e.geometry),(()=>this._updateManipulators(e,t)),{...c.pc,equals:We.aI})],e)}_setupPointManipulator(e,t){const{view:i}=this,{dimension:n}=e,s=new Me(i,{metadata:n}),r=function(e,{isStart:t,createSnappingPipelineStep:i,dimension:n,onUpdate:s,view:r}){const o=t?"startPoint":"endPoint",a=(0,ve.Xt)(e,((e,t,a,l)=>{const c=(0,ce.z7)(e),{snappingStep:u,cancelSnapping:d}=i(l);a=a.next(c).next((0,ve.VG)(n,[o,"measureType","orientation"])).next(d),t.next(c).next((0,ce.xk)(r)).next(...u).next((e=>{const t=(0,C.EL)(e.mapEnd,new we.A);s("startPoint"===o?{startPoint:t}:{endPoint:t})}))}));return[a]}(s,{isStart:t.isStart,createSnappingPipelineStep:e=>(0,at.L)({snappingContext:this._getSnappingContext(e),snappingManager:this._snappingManager,updatingHandles:this._updatingHandles}),dimension:n,onUpdate:t=>this._applyPointUpdate(e,t),view:i});return this._computationHandles.add(r,e),s}_setupOffsetManipulator(e){const{view:t}=this,i=function(e,t){const i=[(0,S.fA)(-.5,0,0),(0,S.fA)(.5,0,0)],n=(0,pe.Z8)(t.unfocusedMaterial,i.map((e=>(0,w.j)((0,S.vt)(),e,.5)))),s=n.instantiate({material:t.focusedMaterial});return new oe.q({view:e,renderObjects:[new le.M(n,ye.p7.Unfocused|ye.p7.Selected|Ve),new le.M(s,ye.p7.Focused|Ve)],collisionType:{type:"line",paths:[i]},radius:He(t.lineSizePt)/2,metadata:t.metadata,available:!1,...ae.MO})}(t,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:e.dimension}),n=function(e,{computation:t,view:i}){return[(0,ve.Xt)(e,((e,n,s)=>{if(!W(t)||!e.selected)return;const{geometry:r,dimension:o}=t,a=(0,ce.z7)(e);n.next(a).next(xe(i,o,r.dimensionSegment,r.primaryOffsetAxis)),s.next(a).next((0,ve.VG)(o,["offset"]))}))]}(i,{computation:e,view:t});return this._computationHandles.add(n,e),i}_setupHeadingManipulator(e){const{view:t}=this,i=new be(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),n=function(e,{computation:t,view:i}){return[(0,ve.Xt)(e,((e,n,s)=>{Oe({cancel:s,computation:t,settingHeading:!0,steps:n,view:i})}))]}(i,{computation:e,view:t});return this._computationHandles.add(n,e),i}_setupRotationManipulator(e){const{view:t}=this,i=new be(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),n=Ce(i,{computation:e,view:t});return this._computationHandles.add(n,e),i}_setupMeasureTypeManipulator(e,t){const{view:i}=this,n=function(e,t){const i=[(0,S.fA)(-.5,0,0),(0,S.fA)(.5,0,0)],n=(0,pe.Z8)(t.thinOffsetManipulatorMaterial,i),s=(0,pe.Z8)(t.unfocusedMaterial,i.map((e=>(0,w.j)((0,S.vt)(),e,.5)))),r=s.instantiate({material:t.focusedMaterial});return new oe.q({view:e,renderObjects:[new le.M(s,ye.p7.Unfocused|Ve),new le.M(r,ye.p7.Focused|Ve),new le.M(n,Ve)],collisionType:{type:"line",paths:[i]},radius:He(t.lineSizePt)/2,available:!1,metadata:t.metadata,...ae.MO})}(i,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:e.dimension}),s=De(n,{computation:e,manipulatorMeasureType:t,view:i});return this._computationHandles.add(s,e),n}_updateManipulators(e,t,i={stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}){const{stagedDimension:n,selectedComputation:s,firstGrabbedManipulator:r}=i,{start:o,end:a,offset:l,heading:c,rotation:u}=t,d=s===e,h=W(e),{dimension:m}=e;for(const e of t.values()){const t=h&&null==n&&(null==r||e===r);e===l?(e.available=t,e.selected=d):e.available=t&&d}if(!h)return;null!=this._computeConstraint(e)?t.forEachMeasureTypeManipulator((e=>e.available=!1)):t.manipulatorForMeasureType(m.measureType).available=!1;for(const e of[c,u])m.measureType===p.L.Direct&&0!==m.offset||(e.available=!1);V(e)?u.available=!1:c.available=!1;const{geometry:_}=e;o.renderLocation=_.directSegment.startRenderSpace,a.renderLocation=_.directSegment.endRenderSpace;const{renderCoordsHelper:f}=this.view;(function(e,t,i){const{dimensionSegment:n,primaryOffsetAxis:s}=t,r=N(Ze,t),o=(0,w.e)(r,S.uY)?(0,v.D_)(je):(0,ae.wQ)(r,s,S.uY,je),a=Math.max((0,w.l)(r),.1/i.unitInMeters);(0,v.hs)(o,o,(0,w.s)(Ze,a,a,a)),e.modelTransform=o,e.renderLocation=n.eval(.5,Ze)})(l,_,f),c.available&&function(e,t,i){Ae(e,t,i,{forHeading:!0})}(c,e,f),u.available&&function(e,t,i){Ae(e,t,i,{forHeading:!1})}(u,e,f),t.forEachMeasureTypeManipulator(((t,i)=>{t.available&&function(e,t,i,n){const{geometry:s}=t,r=E(Ne,i,t,n),o=H(Ze,{measureType:i,directSegment:s.directSegment,renderCoordsHelper:n}),a=(0,w.z)(Fe,r.endRenderSpace,r.startRenderSpace),l=(0,ae.wQ)(a,o,S.uY,je),c=(0,w.l)(a);(0,v.hs)(l,l,(0,w.s)(Fe,c,c,c)),e.modelTransform=l,e.renderLocation=r.eval(.5,Fe)}(t,e,i,f)}))}_updateManipulatorStyle(e){const t=function(e){return(0,J.Lz)(e)+4}(e),i=He(e),n={lineSizePt:e,material:this._orientationManipulatorMaterial};for(const{offset:e,heading:t,rotation:s}of this._computationManipulators.values())e.radius=i/2,t.update(n),s.update(n);this._unfocusedOffsetManipulatorMaterial.setParameters({width:t}),this._focusedOffsetManipulatorMaterial.setParameters({width:i})}_applyPointUpdate(e,t){const{view:i}=this,n=A(e);"startPoint"in t&&(n.elevationAlignedStartPoint=t.startPoint),"endPoint"in t&&(n.elevationAlignedEndPoint=t.endPoint);const s=R(n,i.renderCoordsHelper);if(null==s)return;const r=this._computeConstraint({...n,geometry:s});Qe(e,t,{...n,constraint:r,unconstrainedGeometry:s,view:i}),e===this._stagedComputation&&this._updateStagedDimensionOffset(e)}_updateStagedDimensionOffset(e){if(null==e.geometry)return;e.geometry.directSegment.eval(.5,ht);const t=this.view.state.camera.computeScreenPixelSizeAt(ht);e.dimension.offset=50*t}_computeConstraint(e){return function(e,t){if(q(e))return Ue.Direct;if(!e.enabled)return null;const{geometry:i}=e;if(null==i||(0,w.e)(i.directSegment.startRenderSpace,i.directSegment.endRenderSpace))return null;const{camera:n}=t.state,s=F(b.rq.get(),i,t.renderCoordsHelper),r=j(b.rq.get(),i),o=(0,w.j)(b.rq.get(),s,(0,w.m)(r,s)),a=(0,w.f)(b.rq.get(),r,o),l=(0,w.q)(a),c=(0,w.q)(o),{startRenderSpace:u,endRenderSpace:d}=i.directSegment,h=Math.max(10*n.computeScreenPixelSizeAt(u),10*n.computeScreenPixelSizeAt(d))**2;return l<h?Ue.Vertical:c<h?Ue.Horizontal:null}(function(e,t){return{enabled:t.effectiveFeatureEnabled,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,geometry:e.geometry}}(e,this._snappingManager.options),this.view)}_createOffsetManipulatorMaterial(){return new ge.W({width:1,renderOccluded:me.m$.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0,isDecoration:!0})}get testInfo(){}};(0,s._)([(0,u.MZ)({constructOnly:!0})],dt.prototype,"analysis",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],dt.prototype,"analysisViewData",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],dt.prototype,"manipulators",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],dt.prototype,"parentTool",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],dt.prototype,"view",void 0),(0,s._)([(0,u.MZ)({readOnly:!0})],dt.prototype,"updating",null),(0,s._)([(0,u.MZ)()],dt.prototype,"firstGrabbedManipulator",null),(0,s._)([(0,u.MZ)()],dt.prototype,"hasGrabbedManipulators",null),(0,s._)([(0,u.MZ)()],dt.prototype,"snappingOptions",null),(0,s._)([(0,u.MZ)()],dt.prototype,"_stagedDimension",void 0),(0,s._)([(0,u.MZ)()],dt.prototype,"_activeComputation",null),(0,s._)([(0,u.MZ)()],dt.prototype,"_stagedComputation",null),dt=(0,s._)([(0,d.$)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],dt);const ht=(0,S.vt)();var pt,mt=i(68574),_t=i(92750),ft=i(57966),gt=i(20405);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(pt||(pt={}));let vt=class extends mt.k{constructor(e){super(e),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=2500,this._prevPointerMoveTimeout=null}initialize(){this._intersector=(0,ft.T)(this.view.state.viewingMode),this._lengthDimensionSubTool=new dt({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,o.DQ)(this._lengthDimensionSubTool),(0,o.hA)((()=>this._clearPointerMoveTimeout())),(0,c.wB)((()=>this.state),(e=>{e===pt.Created&&this.finishToolCreation()}),c.pc),(0,c.z7)((()=>this.firstGrabbedManipulator),(e=>{this.selectedDimension=e.metadata}),c.pc),(0,c.wB)((()=>this.selectedDimension),(()=>this._resetPointerMoveTimeout()),c.pc)])}get state(){return this.analysis.dimensions.some((e=>"length"===e.type))?null!=this._activeSubTool?pt.Creating:pt.Created:pt.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(e){this.analysisViewData.selectedDimension=e}onInputEvent(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":if(_t.NE.cancel===e.key){if(null!=this._activeSubTool&&this._activeSubTool.removeStaged())return void e.stopPropagation();this.active||(this.selectedDimension=null)}else _t.NE.delete.includes(e.key)&&this._deleteKeyHandler()}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){null!=this._activeSubTool&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(e){if(this.hasFocusedManipulators)return void e.stopPropagation();if(null==this._activeSubTool)return;const t=this._intersectScreen(e);null!=t&&(this.selectedDimension=this._activeSubTool.onClick({mapPoint:t,pointerType:e.pointerType}),e.stopPropagation())}_doubleClickHandler(e){this.active&&(this.view.activeTool=null,e.stopPropagation())}_pointerMoveHandler(e){if(this._resetPointerMoveTimeout(),null==this._activeSubTool)return;if(this.hasFocusedManipulators)return;const t=this._intersectScreen(e);null!=t&&this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType})}_deleteKeyHandler(){null!=this._activeSubTool&&this._activeSubTool.removeStaged(),this._removeSelected()}_intersectScreen(e){const t=(0,gt.sC)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);const i=this._intersector.results.min,n=b.rq.get();return i.getIntersectionPoint(n)?this.view.renderCoordsHelper.fromRenderCoords(n,new we.A({spatialReference:this.view.spatialReference})):null}_removeSelected(){null!=this.selectedDimension&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,l.xt)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach((e=>e.manipulator.state|=Ve)),this._prevPointerMoveTimeout=Y.p.setTimeout((()=>{this.manipulators.forEach((e=>e.manipulator.state&=~Ve))}),this._pointerMoveTimerMs)}get testInfo(){}};(0,s._)([(0,u.MZ)({constructOnly:!0})],vt.prototype,"view",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],vt.prototype,"analysis",void 0),(0,s._)([(0,u.MZ)({readOnly:!0})],vt.prototype,"state",null),(0,s._)([(0,u.MZ)({readOnly:!0})],vt.prototype,"updating",null),(0,s._)([(0,u.MZ)({readOnly:!0})],vt.prototype,"cursor",null),(0,s._)([(0,u.MZ)({constructOnly:!0})],vt.prototype,"analysisViewData",void 0),(0,s._)([(0,u.MZ)()],vt.prototype,"selectedDimension",null),(0,s._)([(0,u.MZ)()],vt.prototype,"automaticManipulatorSelection",void 0),(0,s._)([(0,u.MZ)()],vt.prototype,"_activeSubTool",void 0),(0,s._)([(0,u.MZ)()],vt.prototype,"_lengthDimensionSubTool",void 0),vt=(0,s._)([(0,d.$)("esri.views.3d.analysis.Dimension.DimensionTool")],vt);i(39553);var yt=i(37902),wt=i(41384),St=i(53357),Mt=i(87795),bt=i(41410),Pt=i(61155);class Ct extends Mt.X{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._renderOccluded=me.m$.OccludeAndTransparent,this._width=1,this._color=(0,St.fA)(1,0,1,1),this._placement="end",this._markerPrimitive="arrow",this._material=t,this._hasExternalMaterial=null!=t,this.applyProperties(e)}setGeometryFromSegment(e,t){const i=e.endRenderSpace;this.transform=(0,v.kN)(Ot,i),this._normal=t;const{points:n}=e.createRenderGeometry(i,this.view.renderCoordsHelper);this.geometry=[n]}get renderOccluded(){return null!=this._material?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(e){this._renderOccluded=e,null!=this._material&&this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get normal(){return this._normal}set normal(e){this._normal=e,this.recreateGeometry()}get width(){return null!=this._material?this._material.parameters.width:this._width}set width(e){this._width=e,null!=this._material&&this._material.setParameters({width:e})}get color(){return null!=this._material?this._material.parameters.color:this._color}set color(e){this._color=(0,St.o8)(e),null!=this._material&&this._material.setParameters({color:this._color})}get placement(){return null!=this._material?this._material.parameters.placement:this._placement}set placement(e){this._placement=e,null!=this._material&&this._material.setParameters({placement:this._placement})}get markerPrimitive(){return this._material?.parameters.markerPrimitive??this._markerPrimitive}set markerPrimitive(e){this._markerPrimitive=e,null!=this._material&&this._material.setParameters({markerPrimitive:e})}createExternalResources(){this._hasExternalMaterial||(this._material=new Pt.i({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,markerPrimitive:this._markerPrimitive,isDecoration:this.isDecoration}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(e){for(const t of(0,bt.z)(this.geometry,this.normal)){const i=(0,bt.t)(this._material,t);e.addGeometry(i)}}forEachExternalMaterial(e){this._hasExternalMaterial||e(this._material)}}const Ot=(0,y.vt)();class Dt{set visible(e){for(const t of this._visualElements.values())t.attached=e}constructor(e){this.destroyed=!1,this._handles=new qe.A,this._messages=null,this._labelSegment=new O.C;const{analysis:t,computation:i,view:n,messages:s,isDecoration:r}=e;this.analysis=t,this.computation=i,this.view=n,this._messages=s;const o=e.visible,a={view:n,attached:o,isDecoration:r},{fontSize:l,textColor:u,textBackgroundColor:d}=t.style;this._visualElements=new Rt({marker:new Ct(a,e.markerMaterial),dimension:new et.t(a,e.dimensionLineMaterial),startOffset:new et.t(a,e.offsetLineMaterial),endOffset:new et.t(a,e.offsetLineMaterial),dimensionSmall:new et.t(a,e.smallDimensionLineMaterial),startOffsetSmall:new et.t(a,e.smallOffsetLineMaterial),endOffsetSmall:new et.t(a,e.smallOffsetLineMaterial),label:new wt.N({view:n,attached:o,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,J.Lz)(l),textColor:u.clone(),backgroundColor:d.clone(),isDecoration:r})}),this._handles.add([(0,c.wB)((()=>i.geometry),(e=>{this.updateCameraDependentElements(n.state.camera,e,t.style),null!=i.geometry&&this._updateLines(i.geometry)}),{...c.Vh,equals:We.aI}),(0,c.wB)((()=>i.length),(e=>this._updateLabelContent(e)),c.Vh)])}destroy(){this.destroyed=!0,this._handles=(0,l.pR)(this._handles);for(const e of this._visualElements.values())e.destroy()}get testInfo(){}_updateLines(e){const t=z(xt,n.Start,e.directSegment,e.dimensionSegment),i=z(Tt,n.End,e.directSegment,e.dimensionSegment),s=this._visualElements;s.marker.setGeometryFromSegment(e.dimensionSegment,e.primaryOffsetAxis),s.dimension.setGeometryFromSegment(e.dimensionSegment),s.startOffset.setGeometryFromSegment(t),s.endOffset.setGeometryFromSegment(i),s.dimensionSmall.setGeometryFromSegment(e.dimensionSegment),s.startOffsetSmall.setGeometryFromSegment(t),s.endOffsetSmall.setGeometryFromSegment(i)}updateCameraDependentElements(e,t,i){const n=this._visualElements;if(null==t){for(const e of n.values())e.visible=!1;return}const s=e.computeScreenPixelSizeAt(t.dimensionSegment.eval(.5,At)),r=function(e,t){return(0,w.q)(N(B,e))/t**2}(t,s),o=r<(2*(0,J.Lz)(i.lineSize))**2,a=!o;n.marker.visible=a,n.dimension.visible=a,n.startOffset.visible=a,n.endOffset.visible=a,n.dimensionSmall.visible=o,n.startOffsetSmall.visible=o,n.endOffsetSmall.visible=o;const l=5*(0,J.Lz)(i.fontSize),{label:c}=n;if(c.visible=r>=l**2,!c.visible)return;const{dimensionSegment:u,primaryOffsetAxis:d}=t,{offset:h}=this.computation.dimension,p=(Math.sign(h)>=0?1:-1)*function(e){return 1.5*(0,J.Lz)(e.fontSize)+20+(0,J.Lz)(e.lineSize/2)}(i)*s;(function(e,t,i,n){(0,w.r)(e.startRenderSpace,t.startRenderSpace,i,n),(0,w.r)(e.endRenderSpace,t.endRenderSpace,i,n)})(this._labelSegment,u,d,p),c.updateLabelPosition()}updateLabelStyle(e){const{label:t}=this._visualElements;t.fontSize=(0,J.Lz)(e.fontSize),t.textColor=e.textColor,t.backgroundColor=e.textBackgroundColor}updateUnitsMessages(e){this._messages=e;const{length:t}=this.computation;this._updateLabelContent(t)}_updateLabelContent(e){const{label:t}=this._visualElements;null!=e&&null!=this._messages?t.text=(0,yt.zJ)(this._messages,e,e.unit):t.text=""}}const xt=new O.C,Tt=new O.C,At=(0,S.vt)();class Rt{constructor(e){this.marker=e.marker,this.dimension=e.dimension,this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.dimensionSmall=e.dimensionSmall,this.startOffsetSmall=e.startOffsetSmall,this.endOffsetSmall=e.endOffsetSmall,this.label=e.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}var zt=i(18994),Et=i(4631),It=i(10709);let Lt=class extends r.A{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(e){super(e),this.loadingMessages=!1,this._messages=null}initialize(){const e=this.isDecoration;this._markerMaterial=new Pt.i({width:1,anchor:zt.kJ.Tip,color:K.uY,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:me.m$.OccludeAndTransparent,markerPrimitive:"triangle",isDecoration:e}),this._dimensionLineMaterial=new ge.W({width:1,color:K.uY,renderOccluded:me.m$.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters,isDecoration:e}),this._offsetLineMaterial=new ge.W({width:1,color:K.uY,renderOccluded:me.m$.OccludeAndTransparent,stipplePattern:(0,it.wk)(5),isDecoration:e}),this._smallDimensionLineMaterial=new ge.W({width:1,color:K.uY,renderOccluded:me.m$.OccludeAndTransparent,isDecoration:e}),this._smallOffsetLineMaterial=new ge.W({width:1,color:K.uY,renderOccluded:me.m$.OccludeAndTransparent,stipplePattern:(0,it.wk)(5),isDecoration:e});for(const e of this._lineMaterials())this.view._stage.add(e),this.addHandles((0,o.hA)((()=>{this.view._stage?.remove(e)})));const t=(0,c.LF)((()=>this.analysisViewData.computations),(({computation:e})=>this._createVisualization(e)));this._dimensionVisualizations=t,this.addHandles([(0,o.DQ)(t),(0,c.wB)((()=>X.A.toUnitRGBA(this.analysis.style.color)),(e=>{for(const t of this._lineMaterials())t.setParameters({color:e})}),c.pc),(0,c.wB)((()=>this.analysis.style.lineSize),(e=>{const t=(0,J.Lz)(e);this._markerMaterial.setParameters({width:.8*t}),this._dimensionLineMaterial.setParameters({width:t,markerParameters:this._markerMaterial.parameters});const i=Math.max(.25*t,1);this._offsetLineMaterial.setParameters({width:i})}),c.pc),(0,c.wB)((()=>({camera:this.view.state.camera,style:kt(this.analysis)})),(({camera:e,style:t})=>{for(const{visualization:i}of this._dimensionVisualizations)i.updateCameraDependentElements(e,i.computation.geometry,t),i.updateLabelStyle(t)})),(0,c.wB)((()=>this.visible),(e=>{for(const{visualization:t}of this._dimensionVisualizations)t.visible=e}))]),this.addHandles([(0,Et.oQ)((()=>this._updateMessageBundle())),(0,c.z7)((()=>!this.loadingMessages),(()=>{for(const{visualization:e}of this._dimensionVisualizations)e.updateUnitsMessages(this._messages)}),c.OH)]),this._updateMessageBundle()}get testInfo(){}_createVisualization(e){const t=new Dt({analysis:this.analysis,computation:e,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages,isDecoration:this.isDecoration});return{visualization:t,remove:()=>t.destroy()}}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await(0,It.ud)("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function kt(e){const{fontSize:t,lineSize:i,textColor:n,textBackgroundColor:s}=e.style;return{fontSize:t,lineSize:i,textBackgroundColor:s.clone(),textColor:n.clone()}}(0,s._)([(0,u.MZ)({constructOnly:!0})],Lt.prototype,"analysisViewData",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Lt.prototype,"view",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],Lt.prototype,"isDecoration",void 0),(0,s._)([(0,u.MZ)()],Lt.prototype,"analysis",null),(0,s._)([(0,u.MZ)()],Lt.prototype,"visible",null),(0,s._)([(0,u.MZ)()],Lt.prototype,"loadingMessages",void 0),Lt=(0,s._)([(0,d.$)("esri.views.3d.analysis.Dimension.DimensionVisualization")],Lt);let Ht=class extends r.A{constructor(e){super(e),this.dimension=null,this.length=null}};(0,s._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Ht.prototype,"dimension",void 0),(0,s._)([(0,u.MZ)()],Ht.prototype,"length",void 0),Ht=(0,s._)([(0,d.$)("esri.views.analysis.LengthDimensionResult")],Ht);const Gt=Ht;let Vt=class extends r.A{constructor(e){super(e),this.geometry=null,this.unconstrainedGeometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(e){const{dimension:t,...i}=e;return{result:new Gt({dimension:t}),...i}}initialize(){this.addHandles([(0,c.wB)((()=>this.dimension.startPoint),(e=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(e)),c.pc),(0,c.wB)((()=>this.dimension.endPoint),(e=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(e)),c.pc)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};(0,s._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Vt.prototype,"result",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Vt.prototype,"projectAndAlignPoint",void 0),(0,s._)([(0,u.MZ)()],Vt.prototype,"dimension",null),(0,s._)([(0,u.MZ)()],Vt.prototype,"length",null),(0,s._)([(0,u.MZ)()],Vt.prototype,"geometry",void 0),(0,s._)([(0,u.MZ)()],Vt.prototype,"unconstrainedGeometry",void 0),(0,s._)([(0,u.MZ)()],Vt.prototype,"elevationAlignedStartPoint",void 0),(0,s._)([(0,u.MZ)()],Vt.prototype,"elevationAlignedEndPoint",void 0),(0,s._)([(0,u.MZ)()],Vt.prototype,"preConstraintProperties",void 0),(0,s._)([(0,u.MZ)()],Vt.prototype,"previousConstraint",void 0),Vt=(0,s._)([(0,d.$)("esri.views.3d.analysis.Dimension.LengthDimensionComputation")],Vt);var Zt=i(5751),Ft=i(5495),jt=i(40377);const Nt=e=>{let t=class extends e{constructor(...e){super(...e),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null}get results(){return new jt.A}createLengthDimensions(e){throw new Error("Method not implemented.")}};return(0,s._)([(0,u.MZ)({constructOnly:!0})],t.prototype,"view",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],t.prototype,"analysis",void 0),(0,s._)([(0,u.MZ)()],t.prototype,"tool",void 0),(0,s._)([(0,u.MZ)({readOnly:!0})],t.prototype,"results",null),(0,s._)([(0,u.MZ)()],t.prototype,"selectedDimension",void 0),(0,s._)([(0,u.MZ)()],t.prototype,"interactive",void 0),(0,s._)([(0,u.MZ)()],t.prototype,"visible",void 0),t=(0,s._)([(0,d.$)("esri.views.analysis.DimensionAnalysisView")],t),t};let Ut=class extends(Nt((0,h.P)(r.A))){constructor(e){super(e),this.type="dimension-view-3d",this.tool=null,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=e=>{if(null==e)return null;const{spatialReference:t,elevationProvider:i}=this.view,n=(0,Zt.B)(e,t,i);return null==n&&(0,Zt.V)(this.analysis,e.spatialReference,a.A.getLogger(this)),n};const e=(0,c.LF)((()=>this.analysis.dimensions),(e=>this._createComputation(e)));this.computations=e,this.addHandles([(0,Ft.Hd)(this,vt),(0,o.DQ)(e)]),this._analysisVisualization=new Lt({analysisViewData:this,view:this.view,isDecoration:!this.parent}),this._analysisController=new $({analysisViewData:this,view:this.view})}destroy(){this._placementTask=(0,l.DC)(this._placementTask),this._analysisVisualization=(0,l.pR)(this._analysisVisualization),(0,Ft.aS)(this)}get updating(){return this._analysisVisualization?.loadingMessages??!1}get results(){return this.analysis.dimensions.map((e=>this._dimensionsToComputations.get(e).result))}get selectedComputation(){const{selectedDimension:e}=this;return null==e?null:this._dimensionsToComputations.get(e)}get testInfo(){}async createLengthDimensions(e){return this.selectedDimension=null,this._placementTask=(0,l.DC)(this._placementTask),this._placementTask=(0,Ft.JY)(this,e),this._placementTask.promise}_createComputation(e){const{_dimensionsToComputations:t}=this,i=new Vt({dimension:e,projectAndAlignPoint:this._projectAndAlignPoint});return t.set(e,i),{computation:i,remove:()=>this._removeComputation(i)}}_removeComputation(e){const{dimension:t}=e;t===this.selectedDimension&&(this.selectedDimension=null),this._dimensionsToComputations.delete(t),e.destroy()}};(0,s._)([(0,u.MZ)({readOnly:!0})],Ut.prototype,"type",void 0),(0,s._)([(0,u.MZ)()],Ut.prototype,"tool",void 0),(0,s._)([(0,u.MZ)()],Ut.prototype,"updating",null),(0,s._)([(0,u.MZ)({readOnly:!0})],Ut.prototype,"results",null),(0,s._)([(0,u.MZ)()],Ut.prototype,"computations",void 0),(0,s._)([(0,u.MZ)()],Ut.prototype,"selectedDimension",void 0),(0,s._)([(0,u.MZ)()],Ut.prototype,"selectedComputation",null),(0,s._)([(0,u.MZ)()],Ut.prototype,"_analysisVisualization",void 0),(0,s._)([(0,u.MZ)()],Ut.prototype,"_analysisController",void 0),(0,s._)([(0,u.MZ)()],Ut.prototype,"_dimensionsToComputations",void 0),(0,s._)([(0,u.MZ)()],Ut.prototype,"_placementTask",void 0),Ut=(0,s._)([(0,d.$)("esri.views.3d.analysis.DimensionAnalysisView3D")],Ut);const Bt=Ut},14788:(e,t,i)=>{i.d(t,{X:()=>y});var n=i(82392),s=i(73783),r=i(23377),o=i(81482),a=(i(6273),i(80861),i(67498),i(26325)),l=i(161),c=i(80561),u=i(34402);class d{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=l.O7.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;const t=this._resources?.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),t=new h({view:this._resourceFactory.view,renderGroup:this._renderGroup}),i=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new h({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:e,geometriesAdded:!1},i&&(this._resources.drapeSourceRenderer=i.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){null!=this._resources?.drapeSourceRenderer&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,c.q.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){null!=this._resources?.drapeSourceRenderer&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,c.q.UPDATE),this._resources.geometriesAdded=!0))}}let h=class extends((0,r.sA)(s.A)){constructor(e){super(e),this.drapeSourceType=l.Om.Features,this.updatePolicy=u.q.SYNC,this.renderGroup=l.O7.Outline}};(0,n._)([(0,o.MZ)({constructOnly:!0})],h.prototype,"view",void 0),(0,n._)([(0,o.MZ)({readOnly:!0})],h.prototype,"drapeSourceType",void 0),(0,n._)([(0,o.MZ)()],h.prototype,"renderGroup",void 0),h=(0,n._)([(0,a.$)("esri.views.3d.interactive.visualElements.DrapedVisualElementResources")],h);var p=i(51467),m=i(61985),_=i(61723),f=i(54909),g=i(5415);class v{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(null==this._resources||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type!==_.X.Mesh&&t.type!==_.X.Line&&t.type!==_.X.Point||e.remove(t)})),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach((t=>{t.type!==_.X.Mesh&&t.type!==_.X.Line&&t.type!==_.X.Point||e.add(t)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,i=t._stage;if(!i)return;const n=new g.x(i,{pickable:!1,updatePolicy:u.q.SYNC}),s=new f.B({castShadow:!1}),r=e.createResources(s,n);r.forEach((e=>{i.add(e),e.type===_.X.Texture&&e.load(i.renderView.renderingContext)})),i.add(s),n.add(s);const o=e.cameraChanged,a=o?(0,m.wB)((()=>t.state.camera),(e=>o(e)),m.Vh):null;this._resources={layer:n,object:s,external:r,cameraHandle:a},this._syncVisible()}_destroyResources(){if(null==this._resources)return;const e=this._resourceFactory.view._stage;e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach((t=>{e.remove(t),t.type===_.X.Texture&&t.unload()}))),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class y extends p.B{constructor(e){super(e),this._isDraped=!1,this.object3dResources=new v(this.createObject3DResourceFactory(e.view)),this.drapedResources=new d(this.createDrapedResourceFactory(e.view)),this.isDraped=e.isDraped??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}},33330:(e,t,i)=>{i.d(t,{A:()=>C,U:()=>y});i(6273);var n=i(80347),s=i(19913),r=i(74772),o=i(53357),a=i(45876),l=i(74224),c=i(94669),u=i(63918),d=i(14788),h=i(95351),p=i(14583),m=i(74316),_=i(31272),f=i(35537),g=i(33763),v=i(16596);class y extends d.X{constructor(e){super(e),this._ray=(0,u.vt)(),this._isWorldDown=!1,this._start=(0,s.vt)(),this._end=(0,s.fA)(1,0,0),this._width=1,this._color=(0,o.fA)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,o.fA)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=C.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=_.m$.OccludeAndTransparent,this._fadedExtensions=x,this._laserline=new h.o({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:w,recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:w,recreateGeometry:e=>this._recreateDrapedGeometry(e)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,n.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,n.f)(this._end,e,this._end),(0,u.Cr)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,n.e)(this._start,e)||((0,n.c)(this._start,e),(0,u.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,n.e)(this._end,e)||((0,n.c)(this._end,e),(0,u.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,r.a)(e,this._color)||((0,r.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,r.a)(e,this._innerColor)||((0,r.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){null!=e&&null!=this._stippleOffColor&&(0,r.a)(e,this._stippleOffColor)||(this._stippleOffColor=null!=e?(0,o.o8)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===_.m$.OccludeAndTransparentStencil?_.m$.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=e??x,this.recreateGeometry()}_updateMaterial(){const{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new v.W(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const n=this._createGeometry(e);i.push(n),t.addGeometry(n),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new v.W(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new f.$(t)}_createGeometry(e){const t=this.extensionType===C.FADED,i=t?[(0,s.vt)(),(0,s.vt)(),(0,s.vt)(),(0,s.vt)()]:[(0,s.vt)(),(0,s.vt)()];return(0,m.Z8)(e,i,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===C.FADED?this._updateLineSegmentFinite(P):this._updateLineSegmentInfinite(this._extensionType,P)}_updateLineSegmentFinite(e){return(0,c.Cr)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch((0,a.$e)(this._ray,S),e){case C.LINE:S.c0=-Number.MAX_VALUE;break;case C.RAY:case C.GROUND_RAY:{const e=this._ray.origin,t=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground")??0,i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&(0,n.k)(S.ray.direction,S.ray.direction),this._extensionType===C.GROUND_RAY&&null!=t&&(S.c1=Math.abs(i-t));break}}if(!(0,l.ig)(i.frustum,S))return this._updateLineSegmentFinite(t);const s=(0,a.j1)(S,M),r=(0,a.mO)(S,b);return(0,c.Cr)(s,r,t)}_updateVertexAttributesObject3D(e,t){const i=e.geometries[0].getMutableAttribute(g.r.POSITION)?.data;if(!i)return;let n=0;for(const e of this._lineVertices(t))i[n++]=e[0],i[n++]=e[1],i[n++]=e[2];e.geometryVertexAttributeUpdated(e.geometries[0],g.r.POSITION)}_updateVertexAttributesDraped(e,t){const i=e.getMutableAttribute(g.r.POSITION)?.data;if(!i)return;let n=0;for(const e of this._lineVertices(t))i[n++]=e[0],i[n++]=e[1],i[n++]=p.bi;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===C.FADED?(yield(0,c.sd)(e,-this.fadedExtensions.start,M),yield(0,c.sd)(e,0,M),yield(0,c.sd)(e,1,M),yield(0,c.sd)(e,1+this.fadedExtensions.end,M)):(yield(0,c.sd)(e,0,M),yield(0,c.sd)(e,1,M))}}function w(e){e.geometries=[]}const S=(0,a.vt)(),M=(0,s.vt)(),b=(0,s.vt)(),P=(0,c.vt)();var C,O;(O=C||(C={}))[O.LINE=0]="LINE",O[O.RAY=1]="RAY",O[O.GROUND_RAY=2]="GROUND_RAY",O[O.FADED=3]="FADED";const D=1/3,x={start:D,end:D}},41384:(e,t,i)=>{i.d(t,{N:()=>S,R:()=>b});var n=i(93814),s=i(56802),r=i(61985),o=i(23572),a=i(53334),l=i(80347),c=i(19913),u=i(51467),d=i(5073),h=i(82392),p=i(73783),m=i(81482),_=(i(6273),i(80861),i(67498),i(26325)),f=(i(2980),i(18985));i(58133);let g=class extends p.A{get startPosition(){return[this.startX,this.startY]}set startPosition(e){this._set("startX",e[0]),this._set("startY",e[1])}get endPosition(){return[this.endX,this.endY]}set endPosition(e){this._set("endX",e[0]),this._set("endY",e[1])}constructor(e){super(e),this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.width=1,this.color=[0,0,0,.5],this.visible=!0,this.isDecoration=!0}get _strokeStyle(){const e=this.color;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _lineCap(){return"round"}render(){const{height:e,left:t,top:i,width:n,x1:s,x2:r,y1:o,y2:a}=this._calculateCoordinates(v),l=`stroke: ${this._strokeStyle}; stroke-width: ${this.width}; stroke-linecap: ${this._lineCap};`;return(0,f.h)("div",{classes:{"esri-line-overlay-item":!0},styles:{left:t+"px",top:i+"px",width:n+"px",height:e+"px",visibility:this.visible?"visible":"hidden"}},[(0,f.h)("svg",{width:n,height:e},[(0,f.h)("line",{x1:s,y1:o,x2:r,y2:a,style:l})])])}renderCanvas(e){if(!this.visible)return;e.strokeStyle=this._strokeStyle,e.lineWidth=this.width,e.lineCap=this._lineCap;const t=this._calculateCoordinates(v);e.beginPath(),e.moveTo(t.left+t.x1,t.top+t.y1),e.lineTo(t.left+t.x2,t.top+t.y2),e.stroke()}_calculateCoordinates(e){const t=Math.min(this.startX,this.endX),i=Math.max(this.startX,this.endX),n=Math.min(this.startY,this.endY),s=Math.max(this.startY,this.endY),r=this.width;return e.left=t-r,e.top=n-r,e.width=i-t+2*r,e.height=Math.max(20,s-n+2*r),e.x1=this.startX-t+r,e.y1=this.startY-n+r,e.x2=this.endX-t+r,e.y2=this.endY-n+r,e}};(0,h._)([(0,m.MZ)()],g.prototype,"startX",void 0),(0,h._)([(0,m.MZ)()],g.prototype,"startY",void 0),(0,h._)([(0,m.MZ)()],g.prototype,"endX",void 0),(0,h._)([(0,m.MZ)()],g.prototype,"endY",void 0),(0,h._)([(0,m.MZ)()],g.prototype,"startPosition",null),(0,h._)([(0,m.MZ)()],g.prototype,"endPosition",null),(0,h._)([(0,m.MZ)()],g.prototype,"width",void 0),(0,h._)([(0,m.MZ)()],g.prototype,"color",void 0),(0,h._)([(0,m.MZ)()],g.prototype,"visible",void 0),(0,h._)([(0,m.MZ)()],g.prototype,"isDecoration",void 0),(0,h._)([(0,m.MZ)({readOnly:!0})],g.prototype,"_strokeStyle",null),g=(0,h._)([(0,_.$)("esri.views.overlay.LineOverlayItem")],g);const v={left:0,top:0,width:0,height:0,x1:0,y1:0,x2:0,y2:0},y=g;var w=i(73517);class S extends u.B{constructor(e){super(e),this._handles=new s.A,this._textItem=null,this._calloutItem=null,this._showCallout=!0,this._showText=!0,this._geometry=null,this._text="-",this._fontSize=14,this._backgroundColor=new n.A([0,0,0,.6]),this._calloutColor=new n.A([0,0,0,.5]),this._textColor=new n.A([255,255,255]),this._distance=25,this._anchor="right",this.updatePositionOnCameraMove=!0,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.updateLabelPosition()}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._textItem&&(this._textItem.isDecoration=e),this._calloutItem&&(this._calloutItem.isDecoration=e)}get textItem(){return this._textItem}get text(){return this._text}set text(e){this._text=e,this.attached&&(this._textItem.text=this._text)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e,this.attached&&(this._textItem.fontSize=this._fontSize)}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){this._backgroundColor=e,this.attached&&(this._textItem.backgroundColor=this._backgroundColor)}get calloutColor(){return this._calloutColor}set calloutColor(e){this._calloutColor=e,this.attached&&(this._calloutItem.color=this._calloutColor.toRgba())}get textColor(){return this._textColor}set textColor(e){this._textColor=e,this.attached&&(this._textItem.textColor=this._textColor)}get distance(){return this._distance}set distance(e){this._distance!==e&&(this._distance=e,this.updateLabelPosition())}get anchor(){return this._anchor}set anchor(e){this._anchor!==e&&(this._anchor=e,this.updateLabelPosition())}get _camera(){return this.view.state.cssCamera}overlaps(e){return!!this.attached&&this.textItem.visible&&e.textItem.visible&&!!this.view.overlay?.overlaps(this._textItem,e.textItem)}updateLabelPosition(){if(!this.attached)return;this._showText=!1,this._showCallout=!1;const{geometry:e,view:t,visible:i}=this;if(null!=e&&t._stage)switch(e.type){case"point":if(!this._computeLabelPositionFromPoint(e.point,E))break;if(e.callout){const t=this._camera,i=e.callout.distance;(0,a.WQ)(z,z,[0,e.callout.offset]),t.renderToScreen(z,E),(0,a.hZ)(T,0,1),(0,a.hs)(T,T,i),(0,a.WQ)(T,T,z),t.renderToScreen(T,I),this._showCallout=this._updatePosition(E,I)}else this._textItem.position=[E[0],E[1]],this._textItem.anchor="center";this._showText=!0;break;case"corner":if(!this._computeLabelPositionFromCorner(e,this._distance,E,I))break;this._showCallout=this._updatePosition(E,I),this._showText=!0;break;case"segment":{if(!this._computeLabelPositionFromSegment(e,this._distance,this._anchor,E,I))break;this._showText=!0;const t=this._updatePosition(E,I);this._showCallout=!1!==e.callout&&t,this._showCallout||(this._textItem.anchor="center")}}this.updateVisibility(i)}_computeLabelPositionFromPoint(e,t){const i=this._camera;return i.projectToRenderScreen(e,R),!(R[2]<0||R[2]>1||(i.renderToScreen(R,t),0))}_computeLabelPositionFromCorner(e,t,i,n){if(!e)return!1;const s=this._camera;return M(e.left,1,s,D),(0,a.ze)(D,D),M(e.right,0,s,x),(0,a.WQ)(T,D,x),(0,a.ze)(T,T),(0,a.S8)(T,T),s.projectToRenderScreen(e.left.endRenderSpace,R),!(R[2]<0||R[2]>1||(s.renderToScreen(R,i),(0,a.hs)(T,T,t),(0,a.WQ)(T,T,R),s.renderToScreen(T,n),0))}_computeLabelPositionFromSegment(e,t,i,n,s){if(!e)return!1;const r=e.segment,o=this._camera;(0,d.QO)(r.startRenderSpace,r.endRenderSpace,o,D),(0,a.hZ)(T,-D[1],D[0]);let l=!1;switch(i){case"top":l=T[1]<0;break;case"bottom":l=T[1]>0;break;case"left":l=T[0]>0;break;case"right":l=T[0]<0}if(l&&(0,a.ze)(T,T),0===(0,a.Bw)(T))switch(i){case"top":T[1]=1;break;case"bottom":T[1]=-1;break;case"left":T[0]=-1;break;case"right":T[0]=1}return r.eval(L[e.sampleLocation],A),o.projectToRenderScreen(A,R),!(R[2]<0||R[2]>1||(o.renderToScreen(R,n),(0,a.hs)(T,T,t),(0,a.WQ)(T,T,R),o.renderToScreen(T,s),0))}_updatePosition(e,t){if(t){const i=t[0]-e[0],n=t[1]-e[1];return this._textItem.position=[t[0],t[1]],this._textItem.anchor=Math.abs(i)>Math.abs(n)?i>0?"left":"right":n>0?"top":"bottom",this._calloutItem.startPosition=[e[0],e[1]],this._calloutItem.endPosition=[t[0],t[1]],!0}return this._textItem.position=[e[0],e[1]],this._textItem.anchor="center",!1}createResources(){this._textItem=new w.A({visible:!0,text:this._text,fontSize:this._fontSize,backgroundColor:this._backgroundColor,textColor:this._textColor,isDecoration:this._isDecoration}),this._calloutItem=new y({color:this._calloutColor.toRgba(),visible:!0,width:2,isDecoration:this._isDecoration}),this.updateLabelPosition(),this.view.overlay?.items.addMany([this._textItem,this._calloutItem]),this.updatePositionOnCameraMove&&this._handles.add((0,r.wB)((()=>this.view.state.camera),(()=>this.updateLabelPosition())))}destroyResources(){this.view.overlay&&!this.view.overlay.destroyed&&this.view.overlay.items.removeMany([this._textItem,this._calloutItem]),this._handles.removeAll()}updateVisibility(e){this._textItem.visible=this._showText&&e,this._calloutItem.visible=this._showCallout&&e}}function M(e,t,i,n){return e.eval(t,P,O),(0,l.g)(C,P,O),(0,d.QO)(P,C,i,n)}function b(e){switch(e){case"top":return"bottom";case"right":return"left";case"bottom":return"top";case"left":return"right"}}const P=(0,c.vt)(),C=(0,c.vt)(),O=(0,c.vt)(),D=(0,o.QG)(),x=(0,o.QG)(),T=(0,o.QG)(),A=(0,c.vt)(),R=(0,o.r_)(),z=(0,o.QG)(),E=(0,o.gs)(),I=(0,o.gs)(),L={start:0,center:.5,end:1}},58274:(e,t,i)=>{i.d(t,{C:()=>u,J:()=>d});var n=i(80347),s=i(19913),r=i(34561),o=i(32159),a=i(42722),l=i(11631),c=i(45773);class u{constructor(e=(0,s.vt)(),t=(0,s.vt)()){this.startRenderSpace=e,this.endRenderSpace=t,this.type="euclidean"}eval(e,t,i){return(0,n.o)(t,this.startRenderSpace,this.endRenderSpace,e),i&&((0,n.f)(i,this.endRenderSpace,this.startRenderSpace),(0,n.n)(i,i)),t}createRenderGeometry(e,t){const i=[],s=[],r=(t,r)=>{const o=p;(0,n.f)(o,t,e),i.push([o[0],o[1],o[2]]),s.push([r[0],r[1],r[2]])},o=t.worldUpAtPosition(this.eval(.5,h),l.rq.get());return r(this.startRenderSpace,o),r(this.endRenderSpace,o),{points:i,normals:s}}static fromPositionAndVector(e,t,i=1){return(0,n.j)(h,t,i),(0,n.g)(h,e,h),new u((0,s.o8)(e),(0,s.o8)(h))}}class d{_projectIn(e,t){this._project?(0,a.F)(e,this.renderSpatialReference,t,this._pcpf):(0,n.c)(t,e)}constructor(e,t,i){this.startRenderSpace=e,this.endRenderSpace=t,this.renderSpatialReference=i,this.type="geodesic",this._start=(0,s.vt)(),this._end=(0,s.vt)(),this._pcpf=(0,o.lO)(i),this._project=(0,r.canProjectWithoutEngine)(i,this._pcpf),this._projectIn(e,this._start),this._projectIn(t,this._end)}eval(e,t,i){if(this._project)if(i){const s=p;(0,c.is)(this._start,this._end,e,t,s),(0,n.g)(m,t,s),(0,a.F)(t,this._pcpf,t,this.renderSpatialReference),(0,a.F)(m,this._pcpf,m,this.renderSpatialReference),(0,n.f)(i,m,t),(0,n.n)(i,i)}else(0,c.nu)(this._start,this._end,e,t),(0,a.F)(t,this._pcpf,t,this.renderSpatialReference);else(0,n.o)(t,this._start,this._end,e),i&&((0,n.f)(i,this._end,this._start),(0,n.n)(i,i));return t}createRenderGeometry(e,t){const i=[],s=[],r=(t,r)=>{const o=m;(0,n.f)(o,t,e),i.push([o[0],o[1],o[2]]),s.push([r[0],r[1],r[2]])};for(let e=0;e<128;++e){const i=e/127,n=h,s=p;this.eval(i,n),t.worldUpAtPosition(n,s),r(n,s)}return{points:i,normals:s}}}const h=(0,s.vt)(),p=(0,s.vt)(),m=(0,s.vt)()},75390:(e,t,i)=>{i.d(t,{r:()=>R});var n=i(40041),s=i(77788),r=i(10875),o=i(71678),a=i(31272),l=i(8445),c=i(15449),u=i(26421),d=i(33763),h=i(66356),p=i(83938),m=i(59615),_=i(29290),f=i(82392),g=(i(41014),i(21979)),v=i(19362),y=i(51662),w=i(24441),S=i(28116),M=i(7782),b=i(18693),P=i(2296),C=i(68716),O=i(15651);class D extends v.w{initializeProgram(e){return new w.B(e.rctx,D.shader.get().build(this.configuration),A)}_setPipelineState(e,t){const i=this.configuration,n=e===M.y.NONE,r=e===M.y.FrontFace;return(0,O.Ey)({blending:i.output===s.V.Color&&i.transparent?n?x:(0,l.ez)(e):null,culling:(0,O.Xt)(i.cullFace),depthTest:{func:(0,l.K_)(e)},depthWrite:n?i.writeDepth?O.kn:null:(0,l.XO)(e),drawBuffers:(0,l.cl)(e),colorWrite:O.wE,stencilWrite:i.hasOccludees?S.v0:null,stencilTest:i.hasOccludees?t?S.a9:S.qh:null,polygonOffset:n||r?null:(0,l.aB)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}D.shader=new g.$(P.I,(()=>i.e(9832).then(i.bind(i,19832))));const x=(0,O.ox)(C.dn.ONE,C.dn.ONE_MINUS_SRC_ALPHA);class T extends b.E{constructor(){super(...arguments),this.output=s.V.Color,this.cullFace=r.s2.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=M.y.NONE,this.multipassEnabled=!1,this.cullAboveGround=!1,this.perspectiveInterpolation=!0}}(0,f._)([(0,y.W)({count:s.V.COUNT})],T.prototype,"output",void 0),(0,f._)([(0,y.W)({count:r.s2.COUNT})],T.prototype,"cullFace",void 0),(0,f._)([(0,y.W)()],T.prototype,"hasSlicePlane",void 0),(0,f._)([(0,y.W)()],T.prototype,"transparent",void 0),(0,f._)([(0,y.W)()],T.prototype,"enableOffset",void 0),(0,f._)([(0,y.W)()],T.prototype,"writeDepth",void 0),(0,f._)([(0,y.W)()],T.prototype,"hasOccludees",void 0),(0,f._)([(0,y.W)({count:M.y.COUNT})],T.prototype,"transparencyPassType",void 0),(0,f._)([(0,y.W)()],T.prototype,"multipassEnabled",void 0),(0,f._)([(0,y.W)()],T.prototype,"cullAboveGround",void 0),(0,f._)([(0,y.W)()],T.prototype,"perspectiveInterpolation",void 0),(0,f._)([(0,y.W)({constValue:!1})],T.prototype,"occlusionPass",void 0);const A=new Map([[d.r.POSITION,0],[d.r.UV0,2],[d.r.PERSPECTIVEDIVIDE,3]]);class R extends m.W{constructor(e){super(e,new I),this.supportsEdges=!0,this.produces=new Map([[c.N.OPAQUE_MATERIAL,e=>(0,s.u5)(e)||(0,s._o)(e)&&!this.parameters.transparent],[c.N.TRANSPARENT_MATERIAL,e=>(0,s._o)(e)&&this.parameters.transparent&&this.parameters.writeDepth],[c.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>(0,s._o)(e)&&this.parameters.transparent&&!this.parameters.writeDepth],[c.N.DRAPED_MATERIAL,e=>(0,s._o)(e)||(0,s.u5)(e)]]),this._vertexAttributeLocations=A,this._configuration=new T}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<l.xt,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}createGLMaterial(e){return new z(e)}createBufferWriter(){const e=p.zK.clone();return this.parameters.perspectiveInterpolation&&e.f32(d.r.PERSPECTIVEDIVIDE),new E(e)}}class z extends o.m{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(D,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}beginSlot(e){return this._output===s.V.Color&&this._updateOccludeeState(e),this._updateParameters(e)}}class E extends h.Z{write(e,t,i,s,r){for(const o of this.vertexBufferLayout.fields.keys()){const a=i.attributes.get(o);if(a)if(o===d.r.PERSPECTIVEDIVIDE){(0,u.vA)(1===a.size);const e=s.getField(o,n.Y$);e&&(0,_.uO)(a,e,r)}else(0,_.zC)(o,a,e,t,s,r)}}}class I extends a.qA{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=r.s2.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0,this.perspectiveInterpolation=!1}}},5495:(e,t,i)=>{i.d(t,{Hd:()=>l,JY:()=>a,aS:()=>c});var n=i(3132),s=i(57725),r=i(37623),o=i(61985);function a(e,t){e.interactive=!0;const{tool:i,view:a}=e;a.activeTool=i;let l=(0,r.u7)(t,(()=>{a.activeTool===i&&(a.activeTool=null)}));return(0,n.UT)((async e=>{await(0,o.C_)((()=>null==i||!i.active),e),l=(0,s.xt)(l)}),t)}function l(e,t){return(0,o.wB)((()=>e.interactive),(()=>function(e,t){e.interactive?function(e,t){c(e);const{view:i,analysis:n}=e,s=new t({view:i,analysis:n,analysisViewData:e});e.tool=s,i.tools.add(s)}(e,t):c(e)}(e,t)),o.pc)}function c(e){const{view:t,tool:i}=e;null!=i&&(t.tools.remove(i),e.tool=null)}},68574:(e,t,i)=>{i.d(t,{k:()=>a});var n=i(82392),s=i(61985),r=(i(80861),i(6273),i(67498),i(62991),i(26325)),o=i(77671);let a=class extends o.g{constructor(e){super(e)}initialize(){this.addHandles((0,s.wB)((()=>this.analysisViewData.visible),(e=>this.visible=e),s.pc))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};a=(0,n._)([(0,r.$)("esri.views.interactive.AnalysisToolBase")],a)},57966:(e,t,i)=>{i.d(t,{T:()=>r});var n=i(57809),s=i(30165);function r(e){const t=(0,n.hz)(e);return t.options.store=s.oH.MIN,t.options.hud=!1,t}},28535:(e,t,i)=>{i.d(t,{e:()=>n});class n{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.feature=e.feature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ,this.drawConstraints=e.drawConstraints}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}}},51720:(e,t,i)=>{i.d(t,{L:()=>h});var n=i(57725),s=i(37623),r=i(61985),o=i(92801),a=i(96124),l=i(19541),c=i(66019),u=i(28535),d=i(49437);function h({predicate:e=()=>!0,snappingManager:t,snappingContext:i,updatingHandles:a,useZ:h=!0}){const g=new c.rh;if(null==t)return{snappingStep:[f,g],cancelSnapping:f};let v,y=null,w=null,S=null;const M=()=>{y=(0,n.DC)(y),t.doneSnapping(),w?.frameTask.remove(),w=null,v=(0,n.xt)(v),S=null},b=(P=t,C=h,O=g,(0,s.sg)((async({frameTask:e,point:t,scenePoint:i,context:n,event:s,delta:r,getLastState:a},l)=>{const c=await e.schedule((()=>P.snap({point:t,scenePoint:i,context:n,signal:l})),l);if(c.valid){let i=await e.schedule((()=>c.apply()),l);const u=a();null!=u.point&&t!==u.point&&(i=P.update({point:u.point,scenePoint:u.scenePoint,context:n})),null!=u.updatePoint&&(0,o.CI)(i,u.updatePoint)||(_(s.mapEnd,i,r,C),O.execute(s))}})));var P,C,O;let D=null,x=null,T=null;return{snappingStep:[n=>{if(!e(n))return n;const{action:o}=n;if("start"===o){const{info:e}=n,s=function(e){return"3d"===e.type?e.resourceController.scheduler.registerTask(d.W6.SNAPPING):d.nu}(t.view);if(w=function(e,t,i){return{context:new u.e({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:null!=t.info?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:null!=t.snapOrigin?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:null!=t.scenePoints?t.scenePoints.sceneStart:null,frameTask:i}}(i,n,s),w.context.selfSnappingZ=null,!h&&null!=e){const t=function(e,t){if(!e.hasZ())return null;const i=t.vertices;let n=null;for(const t of i){const i=e.getZ(t.pos);if(null!=n&&null!=i&&Math.abs(i-n)>1e-6)return null;null==n&&(n=i)}return n}(i.coordinateHelper,e.handle.component);null!=t&&(w.context.selfSnappingZ={value:t,elevationInfo:i.elevationInfo??l.qt})}}if(null!=w){const{context:e,originalScenePos:i,originalPos:l}=w,{mapEnd:c,mapStart:u,scenePoints:d}=n,f=p(l,m(c,u)),g=m(u,l),M={...n,action:"update"},P=w.context,C=function(e,t){return null==e||null==t?null:p(e,m(t.sceneEnd,t.sceneStart))}(i,d),O=t.update({point:f,scenePoint:C,context:e});if(T=O,_(c,O,g,h),D=f,x=C,"end"!==o){const{frameTask:e}=w;null==y&&(y=new AbortController),S=t=>{a.addPromise((0,s.QZ)(b({frameTask:e,event:M,context:P,point:f,scenePoint:C,delta:g,getLastState:()=>({point:D,scenePoint:x,updatePoint:t.forceUpdate?null:T})},y.signal)))},S({forceUpdate:!1}),null==v&&(v=(0,r.wB)((()=>t.options.effectiveEnabled),(()=>S?.({forceUpdate:!0}))))}}return"end"===o&&M(),n},g],cancelSnapping:e=>(M(),e)}}function p(e,[t,i,n]){const s=(0,a.EL)(e);return s.x+=t,s.y+=i,s.hasZ&&(s.z+=n),s}function m(e,t){const i=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,i]}function _(e,t,[i,n,s],r){e.x=t.x+i,e.y=t.y+n,r&&e.hasZ&&t.hasZ&&(e.z=t.z+s)}function f(e){return e}},54500:(e,t,i)=>{i.d(t,{X:()=>p});var n=i(70214),s=i(71709),r=i(40377),o=i(61985),a=i(90876),l=i(51879),c=i(60586);var u=i(15464),d=i(40105);const h=new Map;function p(e){if(!h.has(e)){const t=function(e,t){const i=new c.A({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:t?.distance??l.N.distance,touchSensitivityMultiplier:t?.touchSensitivityMultiplier??l.N.touchSensitivityMultiplier});return{...(0,o.wB)((()=>e.map?.allLayers?.toArray()??[]),(e=>{i.featureSources=new r.A(e.map((e=>new a.A({layer:e}))))}),o.Vh),options:i}}(e,{distance:10}),i=function(e,t){return new d.g({view:e,options:t,snappingEnginesFactory:(t,i)=>[new u.f({view:e,spatialReference:e.spatialReference,options:i})]})}(e,t.options);h.set(e,{referenceCount:0,snappingManager:i,remove:()=>{t.remove(),i.destroy()}})}const t=h.get(e);t.referenceCount++;const i=(0,n.hA)((()=>function(e,t){t.referenceCount--,t.referenceCount>0||(0,s.d)((()=>{0===t.referenceCount&&(t.remove(),h.delete(e))}))}(e,t)));return{snappingManager:t.snappingManager,...i}}},15797:(e,t,i)=>{i.d(t,{O:()=>u});var n=i(82392),s=i(73783),r=i(57725),o=i(37623),a=i(81482),l=(i(6273),i(80861),i(67498),i(26325)),c=i(49437);let u=class extends s.A{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,o.sg)((async(e,t,i,n)=>{const s=this._frameTask;if(null==s)return;const r=await s.schedule((()=>t.snap({...e,context:i,signal:n})),n);r.valid&&await s.schedule((()=>{this.stagedPoint=r.apply(),e!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=t.update({...this._snapPoints,context:i}))}),n)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){const e="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=null!=e?e.registerTask(c.W6.SNAPPING):c.nu}destroy(){this._abortController=(0,r.DC)(this._abortController),this._frameTask=(0,r.xt)(this._frameTask)}update(e,t,i){this._snapPoints=e;const{point:n,scenePoint:s}=e,r=t.update({point:n,scenePoint:s,context:i});return this.stagedPoint=r,r}async snap(e,t,i){const{point:n,scenePoint:s}=e;return this.stagedPoint=t.update({point:n,scenePoint:s,context:i}),this._snapPoints=e,null==this._abortController&&(this._abortController=new AbortController),this._snap(e,t,i,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){null!=this._snapPoints&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=(0,r.DC)(this._abortController),this._snapPoints=null}};(0,n._)([(0,a.MZ)({constructOnly:!0})],u.prototype,"view",void 0),(0,n._)([(0,a.MZ)()],u.prototype,"stagedPoint",null),(0,n._)([(0,a.MZ)()],u.prototype,"constrainResult",void 0),(0,n._)([(0,a.MZ)()],u.prototype,"_stagedPoint",void 0),u=(0,n._)([(0,l.$)("esri.views.interactive.snapping.SnappingOperation")],u)},36598:(e,t,i)=>{i.d(t,{b:()=>c});var n=i(70214),s=i(46997),r=i(56142),o=i(27411),a=i(25674),l=i(43457);class c{draw(e,t){const i=function(e){const t=[];for(const i of e){let e=!0;for(const n of t)if(i.equals(n)){e=!1;break}e&&t.push(i)}return t}(e),c=this.sortUniqueHints(i),u=[];for(const e of c)e instanceof s.v&&u.push(this.visualizeIntersectionPoint(e,t)),e instanceof r.c&&u.push(this.visualizeLine(e,t)),e instanceof o.r&&u.push(this.visualizeParallelSign(e,t)),e instanceof l.l&&u.push(this.visualizeRightAngleQuad(e,t)),e instanceof a._&&u.push(this.visualizePoint(e,t));return(0,n.vE)(u)}sortUniqueHints(e){return e}}},25674:(e,t,i)=>{i.d(t,{_:()=>r});var n=i(80347),s=i(12288);class r extends s.m{constructor(e,t,i){super(t,i),this.point=e}equals(e){return e instanceof r&&(0,n.e)(this.point,e.point)}}},49970:(e,t,i)=>{i.d(t,{Do:()=>l,Kt:()=>a,ob:()=>o});var n=i(19913),s=i(68489),r=i(34664);function o(e){return(0,r.mh)(e)??(0,s.Xg)(e)}function a(e,t){return(0,r.Og)(e,t)??(0,s.ll)(e,t)}function l(e,t,i){return c[0]=e[0],c[1]=e[1],c[2]=3===e.length?e[2]:0,u[0]=t[0],u[1]=t[1],u[2]=3===t.length?t[2]:0,(0,r.n3)(c,u,i)??(0,s.sT)(c,u,i)}const c=(0,n.vt)(),u=(0,n.vt)()}}]);