"use strict";(self.webpackChunkarcgis_node=self.webpackChunkarcgis_node||[]).push([[6361],{80688:(t,e,i)=>{i.d(e,{A:()=>p});var s=i(82392),n=i(73783),a=i(3223),r=i(14755),o=i(23377),l=i(84977),u=i(81482),h=(i(6273),i(80861),i(26325));let c=0,d=class extends((0,l.Te)((0,r.O)((0,o.sA)(n.A)))){constructor(t){super(t),this.id=`${Date.now().toString(16)}-analysis-${c++}`,this.title=null}get parent(){return this._get("parent")}set parent(t){const e=this.parent;if(null!=e)switch(e.type){case"line-of-sight":case"dimension":e.releaseAnalysis(this);break;case"2d":case"3d":e.analyses.includes(this)&&e.analyses.remove(this)}this._set("parent",t)}get isEditable(){return this.requiredPropertiesForEditing.every(a.Ru)}};(0,s._)([(0,u.MZ)({type:String,constructOnly:!0,clonable:!1})],d.prototype,"id",void 0),(0,s._)([(0,u.MZ)({type:String})],d.prototype,"title",void 0),(0,s._)([(0,u.MZ)({clonable:!1,value:null})],d.prototype,"parent",null),(0,s._)([(0,u.MZ)({readOnly:!0})],d.prototype,"isEditable",null),d=(0,s._)([(0,h.$)("esri.analysis.Analysis")],d);const p=d},83303:(t,e,i)=>{var s,n;i.d(e,{f:()=>n,n:()=>s}),function(t){t[t.None=0]="None",t[t.Direct=1]="Direct",t[t.Triangle=2]="Triangle",t[t.ProjectedGeodesic=3]="ProjectedGeodesic"}(s||(s={})),function(t){t[t.Auto=0]="Auto",t[t.AboveSegment=1]="AboveSegment",t[t.BelowSegment=2]="BelowSegment"}(n||(n={}))},62169:(t,e,i)=>{var s;i.d(e,{G:()=>s}),function(t){t[t.Auto=0]="Auto",t[t.Euclidean=1]="Euclidean",t[t.Geodesic=2]="Geodesic"}(s||(s={}))},16952:(t,e,i)=>{i.d(e,{CL:()=>h,Gc:()=>d,OK:()=>u,s7:()=>p,uc:()=>l,zS:()=>c});var s=i(80347),n=i(19913),a=i(69891),r=i(45773),o=i(33701);function l(t,e){const i=(0,a.g)(e);(0,s.s)(i,0,0,0);for(let e=0;e<t.length;++e)(0,s.g)(i,i,t[e]);(0,s.j)(i,i,1/t.length);let n=0;for(let e=0;e<t.length;++e)n=Math.max(n,(0,s.a)(i,t[e]));e[3]=Math.sqrt(n)}function u(t,e){if(t.length<3)throw new Error("need at least 3 points to fit a plane");(0,r.e9)(t[0],t[1],t[2],e)}function h(t,e){return(0,s.m)(t,e)+t[3]}function c(t,e,i,n){const a=_;return(0,s.c)(a.rings[0][0],t),(0,s.c)(a.rings[0][1],e),(0,s.c)(a.rings[0][2],i),(0,s.c)(a.rings[0][3],t),a.spatialReference=n,(0,o.P)(a)}function d(t,e=null,i=!0){const n=(t,e)=>{if(0===e[0]&&0===e[1]&&0===e[2])return!1;for(let i=0;i<t.length;++i)if((0,s.m)(e,t[i])<-1e-6)return!1;return!0};if(0===t.length)return!1;if(1===t.length)return e&&(0,s.c)(e,t[0]),!0;(0,s.s)(v,0,0,0);for(let e=0;e<t.length;++e)(0,s.g)(v,v,t[e]);if((0,s.n)(v,v),n(t,v))return e&&(0,s.c)(e,v),!0;if(!i)return!1;for(let i=0;i<t.length;++i)for(let a=0;a<t.length;++a)if(i!==a&&((0,s.b)(v,t[i],t[a]),(0,s.n)(v,v),n(t,v)))return e&&(0,s.c)(e,v),!0;return!1}function p(t){return"mouse"!==t.pointerType||0===t.button}const _={hasM:!1,hasZ:!0,rings:[[(0,n.vt)(),(0,n.vt)(),(0,n.vt)(),(0,n.vt)()]],spatialReference:null,type:"polygon"},v=(0,n.vt)()},68574:(t,e,i)=>{i.d(e,{k:()=>o});var s=i(82392),n=i(61985),a=(i(80861),i(6273),i(67498),i(62991),i(26325)),r=i(6364);let o=class extends r.g{constructor(t){super(t)}initialize(){this.addHandles((0,n.wB)((()=>this.analysisViewData.visible),(t=>this.visible=t),n.pc))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};o=(0,s._)([(0,a.$)("esri.views.interactive.AnalysisToolBase")],o)},54500:(t,e,i)=>{i.d(e,{X:()=>p});var s=i(70214),n=i(71709),a=i(40377),r=i(61985),o=i(90876),l=i(51879),u=i(60586);var h=i(15464),c=i(40105);const d=new Map;function p(t){if(!d.has(t)){const e=function(t,e){const i=new u.A({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:e?.distance??l.N.distance,touchSensitivityMultiplier:e?.touchSensitivityMultiplier??l.N.touchSensitivityMultiplier});return{...(0,r.wB)((()=>t.map?.allLayers?.toArray()??[]),(t=>{i.featureSources=new a.A(t.map((t=>new o.A({layer:t}))))}),r.Vh),options:i}}(t,{distance:10}),i=function(t,e){return new c.g({view:t,options:e,snappingEnginesFactory:(e,i)=>[new h.f({view:t,spatialReference:t.spatialReference,options:i})]})}(t,e.options);d.set(t,{referenceCount:0,snappingManager:i,remove:()=>{e.remove(),i.destroy()}})}const e=d.get(t);e.referenceCount++;const i=(0,s.hA)((()=>{return i=t,(s=e).referenceCount--,void(s.referenceCount>0||(0,n.d)((()=>{0===s.referenceCount&&(s.remove(),d.delete(i))})));var i,s}));return{snappingManager:e.snappingManager,...i}}},33701:(t,e,i)=>{i.d(e,{P:()=>o});var s=i(7743),n=i(65670),a=i(22538),r=i(7540);function o(t){const{spatialReference:e}=t;return(0,r.M0)(e,l,u,t)}function l(t){return(0,s.gT)(Math.abs((0,a.qy)([t],"square-meters")[0]),"square-meters")}function u(t){try{return(0,s.gT)(Math.abs((0,n.geodesicArea)(t,"square-meters")),"square-meters")}catch(t){return null}}},6361:(t,e,i)=>{i.r(e),i.d(e,{default:()=>lt});var s=i(82392),n=i(37623),a=i(81482),r=(i(6273),i(80861),i(67498),i(26325)),o=i(52239),l=i(80688),u=i(5262),h=i(1912);let c=class extends l.A{constructor(t){super(t),this.type="direct-line-measurement",this.startPoint=null,this.endPoint=null,this.unit=null}get requiredPropertiesForEditing(){return[this.startPoint,this.endPoint]}clear(){this.startPoint=null,this.endPoint=null}};(0,s._)([(0,a.MZ)({type:["direct-line-measurement"]})],c.prototype,"type",void 0),(0,s._)([(0,a.MZ)({type:h.A})],c.prototype,"startPoint",void 0),(0,s._)([(0,a.MZ)({type:h.A})],c.prototype,"endPoint",void 0),(0,s._)([(0,a.MZ)({type:u.GB,value:null})],c.prototype,"unit",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],c.prototype,"requiredPropertiesForEditing",null),c=(0,s._)([(0,r.$)("esri.analysis.DirectLineMeasurementAnalysis")],c);const d=c;var p,_,v=i(61985),y=i(93516),g=(i(3313),i(57725)),w=i(36329),m=i(68660),M=i(96124),b=i(16952),f=i(8035),P=i(61506),V=i(93814),D=i(73783),Z=i(60861),A=i(19913),O=i(94669),L=i(62169),C=i(83303),T=i(12014),S=i(59484),U=i(49190),E=i(95351),I=i(74316);(_=p||(p={})).Manipulators="manipulators",_.AnalysisViewDestroyed="analysis-view-destroyed",_.AnalysisView="analysis-view";let R=class extends D.A{constructor(t){super(t),this.cursorPoint=null,this._visible=!1,this._laserLine=null,this.laserLineEnabled=!0,this._lastDraggedHandle=null}initialize(){this._laserLine=new E.o({view:this.view,attached:!0,isDecoration:!0}),this._updateVisibility(this._visible),this._connectToAnalysisView(),this.addHandles((0,v.wB)((()=>this._params),(({laserLineGlowColor:t,laserLineInnerColor:e,laserLineGlobalAlpha:i})=>{const s=this._laserLine,n=s.style;s.style={...n,innerColor:e,glowColor:t,globalAlpha:i}})))}destroy(){this._laserLine=(0,g.pR)(this._laserLine)}get _params(){const{accentColor:t}=this.view.effectiveTheme;return{laserLineGlowColor:V.A.toUnitRGB(t),laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:V.A.toUnitRGB((0,Z.bJ)(t)),laserLineInnerWidth:.75,laserLineGlobalAlpha:.75*t.a,handleColor:(0,Z.f6)(t,.5),handleRadius:5}}get visible(){return this._visible}set visible(t){t?this.show():this.hide()}get testData(){}get _cursorPosition(){const t=(0,A.vt)(),e=this.cursorPoint;return e&&this.view.renderCoordsHelper.toRenderCoords(e,t),t}get _startPosition(){const t=(0,A.vt)(),e=this.analysis.startPoint;return e&&this.view.renderCoordsHelper.toRenderCoords(e,t),t}get _endPosition(){const t=(0,A.vt)(),e=this.analysis.endPoint;return e&&this.view.renderCoordsHelper.toRenderCoords(e,t),t}get _laserLineParams(){const t=this._focusPosition,{active:e,lineState:i}=this.toolState,s=this.analysisViewData,n=this.laserLineEnabled&&!!t&&"measured"!==i&&e;if(!n||!this.visible||null==s||s.destroyed)return{heightManifoldTarget:null,pointDistanceLine:null,lineVerticalPlaneSegment:null};const a=s.actualVisualizedMeasurement,r="local"!==this.view.viewingMode&&n&&!!this.analysis.startPoint&&"geodesic"===a,o=n&&s.viewMode===C.n.Triangle;return{heightManifoldTarget:"euclidean"===a?t:null,pointDistanceLine:r?this._pointDistanceLine:null,lineVerticalPlaneSegment:o?(0,O.Cr)(this._startPosition,this._endPosition):null}}get _focusPosition(){const{lineState:t}=this.toolState,e=this.analysisViewData,i=null!=e&&!e.destroyed&&e.measurementMode===L.G.Euclidean&&e.viewMode===C.n.Direct;switch(t){case"drawing":return i?this._startPosition:this.analysis.endPoint?this._endPosition:this._startPosition;case"editing":return i?"start"===this._lastDraggedHandle?this._endPosition:this._startPosition:"start"===this._lastDraggedHandle?this._startPosition:this._endPosition;default:return null!=this.cursorPoint?this._cursorPosition:null}}get _pointDistanceLine(){return{origin:"drawing"===this.toolState.lineState||"end"===this._lastDraggedHandle?this._startPosition:this._endPosition,target:this._focusPosition}}createManipulators(){const t=this._params,{view:e}=this,i=()=>{const i=(0,S.UM)(t.handleColor),s=[new U.M((0,I.CM)(i,1,32,32))],n=new T.q({view:e,renderObjects:s});return n.available=!1,n.radius=t.handleRadius,[n,i]},[s,n]=i(),[a,r]=i(),o=new T.q({view:this.view,available:!1,interactive:!1});null!=this.analysis.startPoint&&(s.location=this.analysis.startPoint,s.available=!0),null!=this.analysis.endPoint&&(a.location=this.analysis.endPoint,a.available=!0);const l=()=>{let t=this._lastDraggedHandle;s.grabbing&&!a.grabbing&&(t="start"),a.grabbing&&!s.grabbing&&(t="end"),s.grabbing||a.grabbing||(t=null),this._lastDraggedHandle=t},u=s.events.on("grab-changed",l),h=a.events.on("grab-changed",l);return this.addHandles([u,h,(0,v.wB)((()=>(0,Z.pf)(this._params.handleColor)),(t=>{n.setParameters({color:t}),r.setParameters({color:t})}),{equals:Z.we})],p.Manipulators),{start:s,end:a,cursor:o}}show(){this.destroyed||this._visible||this._updateVisibility(!0)}hide(){!this.destroyed&&this._visible&&this._updateVisibility(!1)}_connectToAnalysisView(){this.removeHandles(p.AnalysisView),this.addHandles([(0,v.wB)((()=>this.analysisViewData?.destroyed),(t=>{t&&this.removeHandles(p.AnalysisView)}),v.Vh),(0,v.wB)((()=>["measured"===this.toolState.lineState,this.analysisViewData]),(([t,e])=>{null==e||e.destroyed||(e.allowVisualElementsOrientationChange=!t)}),v.Vh),(0,v.wB)((()=>this._laserLineParams),(t=>{const e=this._laserLine;e.heightManifoldTarget=t.heightManifoldTarget,e.pointDistanceLine=t.pointDistanceLine,e.lineVerticalPlaneSegment=t.lineVerticalPlaneSegment}),v.Vh)],p.AnalysisView)}_updateVisibility(t){this.initialized&&(this._visible=t,t?this._laserLine.style={innerColor:this._params.laserLineInnerColor,innerWidth:this._params.laserLineInnerWidth,glowColor:this._params.laserLineGlowColor,glowWidth:this._params.laserLineGlowWidth,glowFalloff:this._params.laserLineGlowFalloff,globalAlpha:this._params.laserLineGlobalAlpha}:this.view.cursor=null,this._laserLine.visible=t)}};(0,s._)([(0,a.MZ)({constructOnly:!0})],R.prototype,"view",void 0),(0,s._)([(0,a.MZ)()],R.prototype,"_params",null),(0,s._)([(0,a.MZ)({constructOnly:!0})],R.prototype,"analysis",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0})],R.prototype,"analysisViewData",void 0),(0,s._)([(0,a.MZ)()],R.prototype,"cursorPoint",void 0),(0,s._)([(0,a.MZ)()],R.prototype,"toolState",void 0),(0,s._)([(0,a.MZ)()],R.prototype,"visible",null),(0,s._)([(0,a.MZ)()],R.prototype,"testData",null),(0,s._)([(0,a.MZ)()],R.prototype,"_visible",void 0),(0,s._)([(0,a.MZ)()],R.prototype,"_laserLine",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0})],R.prototype,"laserLineEnabled",void 0),(0,s._)([(0,a.MZ)()],R.prototype,"_cursorPosition",null),(0,s._)([(0,a.MZ)()],R.prototype,"_startPosition",null),(0,s._)([(0,a.MZ)()],R.prototype,"_endPosition",null),(0,s._)([(0,a.MZ)()],R.prototype,"_lastDraggedHandle",void 0),(0,s._)([(0,a.MZ)()],R.prototype,"_laserLineParams",null),(0,s._)([(0,a.MZ)()],R.prototype,"_focusPosition",null),(0,s._)([(0,a.MZ)()],R.prototype,"_pointDistanceLine",null),R=(0,s._)([(0,r.$)("esri.views.3d.interactive.measurementTools.directLineMeasurement3D.DirectLineMeasurement3DView")],R);var k=i(2568),x=i(68574),G=i(19793),H=i(66019),B=i(17071),N=i(13243),F=i(28535),$=i(51720),z=i(54500),K=i(53981),W=i(20405);let q=class extends x.k{constructor(t){super(t),this._updatingHandles=new m.U,this._emulatedDrag=null,this.lineState="initial",this.startPointSurfaceLocation=null,this.endPointSurfaceLocation=null,this.cursorPointSurfaceLocation=null,this.startManipulator=null,this.endManipulator=null,this.cursorManipulator=null,this._getSnappingContext=(0,w.B)((t=>new F.e({elevationInfo:{mode:"absolute-height",offset:0},pointer:t,editGeometryOperations:new N.p(new B.ZE("point",(0,G.BV)(!0,!1,this.view.spatialReference)),this.view.state.viewingMode),visualizer:new f.s})))}initialize(){const{view:t,analysis:e,analysisViewData:i,visible:s}=this;this.measurementView=new R({toolState:this,view:t,analysis:e,analysisViewData:i,visible:s});const n=(0,z.X)(t);this._snappingManagerResult=n,this.addHandles(n);const{start:a,end:r,cursor:o}=this.measurementView.createManipulators(),l=(t,e,i)=>(0,H.Xt)(t,((t,s,n,a)=>{const r=(0,P.z7)(t),o=this._snappingManager,l=this._getSnappingContext(a),u=this._updatingHandles,{lineState:c}=this;n=n.next(r).next((0,H.VG)(this,[i,e])).next((i=>{if("cursorPoint"!==e){const i=this.analysis[e];null!=i&&(t.location=i)}return i}));const d=(0,P.xk)(this.view);let p=s.next(r).next((t=>{const s=d(t);return s||"drawing"!==this.lineState&&"initial"!==this.lineState||(this[e]=null,this[i]=null),s}));if("touch"!==a||"editing"===c){const{snappingStep:t,cancelSnapping:e}=(0,$.L)({snappingManager:o,snappingContext:l,updatingHandles:u});n=n.next(e),p=p.next(...t)}p.next((t=>"start"!==t.action?t:null)).next((s=>{const n=(0,M.EL)(s.mapEnd,new h.A);this[e]=n,t.location=n,this[i]=this._surfaceLocation(n,s.surfaceType)}))})),u=t=>t.events.on("grab-changed",(()=>{const t=a.grabbing||r.grabbing;this.lineState=t?"editing":"measured"}));this.addHandles([l(a,"startPoint","startPointSurfaceLocation"),l(r,"endPoint","endPointSurfaceLocation"),l(o,"cursorPoint","cursorPointSurfaceLocation"),u(a),u(r)]),this.manipulators.add(a),this.manipulators.add(r),this.manipulators.add(o),this.startManipulator=a,this.endManipulator=r,this.cursorManipulator=o,this.addHandles((0,v.wB)((()=>this.state),(t=>{"measured"===t&&this.finishToolCreation()}),v.pc)),(0,K.BY)(this)}destroy(){this._updatingHandles=(0,g.pR)(this._updatingHandles),this.measurementView=(0,g.pR)(this.measurementView)}get _snappingManager(){return this._snappingManagerResult.snappingManager}get state(){const{analysis:t}=this;if(null==t.startPoint&&null==t.endPoint)return"ready";const{lineState:e}=this;return this.validMeasurement&&"editing"!==e&&"drawing"!==e?"measured":"measuring"}get cursor(){return"ready"===this.state||"drawing"===this.lineState?"crosshair":null}get startPoint(){return this.analysis.startPoint}set startPoint(t){this.analysis.startPoint=t}get endPoint(){return this.analysis.endPoint}set endPoint(t){this.analysis.endPoint=t}get cursorPoint(){return this.measurementView.cursorPoint}set cursorPoint(t){this.measurementView.cursorPoint=t}get snappingOptions(){return this._snappingManager.options}get validMeasurement(){return null!=this.analysis.startPoint&&null!=this.analysis.endPoint}get updating(){return this._updatingHandles.updating||this._snappingManager.updating}onShow(){this.measurementView.show(),this._updateManipulatorAvailability()}onHide(){this.measurementView.hide()}onDeactivate(){this._emulatedDrag?.cancel(),this._emulatedDrag=null}onInputEvent(t){switch(t.type){case"immediate-click":this._handleImmediateClick(t);break;case"pointer-move":this._handlePointerMove(t)}this._updateManipulatorAvailability()}_handlePointerMove(t){if(!this.active||this.view.navigating)return;const{pointerType:e}=t;if("mouse"!==e)return;const i=(0,W.ZV)(t),{lineState:s,cursorManipulator:n,endManipulator:a}=this;let r=!1;null==this.cursorPoint&&(this._emulatedDrag?.cancel(),this._emulatedDrag=j(n,e,i),r=!0),"initial"===s&&(this._emulatedDrag?.update(i),r=!0),"drawing"===s&&(a.events.emit("drag",{action:"update",start:i,screenPoint:i}),r=!0),r&&t.stopPropagation()}_handleImmediateClick(t){if(!this.active)return;if(!(0,b.s7)(t))return;const e=(0,W.ZV)(t),{pointerType:i}=t,{cursorManipulator:s,startManipulator:n,endManipulator:a,lineState:r}=this;let o=!1;switch(null==this.cursorPoint&&(this._emulatedDrag?.cancel(),this._emulatedDrag=j(s,i,e)),r){case"initial":if(this._emulatedDrag?.update(e),null!=this.cursorPoint){this._emulatedDrag?.end(e),this._emulatedDrag=null;const{cursorPoint:t}=this;this.startPoint=t,this.startPointSurfaceLocation=this.cursorPointSurfaceLocation,n.location=t,n.interactive=!1,a.interactive=!1,this.lineState="drawing",this._emulatedDrag=j(a,i,e),o=!0}break;case"drawing":this._emulatedDrag?.update(e),null!=this.endPoint&&(this._emulatedDrag?.end(e),this._emulatedDrag=null,n.interactive=!0,a.interactive=!0,this.lineState="measured",o=!0)}o&&t.stopPropagation()}_surfaceLocation(t,e){return e===P.Og.GROUND?"on-the-surface":(t.z??0)>=this._getElevation(t)?"above-the-surface":"below-the-surface"}_updateManipulatorAvailability(){this.startManipulator.available=null!=this.analysis.startPoint,this.endManipulator.available=null!=this.analysis.endPoint}_getElevation(t){return this.view.basemapTerrain.ready?(0,k.R1)(this.view.elevationProvider,t)??0:0}get test(){}};function j(t,e,i){return t.events.emit("drag",{action:"start",pointerType:e,start:i,screenPoint:i}),{update:e=>t.events.emit("drag",{action:"update",start:e,screenPoint:e}),end:e=>t.events.emit("drag",{action:"end",start:e,screenPoint:e}),cancel:()=>t.events.emit("drag",{action:"cancel"})}}(0,s._)([(0,a.MZ)({readOnly:!0})],q.prototype,"state",null),(0,s._)([(0,a.MZ)()],q.prototype,"lineState",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],q.prototype,"cursor",null),(0,s._)([(0,a.MZ)()],q.prototype,"startPoint",null),(0,s._)([(0,a.MZ)()],q.prototype,"endPoint",null),(0,s._)([(0,a.MZ)()],q.prototype,"cursorPoint",null),(0,s._)([(0,a.MZ)({constructOnly:!0})],q.prototype,"analysis",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0})],q.prototype,"analysisViewData",void 0),(0,s._)([(0,a.MZ)()],q.prototype,"measurementView",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0})],q.prototype,"view",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],q.prototype,"validMeasurement",null),(0,s._)([(0,a.MZ)({value:null})],q.prototype,"startPointSurfaceLocation",void 0),(0,s._)([(0,a.MZ)({value:null})],q.prototype,"endPointSurfaceLocation",void 0),(0,s._)([(0,a.MZ)({value:null})],q.prototype,"cursorPointSurfaceLocation",void 0),(0,s._)([(0,a.MZ)()],q.prototype,"updating",null),q=(0,s._)([(0,r.$)("esri.views.3d.interactive.measurementTools.directLineMeasurement3D.DirectLineMeasurement3DTool")],q);const Y=q;var X=i(76755);let J=class extends X.d{constructor(t){super(t),this.analysis=null,this.supportedViewType="3d",this.unsupportedErrorMessage="DirectLineMeasurement3DViewModel is only supported in 3D views.",this._userUnit=null,this._userUnitOptions=null}initialize(){this.addHandles((0,v.wB)((()=>({analysis:this.analysis,unit:this.unit})),(({analysis:t,unit:e})=>{null!=t&&(t.unit=e)}),v.pc))}get state(){return this.disabled||!this.ready?"disabled":null==this.tool?"ready":this.tool.state}get measurement(){const{tool:t}=this;if(null==t)return null;const e=t=>({text:t,state:"available"}),{analysisViewData:i}=t,s=null!=i.result;return{mode:i.result?.mode??"euclidean",directDistance:s&&"euclidean"===i.actualVisualizedMeasurement?e(i.directLabelText):{text:null,state:"unavailable"},horizontalDistance:s?e(i.horizontalLabelText):{text:null,state:"unavailable"},verticalDistance:s?e(i.verticalLabelText):{text:null,state:"unavailable"}}}set unitOptions(t){this._userUnitOptions=t,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}get unitOptions(){return this._filteredOrAllUnits(this._userUnitOptions)}set unit(t){this._userUnit=t?this._findSelectableUnit(t,this._userUnit):null}get unit(){return this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)}constructAnalysis(){return new d}constructTool(){return new Y({view:this.view,analysis:this.analysis,analysisViewData:this.analysisView,visible:this.visible})}_findSelectableUnit(t,e){const i=this.unitOptions;return i.includes(t)?t:e?this._findSelectableUnit(e):i[0]}_filteredOrAllUnits(t){if(!t)return u.GB.slice();const e=t.filter((t=>u.GB.includes(t)));return 0===e.length?u.GB.slice():e}};(0,s._)([(0,a.MZ)({type:d})],J.prototype,"analysis",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],J.prototype,"state",null),(0,s._)([(0,a.MZ)({readOnly:!0})],J.prototype,"measurement",null),(0,s._)([(0,a.MZ)()],J.prototype,"unitOptions",null),(0,s._)([(0,a.MZ)()],J.prototype,"unit",null),(0,s._)([(0,a.MZ)(y.q)],J.prototype,"defaultUnit",void 0),(0,s._)([(0,a.MZ)()],J.prototype,"_userUnit",void 0),(0,s._)([(0,a.MZ)()],J.prototype,"_userUnitOptions",void 0),J=(0,s._)([(0,r.$)("esri.widgets.DirectLineMeasurement3D.DirectLineMeasurement3DViewModel")],J);const Q=J;var tt=i(533),et=i(2070),it=(i(33510),i(2153)),st=i(2110);const nt="esri-direct-line-measurement-3d",at={base:nt,newMeasurementButton:`${nt}__clear-button`};let rt=class extends o.A{constructor(t,e){super(t,e),this.messages=null,this.messagesCommon=null,this.viewModel=new Q}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get visible(){return this.viewModel.visible}set visible(t){this.viewModel.visible=t}get active(){return this.viewModel.active}get analysis(){return this.viewModel.analysis}set analysis(t){this.viewModel.analysis=t}get icon(){return"measure-line"}set icon(t){this._overrideIfSome("icon",t)}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get unitOptions(){return this.viewModel.unitOptions}set unitOptions(t){this.viewModel.unitOptions=t}get unit(){return this.viewModel.unit}set unit(t){this.viewModel.unit=t}render(){const{messages:t,messagesCommon:e,unit:i,unitOptions:s,viewModel:a}=this,{active:r,measurement:o,state:l,supported:u}=a;return(0,st.K)("div",{"aria-label":this.messages.widgetLabel,class:this.classes(at.base,tt.D.widget,tt.D.panel),key:this,role:"presentation"},this.visible?(0,st.K)(et.I,{active:r,measurementItems:[{key:"direct",title:t.direct,value:ot(o?.directDistance)},{key:"horizontal",title:t.horizontal,value:ot(o?.horizontalDistance)},{key:"vertical",title:t.vertical,value:ot(o?.verticalDistance)}],messages:{...t,notApplicable:e?.notApplicable},newMeasurementButtonClass:at.newMeasurementButton,state:l,supported:u,unit:i,unitOptions:s,onNewMeasurementClick:()=>{(0,n.QZ)(this.viewModel.start())},onUnitChange:t=>{this.unit=t}}):null)}};function ot(t){return"available"===t?.state?t.text:null}(0,s._)([(0,a.MZ)()],rt.prototype,"view",null),(0,s._)([(0,a.MZ)()],rt.prototype,"visible",null),(0,s._)([(0,a.MZ)()],rt.prototype,"active",null),(0,s._)([(0,a.MZ)({constructOnly:!0,nonNullable:!0})],rt.prototype,"analysis",null),(0,s._)([(0,a.MZ)()],rt.prototype,"icon",null),(0,s._)([(0,a.MZ)()],rt.prototype,"label",null),(0,s._)([(0,a.MZ)(),(0,it.G)("esri/widgets/DirectLineMeasurement3D/t9n/DirectLineMeasurement3D")],rt.prototype,"messages",void 0),(0,s._)([(0,a.MZ)(),(0,it.G)("esri/t9n/common")],rt.prototype,"messagesCommon",void 0),(0,s._)([(0,a.MZ)()],rt.prototype,"uiStrings",void 0),(0,s._)([(0,a.MZ)({type:Q})],rt.prototype,"viewModel",void 0),(0,s._)([(0,a.MZ)()],rt.prototype,"unitOptions",null),(0,s._)([(0,a.MZ)()],rt.prototype,"unit",null),rt=(0,s._)([(0,r.$)("esri.widgets.DirectLineMeasurement3D")],rt);const lt=rt},76755:(t,e,i)=>{i.d(e,{d:()=>_});var s,n,a=i(82392),r=i(3132),o=(i(6273),i(80861)),l=i(57725),u=i(37623),h=i(61985),c=i(81482),d=(i(67498),i(26325)),p=i(74219);(n=s||(s={}))[n.PENDING=0]="PENDING",n[n.WAIT_FOR_VIEW_READY=1]="WAIT_FOR_VIEW_READY",n[n.RUNNING=2]="RUNNING";let _=class extends p.j{constructor(t={}){super(t),this.analysisView=null,this._reconnectViewTask=null,this._parentChangeFromReconnect=!1,this._startUserOperation=null;const e=t?.analysis;null!=e?this.analysis=e:(this._set("analysis",this.constructAnalysis()),this._set("isAnalysisOwner",!0))}normalizeCtorArgs(t){const{analysis:e,...i}=t;return i}initialize(){this.addHandles([(0,h.wB)((()=>this.analysis?.parent),(t=>{this._parentChangeFromReconnect||t===this.view||this._set("isAnalysisOwner",!1);const e=!this._parentChangeFromReconnect;this._parentChangeFromReconnect=!1,e&&this._scheduleViewReconnect()}),h.OH),(0,h.wB)((()=>({view:this.view,ready:null!=this.view&&this.view.ready,supported:this.supported})),(({view:t},e)=>{const i=e?.view;t!==i&&(this._startUserOperation=(0,l.DC)(this._startUserOperation),this._disconnectFromView(i)),this._scheduleViewReconnect()}),h.pc),(0,h.wB)((()=>this.analysis.isEditable),((t,e)=>{null!=this.analysisView&&(t&&!e&&null==this.tool?this.createTool():t||!e||null==this.tool||this.tool.active||this.removeTool())}))])}destroy(){this._reconnectViewTask=(0,l.DC)(this._reconnectViewTask),this._startUserOperation=(0,l.DC)(this._startUserOperation),null!=this.analysisView&&(this.analysisView.visible=void 0),this._disconnectFromView(this.view),null!=this.analysis&&this.isAnalysisOwner&&(this.analysis.destroy(),this._set("analysis",null))}set analysis(t){t!==this._get("analysis")&&(this._startUserOperation=(0,l.DC)(this._startUserOperation),this._disconnectFromView(this.view),this._setExternalAnalysis(t),this._scheduleViewReconnect())}get ready(){return null!=this.analysisView&&!this.connectingToView}get connectingToView(){return null!=this._reconnectViewTask}get isAnalysisOwner(){return this._get("isAnalysisOwner")}set visible(t){this._set("visible",t),null!=this.analysisView&&(this.analysisView.visible=t)}async start(){if(!this.visible)return void o.A.getLogger(this).warn("Cannot start analysis when not visible");this.clear();const t={task:null,abort:null,state:s.PENDING},e=(0,r.UT)((async e=>{t.state=s.WAIT_FOR_VIEW_READY,await(0,h.C_)((()=>this.ready),e),t.state=s.RUNNING,this.createTool({interactive:!0})}));return t.task=e,t.abort=()=>e.abort(),this._startUserOperation=t,e.promise}clear(){this._startUserOperation=(0,l.DC)(this._startUserOperation),this.removeTool(),this.analysis.clear()}onConnectToAnalysisView(t){}onDisconnectFromAnalysisView(){}_scheduleViewReconnect(){this._reconnectViewTask=(0,l.DC)(this._reconnectViewTask);const t=(0,r.UT)((async e=>{try{await this._reconnectView(e)}catch(t){if((0,u.Te)(e),!(0,u.zf)(t))return void o.A.getLogger(this).warn("Failed to use analysis in view model",t);throw t}finally{t===this._reconnectViewTask&&(this._reconnectViewTask=null)}}));this._reconnectViewTask=t}async _reconnectView(t){const{view:e}=this,i=null!=e&&e.ready&&this.supported,s=this.analysis;if(this._startUserOperation=v(this._startUserOperation),this._disconnectFromView(e),i&&null!=e&&null!=s){if(this.isAnalysisOwner){if(null!=s.parent)return void this.logError("expected owned analysis to have null parent when connecting to view");this._parentChangeFromReconnect=!0,e.analyses.add(s)}this.analysisView=await e.whenAnalysisView(s),(0,u.G4)(t)?this._startUserOperation=v(this._startUserOperation):(this.analysisView.visible=this.visible,this.onConnectToAnalysisView(this.analysisView),this.createTool())}}_disconnectFromView(t){this.removeTool(),null!=t&&this.isAnalysisOwner&&(this._parentChangeFromReconnect=!0,t.analyses.remove(this.analysis),this.analysis.clear()),this.analysisView=null,this.onDisconnectFromAnalysisView()}_setExternalAnalysis(t){null==this.analysisView||this.isAnalysisOwner||(this.analysisView.visible=!0),this.analysisView=null,this._set("isAnalysisOwner",!1),this._set("analysis",t),this._parentChangeFromReconnect=!1}get testInfo(){}};function v(t){return null!=t&&t.state>=s.RUNNING?(t.abort(),null):t}(0,a._)([(0,c.MZ)({nonNullable:!0})],_.prototype,"analysis",null),(0,a._)([(0,c.MZ)()],_.prototype,"analysisView",void 0),(0,a._)([(0,c.MZ)()],_.prototype,"ready",null),(0,a._)([(0,c.MZ)()],_.prototype,"connectingToView",null),(0,a._)([(0,c.MZ)({readOnly:!0})],_.prototype,"isAnalysisOwner",null),(0,a._)([(0,c.MZ)({type:Boolean,value:!0})],_.prototype,"visible",null),(0,a._)([(0,c.MZ)()],_.prototype,"_reconnectViewTask",void 0),_=(0,a._)([(0,d.$)("esri.widgets.support.InteractiveAnalysisViewModel")],_)},74219:(t,e,i)=>{i.d(e,{j:()=>u});var s=i(82392),n=i(73783),a=i(80861),r=i(61985),o=i(81482),l=(i(6273),i(67498),i(26325));let u=class extends n.A{constructor(t){super(t),this.tool=null,this._loggedUnsupportedErrorOnce=!1,null!=t?.visible&&(this.visible=t.visible)}initialize(){this.addHandles((0,r.wB)((()=>({ready:null!=this.view&&this.view.ready,supported:this.supported})),(({ready:t,supported:e})=>{!t||e||this._loggedUnsupportedErrorOnce||(this.logError(this.unsupportedErrorMessage),this._loggedUnsupportedErrorOnce=!0)}),r.pc))}destroy(){this.removeTool(),this.view=null}get active(){return null!=this.tool&&this.tool.active}get disabled(){return null==this.view||!this.view.ready||!this.supported}get supported(){return null==this.view||this.view.type===this.supportedViewType}get view(){return this._get("view")}set view(t){if(t===this.view)return;this.removeTool(),this._set("view",t);const e="tools";this.removeHandles(e),null!=t&&this.addHandles(t.tools.on("after-remove",(t=>{t.item===this.tool&&this._set("tool",null)})),e)}set visible(t){this._set("visible",t),null!=this.tool&&(this.tool.visible=t)}createTool(t={interactive:!1}){if(this.removeTool(),null==this.view||!this.view.ready||!this.supported)return;const e=this.constructTool();e.created?(this._set("tool",e),this.view.tools.add(e)):t.interactive?(this._set("tool",e),this.view.addAndActivateTool(e),(0,r.z7)((()=>e.created),(()=>{e.active&&null!=this.view&&(this.view.activeTool=null)}),{initial:!0,once:!0})):e.destroy()}removeTool(){const t=this.tool;if(null==t)return;const e=this.view?.tools;null!=e?e.remove(t):t.destroy(),this._set("tool",null)}logError(...t){a.A.getLogger(this).error(...t)}};(0,s._)([(0,o.MZ)({constructOnly:!0})],u.prototype,"tool",void 0),(0,s._)([(0,o.MZ)()],u.prototype,"active",null),(0,s._)([(0,o.MZ)()],u.prototype,"disabled",null),(0,s._)([(0,o.MZ)()],u.prototype,"supported",null),(0,s._)([(0,o.MZ)({value:null})],u.prototype,"view",null),(0,s._)([(0,o.MZ)({type:Boolean,value:!0})],u.prototype,"visible",null),u=(0,s._)([(0,l.$)("esri.widgets.support.InteractiveToolViewModel")],u)},2070:(t,e,i)=>{i.d(e,{I:()=>d});var s=i(82392),n=i(81482),a=(i(6273),i(80861),i(67498),i(26325)),r=i(52239),o=i(9737),l=i(27273),u=(i(33510),i(2110));const h="esri-measurement-widget-content",c={base:h,actions:`${h}__actions`,error:`${h}__error`,hint:`${h}__hint`,hintText:`${h}__hint-text`,panelError:`${h}__panel--error`,settings:`${h}__settings`,measurement:`${h}__measurement`,measurementItem:`${h}__measurement-item`,measurementItemDisabled:`${h}__measurement-item--disabled`,measurementItemTitle:`${h}__measurement-item__title`,measurementItemValue:`${h}__measurement-item__value`};let d=class extends r.A{constructor(t,e){super(t,e)}loadDependencies(){return(0,o.W)({button:()=>Promise.all([i.e(2006),i.e(2282),i.e(6283),i.e(5399)]).then(i.bind(i,45399))})}render(){return(0,u.K)("div",{class:c.base},this._renderContent())}_renderContent(){const{supported:t,active:e,state:i}=this;switch(i){case"disabled":case"ready":return t?e?this._renderHint():this._renderActions():this._renderUnsupportedMessage();case"measuring":case"measured":return[this._renderSettings(),this._renderMeasurement(),this._renderActions()]}}_renderUnsupportedMessage(){return(0,u.K)("section",{class:c.error,key:"unsupported"},(0,u.K)("p",null,this.messages.unsupported))}_renderHint(){const{messages:t}=this;return(0,u.K)("section",{class:c.hint,key:"hint"},(0,u.K)("p",{class:c.hintText},t.hint))}_renderSettings(){return(0,u.K)("div",{class:c.settings,key:"settings"},(0,u.K)(l.t,{options:this.unitOptions,selectLabel:this.messages.unit,value:this.unit,onChange:this.onUnitChange}))}_renderMeasurement(){return(0,u.K)("section",{class:c.measurement,key:"measurement"},this.measurementItems.map((t=>this._renderMeasurementItem(t))))}_renderMeasurementItem({key:t,title:e,value:i}){return(0,u.K)("div",{class:this.classes(c.measurementItem,null==i&&c.measurementItemDisabled),key:t},(0,u.K)("span",{class:c.measurementItemTitle},e),(0,u.K)("span",{"aria-live":"polite",class:c.measurementItemValue},i??this.messages.notApplicable))}_renderActions(){const{messages:t}=this;return(0,u.K)("div",{class:c.actions},(0,u.K)("calcite-button",{class:this.newMeasurementButtonClass,disabled:"disabled"===this.state,onclick:this.onNewMeasurementClick},t.newMeasurement))}};(0,s._)([(0,n.MZ)()],d.prototype,"active",void 0),(0,s._)([(0,n.MZ)()],d.prototype,"measurementItems",void 0),(0,s._)([(0,n.MZ)()],d.prototype,"messages",void 0),(0,s._)([(0,n.MZ)()],d.prototype,"newMeasurementButtonClass",void 0),(0,s._)([(0,n.MZ)()],d.prototype,"onNewMeasurementClick",void 0),(0,s._)([(0,n.MZ)()],d.prototype,"onUnitChange",void 0),(0,s._)([(0,n.MZ)()],d.prototype,"state",void 0),(0,s._)([(0,n.MZ)()],d.prototype,"supported",void 0),(0,s._)([(0,n.MZ)()],d.prototype,"unit",void 0),(0,s._)([(0,n.MZ)()],d.prototype,"unitOptions",void 0),d=(0,s._)([(0,a.$)("esri.widgets.support.MeasurementWidgetContent")],d)}}]);