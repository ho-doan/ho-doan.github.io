"use strict";(self.webpackChunkarcgis_node=self.webpackChunkarcgis_node||[]).push([[9017,5390],{2296:(e,t,r)=>{r.d(t,{I:()=>_,b:()=>f});var i=r(77788),a=r(29592),s=r(31790),n=r(65630),o=r(78546),l=r(83660),h=r(21586),c=r(19635),d=r(41014),u=r(92624),p=r(19778),g=r(7782),m=r(33763);function f(e){const t=new u.N5,{vertex:r,fragment:f}=t;return(0,h.NB)(r,e),t.include(s.d,e),t.attributes.add(m.r.POSITION,"vec3"),t.attributes.add(m.r.UV0,"vec2"),e.perspectiveInterpolation&&t.attributes.add(m.r.PERSPECTIVEDIVIDE,"float"),t.varyings.add("vpos","vec3"),e.multipassEnabled&&t.varyings.add("depth","float"),r.code.add(d.H`
    void main(void) {
      vpos = position;
      ${e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0;
      gl_Position = transformPosition(proj, view, vpos);

      ${e.perspectiveInterpolation?"gl_Position *= perspectiveDivide;":""}
    }
  `),t.include(a.HQ,e),t.include(n.Q,e),f.uniforms.add(new p.N("tex",(e=>e.texture)),new c.m("opacity",(e=>e.opacity))),t.varyings.add("vTexCoord","vec2"),e.transparencyPassType===g.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),f.include(l.a),f.code.add(d.H`
    void main() {
      discardBySlice(vpos);
      ${e.multipassEnabled?"terrainDepthTest(depth);":""}
      fragColor = texture(tex, vTexCoord) * opacity;

      if (fragColor.a < ${d.H.float(o.H)}) {
        discard;
      }

      fragColor = highlightSlice(fragColor, vpos);
      ${e.transparencyPassType===g.y.ColorAlpha?d.H`
              fragColor = premultiplyAlpha(fragColor);
              fragAlpha = fragColor.a;`:""}
      ${e.output===i.V.ObjectAndLayerIdColor?d.H`
              fragColor = vec4(0,0,0,1);`:""}
    }
    `),t}const _=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}))},29017:(e,t,r)=>{r.d(t,{A:()=>G});var i=r(82392),a=r(3132),s=r(70214),n=r(80861),o=r(57725),l=r(37623),h=r(61985),c=r(81482),d=(r(6273),r(67498),r(26325)),u=r(8e3),p=r(2532),g=r(161),m=r(93766),f=r(75644),_=r(68435),v=r(10941),y=r(53633),w=r(74316),x=r(33763);function E(e,t){return(0,w.Gj)(e,[[t[0],t[1],-1],[t[2],t[1],-1],[t[2],t[3],-1],[t[0],t[3],-1]])}function P(e,t,r){if(!(0,p.HY)(t,r))return E(e,r);const i=[t[1]-r[1],Math.min(t[3],r[3])-Math.max(t[1],r[1]),r[3]-t[3],123456],a=[t[0]-r[0],Math.min(t[2],r[2])-Math.max(t[0],r[0]),r[2]-t[2],123456],s=r[2]-r[0],n=r[3]-r[1],o=a[0]>0&&a[2]>0?3:2,l=i[0]>0&&i[2]>0?3:2,h=(l+1)*(o+1),c=(0,f.jh)(3*h),d=(0,_.oe)(2*h),u=new Array(6*(l*o-1));let g=0,m=0,w=0,P=0,I=0;for(let e=0;e<4;e++){const t=i[e];if(t<=0)continue;let l=0;for(let t=0;t<4;t++){const i=a[t];i<=0||(c[m++]=r[0]+l,c[m++]=r[1]+g,c[m++]=-1,d[w++]=l/s,d[w++]=g/n,t<3&&e<3&&(1!==t||1!==e)&&(u[I++]=P,u[I++]=P+1,u[I++]=P+o+1,u[I++]=P+1,u[I++]=P+o+2,u[I++]=P+o+1),P++,l+=i)}g+=t}const b=new Array(u.length);return new y.V(e,[[x.r.POSITION,new v.n(c,u,3,!0)],[x.r.NORMAL,new v.n(A,b,3,!0)],[x.r.UV0,new v.n(d,u,2,!0)]])}const A=[0,0,1];var I=r(315),b=r(31882),S=r(68986),T=r(80561),C=r(35537),R=r(32573),O=r(34402),M=r(75390),D=r(24775),N=r(30386),L=r(96383),V=r(68716);let H=class extends((0,N.A)((0,m.w)(D.A))){constructor(){super(...arguments),this.drapeSourceType=g.Om.RasterImage,this.updatePolicy=O.q.SYNC,this.fullExtentInLocalViewSpatialReference=null,this.maximumDataResolution=null,this._images=new Array,this._extents=new Array,this._overlays=new Array,this.updateWhenStationary=!0,this._drapeSourceRenderer=null,this.refreshDebounced=(0,l.sg)((async e=>{this.destroyed||await this._doRefresh(e).catch((e=>{(0,l.zf)(e)||n.A.getLogger(this).error(e)}))}),2e3)}get visibleAtCurrentScale(){const e=this.layer,t="effectiveScaleRange"in e?e.effectiveScaleRange:null;return(0,L.E5)(t,this.view.terrainScale)}initialize(){this._drapeSourceRenderer=this.view.basemapTerrain.overlayManager.registerGeometryDrapeSource(this),this.addHandles((0,s.hA)((()=>this.view.basemapTerrain.overlayManager.unregisterDrapeSource(this)))),this.addResolvingPromise((0,I.V)(this).then((e=>this._set("fullExtentInLocalViewSpatialReference",e)))),this._updatingHandles.add((()=>this.suspended),(()=>this._suspendedChangeHandler()))}destroy(){this.clear()}setDrapingExtent(e,t){this._spatialReference=t,e.forEach(((e,t)=>{this._overlays[t]=e,this._updateImageExtent(e,t)}))}_updateImageExtent(e,t){const r=this._clippedExtent(e.extent,W);if(null==r)return;const i=function(e,t,r){const i=(0,p.VL)(e)/(0,p.uJ)(e),a={width:r,height:r};return i>1.0001?a.height=r/i:i<.9999&&(a.width=r*i),a.width=Math.round(a.width/((0,p.VL)(e)/(0,p.VL)(t))),a.height=Math.round(a.height/((0,p.uJ)(e)/(0,p.uJ)(t))),a}(e.extent,r,e.resolution);let a=e.pixelRatio*this.view.state.pixelRatio;const{layer:s}=this;if("imageMaxWidth"in s&&null!=s.imageMaxWidth||"imageMaxHeight"in s&&null!=s.imageMaxHeight){const e=s.imageMaxWidth,t=s.imageMaxHeight;if(i.width>e){const t=e/i.width;i.height=Math.floor(i.height*t),i.width=e,a*=t}if(i.height>t){const e=t/i.height;i.width=Math.floor(i.width*e),i.height=t,a*=e}}const o=this._extents[t];o&&(0,p.aI)(o.extent,r)&&this._imageSizeEquals(r,o.imageSize,i)||(this._extents[t]={extent:(0,p.vt)(r),imageSize:i,pixelRatio:a},this.suspended||this._fetch(t).catch((e=>{(0,l.zf)(e)||n.A.getLogger(this).error(e)})))}clear(){for(let e=0;e<this._images.length;e++)this._clearImage(e)}async doRefresh(){return this._doRefresh()}async _doRefresh(e){if(this.suspended)return;const t=[];for(let r=0;r<this._extents.length;r++)this._extents[r]&&t.push(this._fetch(r,e));await Promise.allSettled(t)}async processResult(e,t,r){(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(e.image=t)}findExtentInfoAt(e){for(const t of this._extents){const r=t.extent;if(new u.A(r[0],r[1],r[2],r[3],this._spatialReference).contains(e))return t}return null}getFetchOptions(){}async redraw(e,t){await(0,a.jJ)(this._images,(async(r,i)=>{r&&(await e(r,t),await this._createStageObjects(i,r.image,t))}))}_imageSizeEquals(e,t,r){if(!this.maximumDataResolution)return!1;const i=(0,p.VL)(e)/this.maximumDataResolution.x,a=(0,p.uJ)(e)/this.maximumDataResolution.y,s=i/t.width,n=a/t.height,o=i/r.width,l=a/r.height,h=Math.abs(s-o),c=Math.abs(n-l),d=b.b.TESTS_DISABLE_OPTIMIZATIONS?0:1.5;return h<=d&&c<=d}async _fetch(e,t){if(this.suspended)return;const r=this._extents[e],i=r.extent;this._images[e]||(this._images[e]={texture:null,material:null,renderGeometry:null,loadingPromise:null,loadingAbortController:null,image:null,pixelData:null,renderExtent:(0,p.vt)(i)});const a=this._images[e];a.loadingAbortController=(0,o.DC)(a.loadingAbortController);const s=new u.A(i[0],i[1],i[2],i[3],this._spatialReference);if(0===s.width||0===s.height)return void this._clearImage(e);const h=new AbortController;a.loadingAbortController=h,(0,l.u7)(t,(()=>h.abort()));const c=h.signal,d=this._waitFetchReady(c).then((async()=>{const t={requestAsImageElement:!0,pixelRatio:this._overlays[e].pixelRatio,...this.getFetchOptions(),signal:c},{height:i,width:a}=r.imageSize;return this.layer.fetchImage(s,a,i,t)})).then((e=>{if((0,l.G4)(c))throw n.A.getLogger(this).warnOnce("A call to fetchImage resolved even though the request was aborted. fetchImage should not resolve if options.signal.aborted is true."),(0,l.NK)();return this.processResult(a,e)})).then((()=>{(0,p.C)(a.renderExtent,i)}));a.loadingPromise=d,await this._updatingHandles.addPromise(d.then((async()=>{(0,l.Te)(c),await this._createStageObjects(e,a.image,c)})).catch((e=>{throw e&&!(0,l.zf)(e)&&n.A.getLogger(this).error(e),e})).finally((()=>{d===a.loadingPromise&&(a.loadingPromise=null,a.loadingAbortController=null)})))}_clearImage(e){const t=this._images[e];if(t){null!=t.renderGeometry&&(this._drapeSourceRenderer.removeGeometries([t.renderGeometry],T.q.UPDATE),t.renderGeometry=null);const e=this.view._stage,r=t.texture;r?.unload(),e.remove(r),t.texture=null,e.remove(t.material),t.material=null,t.loadingAbortController=(0,o.DC)(t.loadingAbortController),t.loadingPromise=null,t.image=null,t.pixelData=null}}async _createStageObjects(e,t,r){const i=this.view._stage,s=this._images[e],n=()=>{s.texture?.unload(),i.remove(s.texture),s.texture=null,s.renderGeometry&&(this._drapeSourceRenderer.removeGeometries([s.renderGeometry],T.q.UPDATE),s.renderGeometry=null)};if(t){const o=new R.g(t,{width:t.width,height:t.height,preMultiplyAlpha:!0,wrap:{s:V.pF.CLAMP_TO_EDGE,t:V.pF.CLAMP_TO_EDGE}});let h;if(await(0,a.Ke)(this._images[e===S.vr.INNER?S.vr.OUTER:S.vr.INNER].loadingPromise),(0,l.Te)(r),n(),await i.schedule((()=>o.load(i.renderView.renderingContext)),r),i.add(o),s.texture=o,null==s.material?(s.material=new M.r({transparent:!0,textureId:o.id}),i.add(s.material)):s.material.setParameters({textureId:o.id}),e===S.vr.INNER)h=E(s.material,s.renderExtent);else{const e=this._images[0].renderExtent;if(!e)return void n();h=P(s.material,e,s.renderExtent)}s.renderGeometry=new C.$(h),s.renderGeometry.localOrigin=this._overlays[e].renderLocalOrigin,this._drapeSourceRenderer.addGeometries([s.renderGeometry],T.q.UPDATE)}else n(),i.remove(s.material),s.material=null}_clippedExtent(e,t){if("local"!==this.view.viewingMode)return(0,p.C)(t,e);const r=this.view.basemapTerrain;return r.ready?(0,p.E$)(e,r.extent,t):(0,p.C)(t,e)}_suspendedChangeHandler(){this.suspended?this.clear():this.refreshDebounced()}async _waitFetchReady(e){await(0,h.C_)((()=>this.view.stationary),e),(0,l.Te)(e)}};(0,i._)([(0,c.MZ)()],H.prototype,"layer",void 0),(0,i._)([(0,c.MZ)()],H.prototype,"suspended",void 0),(0,i._)([(0,c.MZ)({readOnly:!0})],H.prototype,"fullExtentInLocalViewSpatialReference",void 0),(0,i._)([(0,c.MZ)({readOnly:!0})],H.prototype,"visibleAtCurrentScale",null),(0,i._)([(0,c.MZ)()],H.prototype,"updating",void 0),H=(0,i._)([(0,d.$)("esri.views.3d.layers.DynamicLayerView3D")],H);const G=H,W=(0,p.vt)()},93766:(e,t,r)=>{r.d(t,{w:()=>c});var i=r(82392),a=r(70214),s=r(37623),n=r(61985),o=r(81482),l=(r(6273),r(80861),r(67498),r(26325)),h=r(4197);const c=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(){super.postscript(),(0,h.jI)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.addHandles((0,a.hA)((()=>e.abort()))),await(0,n.C_)((()=>this.view.defaultsFromMap?.heightModelInfoReady),t),(0,s.Te)(t);const r=(0,h.Hu)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(r)throw r}};return(0,i._)([(0,o.MZ)()],t.prototype,"view",void 0),(0,i._)([(0,o.MZ)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,i._)([(0,l.$)("esri.views.3d.layers.LayerView3D")],t),t}},315:(e,t,r)=>{r.d(t,{V:()=>s});var i=r(64672),a=r(57942);function s(e){const t=e.view.spatialReference,r=e.layer.fullExtent,s=null!=r&&r.spatialReference;if(null==r||!s)return Promise.resolve(null);if(s.equals(t))return Promise.resolve(r.clone());const n=(0,i.Cv)(r,t);return null!=n?Promise.resolve(n):e.view.state.isLocal?(0,a.projectGeometry)(r,t,e.layer.portalItem).then((t=>!e.destroyed&&t?t:null)).catch((()=>null)):Promise.resolve(null)}},75390:(e,t,r)=>{r.d(t,{r:()=>O});var i=r(40041),a=r(77788),s=r(10875),n=r(71678),o=r(31272),l=r(8445),h=r(15449),c=r(26421),d=r(33763),u=r(66356),p=r(83938),g=r(59615),m=r(29290),f=r(82392),_=(r(41014),r(21979)),v=r(19362),y=r(51662),w=r(24441),x=r(28116),E=r(7782),P=r(18693),A=r(2296),I=r(68716),b=r(15651);class S extends v.w{initializeProgram(e){return new w.B(e.rctx,S.shader.get().build(this.configuration),R)}_setPipelineState(e,t){const r=this.configuration,i=e===E.y.NONE,s=e===E.y.FrontFace;return(0,b.Ey)({blending:r.output===a.V.Color&&r.transparent?i?T:(0,l.ez)(e):null,culling:(0,b.Xt)(r.cullFace),depthTest:{func:(0,l.K_)(e)},depthWrite:i?r.writeDepth?b.kn:null:(0,l.XO)(e),drawBuffers:(0,l.cl)(e),colorWrite:b.wE,stencilWrite:r.hasOccludees?x.v0:null,stencilTest:r.hasOccludees?t?x.a9:x.qh:null,polygonOffset:i||s?null:(0,l.aB)(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}S.shader=new _.$(A.I,(()=>r.e(9832).then(r.bind(r,19832))));const T=(0,b.ox)(I.dn.ONE,I.dn.ONE_MINUS_SRC_ALPHA);class C extends P.E{constructor(){super(...arguments),this.output=a.V.Color,this.cullFace=s.s2.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=E.y.NONE,this.multipassEnabled=!1,this.cullAboveGround=!1,this.perspectiveInterpolation=!0}}(0,f._)([(0,y.W)({count:a.V.COUNT})],C.prototype,"output",void 0),(0,f._)([(0,y.W)({count:s.s2.COUNT})],C.prototype,"cullFace",void 0),(0,f._)([(0,y.W)()],C.prototype,"hasSlicePlane",void 0),(0,f._)([(0,y.W)()],C.prototype,"transparent",void 0),(0,f._)([(0,y.W)()],C.prototype,"enableOffset",void 0),(0,f._)([(0,y.W)()],C.prototype,"writeDepth",void 0),(0,f._)([(0,y.W)()],C.prototype,"hasOccludees",void 0),(0,f._)([(0,y.W)({count:E.y.COUNT})],C.prototype,"transparencyPassType",void 0),(0,f._)([(0,y.W)()],C.prototype,"multipassEnabled",void 0),(0,f._)([(0,y.W)()],C.prototype,"cullAboveGround",void 0),(0,f._)([(0,y.W)()],C.prototype,"perspectiveInterpolation",void 0),(0,f._)([(0,y.W)({constValue:!1})],C.prototype,"occlusionPass",void 0);const R=new Map([[d.r.POSITION,0],[d.r.UV0,2],[d.r.PERSPECTIVEDIVIDE,3]]);class O extends g.W{constructor(e){super(e,new N),this.supportsEdges=!0,this.produces=new Map([[h.N.OPAQUE_MATERIAL,e=>(0,a.u5)(e)||(0,a._o)(e)&&!this.parameters.transparent],[h.N.TRANSPARENT_MATERIAL,e=>(0,a._o)(e)&&this.parameters.transparent&&this.parameters.writeDepth],[h.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>(0,a._o)(e)&&this.parameters.transparent&&!this.parameters.writeDepth],[h.N.DRAPED_MATERIAL,e=>(0,a._o)(e)||(0,a.u5)(e)]]),this._vertexAttributeLocations=R,this._configuration=new C}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<l.xt,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}createGLMaterial(e){return new M(e)}createBufferWriter(){const e=p.zK.clone();return this.parameters.perspectiveInterpolation&&e.f32(d.r.PERSPECTIVEDIVIDE),new D(e)}}class M extends n.m{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(S,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}beginSlot(e){return this._output===a.V.Color&&this._updateOccludeeState(e),this._updateParameters(e)}}class D extends u.Z{write(e,t,r,a,s){for(const n of this.vertexBufferLayout.fields.keys()){const o=r.attributes.get(n);if(o)if(n===d.r.PERSPECTIVEDIVIDE){(0,c.vA)(1===o.size);const e=a.getField(n,i.Y$);e&&(0,m.uO)(o,e,s)}else(0,m.zC)(n,o,e,t,a,s)}}}class N extends o.qA{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=s.s2.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0,this.perspectiveInterpolation=!1}}},30386:(e,t,r)=>{r.d(t,{A:()=>l});var i=r(82392),a=r(80861),s=r(37623),n=r(61985),o=(r(6273),r(67498),r(62991),r(26325));const l=e=>{let t=class extends e{initialize(){this.addHandles((0,n.on)((()=>this.layer),"refresh",(e=>{this.doRefresh(e.dataChanged).catch((e=>{(0,s.zf)(e)||a.A.getLogger(this).error(e)}))})),"RefreshableLayerView")}};return t=(0,i._)([(0,o.$)("esri.views.layers.RefreshableLayerView")],t),t}}}]);