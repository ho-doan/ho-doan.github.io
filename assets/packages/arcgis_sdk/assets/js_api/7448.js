"use strict";(self.webpackChunkarcgis_node=self.webpackChunkarcgis_node||[]).push([[7448],{7198:(e,t,r)=>{r.d(t,{F:()=>o});var i=r(54736),n=(r(3223),r(61090),r(15565),r(80861),r(11895));r(33376);function o(e,t,r){if(null==e?.timeInfo)return null;const{datesInUnknownTimezone:o=!1,timeOffset:s,useViewTime:l}=e;let a=e.timeExtent;o&&(a=function(e){if(!e)return e;const{start:t,end:r}=e;return new i.A({start:null!=t?(0,n.S1)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=r?(0,n.S1)(r,r.getTimezoneOffset(),"minutes"):r})}(a));let u=l?t&&a?t.intersection(a):t||a:a;return!u||u.isEmpty||u.isAllTime?u:(s&&(u=u.offset(-s.value,s.unit)),o&&(u=function(e){if(!e)return e;const{start:t,end:r}=e;return new i.A({start:null!=t?(0,n.S1)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=r?(0,n.S1)(r,-r.getTimezoneOffset(),"minutes"):r})}(u)),u.equals(r)?r:u)}},74704:(e,t,r)=>{r.d(t,{A:()=>F});var i,n=r(82392),o=r(3313),s=r(20857),l=r(1817),a=r(84977),u=r(15565),f=r(81482),p=(r(6273),r(80861),r(25376)),d=r(26325),y=r(48524),c=r(44153),h=r(56053),m=r(45352);const g=new l.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let w=i=class extends a.oY{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){const r=c.A.fromJSON(t.spatialReference),i=[];for(let t=0;t<e.length;t++){const n=e[t],o=s.A.fromJSON(n),l=n.geometry?.spatialReference;null==o.geometry||l||(o.geometry.spatialReference=r);const a=n.aggregateGeometries,u=o.aggregateGeometries;if(a&&null!=u)for(const e in u){const t=u[e],i=a[e],n=i?.spatialReference;null==t||n||(t.spatialReference=r)}i.push(o)}return i}writeGeometryType(e,t,r,i){if(e)return void g.write(e,t,r,i);const{features:n}=this;if(n)for(const e of n)if(null!=e?.geometry)return void g.write(e.geometry.type,t,r,i)}readQueryGeometry(e,t){if(!e)return null;const r=!!e.spatialReference,i=(0,h.rS)(e);return i&&!r&&t.spatialReference&&(i.spatialReference=c.A.fromJSON(t.spatialReference)),i}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:r}=this;if(r)for(const e of r)if(e&&null!=e.geometry&&e.geometry.spatialReference)return void(t.spatialReference=e.geometry.spatialReference.toJSON())}clone(){return new i(this.cloneProperties())}cloneProperties(){return(0,u.o8)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let r=0;r<t.features.length;r++){const i=t.features[r];if(i.geometry){const t=e?.[r];i.geometry=t?.toJSON()||i.geometry}}return t}quantize(e){const{scale:[t,r],translate:[i,n]}=e,o=this.features,s=this._getQuantizationFunction(this.geometryType,(e=>Math.round((e-i)/t)),(e=>Math.round((n-e)/r)));for(let e=0,t=o.length;e<t;e++)s?.(o[e].geometry)||(o.splice(e,1),e--,t--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:r}=this;if(!r)return this;const{translate:[i,n],scale:[o,s]}=r;let l=null,a=null;if(this.hasZ&&null!=r?.scale?.[2]){const{translate:[,,e],scale:[,,t]}=r;l=r=>r*t+e}if(this.hasM&&null!=r?.scale?.[3]){const{translate:[,,,e],scale:[,,,t]}=r;a=r=>null==r?r:r*t+e}const u=this._getHydrationFunction(e,(e=>e*o+i),(e=>n-e*s),l,a);for(const{geometry:e}of t)null!=e&&u&&u(e);return this.transform=null,this}_quantizePoints(e,t,r){let i,n;const o=[];for(let s=0,l=e.length;s<l;s++){const l=e[s];if(s>0){const e=t(l[0]),s=r(l[1]);e===i&&s===n||(o.push([e-i,s-n]),i=e,n=s)}else i=t(l[0]),n=r(l[1]),o.push([i,n])}return o.length>0?o:null}_getQuantizationFunction(e,t,r){return"point"===e?e=>(e.x=t(e.x),e.y=r(e.y),e):"polyline"===e||"polygon"===e?e=>{const i=(0,h.Bi)(e)?e.rings:e.paths,n=[];for(let e=0,o=i.length;e<o;e++){const o=i[e],s=this._quantizePoints(o,t,r);s&&n.push(s)}return n.length>0?((0,h.Bi)(e)?e.rings=n:e.paths=n,e):null}:"multipoint"===e?e=>{const i=this._quantizePoints(e.points,t,r);return i&&i.length>0?(e.points=i,e):null}:"extent"===e?e=>e:null}_getHydrationFunction(e,t,r,i,n){return"point"===e?e=>{e.x=t(e.x),e.y=r(e.y),i&&(e.z=i(e.z))}:"polyline"===e||"polygon"===e?e=>{const o=(0,h.Bi)(e)?e.rings:e.paths;let s,l;for(let e=0,i=o.length;e<i;e++){const i=o[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];e>0?(s+=n[0],l+=n[1]):(s=n[0],l=n[1]),n[0]=t(s),n[1]=r(l)}}if(i&&n)for(let e=0,t=o.length;e<t;e++){const t=o[e];for(let e=0,r=t.length;e<r;e++){const r=t[e];r[2]=i(r[2]),r[3]=n(r[3])}}else if(i)for(let e=0,t=o.length;e<t;e++){const t=o[e];for(let e=0,r=t.length;e<r;e++){const r=t[e];r[2]=i(r[2])}}else if(n)for(let e=0,t=o.length;e<t;e++){const t=o[e];for(let e=0,r=t.length;e<r;e++){const r=t[e];r[2]=n(r[2])}}}:"extent"===e?e=>{e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax),i&&null!=e.zmax&&null!=e.zmin&&(e.zmax=i(e.zmax),e.zmin=i(e.zmin)),n&&null!=e.mmax&&null!=e.mmin&&(e.mmax=n(e.mmax),e.mmin=n(e.mmin))}:"multipoint"===e?e=>{const o=e.points;let s,l;for(let e=0,i=o.length;e<i;e++){const i=o[e];e>0?(s+=i[0],l+=i[1]):(s=i[0],l=i[1]),i[0]=t(s),i[1]=r(l)}if(i&&n)for(let e=0,t=o.length;e<t;e++){const t=o[e];t[2]=i(t[2]),t[3]=n(t[3])}else if(i)for(let e=0,t=o.length;e<t;e++){const t=o[e];t[2]=i(t[2])}else if(n)for(let e=0,t=o.length;e<t;e++){const t=o[e];t[2]=n(t[2])}}:null}};(0,n._)([(0,f.MZ)({type:String,json:{write:!0}})],w.prototype,"displayFieldName",void 0),(0,n._)([(0,f.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],w.prototype,"exceededTransferLimit",void 0),(0,n._)([(0,f.MZ)({type:[s.A],json:{write:!0}})],w.prototype,"features",void 0),(0,n._)([(0,p.w)("features")],w.prototype,"readFeatures",null),(0,n._)([(0,f.MZ)({type:[m.A],json:{write:!0}})],w.prototype,"fields",void 0),(0,n._)([(0,f.MZ)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:g.read}}})],w.prototype,"geometryType",void 0),(0,n._)([(0,y.K)("geometryType")],w.prototype,"writeGeometryType",null),(0,n._)([(0,f.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],w.prototype,"hasM",void 0),(0,n._)([(0,f.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],w.prototype,"hasZ",void 0),(0,n._)([(0,f.MZ)({types:o.yR,json:{write:!0}})],w.prototype,"queryGeometry",void 0),(0,n._)([(0,p.w)("queryGeometry")],w.prototype,"readQueryGeometry",null),(0,n._)([(0,f.MZ)({type:c.A,json:{write:!0}})],w.prototype,"spatialReference",void 0),(0,n._)([(0,y.K)("spatialReference")],w.prototype,"writeSpatialReference",null),(0,n._)([(0,f.MZ)({json:{write:!0}})],w.prototype,"transform",void 0),w=i=(0,n._)([(0,d.$)("esri.rest.support.FeatureSet")],w),w.prototype.toJSON.isDefaultToJSON=!0;const F=w},33376:(e,t,r)=>{r.d(t,{X:()=>i});const i=Symbol("WebScene")},50241:(e,t,r)=>{r.d(t,{A:()=>g});var i=r(82392),n=r(62991),o=(r(6273),r(80861)),s=r(37623),l=r(61985),a=r(81482),u=(r(67498),r(26325)),f=r(11479),p=r(51216),d=r(46227),y=r(57179),c=r(10591),h=r(83911),m=r(96444);const g=e=>{let t=class extends e{constructor(...e){super(...e),this._updatingRequiredFieldsPromise=null,this.dataUpdating=!1,this.filter=null,this.layer=null,this.requiredFields=[],this.view=null}initialize(){this.addHandles([(0,l.wB)((()=>{const e=this.layer;return[e&&"elevationInfo"in e?e.elevationInfo?.featureExpressionInfo:null,e&&"displayField"in e?e.displayField:null,e&&"timeInfo"in e&&e.timeInfo,e&&"renderer"in e&&e.renderer,e&&"labelingInfo"in e&&e.labelingInfo,e&&"floorInfo"in e&&e.floorInfo,this.filter,this.featureEffect,this.timeExtent]}),(()=>this._handleRequiredFieldsChange()),l.pc),(0,l.on)((()=>this.view?.floors),"change",(()=>this._handleRequiredFieldsChange())),(0,l.on)((()=>{const e=this.layer;return e&&"sublayers"in e?e.sublayers:null}),"change",(()=>this._handleRequiredFieldsChange()))])}get availableFields(){if(!this.layer)return[];const{layer:e,layer:{fieldsIndex:t},requiredFields:r}=this;return"outFields"in e&&e.outFields?(0,d.DB)(t,[...(0,d.hL)(t,e.outFields),...r]):(0,d.DB)(t,r)}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(e){this._override("featureEffect",e)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){o.A.getLogger(this).error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(e){throw new Error("missing implementation")}createQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=null!=this.filter?this.filter.createQuery(e):new c.A(e);if("floorInfo"in this.layer&&this.layer.floorInfo){const e=(0,y.E)(this);null!=e&&(t.where=t.where?`(${t.where}) AND (${e})`:e)}return null!=this.timeExtent&&(t.timeExtent=null!=t.timeExtent?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}createAggregateQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return new c.A(e)}queryFeatures(e,t){throw new Error("missing implementation")}queryObjectIds(e,t){throw new Error("missing implementation")}queryFeatureCount(e,t){throw new Error("missing implementation")}queryExtent(e,t){throw new Error("missing implementation")}async fetchPopupFeaturesFromGraphics(e,t){return this._validateFetchPopupFeatures(e,t),this._fetchPopupFeatures(e,t)}_loadArcadeModules(e){return e.expressionInfos?.length||Array.isArray(e.content)&&e.content.some((e=>"expression"===e.type))?(0,h.lw)():Promise.resolve()}_handleRequiredFieldsChange(){const e=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",e),e.then((()=>{this._updatingRequiredFieldsPromise===e&&this._set("_updatingRequiredFieldsPromise",null)}))}async _updateRequiredFields(){if(!this.layer||!this.view)return;const e="3d"===this.view.type,{layer:t,layer:{fieldsIndex:r,objectIdField:i}}=this,n="renderer"in t&&t.renderer,s="orderBy"in t&&t.orderBy,l="featureReduction"in t?t.featureReduction:null,a=new Set,u=await Promise.allSettled([n?n.collectRequiredFields(a,r):null,(0,d.Im)(a,t),e&&"elevationInfo"in t?(0,d.NO)(a,t):null,null!=this.filter?(0,d.o)(a,t,this.filter):null,e||null==this.featureEffect?null:(0,d.o)(a,t,this.featureEffect.filter),!e&&l?(0,d.RP)(a,t,l):null,!e&&s?(0,d.f)(a,t,s):null]);if("timeInfo"in t&&t.timeInfo&&this.timeExtent&&(0,d._w)(a,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),"floorInfo"in t&&t.floorInfo&&(0,d._w)(a,t.fieldsIndex,[t.floorInfo.floorField]),"feature"===t.type&&e&&null!=t.infoFor3D&&(null==t.globalIdField&&o.A.getLogger(this).error("globalIdField missing on 3DObjectFeatureLayer"),(0,d._w)(a,t.fieldsIndex,[t.globalIdField])),"subtype-group"===t.type){(0,d.rq)(a,r,t.subtypeField);const e=t.sublayers.map((e=>Promise.all([e.renderer?.collectRequiredFields(a,r),(0,d.Im)(a,e)])));await Promise.allSettled(e)}if("catalog-footprint"===t.type&&t.parent){const e=t.parent;(0,d._w)(a,r,[e.itemNameField,e.itemSourceField,e.itemTypeField,e.maxScaleField,e.minScaleField])}for(const e of u)"rejected"===e.status&&o.A.getLogger(this).error(e.reason);(0,d.rq)(a,r,i),e&&"displayField"in t&&t.displayField&&(0,d.rq)(a,r,t.displayField);const f=Array.from(a).sort();this._set("requiredFields",f)}_validateFetchPopupFeatures(e,t){if(null!=t)for(const r of e){const e=r.origin&&"layer"in r.origin?r.origin.layer:r.layer;if("popupEnabled"in e&&!e.popupEnabled)throw new n.A("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:e});if(r.isAggregate){const t="featureReduction"in e?e.featureReduction:null;if(!(t&&"popupTemplate"in t&&t.popupEnabled&&t.popupTemplate))throw new n.A("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:e})}else if("popupTemplate"in e&&!(0,m.D8)(e,t))throw new n.A("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:e})}}_popupFeatureHasRequiredFields(e,t){return(0,d.Kl)(t,e)}async _fetchPopupFeatures(e,t){const r=new Array(e.length),i=new Map,n=await this._createPopupQuery(e.map((e=>e.origin?.layer??e.layer)),t);for(let o=0;o<e.length;o++){const l=e[o];if(l.isAggregate){r[o]=l;continue}const a=l.origin?.layer??l.layer;if(!a||!("popupEnabled"in a))continue;const u=(0,d.hL)(this.layer.fieldsIndex,n.outFields),f=(0,m.D8)(a,t);if(null==f)continue;const p=await this._loadArcadeModules(f);(0,s.Te)(t),p&&p.arcadeUtils.hasGeometryOperations(f)||!this._popupFeatureHasRequiredFields(l,u)?i.set(l.getObjectId(),{graphic:l,index:o}):r[o]=l}if("stream"===this.layer.type||0===i.size)return r.filter(Boolean);n.objectIds=Array.from(i.keys());try{const e=await this.layer.queryFeatures(n,t);for(const t of e.features){const{graphic:{geometry:e,origin:n},index:o}=i.get(t.getObjectId());t.geometry||=e,t.origin=n,r[o]=t}}catch{}return r.filter(Boolean)}async _createPopupQuery(e,t){const r=this.layer.createQuery(),i=new Set;let n=!1;const o=e??[this.layer];for(const e of o){if(!("popupEnabled"in e))continue;const r=(0,m.D8)(e,t);if(null==r)continue;const o=await this._loadArcadeModules(r);(0,s.Te)(t);const l=o&&o.arcadeUtils.hasGeometryOperations(r);n=!("point"!==this.layer.geometryType&&!l);const a=await(0,m.TO)(this.layer,r);(0,s.Te)(t);for(const e of a)i.add(e)}if(r.returnGeometry=n,r.returnZ=n,r.returnM=n,r.outFields=Array.from(i),r.outSpatialReference=this.view.spatialReference,"floorInfo"in this.layer&&this.layer.floorInfo){const e=(0,y.E)(this);null!=e&&(r.where=r.where?`(${r.where}) AND (${e})`:e)}return r}canResume(){return!(!super.canResume()||null!=this.timeExtent&&this.timeExtent.isEmpty)}getTest(){}get test(){}};return(0,i._)([(0,a.MZ)()],t.prototype,"_updatingRequiredFieldsPromise",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],t.prototype,"availableFields",null),(0,i._)([(0,a.MZ)({readOnly:!0})],t.prototype,"dataUpdating",void 0),(0,i._)([(0,a.MZ)({type:f.A})],t.prototype,"featureEffect",null),(0,i._)([(0,a.MZ)({type:p.A})],t.prototype,"filter",void 0),(0,i._)([(0,a.MZ)()],t.prototype,"layer",void 0),(0,i._)([(0,a.MZ)({type:Number})],t.prototype,"maximumNumberOfFeatures",null),(0,i._)([(0,a.MZ)({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null),(0,i._)([(0,a.MZ)({readOnly:!0})],t.prototype,"requiredFields",void 0),(0,i._)([(0,a.MZ)()],t.prototype,"suspended",void 0),(0,i._)([(0,a.MZ)()],t.prototype,"view",void 0),t=(0,i._)([(0,u.$)("esri.views.layers.FeatureLayerView")],t),t}},30386:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(82392),n=r(80861),o=r(37623),s=r(61985),l=(r(6273),r(67498),r(62991),r(26325));const a=e=>{let t=class extends e{initialize(){this.addHandles((0,s.on)((()=>this.layer),"refresh",(e=>{this.doRefresh(e.dataChanged).catch((e=>{(0,o.zf)(e)||n.A.getLogger(this).error(e)}))})),"RefreshableLayerView")}};return t=(0,i._)([(0,l.$)("esri.views.layers.RefreshableLayerView")],t),t}}}]);