"use strict";(self.webpackChunkarcgis_node=self.webpackChunkarcgis_node||[]).push([[4957],{54957:(e,t,s)=>{s.r(t),s.d(t,{default:()=>oe});var i=s(82392),r=s(37623),n=s(81482),a=(s(6273),s(80861)),o=(s(67498),s(26325)),l=s(52239),u=s(61090),h=s(61985),p=s(5262),c=s(34561),m=s(93516),d=(s(3313),s(20857)),g=(s(39553),s(3438),s(60861)),_=s(57725),v=s(59491),y=s(68660),w=s(65670),f=s(22538),M=s(11682),b=s(84456),A=s(5896),L=s(67907),O=s(19793),T=s(66019),Z=s(83423),S=s(6364),D=s(17071),k=s(13243),G=s(28535),q=s(51720),x=s(54500),C=s(53981),R=s(10709),U=s(4631),z=s(1912),j=s(55736),B=s(84655),V=s(31864),W=s(70842),H=s(68231),I=s(38648),E=s(44153),$=s(65648);const J=1e5;let K=class extends S.g{constructor(e){super(e),this._drawActive=!1,this._measurementLayer=new M.A({internal:!0,listMode:"hide",visible:!1}),this._manipulatorLayer=new M.A({internal:!0,listMode:"hide",visible:!1}),this._snappingLayer=new M.A({internal:!0,listMode:"hide",visible:!1}),this._updatingHandles=new y.U,this._vertices=[],this.geodesicDistanceThreshold=null,this.measurement=null,this.measurementLabel=null}initialize(){(0,R.ud)("esri/core/t9n/Units").then((e=>{this.messages=e}));const e=this.view;this._draw=new L.A({view:e}),e.map.addMany([this._measurementLayer,this._manipulatorLayer,this._snappingLayer]),e.focus(),this._snappingManagerResult=(0,x.X)(e),this.addHandles([(0,U.oQ)((async()=>{this.messages=await(0,R.ud)("esri/core/t9n/Units")})),(0,h.wB)((()=>[this.unit,this.geodesicDistanceThreshold,this.messages]),(()=>{this._updateGraphics()}),h.Vh),(0,h.wB)((()=>[this.view.effectiveTheme.accentColor,this.view.effectiveTheme.textColor]),(()=>{if(!this._vertices.length)return;const e=this._vertices.map((({coord:e})=>e));for(const{handle:e}of this._vertices)e.remove();this._vertices=[],this._measurementLayer.removeAll(),this._manipulatorLayer.removeAll(),this._snappingLayer.removeAll(),this.manipulators.removeAll(),this._updateSketch(e)})),(0,h.wB)((()=>this.snappingOptions.featureSources),(e=>{for(const t of e)t.layer!==this._measurementLayer&&t.layer!==this._manipulatorLayer||(t.enabled=!1)}),h.Vh),this._snappingManagerResult]),(0,C.BY)(this)}destroy(){const{map:e}=this.view;this._draw.view=null,this._draw=(0,_.pR)(this._draw),e.removeMany([this._measurementLayer,this._manipulatorLayer,this._snappingLayer]),this._measurementLayer.removeAll(),this._manipulatorLayer.removeAll(),this._snappingLayer.removeAll(),this._set("measurement",null),this._set("measurementLabel",null),this._measurementLayer=(0,_.pR)(this._measurementLayer),this._manipulatorLayer=(0,_.pR)(this._manipulatorLayer),this._snappingLayer=(0,_.pR)(this._snappingLayer),this._updatingHandles=(0,_.pR)(this._updatingHandles),this._resetVertices()}get _snappingManager(){return this._snappingManagerResult.snappingManager}get cursor(){return this._drawActive?"crosshair":null}set editable(e){this._set("editable",e),e||this._draw.reset()}get snappingOptions(){return this._snappingManager.options}get updating(){return this._updatingHandles.updating||this._snappingManager.updating}onActivate(){this._drawActive||0!==this._vertices.length||this._startSketch()}onShow(){this._measurementLayer.visible=!0,this._manipulatorLayer.visible=!0,this._snappingLayer.visible=!0}onHide(){this._measurementLayer.visible=!1,this._manipulatorLayer.visible=!1,this._snappingLayer.visible=!1}reset(){this.manipulators.removeAll(),this._resetVertices(),this._measurementLayer.removeAll(),this._manipulatorLayer.removeAll(),this._set("measurement",null),this._set("measurementLabel",null),this._draw.reset(),this._drawActive=!1}_getSnappingContext(e){return new G.e({elevationInfo:{mode:"on-the-ground",offset:0},pointer:e,editGeometryOperations:new k.p(new D.ZE("point",(0,O.BV)(!1,!1,this.view.spatialReference)),b.RT.Local),visualizer:new A.J(this._snappingLayer)})}_resetVertices(){for(const{handle:e}of this._vertices)e.remove();this._vertices=[]}_startSketch(){this._drawActive=!0;const e=this._snappingManager,t=this._draw.create("polyline",{mode:"click",snappingManager:e});t.on(["vertex-add","vertex-update","vertex-remove","cursor-update","undo","redo"],(e=>this._updateSketch(e.vertices))),t.on("draw-complete",(()=>this._stopSketch()))}_stopSketch(){if(this._vertices.length<3)return this.reset(),void this._startSketch();this.manipulators.forEach((({manipulator:e})=>{e.interactive=!0})),this._drawActive=!1,this.finishToolCreation()}_updateSketch(e){const t=this.view.spatialReference;if(t&&(!Q(t)||(0,c.isLoaded)())){for(;this._vertices.length>e.length;){const{handle:e,manipulator:t}=this._vertices.pop();e.remove(),this.manipulators.remove(t)}for(let s=this._vertices.length;s<e.length;s++){const[i,r]=e[s],n=new z.A({x:i,y:r,spatialReference:t}),a=N(n,this.view,this._manipulatorLayer);this.manipulators.add(a);const o=k.p.fromGeometry(n,b.RT.Local);o.on("vertex-update",(e=>{const t=e.vertices.at(0);t&&(this._vertices[s].coord=[t.pos[0],t.pos[1]],this._updateGraphics())}));const l=(0,T.Xt)(a,((e,t,s,i)=>{const r=this._getSnappingContext(i),n=this._snappingManager,a=this._updatingHandles,{snappingStep:l}=(0,q.L)({snappingContext:r,snappingManager:n,updatingHandles:a});t.next((0,T.y$)(this.view)).next((t=>{if("start"===t.action){const s=new z.A(t.mapStart);e.graphic.geometry=s,o.trySetGeometry(s)}return t})).next(...l).next((0,T.Wp)({operations:o})).next((()=>{e.graphic.geometry=o.data.geometry}))}));this._vertices.push({manipulator:a,coord:[i,r],handle:l})}if(this._vertices.length){const s=this._vertices.length-1,i=this._vertices[s],[r,n]=e[s];i.coord[0]===r&&i.coord[1]===n||(i.coord=[r,n],i.manipulator.graphic.geometry=new z.A({x:r,y:n,spatialReference:t}));const a=this._drawActive?this._vertices[s].manipulator:null;this.manipulators.forEach((({manipulator:e})=>{e.interactive=null==a||e!==a}))}this._updateGraphics()}}_updateGraphics(){if(this._vertices.length<2)return void this._measurementLayer.removeAll();const e=function(e,t,s){if(2===e.length){const i=new I.A({paths:e,spatialReference:t});let r;if(t?.isGeographic)if((0,f.TT)(t))r=(0,f.Ow)(i,J);else{const e=(0,c.project)(i,E.A.WGS84),s=(0,f.Ow)(e,J);r=(0,c.project)(s,t)}else if(t?.isWebMercator)r=(0,w.geodesicDensify)(i,J,"meters");else if((0,w.planarLength)(i,"meters")>=X(s)){const e=(0,c.project)(i,E.A.WGS84),s=(0,f.Ow)(e,J);r=(0,c.project)(s,t)}else r=i;return{measurement:null,fillGeometry:null,outlineGeometry:r}}e.push(e[0]);const i=new I.A({paths:[e],spatialReference:t}),r=new $.A({rings:[e],spatialReference:t});let n,a,o=null,l=null;if(t?.isGeographic)if((0,f.TT)(t)){if(o=(0,f.Ow)(i,J),l=(0,f.Ow)(r,J),l=(0,w.simplify)(l),!l)return null;n=(0,f.l1)([i],"meters")[0],a=(0,f.qy)([l],"square-meters")[0]}else{const e=E.A.WGS84,s=(0,c.project)(i,e),u=(0,c.project)(r,e);if(o=(0,f.Ow)(s,J),l=(0,f.Ow)(u,J),l=(0,w.simplify)(l),!l)return null;n=(0,f.l1)([s],"meters")[0],a=(0,f.qy)([l],"square-meters")[0],o=(0,c.project)(o,t),l=(0,c.project)(l,t)}else if(t?.isWebMercator){if(o=(0,w.geodesicDensify)(i,J,"meters"),l=(0,w.geodesicDensify)(r,J,"meters"),l=(0,w.simplify)(l),!l)return null;n=(0,w.geodesicLength)(i,"meters"),a=(0,w.geodesicArea)(l,"square-meters")}else{const e=(0,w.planarLength)(i,"meters");if(e>=X(s)){const e=E.A.WGS84,s=(0,c.project)(i,e),u=(0,c.project)(r,e);if(o=(0,f.Ow)(s,J),l=(0,f.Ow)(u,J),l=(0,w.simplify)(l),!l)return null;n=(0,f.l1)([s],"meters")[0],a=(0,f.qy)([l],"square-meters")[0],o=(0,c.project)(o,t),l=(0,c.project)(l,t)}else{if(o=i,l=(0,w.simplify)(r),!l)return null;n=e,a=(0,w.planarArea)(l,"square-meters")}}return{measurement:{geometry:l,area:a,perimeter:n},fillGeometry:l,outlineGeometry:o}}(this._vertices.map((({coord:e})=>e)),this.view.spatialReference,this.geodesicDistanceThreshold);if(!e)return;const{measurement:t,fillGeometry:s,outlineGeometry:i}=e;this._set("measurement",t);const r=t?function(e,t,s){if(!t||!e)return null;const i={area:null,perimeter:null},{area:r,perimeter:n}=t;switch(s){case"metric":i.area=(0,v.zq)(e,r,"square-meters");break;case"imperial":i.area=(0,v.Sz)(e,r,"square-meters");break;default:{const t=(0,p.oU)(r,"square-meters",s);i.area=(0,v.zJ)(e,t,s);break}}const a=function(e){switch(e){case"metric":case"ares":case"hectares":return"metric";case"imperial":case"acres":return"imperial";case"square-inches":return"inches";case"square-feet":return"feet";case"square-yards":return"yards";case"square-miles":return"miles";case"square-us-feet":return"us-feet";case"square-meters":return"meters";case"square-kilometers":return"kilometers";case"square-millimeters":return"millimeters";case"square-centimeters":return"centimeters";case"square-decimeters":return"decimeters";default:return null}}(s);if(a)switch(a){case"metric":i.perimeter=(0,v.Ee)(e,n,"meters");break;case"imperial":i.perimeter=(0,v.tr)(e,n,"meters");break;default:{const t=(0,p.oU)(n,"meters",a);i.perimeter=(0,v.zJ)(e,t,a);break}}else i.perimeter="";return i}(this.messages,t,this.unit):null;if(this._set("measurementLabel",r),!s&&!i)return;let n,a,o;const{graphics:l}=this._measurementLayer,u=3===l.length,{effectiveTheme:h}=this.view;u?(n=l.at(0),a=l.at(1),o=l.at(2)):(n=new d.A({symbol:new j.A({color:(0,g._L)(h.accentColor,.3),outline:null})}),a=new d.A({symbol:new B.A({color:h.accentColor,width:2})}),o=new d.A({symbol:new V.A({color:h.textColor,font:new W.A({size:14,family:"sans-serif"}),haloColor:(0,g._L)((0,g.bJ)(h.textColor,g.pW.Low),.5),haloSize:2})}),l.removeAll(),l.addMany([n,a,o])),n.geometry=s,a.geometry=i,o.geometry=s?.centroid,o.symbol.text=r?.area??""}};function N(e,t,s){const i={style:"circle",color:(0,g._L)(t.effectiveTheme.accentColor,.5),outline:{type:"simple-line",width:0}},r=new H.A({...i,size:8}),n=new H.A({...i,size:12}),a=new d.A({geometry:e,symbol:r});return new Z.l({view:t,layer:s,graphic:a,focusedSymbol:n})}function Q(e){if(!e)return!1;const{isGeographic:t,isWebMercator:s,isWGS84:i}=e;return t&&!i&&!(0,f.TT)(e)||!t&&!s}function X(e){return e??1/0}(0,i._)([(0,n.MZ)()],K.prototype,"_drawActive",void 0),(0,i._)([(0,n.MZ)({readOnly:!0})],K.prototype,"cursor",null),(0,i._)([(0,n.MZ)({value:!0})],K.prototype,"editable",null),(0,i._)([(0,n.MZ)({type:Number})],K.prototype,"geodesicDistanceThreshold",void 0),(0,i._)([(0,n.MZ)({readOnly:!0})],K.prototype,"measurement",void 0),(0,i._)([(0,n.MZ)({readOnly:!0})],K.prototype,"measurementLabel",void 0),(0,i._)([(0,n.MZ)()],K.prototype,"messages",void 0),(0,i._)([(0,n.MZ)()],K.prototype,"unit",void 0),(0,i._)([(0,n.MZ)()],K.prototype,"updating",null),(0,i._)([(0,n.MZ)({constructOnly:!0})],K.prototype,"view",void 0),K=(0,i._)([(0,o.$)("esri.widgets.AreaMeasurement2D.AreaMeasurement2DTool")],K);var Y=s(74219);let F=class extends Y.j{constructor(e){super(e),this.supportedViewType="2d",this.unsupportedErrorMessage="AreaMeasurement2DViewModel is only supported in 2D views."}initialize(){this.addHandles([(0,h.wB)((()=>this.view?.spatialReference),(()=>this.clear())),(0,h.wB)((()=>this.unit),(e=>{null!=this.tool&&(this.tool.unit=e)}),h.Vh),(0,h.wB)((()=>this.geodesicDistanceThreshold),(e=>{null!=this.tool&&(this.tool.geodesicDistanceThreshold=e)}),h.Vh)])}get geodesicDistanceThreshold(){return this._get("geodesicDistanceThreshold")}set geodesicDistanceThreshold(e){(0,u.Lx)(a.A.getLogger(this),"geodesicDistanceThreshold",{version:"4.29",warnOnce:!0}),this._set("geodesicDistanceThreshold",e)}get measurement(){return null!=this.tool?this.tool.measurement:null}get measurementLabel(){return null!=this.tool?this.tool.measurementLabel:null}get state(){return this.disabled||null==this.view||null==this.view.spatialReference?"disabled":this.tool?.measurement?this.tool.active?"measuring":"measured":"ready"}get unit(){return this._validateUnit(this.defaultUnit)}set unit(e){this._overrideIfSome("unit",this._validateUnit(e))}get unitOptions(){return p.z3}set unitOptions(e){this._overrideIfSome("unitOptions",this._validateUnits(e))}async start(){const e=this.view;null!=e&&(await(0,h.C_)((()=>e.ready)),Q(e.spatialReference)&&await(0,c.load)()),this.createTool({interactive:!0})}clear(){this.removeTool()}constructTool(){return new K({view:this.view,visible:this.visible,geodesicDistanceThreshold:this.geodesicDistanceThreshold,unit:this.unit})}_validateUnit(e){const{unitOptions:t,defaultUnit:s}=this;return null!=e&&t.includes(e)?e:t.includes(s)?s:t.length>0?t[0]:s}_validateUnits(e){if(null==e)return[];const t=e.filter((e=>p.z3.includes(e)));return 0===t.length?p.z3.slice():t}};(0,i._)([(0,n.MZ)(m.q)],F.prototype,"defaultUnit",void 0),(0,i._)([(0,n.MZ)()],F.prototype,"geodesicDistanceThreshold",null),(0,i._)([(0,n.MZ)({readOnly:!0})],F.prototype,"measurement",null),(0,i._)([(0,n.MZ)({readOnly:!0})],F.prototype,"measurementLabel",null),(0,i._)([(0,n.MZ)({readOnly:!0})],F.prototype,"state",null),(0,i._)([(0,n.MZ)({type:String})],F.prototype,"unit",null),(0,i._)([(0,n.MZ)({type:[String]})],F.prototype,"unitOptions",null),F=(0,i._)([(0,o.$)("esri.widgets.AreaMeasurement2D.AreaMeasurement2DViewModel")],F);const P=F;var ee=s(533),te=s(2070),se=(s(33510),s(2153)),ie=s(2110);const re="esri-area-measurement-2d",ne={base:re,newMeasurementButton:`${re}__clear-button`};let ae=class extends l.A{constructor(e,t){super(e,t),this.messages=null,this.messagesUnits=null,this.messagesCommon=null,this.viewModel=new P}get active(){return this.viewModel.active}get icon(){return"measure-area"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get unit(){return this.viewModel.unit}set unit(e){this.viewModel.unit=e}get unitOptions(){return this.viewModel.unitOptions}set unitOptions(e){this.viewModel.unitOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}render(){const{messages:e,messagesCommon:t,messagesUnits:s,unit:i,unitOptions:n,viewModel:a,visible:o}=this,{active:l,measurementLabel:u,state:h,supported:p}=a;return(0,ie.K)("div",{"aria-label":e.widgetLabel,class:this.classes(ne.base,ee.D.widget,ee.D.panel),key:this,role:"presentation"},o?(0,ie.K)(te.I,{active:l,measurementItems:[{key:"area",title:s?.measures.area,value:u?.area},{key:"perimeter",title:e.perimeter,value:u?.perimeter}],messages:{...e,notApplicable:t.notApplicable},newMeasurementButtonClass:ne.newMeasurementButton,state:h,supported:p,unit:i,unitOptions:n,onNewMeasurementClick:()=>{(0,r.QZ)(a.start())},onUnitChange:e=>{this.unit=e}}):null)}};(0,i._)([(0,n.MZ)({readOnly:!0})],ae.prototype,"active",null),(0,i._)([(0,n.MZ)()],ae.prototype,"icon",null),(0,i._)([(0,n.MZ)()],ae.prototype,"label",null),(0,i._)([(0,n.MZ)(),(0,se.G)("esri/widgets/AreaMeasurement2D/t9n/AreaMeasurement2D")],ae.prototype,"messages",void 0),(0,i._)([(0,n.MZ)(),(0,se.G)("esri/core/t9n/Units")],ae.prototype,"messagesUnits",void 0),(0,i._)([(0,n.MZ)(),(0,se.G)("esri/t9n/common")],ae.prototype,"messagesCommon",void 0),(0,i._)([(0,n.MZ)()],ae.prototype,"uiStrings",void 0),(0,i._)([(0,n.MZ)()],ae.prototype,"unit",null),(0,i._)([(0,n.MZ)()],ae.prototype,"unitOptions",null),(0,i._)([(0,n.MZ)()],ae.prototype,"view",null),(0,i._)([(0,n.MZ)({type:P})],ae.prototype,"viewModel",void 0),(0,i._)([(0,n.MZ)({type:Boolean})],ae.prototype,"visible",null),ae=(0,i._)([(0,o.$)("esri.widgets.AreaMeasurement2D")],ae);const oe=ae}}]);