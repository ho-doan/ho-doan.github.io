"use strict";(self.webpackChunkarcgis_node=self.webpackChunkarcgis_node||[]).push([[5052],{45970:(e,t,r)=>{r.d(t,{O:()=>d,W:()=>c});var i=r(82541),n=r(79441),s=r(53334),a=r(80347);const o=(0,r(19913).vt)(),l=(0,n.vt)(),h=(0,n.vt)(),u=(0,n.vt)();function c(e,t,r){return(0,a.s)(o,t[0],t[1],1),(0,a.t)(o,o,(0,i.mg)(l,r)),0===o[2]?(0,s.hZ)(e,o[0],o[1]):(0,s.hZ)(e,o[0]/o[2],o[1]/o[2])}function d(e,t,r){return m(h,t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]),m(u,r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7]),(0,i.lw)(e,(0,i.KC)(h,h),u),0!==e[8]&&(e[0]/=e[8],e[1]/=e[8],e[2]/=e[8],e[3]/=e[8],e[4]/=e[8],e[5]/=e[8],e[6]/=e[8],e[7]/=e[8],e[8]/=e[8]),e}function m(e,t,r,n,s,h,u,c,d){(0,i.hZ)(e,t,n,h,r,s,u,1,1,1),(0,a.s)(o,c,d,1),(0,i.KC)(l,e);const[m,f,p]=(0,a.t)(o,o,(0,i.mg)(l,l));return(0,i.hZ)(l,m,0,0,0,f,0,0,0,p),(0,i.lw)(e,l,e)}},12802:(e,t,r)=>{r.d(t,{NH:()=>a,ip:()=>o,sU:()=>h,vG:()=>u});r(6273);var i=r(62991),n=r(37623),s=r(19759);function a(e){const t=l(e);return null!=t?t.toDataURL():""}async function o(e,t){const r=l(e);if(null==r)throw new i.A("imageToArrayBuffer","Unsupported image type");const a=function(e){if(!(e instanceof HTMLImageElement))return"image/png";const t=e.src;if((0,s.DB)(t)){const e=(0,s.r$)(t);return"image/jpeg"===e?.mediaType?e.mediaType:"image/png"}return/\.png$/i.test(t)?"image/png":/\.(jpg|jpeg)$/i.test(t)?"image/jpeg":"image/png"}(e),o=await new Promise((e=>r.toBlob(e,a)));if((0,n.Te)(t),!o)throw new i.A("imageToArrayBuffer","Failed to encode image");const h=await o.arrayBuffer();return(0,n.Te)(t),{data:h,type:a}}function l(e){if(e instanceof HTMLCanvasElement)return e;if(e instanceof HTMLVideoElement)return null;const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");return e instanceof HTMLImageElement?r.drawImage(e,0,0,e.width,e.height):e instanceof ImageData&&r.putImageData(e,0,0),t}function h(e){const t=[],r=new Uint8Array(e);for(let e=0;e<r.length;e++)t.push(String.fromCharCode(r[e]));return"data:application/octet-stream;base64,"+btoa(t.join(""))}function u(e){if(e.byteLength<8)return!1;const t=new Uint8Array(e);return 137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]}},31275:(e,t,r)=>{r.d(t,{_:()=>c});var i=r(82392),n=r(73783),s=r(81482),a=(r(6273),r(80861),r(67498),r(26325)),o=r(65648),l=r(34561),h=r(2532),u=r(13795);let c=class extends n.A{constructor(e){super(e)}get bounds(){const e=this.coords;return null==e?.extent?null:(0,h.VY)(e.extent)}get coords(){const e=this.element.georeference?.coords;return(0,l.projectOrLoad)(e,this.spatialReference).geometry}get normalizedCoords(){return o.A.fromJSON((0,u.jZ)(this.coords))}get normalizedBounds(){const e=null!=this.normalizedCoords?this.normalizedCoords.extent:null;return null!=e?(0,h.VY)(e):null}};(0,i._)([(0,s.MZ)()],c.prototype,"spatialReference",void 0),(0,i._)([(0,s.MZ)()],c.prototype,"element",void 0),(0,i._)([(0,s.MZ)()],c.prototype,"bounds",null),(0,i._)([(0,s.MZ)()],c.prototype,"coords",null),(0,i._)([(0,s.MZ)()],c.prototype,"normalizedCoords",null),(0,i._)([(0,s.MZ)()],c.prototype,"normalizedBounds",null),c=(0,i._)([(0,a.$)("esri.layers.support.MediaElementView")],c)},77497:(e,t,r)=>{r.d(t,{A:()=>m});var i=r(82541),n=r(93446),s=r(14571),a=r(6590),o=r(87249),l=r(67488),h=r(86757),u=r(90804),c=r(57122),d=r(47764);class m extends d.A{constructor(){super(...arguments),this._viewStateId=-1,this._dvsMat3=(0,n.vt)()}get dvsMat3(){return this._dvsMat3}beforeRender(e){this._updateMatrices(e),this._updateOverlays(e,this.children);for(const t of this.children)t.beforeRender(e)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"overlay",brushes:[u.d.overlay],target:()=>this.children,drawPhase:c.S5.MAP});return[...super.prepareRenderPasses(e),t]}_updateMatrices(e){const{state:t}=e,{id:r,size:n,pixelRatio:l,resolution:h,rotation:u,viewpoint:c,displayMat3:d}=t;if(this._viewStateId===r)return;const m=Math.PI/180*u,f=l*n[0],p=l*n[1];this._localOrigin=c.targetGeometry.clone();const{x:_,y:g}=this._localOrigin,y=(0,o.mT)(_,t.spatialReference);this._localOrigin.x=y,this._localOrigin.y=g;const w=h*f,v=h*p,T=(0,i.D_)(this._dvsMat3);(0,i.lw)(T,T,d),(0,i.Tl)(T,T,(0,s.fA)(f/2,p/2)),(0,i.hs)(T,T,(0,a.fA)(f/w,-p/v,1)),(0,i.e$)(T,T,-m),this._viewStateId=r}_updateOverlays(e,t){const{state:r}=e,{rotation:i,spatialReference:n,worldScreenWidth:s,size:a,viewpoint:o}=r,u=this._localOrigin;let c,d=0;const m=(0,l.Vp)(n);if(m&&n.isWrappable){const e=a[0],t=a[1],l=180/Math.PI*i,u=Math.abs(Math.cos(l)),f=Math.abs(Math.sin(l)),p=Math.round(e*u+t*f),[_,g]=m.valid,y=(0,h.FT)(n),{x:w,y:v}=o.targetGeometry,T=[w,v],A=[0,0];r.toScreen(A,T);const x=[0,0];let M;M=p>s?.5*s:.5*p;const R=Math.floor((w+.5*y)/y),C=_+R*y,F=g+R*y,b=[A[0]+M,0];r.toMap(x,b),x[0]>F&&(d=y),b[0]=A[0]-M,r.toMap(x,b),x[0]<C&&(d=-y),c={worldWidth:y,xBounds:[_,g]}}for(const e of t)e.updateDrawCoords(u,d,n,c)}}},30885:(e,t,r)=>{r.d(t,{ZH:()=>u});var i=r(70214),n=r(67900),s=(r(12802),r(85953)),a=r(51187);function o(e,t){const{width:r,height:i,getFrame:s}=e,a=e.frameDurations.slice(),o=a.pop();return a.push((0,n.l5)(o+t)),{frameCount:e.frameCount,duration:e.duration+t,frameDurations:a,getFrame:s,width:r,height:i}}class l{constructor(e,t,r,i){this._animation=e,this._repeatType=r,this._onFrameData=i,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let n=0;for(;t>n;)n+=this.timeToFrame,this.nextFrame();const s=this._animation.getFrame(this._currentFrame);this._onFrameData(s)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case s.fu.None:this._currentFrame-=this._direction;break;case s.fu.Loop:this._currentFrame=0;break;case s.fu.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case s.fu.None:this._currentFrame-=this._direction;break;case s.fu.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case s.fu.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const e=this._animation.getFrame(this._currentFrame);this._onFrameData(e)}}function h(e,t,r,i){let h,{repeatType:u}=t;if(null==u&&(u=s.fu.Loop),!0===t.reverseAnimation&&(e=function(e){const{width:t,height:r}=e,i=e.frameDurations.reverse();return{frameCount:e.frameCount,duration:e.duration,frameDurations:i,getFrame:t=>{const r=e.frameDurations.length-1-t;return e.getFrame(r)},width:t,height:r}}(e)),null!=t.duration&&(e=function(e,t){const{width:r,height:i,getFrame:s}=e,a=t/e.duration,o=e.frameDurations.map((e=>(0,n.l5)(e*a)));return{frameCount:e.frameCount,duration:e.duration,frameDurations:o,getFrame:s,width:r,height:i}}(e,(0,n.l5)(1e3*t.duration))),null!=t.repeatDelay){const r=1e3*t.repeatDelay;u===s.fu.Loop?e=o(e,(0,n.l5)(r)):u===s.fu.Oscillate&&(e=function(e,t){const{width:r,height:i,getFrame:s}=e,a=e.frameDurations.slice(),o=a.shift();return a.unshift((0,n.l5)(o+t)),{frameCount:e.frameCount,duration:e.duration+t,frameDurations:a,getFrame:s,width:r,height:i}}(o(e,(0,n.l5)(r/2)),(0,n.l5)(r/2)))}if(null!=t.startTimeOffset)h=(0,n.l5)(1e3*t.startTimeOffset);else if(null!=t.randomizeStartTime){const i=82749913,s=null!=t.randomizeStartSeed?t.randomizeStartSeed:i,o=(0,a.J)(r,s);h=(0,n.l5)(o*function(e){return(0,n.l5)(e.frameDurations.reduce(((e,t)=>e+t),0))}(e))}else h=(0,n.l5)(0);return new l(e,h,u,i)}function u(e,t,r,n){const s=null==t.playAnimation||t.playAnimation,a=h(e,t,r,n);let o,l=a.timeToFrame;return function e(){o=s?setTimeout((()=>{a.nextFrame(),l=a.timeToFrame,e()}),l):void 0}(),(0,i.hA)((()=>s&&clearTimeout(o)))}},51187:(e,t,r)=>{r.d(t,{A:()=>s,J:()=>n});var i=r(21332);function n(e,t){let r;if("string"==typeof e)r=(0,i.Wm)(e+`-seed(${t})`);else{let i=12;r=e^t;do{r=107*(r>>8^r)+i|0}while(0!=--i)}return(1+r/(1<<31))/2}function s(e){return Math.floor(n(e,a)*o)}const a=53290320,o=10},5052:(e,t,r)=>{r.r(t),r.d(t,{default:()=>j});var i=r(82392),n=(r(3313),r(20857),r(42957),r(8499),r(72502),r(2394),r(52721),r(46243),r(79645),r(1851),r(29221),r(80861)),s=(r(3438),r(40377)),a=(r(6273),r(80294)),o=r(37623),l=r(61985),h=r(81482),u=(r(67498),r(26325)),c=r(2532),d=r(10805),m=r(19387),f=r(31275),p=r(62991),_=(r(9987),r(49095),r(60861),r(32083),r(70842),r(39744),r(8e3)),g=(r(61064),r(67709),r(1912),r(65648),r(38648),r(60929),r(67488),r(15303),r(24606),r(16444),r(89467),r(85388),r(20965),r(19773),r(15717),r(53697),r(12868),r(78230),r(14275),r(43826),r(22535),r(84520),r(75607),r(82871),r(40771),r(79789),r(27272),r(78557),r(70760),r(85953)),y=(r(4506),r(6538),r(14571),r(99576),r(61793),r(9427),r(39637),r(24085),r(57888),r(85202),r(57122),r(27724),r(53357),r(63103),r(68716)),w=(r(49214),r(95614),r(86424),r(89958)),v=(r(75904),r(74416),r(73553),r(84077),r(2379),r(93911),r(52371),r(50668),r(3947),r(9683),r(84500),r(38116),r(19759),r(16269),r(1980),r(33548),r(23747),r(42010),r(41820),r(47819),r(39313),r(64329),r(5467),r(90927),r(36123),r(23695),r(20059),r(46373),r(93814),r(37249),r(98721),r(43208),r(22956),r(33121),r(15651),r(41014),r(72628),r(48779),r(70947),r(91814),r(6590),r(75981),r(44153),r(99263),r(6480),r(38788),r(3132),r(68660),r(47252),r(62516),r(39156),r(7836)),T=r(11679),A=r(92840),x=r(57725),M=r(45970),R=r(79441),C=r(53334),F=r(56560),b=r(40087),E=r(30885),S=r(89325),V=r(88416),D=r(40866);const O=[1,1],z=(0,R.vt)(),H={none:g.fu.None,loop:g.fu.Loop,oscillate:g.fu.Oscillate};class L extends b.q{constructor(e){super(),this.elementView=e,this.isWrapAround=!1,this.wrapAroundShift=0,this.perspectiveTransform=(0,F.vt)(),this._playHandle=null,this._vertices=new Float32Array(20),this._handles=[],this._handles.push((0,l.wB)((()=>this.elementView.element.opacity),(e=>this.opacity=e),l.Vh),(0,l.wB)((()=>[this.elementView.coords]),(()=>{this.requestRender()}),l.Vh),(0,l.wB)((()=>["animationOptions"in this.elementView.element&&this.elementView.element.animationOptions]),(()=>{this._playHandle?.remove(),this.texture=(0,x.WD)(this.texture),this.requestRender()}),l.Vh),(0,l.z7)((()=>this.elementView.element.loaded),(()=>{const e=this.elementView.element;this.ready(),"video"===e.type&&null!=e.content&&this._handles.push((0,A.on)(e.content,"play",(()=>this.requestRender())))}),l.Vh)),e.element.load().catch((t=>{n.A.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new p.A("element-load-error","Element cannot be displayed",{element:e,error:t}))}))}getMesh(e){throw new Error("Method not implemented.")}destroy(){this._playHandle?.remove(),this._handles.forEach((e=>e.remove())),this.texture=(0,x.WD)(this.texture)}get textureSize(){return O}get dvsMat3(){return this.parent.dvsMat3}beforeRender(e){const{context:t}=e,r=this.elementView.element.content;if(null!=r){const e=r instanceof HTMLImageElement,i=r instanceof HTMLVideoElement,n=e?r.naturalWidth:i?r.videoWidth:r.width,s=e?r.naturalHeight:i?r.videoHeight:r.height;if(this._updatePerspectiveTransform(n,s),this.texture)i&&!r.paused&&(this.texture.setData(r),this.requestRender(),this.texture.generateMipmap());else{const e=new V.R;if(e.wrapMode=y.pF.CLAMP_TO_EDGE,e.preMultiplyAlpha=!0,e.width=n,e.height=s,"getFrame"in r){const i=r=>{this.texture?this.texture.setData(r):this.texture=new w.g(t,e,r),this.requestRender()};"animationOptions"in this.elementView.element&&(this._playHandle=(0,E.ZH)(r,function(e){return e?{...e,playAnimation:e.playing,repeatType:e.repeatType?H[e.repeatType]:void 0}:{}}(this.elementView.element.animationOptions),null,i))}else this.texture=new w.g(t,e,r);this.texture.generateMipmap(),i&&!r.paused&&this.requestRender()}}super.beforeRender(e)}_createTransforms(){return null}draw(e){e.drawArrays(y.WR.TRIANGLE_STRIP,0,4)}updateDrawCoords(e,t,r,i){const{coords:n,bounds:s}=this.elementView;if(null==n||null==s)return;const[a,o,l,h]=n.rings[0],u=this._vertices,{x:c,y:d}=e;u.set([o[0]-c,o[1]-d,a[0]-c,a[1]-d,l[0]-c,l[1]-d,h[0]-c,h[1]-d]);let m=t;if(i){const[e,,t]=s,{worldWidth:r,xBounds:n}=i,[a,o]=n;e<a&&t>a?m=r:t>o&&e<o&&(m=-r)}this.wrapAroundShift=m,this.isWrapAround=0!==m}getVAO(e,t,r){if(null==this.elementView.coords)return null;const i=this._vertices;if(this._vao)this._geometryVbo.setData(i);else{this._geometryVbo=S.g.createVertex(e,y._U.DYNAMIC_DRAW,i);const n=S.g.createVertex(e,y._U.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1]));this._vao=new D.Z(e,r,t,{geometry:this._geometryVbo,tex:n})}return this._vao}_updatePerspectiveTransform(e,t){const r=this._vertices;(0,M.O)(z,[0,0,e,0,0,t,e,t],[r[0],r[1],r[4],r[5],r[2],r[3],r[6],r[7]]),(0,C.hZ)(this.perspectiveTransform,z[6]/z[8]*e,z[7]/z[8]*t)}}var q=r(77497),G=r(7511),I=r(24775);let U=class extends((0,G.e)(I.A)){constructor(){super(...arguments),this._overlayContainer=null,this._fetchQueue=null,this._tileStrategy=null,this._elementReferences=new Map,this._debugGraphicsView=null,this.layer=null,this.elements=new s.A}attach(){this.addAttachHandles([(0,l.on)((()=>this.layer.effectiveSource),"refresh",(()=>{this._tileStrategy.refresh((e=>this._updateTile(e))),this.requestUpdate()})),(0,l.on)((()=>this.layer.effectiveSource),"change",(({element:e})=>this._elementUpdateHandler(e)))]),this._overlayContainer=new q.A,this.container.addChild(this._overlayContainer),this._fetchQueue=new v.A({tileInfoView:this.view.featuresTilingScheme,concurrency:10,process:(e,t)=>this._queryElements(e,t)}),this._tileStrategy=new T.A({cachePolicy:"purge",resampling:!0,acquireTile:e=>this._acquireTile(e),releaseTile:e=>this._releaseTile(e),tileInfoView:this.view.featuresTilingScheme}),this.requestUpdate()}detach(){this.elements.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.destroy(),this._overlayContainer.removeAllChildren(),this.container.removeAllChildren(),this._elementReferences.clear(),this._debugGraphicsView?.destroy()}supportsSpatialReference(e){return!0}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}update(e){this._tileStrategy.update(e),this._debugGraphicsView?.update(e)}async hitTest(e,t){const r=[],i=e.normalize(),n=[i.x,i.y];for(const{projectedElement:{normalizedCoords:t,element:i}}of this._elementReferences.values())null!=t&&(0,d.t1)(t.rings,n)&&r.push({type:"media",element:i,layer:this.layer,mapPoint:e,sourcePoint:i.toSource(e)});return r.reverse()}canResume(){return null!=this.layer.source&&super.canResume()}async doRefresh(){this._fetchQueue.reset(),this._tileStrategy.refresh((e=>this._updateTile(e)))}_acquireTile(e){const t=new B(e.clone());return this._updateTile(t),t}_updateTile(e){this._updatingHandles.addPromise(this._fetchQueue.push(e.key).then((t=>{const[r,i]=e.setElements(t);this._referenceElements(e,r),this._dereferenceElements(e,i),this.requestUpdate()}),(e=>{(0,o.zf)(e)||n.A.getLogger(this).error(e)})))}_releaseTile(e){this._fetchQueue.abort(e.key.id),e.elements&&this._dereferenceElements(e,e.elements),this.requestUpdate()}async _queryElements(e,t){const r=this.layer.effectiveSource;if(null==r)return[];this.view.featuresTilingScheme.getTileBounds(Z,e,!0);const i=new _.A({xmin:Z[0],ymin:Z[1],xmax:Z[2],ymax:Z[3],spatialReference:this.view.spatialReference});return r.queryElements(i,t)}_referenceElements(e,t){if(null!=this.layer.source)for(const r of t)this._referenceElement(e,r)}_referenceElement(e,t){(0,a.tE)(this._elementReferences,t.uid,(()=>{const e=new f._({element:t,spatialReference:this.view.spatialReference}),r=new L(e);this._overlayContainer.addChild(r),this.elements.add(t);return{tiles:new Set,projectedElement:e,overlay:r,debugGraphic:null}})).tiles.add(e)}_dereferenceElements(e,t){for(const r of t)this._dereferenceElement(e,r)}_dereferenceElement(e,t){const r=this._elementReferences.get(t.uid);r.tiles.delete(e),r.tiles.size||(this._overlayContainer.removeChild(r.overlay),r.overlay.destroy(),r.projectedElement.destroy(),this._elementReferences.delete(t.uid),this.elements.remove(t),this._debugGraphicsView?.graphics.remove(r.debugGraphic))}_elementUpdateHandler(e){let t=this._elementReferences.get(e.uid);if(t){const r=t.projectedElement.normalizedCoords;if(null==r)return this._overlayContainer.removeChild(t.overlay),t.overlay.destroy(),t.projectedElement.destroy(),this._elementReferences.delete(e.uid),this.elements.remove(e),void this._debugGraphicsView?.graphics.remove(t.debugGraphic);const i=[],n=[];for(const e of this._tileStrategy.tiles){const s=W(this.view.featuresTilingScheme,e,r);t.tiles.has(e)?s||n.push(e):s&&i.push(e)}for(const t of i)this._referenceElement(t,e);for(const t of n)this._dereferenceElement(t,e);return t=this._elementReferences.get(e.uid),void(t?.debugGraphic&&(t.debugGraphic.geometry=t.projectedElement.normalizedCoords,this._debugGraphicsView.graphicUpdateHandler({graphic:t.debugGraphic,property:"geometry"})))}const r=new f._({element:e,spatialReference:this.view.spatialReference}).normalizedCoords;if(null!=r)for(const t of this._tileStrategy.tiles)W(this.view.featuresTilingScheme,t,r)&&this._referenceElement(t,e)}};(0,i._)([(0,h.MZ)()],U.prototype,"layer",void 0),(0,i._)([(0,h.MZ)({readOnly:!0})],U.prototype,"elements",void 0),U=(0,i._)([(0,u.$)("esri.views.2d.layers.MediaLayerView2D")],U);const Z=(0,c.vt)(),P={xmin:0,ymin:0,xmax:0,ymax:0};function W(e,t,r){return e.getTileBounds(Z,t.key,!0),P.xmin=Z[0],P.ymin=Z[1],P.xmax=Z[2],P.ymax=Z[3],(0,m.fA)(P,r)}class B{constructor(e){this.key=e,this.elements=null,this.isReady=!1,this.visible=!0}setElements(e){const t=[],r=new Set(this.elements);this.elements=e;for(const i of e)r.has(i)?r.delete(i):t.push(i);return this.isReady=!0,[t,Array.from(r)]}destroy(){}}const j=U}}]);