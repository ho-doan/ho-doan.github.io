"use strict";(self.webpackChunkarcgis_node=self.webpackChunkarcgis_node||[]).push([[2083],{22589:(e,t,s)=>{s.d(t,{$r:()=>a,M$:()=>o,mF:()=>n});var r=s(93814),i=s(43621);const n={selection:e=>new i.A({color:new r.A([e.color.r/2,e.color.g/2,e.color.b/2,e.color.a])}),highlight:e=>e,popup:e=>new i.A({color:new r.A([e.color.g,e.color.b,e.color.r,e.color.a])})};function a(e){if(!e)return 0;let t=1;for(const s in n){if(s===e)break;t<<=1}return t}const o=Object.keys(n)},51187:(e,t,s)=>{s.d(t,{A:()=>n,J:()=>i});var r=s(21332);function i(e,t){let s;if("string"==typeof e)s=(0,r.Wm)(e+`-seed(${t})`);else{let r=12;s=e^t;do{s=107*(s>>8^s)+r|0}while(0!=--r)}return(1+s/(1<<31))/2}function n(e){return Math.floor(i(e,a)*o)}const a=53290320,o=10},55591:(e,t,s)=>{s.d(t,{o:()=>ie});var r=s(41820),i=s(47819),n=s(39313),a=s(64329),o=s(5467),c=s(90927),h=s(36123),l=s(23695),u=s(20059),d=s(80294),m=s(23572),f=s(94464),p=s(68749),_=s(53334),g=s(14571),x=s(56560),y=s(5525),v=s(65977),M=s(99576),P=s(31927),w=s(71345),b=s(87574),I=s(61866);function S(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e}function L(e,t){return Math.sqrt(e*e+t*t)}function k(e){const t=L(e[0],e[1]);e[0]/=t,e[1]/=t}function z(e,t){return L(e[0]-t[0],e[1]-t[1])}function A(e){return e.length-1}function B(e){let t=0;for(let s=0;s<A(e);s++)t+=E(e,s);return t}function E(e,t,s=1){let[r,i]=function(e,t){return e[t+1]}(e,t);return[r,i]=[Math.round(r),Math.round(i)],Math.sqrt(r*r+i*i)*s}class D{constructor(e,t,s,r,i){this._segments=e,this._index=t,this._distance=s,this._xStart=r,this._yStart=i,this._done=!1}static create(e){return new D(e,0,0,e[0][0],e[0][1])}clone(){return new D(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(e){return this._index===e._index||e._index===this._index-1&&(0===this._distance||1===e._distance)||e._index===this._index+1&&(1===this._distance||0===e._distance)}leq(e){return this._index<e._index||this._index===e._index&&this._distance<=e._distance}geq(e){return this._index>e._index||this._index===e._index&&this._distance>=e._distance}get _segment(){return this._segments[this._index+1]}get angle(){const e=this.dy,t=(0*e+-1*-this.dx)/(1*this.length);let s=Math.acos(t);return e>0&&(s=2*Math.PI-s),s}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:e,dy:t}=this;return Math.sqrt(e*e+t*t)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<A(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(e,t){const s=this.backwardLength;if(e<=s)return this._distance=(s-e)/this.length,this;let r=this.backwardLength;for(;this.prev();){if(r+this.length>e)return this._seekBackwards(e-r);r+=this.length}return this._distance=0,t?this:null}seek(e,t=!1){if(e<0)return this._seekBackwards(Math.abs(e),t);if(e<=this.remainingLength)return this._distance=(this.backwardLength+e)/this.length,this;let s=this.remainingLength;for(;this.next();){if(s+this.length>e)return this.seek(e-s,t);s+=this.length}return this._distance=1,t?this:null}}function G(e,t,s,r=!0){const i=B(e),n=D.create(e),a=i/2;if(!r)return n.seek(a),void(Math.abs(n.x)<I.s&&Math.abs(n.y)<I.s&&s(n.clone(),0,a+0*t,i));const o=Math.max((i-t)/2,0),c=Math.floor(o/t),h=a-c*t;n.seek(h);for(let e=-c;e<=c;e++)Math.abs(n.x)<I.s&&Math.abs(n.y)<I.s&&s(n.clone(),e,a+e*t,i),n.seek(t)}function R(e,t){const s=t;for(let t=0;t<e.length;t++){let r=e[t];N(r,s);const i=[];i.push(r[0]);for(let e=1;e<r.length;e++){const[t,s]=r[e-1],[n,a]=r[e],o=n-t,c=a-s;i.push([o,c])}e[t]=i,r=i}return e}function N(e,t){const s=1e-6;if(t<=0)return;const r=e.length;if(r<3)return;const i=[];let n=0;i.push(0);for(let t=1;t<r;t++)n+=z(e[t],e[t-1]),i.push(n);t=Math.min(t,.2*n);const a=[];a.push(e[0][0]),a.push(e[0][1]);const o=e[r-1][0],c=e[r-1][1],h=S([0,0],e[0],e[1]);k(h),e[0][0]+=t*h[0],e[0][1]+=t*h[1],S(h,e[r-1],e[r-2]),k(h),e[r-1][0]+=t*h[0],e[r-1][1]+=t*h[1];for(let e=1;e<r;e++)i[e]+=t;i[r-1]+=t;const l=.5*t;for(let n=1;n<r-1;n++){let o=0,c=0,h=0;for(let r=n-1;r>=0&&!(i[r+1]<i[n]-l);r--){const a=l+i[r+1]-i[n],u=i[r+1]-i[r],d=i[n]-i[r]<l?1:a/u;if(Math.abs(d)<s)break;const m=d*d,f=d*a-.5*m*u,p=d*u/t,_=e[r+1],g=e[r][0]-_[0],x=e[r][1]-_[1];o+=p/f*(_[0]*d*a+.5*m*(a*g-u*_[0])-m*d*u*g/3),c+=p/f*(_[1]*d*a+.5*m*(a*x-u*_[1])-m*d*u*x/3),h+=p}for(let a=n+1;a<r&&!(i[a-1]>i[n]+l);a++){const r=l-i[a-1]+i[n],u=i[a]-i[a-1],d=i[a]-i[n]<l?1:r/u;if(Math.abs(d)<s)break;const m=d*d,f=d*r-.5*m*u,p=d*u/t,_=e[a-1],g=e[a][0]-_[0],x=e[a][1]-_[1];o+=p/f*(_[0]*d*r+.5*m*(r*g-u*_[0])-m*d*u*g/3),c+=p/f*(_[1]*d*r+.5*m*(r*x-u*_[1])-m*d*u*x/3),h+=p}a.push(o/h),a.push(c/h)}a.push(o),a.push(c);for(let t=0,s=0;t<r;t++)e[t][0]=a[s++],e[t][1]=a[s++]}var Z=s(51917),T=s(37249);const F=(0,d.Bj)((e=>{let t=0;if(0===e)return 1/0;for(;!(e%2);)t++,e/=2;return t}));class O extends T.G8{constructor(){super(...arguments),this._zoomLevel=0}_write(e,t,s,r){if(this._zoomLevel=r||0,null!=s)throw new Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(t.geometryType){case"esriGeometryPoint":{const s=t.readXForDisplay(),r=t.readYForDisplay();return this._writePoint(e,s,r,t)}case"esriGeometryEnvelope":case"esriGeometryPolygon":case"esriGeometryMultipoint":{const s=t.readCentroidForDisplay();if(!s)return;const[r,i]=s.coords;return this._writePoint(e,r,i,t)}case"esriGeometryPolyline":this._writeLines(e,t)}}_writePoint(e,t,s,r){const i=this._getShaping();if(!i)return;let n=this._getPointReferenceBounds();n||(n={offsetX:0,offsetY:0,size:0});const a=i.boundsT,o=(0,M.xy)(this.evaluatedMeshParams.horizontalAlignment),c=(0,M.UD)(this.evaluatedMeshParams.verticalAlignment),h=this.evaluatedMeshParams.scaleInfo?.maxScale??0,l=this.evaluatedMeshParams.scaleInfo?.minScale??0,u=(0,P.Q4)(r.getDisplayId());e.metricStart(new b.f(u,t,s,o,c,h,l,n)),e.metricBoxWrite(a),this._writeGlyphs(e,r.getDisplayId(),t,s,i,0,n),e.metricEnd()}_getPointReferenceBounds(){if(!this._references)return null;for(const e of this._references){const t=e.getBoundsInfo();if(t)return t}return null}_writeLines(e,t){const{scaleInfo:s,verticalAlignment:r}=this.evaluatedMeshParams,i=this.evaluatedMeshParams.repeatLabelDistance||128,n=this._getShaping("middle");if(!n)return;const a=(e,t,s,r)=>this._placeSubdivGlyphs(e,t,s,r),o=(n.bounds.width+i)/2;this._current={out:e,id:t.getDisplayId(),shaping:n,zoomRange:(0,Z.My)(s,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0},offsetDirection:null},this._verticalPlacement="bottom"===r?"above":"top"===r?"below":null,this._verticalPlacement?this._writeAboveAndBelowAlong(t,a,o):this._writeCenterAlong(t,a,o)}_writeAboveAndBelowAlong(e,t,s){const{repeatLabel:r,fontSize:i}=this.evaluatedMeshParams,{shaping:n}=this._current,a=(0,m.Lz)(i),o=e.readGeometryForDisplay();if(!o)return;const c=new v.A;(0,y.kz)(c,o,!1,!1,"esriGeometryPolyline",1);const h=V(new v.A,c,a),l=V(new v.A,c,-a),u=(0,y.zv)(l,"esriGeometryPolyline",!1,!1),d=R((0,y.zv)(h,"esriGeometryPolyline",!1,!1).paths,n.bounds.width),f=R(u.paths,n.bounds.width);this._current.offsetDirection="above";for(const e of d)G(e,s,t,!!r);this._current.offsetDirection="below";for(const e of f)G(e,s,t,!!r)}_writeCenterAlong(e,t,s){const{repeatLabel:r}=this.evaluatedMeshParams,{shaping:i}=this._current,n=R(e.readLegacyGeometryForDisplay().paths,i.bounds.width);for(const e of n)G(e,s,t,!!r)}_placeSubdivGlyphs(e,t,s,r){const{allowOverrun:i,labelPosition:n,repeatLabelDistance:a}=this.evaluatedMeshParams,o=this._current.zoomRange[0],c=F(t),h=this._current.shaping.bounds.width/2,l=Math.sqrt(a||128)/2,u=Math.min(s,r-s),d=this._current.shaping.isMultiline?T.GJ:Math.log2(u/(l+h/2)),m=0===t?d:Math.min(c,d),f=Math.max(o,this._zoomLevel+1-m),p=this._zoomLevel-f,_=this._current.shaping.bounds.width/2*2**p;this._current.shaping.isMultiline?0===t&&this._placeStraight(e,f):i&&p<0?this._placeStraightAlong(e,o):"parallel"===n?this._placeStraightAlong(e,f):"curved"===n&&this._placeCurved(e,f,_)}_placeStraight(e,t){const{out:s,id:r,shaping:i,referenceBounds:n}=this._current,{x:a,y:o}=e,c=(0,P.Q4)(r),h=this.evaluatedMeshParams.scaleInfo?.maxScale??0,l=this.evaluatedMeshParams.scaleInfo?.minScale??0;s.metricStart(new b.f(c,e.x,e.y,0,0,h,l,null)),s.metricBoxWrite(i.boundsT);const u=e.angle*(180/Math.PI)%360,d=(e.angle*(180/Math.PI)+180)%360;this._writeGlyphs(s,r,a,o,i,0,n,{clipAngle:u,mapAligned:!0,isLineLabel:!0,minZoom:t}),this._writeGlyphs(s,r,a,o,i,0,n,{clipAngle:d,mapAligned:!0,isLineLabel:!0,minZoom:t}),s.metricEnd()}_placeCurved(e,t,s){const{out:r,id:i}=this._current,n=e.clone(),a=e.angle*(180/Math.PI)%360,o=(e.angle*(180/Math.PI)+180)%360,c=(0,P.Q4)(i),h=this.evaluatedMeshParams.scaleInfo?.maxScale??0,l=this.evaluatedMeshParams.scaleInfo?.minScale??0;r.metricStart(new b.f(c,e.x,e.y,0,0,h,l,null)),this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||(this._placeFirst(n,t,1,a),this._placeBack(e,n,t,s,1,a),this._placeForward(e,n,t,s,1,a)),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||(this._placeFirst(n,t,0,o),this._placeBack(e,n,t,s,0,o),this._placeForward(e,n,t,s,0,o)),r.metricEnd()}_placeStraightAlong(e,t){const{out:s,id:r,shaping:i,zoomRange:n,referenceBounds:a}=this._current,{boxBorderLineColor:o,boxBackgroundColor:c}=this.evaluatedMeshParams,h=e.clone(),l=e.angle*(180/Math.PI)%360,u=(e.angle*(180/Math.PI)+180)%360;if(i.glyphs.length>0&&(o||c)){const o=Math.max(t,n[0],0),c=Math.min(T.GJ,n[1]),h=(0,f.$0)((0,p.vt)(),-e.angle),d={minZoom:o,maxZoom:c,clipAngle:l,mapAligned:!0,isLineLabel:!0},_=(0,m.Lz)(this.evaluatedMeshParams.offsetX),x=(0,m.Lz)(this.evaluatedMeshParams.offsetY);if(!this._verticalPlacement||this._verticalPlacement===this._current.offsetDirection){const t=(0,g.fA)(_,-1*x),[n,o]=i.shapeBackground((0,f.Tl)((0,p.vt)(),h,t));s.recordStart(this.instanceId,this.attributeLayout,i.glyphs[0].textureBinding);const c=2*Math.max(n.width,n.height);s.recordBounds(e.x+n.x,e.y+n.y,c,c),this._writeTextBox(s,r,e.x,e.y,o,a,d),s.recordEnd()}if(!this._verticalPlacement||this._verticalPlacement!==this._current.offsetDirection){const t=(0,g.fA)(_,x),[n,o]=i.shapeBackground((0,f.Tl)((0,p.vt)(),h,t));d.clipAngle=u,s.recordStart(this.instanceId,this.attributeLayout,i.glyphs[0].textureBinding);const c=2*Math.max(n.width,n.height);s.recordBounds(e.x+n.x,e.y+n.y,c,c),this._writeTextBox(s,r,e.x,e.y,o,a,d),s.recordEnd()}}const d=(0,P.Q4)(r),_=this.evaluatedMeshParams.scaleInfo?.maxScale??0,x=this.evaluatedMeshParams.scaleInfo?.minScale??0;s.metricStart(new b.f(d,e.x,e.y,0,0,_,x,null)),this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||this._placeFirst(h,t,1,l,!0),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||this._placeFirst(h,t,0,u,!0),s.metricEnd()}_placeBack(e,t,s,r,i,n){const a=e.clone();let o=e.backwardLength+0;for(;a.prev()&&!(o>=r);)this._placeOnSegment(a,t,o,s,-1,i,n),o+=a.length+0}_placeForward(e,t,s,r,i,n){const a=e.clone();let o=e.remainingLength+0;for(;a.next()&&!(o>=r);)this._placeOnSegment(a,t,o,s,1,i,n),o+=a.length+0}_placeFirst(e,t,s,r,i=!1){const{out:n,id:a,shaping:o,zoomRange:c,referenceBounds:h}=this._current,l=o.glyphs;for(const u of l){const l=u.x>o.bounds.x?s:1-s,d=l*e.remainingLength+(1-l)*e.backwardLength,m=Math.abs(u.x+u.width/2-o.bounds.x),f=Math.max(0,this._zoomLevel+Math.log2(m/(d+0))),p=Math.max(t,i?0:f);u.maxZoom=Math.min(c[1],T.GJ),u.angle=e.angle+(1-s)*Math.PI,u.minZoom=Math.max(c[0],p),this._writeLineGlyph(n,a,e.x,e.y,o.bounds,u,r,h,!0),s&&this._isVisible(u.minZoom,u.maxZoom)&&n.metricBoxWrite(u.bounds)}}_placeOnSegment(e,t,s,r,i,n,a){const{out:o,id:c,shaping:h,referenceBounds:l}=this._current,u=h.glyphs,d=e.dx/e.length,m=e.dy/e.length,f={x:e.x+s*-i*d,y:e.y+s*-i*m};for(const d of u){const u=d.x>h.bounds.x?n:1-n;if(!(u&&1===i||!u&&-1===i))continue;const m=Math.abs(d.x+d.width/2-h.bounds.x),p=Math.max(0,this._zoomLevel+Math.log2(m/s)-.1),_=Math.max(r,this._zoomLevel+Math.log2(m/(s+e.length+0)));if(0!==p&&(d.angle=e.angle+(1-n)*Math.PI,d.minZoom=_,d.maxZoom=p,this._writeLineGlyph(o,c,f.x,f.y,h.bounds,d,a,l,!0),n&&this._isVisible(d.minZoom,d.maxZoom))){const s=d.bounds,r=e.x-t.x,i=e.y-t.y,n=new w.A(s.center[0]+r,s.center[1]+i,s.width,s.height);o.metricBoxWrite(n)}}}_writeLineGlyph(e,t,s,r,i,n,a,o,c){const h=s+i.x,l=r+i.y,u=2*(this.evaluatedMeshParams.minPixelBuffer?this.evaluatedMeshParams.minPixelBuffer/this._textMeshTransformProps.fontSize:1),d=Math.max(i.width,i.height)*u;e.recordStart(this.instanceId,this.attributeLayout,n.textureBinding),e.recordBounds(h,l,d,d);const{texcoords:m,offsets:f}=n,p=this._textMeshTransformProps.fontSize;this._writeQuad(e,t,s,r,{texcoords:m,offsets:f,fontSize:p,color:(0,Z.Jb)(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:o,minZoom:Math.max(this._current.zoomRange[0],n.minZoom),maxZoom:Math.min(this._current.zoomRange[1],n.maxZoom),clipAngle:a,mapAligned:c,isLineLabel:!0}),e.recordEnd()}_isVisible(e,t){const s=this._zoomLevel;return e<=s&&s<=t}}function V(e,t,s){const{coords:r,lengths:i}=t,n=(0,x.vt)(),a=(0,x.vt)(),o=(0,x.vt)(),c=(0,x.vt)(),h=(0,x.vt)(),l=(0,x.vt)();let u=0;for(let t=0;t<i.length;t++){const d=i[t];for(let t=0;t<d;t++){const i=2*(t+u-1),m=2*(t+u),f=2*(t+u+1);t>0?(0,_.hZ)(n,r[i],r[i+1]):(0,_.hZ)(n,0,0),(0,_.hZ)(a,r[m],r[m+1]),t<d-1?(0,_.hZ)(o,r[f],r[f+1]):(0,_.hZ)(o,0,0),0===t?(0,_.hZ)(c,0,0):((0,_.jb)(c,a,n),(0,_.S8)(c,c),(0,_.hZ)(c,c[1],-c[0])),t===d-1?(0,_.hZ)(h,0,0):((0,_.jb)(h,o,a),(0,_.S8)(h,h),(0,_.hZ)(h,h[1],-h[0])),(0,_.WQ)(l,c,h),(0,_.S8)(l,l);const p=l[0]*h[0]+l[1]*h[1];0!==p&&(0,_.hs)(l,l,p),(0,_.hs)(l,l,s),e.coords.push(a[0]+l[0],a[1]+l[1])}e.lengths.push(d),u+=d}return e}var W=s(98721),C=s(43208),j=s(22956),q=s(3223),$=s(62991),Q=s(15565),J=s(80861),Y=s(51187),X=s(43135),H=s(77377);async function K(e,t,s=!1){const{defaultValue:r,valueExpressionInfo:i,value:n}=t;if(i){const{expression:n}=i,a=await e.createComputedField({expression:n},s);return a?{...t,computed:a,defaultValue:r}:null}return{...t,computed:new H.G(n),defaultValue:r}}async function U(e,t){const{defaultValue:s,valueExpressionInfo:r}=t,{expression:i}=r,n=await e.createComputedField({expression:i});return n?{...t,computed:n,defaultValue:s}:null}const ee=e=>"boolean"!=typeof e&&"number"!=typeof e&&"valueExpressionInfo"in e,te=e=>e.some((e=>{for(const t in e){const s=e[t];if(ee(s))return!0}return!1}));class se{static async create(e,t,s){const r={},i=new Map,n=new Map,a=new Map,o=new Map,c=new Map;for(const h in s){const l=s[h];if(null!=l&&"object"==typeof l)if(Array.isArray(l)){if("object"==typeof l[0])throw new Error(`InternalError: Cannot handle ${h}. Nested array params are not supported`);r[h]=l}else if("valueExpressionInfo"in l){if(l.value){r[h]=l.value;continue}const t=await U(e,l);if(!t){r[h]=l.defaultValue;continue}i.set(h,t),r[h]=null}else switch(l.type){case"cim-effect-infos":if(l.effectInfos.some((e=>e.overrides.length))){n.set(h,{effects:await Promise.all(l.effectInfos.map((async t=>{const s=t.overrides.map((t=>K(e,t)));return{effect:t.effect,compiledOverrides:(await Promise.all(s)).filter(q.Ru)}})))});break}r[h]=l.effectInfos.map((e=>e.effect));break;case"cim-marker-placement-param":l.overrides.length&&a.set(h,{placementInfo:l,compiledOverrides:(await Promise.all(l.overrides.map((t=>K(e,t))))).filter(q.Ru)}),r[h]=l.placement;break;case"text-rasterization-param":{if(l.overrides.length){const t=l.overrides.map((t=>K(e,t,l.useLegacyLabelEvaluationRules)));o.set(h,{compiledOverrides:(await Promise.all(t)).filter(q.Ru),rasterizationParam:l,objectIdToResourceId:new Map});continue}const s={type:"cim-rasterization-info",resource:l.resource};r[h]=await t.fetchResourceImmediate(s)??null;break}case"sprite-rasterization-param":{if(l.overrides.length){const t=l.overrides.map((t=>K(e,t)));o.set(h,{compiledOverrides:(await Promise.all(t)).filter(q.Ru),rasterizationParam:l,objectIdToResourceId:new Map});continue}if("animated"===l.resource.type){o.set(h,{compiledOverrides:[],rasterizationParam:l,objectIdToResourceId:new Map});continue}const s={type:"cim-rasterization-info",resource:l.resource};r[h]=await t.fetchResourceImmediate(s)??null;break}case"cim-marker-transform-param":{const{params:t}=l;if(te(t)){const s={compiledMarkerInfos:[]};await Promise.all(t.map((async t=>{const r={props:{}};for(const s in t)if(ee(t[s])){const i=await U(e,t[s]);r.compiledExpressionMap||(r.compiledExpressionMap=new Map);const n=r.compiledExpressionMap;i&&n.set(s,i)}else r.props[s]=t[s];s.compiledMarkerInfos.push(r)}))),c.set(h,s)}else r[h]={type:"cim-marker-transform-info",infos:t};break}default:r[h]=l}else r[h]=l}return new se(s,r,i,n,a,o,c)}constructor(e,t,s,r,i,n,a){this.inputMeshParams=e,this._resolvedMeshParams=t,this._dynamicProperties=s,this._dynamicEffectProperties=r,this._dynamicPlacementProperties=i,this._dynamicAsyncProperties=n,this._dynamicTransformProperties=a,this.evaluator=e=>e}get hasDynamicProperties(){return!!(this._dynamicProperties.size||this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size)}get evaluatedMeshParams(){return this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams)),this._evaluatedMeshParams}enqueueRequest(e,t,s){for(const r of this._dynamicAsyncProperties.values()){const i=(0,Q.o8)(r.rasterizationParam.resource);"animated"===r.rasterizationParam.resource.type&&r.rasterizationParam.resource.randomizeStartTime&&(i.primitiveName="__RESERVED__PRIMITIVE__NAME__",i.startGroup=(0,Y.A)(t.getObjectId()||0));for(const{primitiveName:e,propertyName:n,computed:a,defaultValue:o,valueExpressionInfo:c}of r.compiledOverrides)try{const c="animated"===r.rasterizationParam.resource.type?i.primitiveName:e;(0,X.Ph)(i,c,n,a,t,s,o)}catch(t){J.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator").errorOnce(new $.A("invalid-arcade-expression",`Encountered an error when evaluating the arcade expression '${c?.expression}' (primitive: '${e}', property: '${n}')`,t))}const n=e.enqueueRequest({type:"cim-rasterization-info",resource:i});r.objectIdToResourceId.set(t.getObjectId(),n)}}evaluateMeshParams(e,t,s){for(const[e,r]of this._dynamicProperties.entries())this._resolvedMeshParams[e]=r.computed.readWithDefault(t,s,r.defaultValue);for(const[e,r]of this._dynamicPlacementProperties.entries())for(const{computed:i,defaultValue:n,propertyName:a}of r.compiledOverrides){const o=i.readWithDefault(t,s,n);r.placementInfo.placement[a]=o,this._resolvedMeshParams[e]=r.placementInfo.placement}for(const[e,r]of this._dynamicEffectProperties.entries())for(const i of r.effects){for(const{computed:e,defaultValue:r,propertyName:n}of i.compiledOverrides){const a=e.readWithDefault(t,s,r);i.effect[n]=a}this._resolvedMeshParams[e]=r.effects.map((e=>e.effect))}for(const[e,r]of this._dynamicTransformProperties.entries()){const i={type:"cim-marker-transform-info",infos:[]};for(const e of r.compiledMarkerInfos){const r={...e.props};if(e.compiledExpressionMap)for(const[i,n]of e.compiledExpressionMap){const e=n.computed.readWithDefault(t,s,n.defaultValue);r[i]="number"==typeof e||"boolean"==typeof e?e:n.defaultValue}i.infos.push(r)}this._resolvedMeshParams[e]=i}for(const[s,r]of this._dynamicAsyncProperties.entries()){const i=r.objectIdToResourceId.get(t.getObjectId());if(null==i)continue;const n=e.getResource(i);this._resolvedMeshParams[s]=n}return this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams),this.evaluatedMeshParams}}var re=s(33121);class ie{async createMeshWriter(e,t,s,r){const i=this._getMeshWriter(r.techniqueType),n=await se.create(e,t,r.inputParams),a=new i(r.id,n,r.optionalAttributes,s);return await a.loadDependencies(),a}_getMeshWriter(e){switch(e){case r.N.Fill:return o.Y;case r.N.DotDensity:return i.k;case r.N.ComplexFill:return n.KE;case r.N.PatternFill:return h.m;case r.N.OutlineFill:return c.w0;case r.N.PatternOutlineFill:return l.Q;case r.N.ComplexOutlineFill:return a.O;case r.N.Marker:return j.H;case r.N.PieChart:return re.v;case r.N.Text:return T.G8;case r.N.Line:return W.Bw;case r.N.TexturedLine:return C.K;case r.N.Heatmap:return u.h;case r.N.Label:return O;case r.N.Test:throw new Error("Internal Error: Found invalid mesh writer")}}}},77377:(e,t,s)=>{s.d(t,{G:()=>i});var r=s(13666);class i extends r.L{constructor(e){super(),this._value=e}resize(e){}read(e,t){return this._value}readWithDefault(e,t,s){return this._value}referencesScale(){return!1}referencesGeometry(){return!1}}}}]);