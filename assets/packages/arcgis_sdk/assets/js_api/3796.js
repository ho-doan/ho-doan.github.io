"use strict";(self.webpackChunkarcgis_node=self.webpackChunkarcgis_node||[]).push([[3796],{53357:(e,t,i)=>{function r(){return new Float32Array(4)}function s(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function n(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function a(){return r()}function o(){return n(1,1,1,1)}function l(){return n(1,0,0,0)}function c(){return n(0,1,0,0)}function h(){return n(0,0,1,0)}function d(){return n(0,0,0,1)}i.d(t,{fA:()=>n,o8:()=>s});const u=a(),p=o(),_=l(),v=c(),m=h(),w=d();Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_W:w,UNIT_X:_,UNIT_Y:v,UNIT_Z:m,ZEROS:u,clone:s,create:r,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:n,ones:o,unitW:d,unitX:l,unitY:c,unitZ:h,zeros:a},Symbol.toStringTag,{value:"Module"}))},14793:(e,t,i)=>{i.d(t,{P:()=>l});var r=i(82392),s=i(70214),n=i(71004),a=i(81482),o=(i(6273),i(80861),i(67498),i(26325));const l=e=>{let t=class extends((0,n.g)(e)){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(e){this._userInteractive=e}get updating(){return!1}get visible(){return null==this.parent||this.parent.visible&&!this.parent.suspended}set visible(e){this._overrideIfSome("visible",e)}forceInteractiveForViewModel(){return this._interactiveViewModelCount++,(0,s.hA)((()=>this._interactiveViewModelCount--))}};return(0,r._)([(0,a.MZ)({constructOnly:!0})],t.prototype,"parent",void 0),(0,r._)([(0,a.MZ)({constructOnly:!0})],t.prototype,"view",void 0),(0,r._)([(0,a.MZ)({type:Boolean})],t.prototype,"interactive",null),(0,r._)([(0,a.MZ)()],t.prototype,"_userInteractive",void 0),(0,r._)([(0,a.MZ)({readOnly:!0})],t.prototype,"updating",null),(0,r._)([(0,a.MZ)()],t.prototype,"visible",null),(0,r._)([(0,a.MZ)()],t.prototype,"_interactiveViewModelCount",void 0),t=(0,r._)([(0,o.$)("esri.views.3d.analysis.AnalysisView3D")],t),t}},62530:(e,t,i)=>{i.d(t,{Bw:()=>m,D9:()=>M,DG:()=>d,E3:()=>C,FF:()=>l,Hb:()=>n,I4:()=>b,Jj:()=>R,Ll:()=>p,NT:()=>w,Sw:()=>S,UF:()=>o,YG:()=>O,ZR:()=>_,aE:()=>E,aj:()=>D,c1:()=>h,cE:()=>c,cO:()=>v,lS:()=>u,qD:()=>f,rb:()=>y,sd:()=>A,vA:()=>V,vo:()=>a,xj:()=>g});var r=i(6273),s=i(4506);const n=(0,r.A)("mac")?"Meta":"Control",a="Shift",o=2,l=1.15,c=1.15,h=2500,d=.02,u=Math.cos((0,s.kU)(45)),p=Math.cos((0,s.kU)(5)),_=.95,v=.3,m=2,w=1,f=3,y=11,g=22.5,b=40,V=48,M=2.25,D=4,O=1,R=.3,C=6,A=4,S=1600,E=.4},93796:(e,t,i)=>{i.r(t),i.d(t,{default:()=>bt});var r=i(82392),s=i(73783),n=i(57725),a=i(61985),o=i(81482),l=(i(6273),i(80861),i(67498),i(26325)),c=i(14793),h=i(70214),d=i(93814),u=i(15565),p=i(4506),_=i(25336),v=i(26110),m=i(80347),w=i(19913),f=(i(53334),i(56560)),y=i(65670),g=(i(11631),i(59484)),b=i(61506);function V({tiltedUpVector:e,rightVector:t,observerRenderSpace:i},r){const s=(0,g.wQ)(e,t,i,r);return s[12]=0,s[13]=0,s[14]=0,s}function M(e,t,i){const r=(0,w.vt)(),s=(0,m.b)((0,w.vt)(),i.basis1,i.basis2);return e.next((0,b.AA)(t,i.plane)).next((e=>{"start"===e.action&&(0,m.c)(r,e.renderStart);const t=(0,p.KJ)((0,g.FY)(r,e.renderEnd,i.origin,s));return{...e,deltaAngle:t}}))}function D(e,t){if(null==e)return 0;const{observer:i,target:r}=e,s=t.camera.position,n=(0,y.distance)(s,i)>(0,y.distance)(s,r)?i:r;return t.pixelSizeAt(n)}(0,f.vt)();var O=i(9921),R=i(31272),C=i(51310);const A=new d.A([85,85,85,.5]);let S=class extends s.A{constructor(e){super(e),this.visible=!0,this._viewshedCorners={topLeft:(0,w.vt)(),topRight:(0,w.vt)(),bottomLeft:(0,w.vt)(),bottomRight:(0,w.vt)(),center:(0,w.vt)()},this._arcCenterPoints={top:(0,w.vt)(),bottom:(0,w.vt)(),left:(0,w.vt)(),right:(0,w.vt)()},this._parallelCenters={top:(0,w.vt)(),bottom:(0,w.vt)()}}initialize(){const e={view:this.view,isDecoration:!0,color:this._color,renderOccluded:R.m$.OccludeAndTransparent},t={...e,width:2,stipplePattern:(0,C.wk)(2)};this._boundaryLinesVisualElement=new O.t(e),this._leftArcVisualElement=new O.t(e),this._rightArcVisualElement=new O.t(e),this._topArcVisualElement=new O.t(e),this._bottomArcVisualElement=new O.t(e),this._centralLongitude=new O.t(t),this._centralLatitude=new O.t(t),this.addHandles([(0,a.wB)((()=>{const e=this.viewshedComputedData;if(!e?.isValid())return null;const t=this._offsetScale,i=this._viewshedCorners,r=this._arcCenterPoints,s=this._parallelCenters;return e.cornerPoints(t,i),e.arcCentersPoints(t,r),e.parallelCenterPoints(s),{viewshedComputedData:e,corners:i,arcCenters:r,parallelCenters:s}}),(e=>{null!=e?(this._forEachVisualElement((e=>e.attached=!0)),this._updateVisualElements(e)):this._forEachVisualElement((e=>e.attached=!1))}),{initial:!0,equals:u.aI}),(0,a.wB)((()=>({visible:this.visible,horFOV:this.viewshedComputedData?.horizontalFieldOfView})),(({visible:e,horFOV:t},i)=>{e!==i?.visible&&this._forEachVisualElement((t=>t.visible=e)),e&&t!==i?.horFOV&&(this._boundaryLinesVisualElement.visible=360!==t)}),a.Vh),(0,a.wB)((()=>this._color),(e=>this._forEachVisualElement((t=>t.color=e))),a.Vh)])}get _color(){const e=this.viewshedComputedData;if(null==e)return d.A.toUnitRGBA(A);const t=this.analysisViewData,i=t.tool?.active||t.interactive,r=e===t.selectedViewshedComputedData,s=e.viewshed===t.tool?.stagedViewshed,n=i&&(r||s)?this.view.effectiveTheme.accentColor:A;return d.A.toUnitRGBA(n)}get _offsetScale(){return D(this.viewshedComputedData,this.view)}destroy(){this._boundaryLinesVisualElement=(0,n.pR)(this._boundaryLinesVisualElement),this._leftArcVisualElement=(0,n.pR)(this._leftArcVisualElement),this._rightArcVisualElement=(0,n.pR)(this._rightArcVisualElement),this._topArcVisualElement=(0,n.pR)(this._topArcVisualElement),this._bottomArcVisualElement=(0,n.pR)(this._bottomArcVisualElement),this._centralLongitude=(0,n.pR)(this._centralLongitude),this._centralLatitude=(0,n.pR)(this._centralLatitude)}_forEachVisualElement(e){[this._boundaryLinesVisualElement,this._leftArcVisualElement,this._rightArcVisualElement,this._topArcVisualElement,this._bottomArcVisualElement,this._centralLatitude,this._centralLongitude].forEach(e)}_updateVisualElements(e){const{viewshedComputedData:t,corners:i,arcCenters:r,parallelCenters:s}=e;this._updateBoundaryLines(i),this._updateBoundaryArcs(t,i,s),this._updateCentralHelperArcs(t,r)}_updateBoundaryLines(e){this._boundaryLinesVisualElement.geometry=[[e.center,e.topLeft],[e.center,e.topRight],[e.center,e.bottomLeft],[e.center,e.bottomRight]]}_updateBoundaryArcs(e,t,i){const{observerRenderSpace:r,rightVector:s,horizontalFieldOfView:n,tiltedUpVector:a}=e,o=(0,p.kU)(n),l=(0,w.vt)(),c=(0,v.vt)();(0,_.$0)(c,o/2,a),(0,m.h)(l,s,c),E(this._leftArcVisualElement,r,t.bottomLeft,t.topLeft,"forward",l),(0,_.$0)(c,-o/2,a),(0,m.s)(l,0,0,0),(0,m.h)(l,s,c),E(this._rightArcVisualElement,r,t.bottomRight,t.topRight,"forward",l);const h=n>180?"backward":"forward";E(this._topArcVisualElement,i.top,t.topRight,t.topLeft,h,a),E(this._bottomArcVisualElement,i.bottom,t.bottomRight,t.bottomLeft,h,a)}_updateCentralHelperArcs(e,t){const i=e.observerRenderSpace,r=e.horizontalFieldOfView>=180?"backward":"forward";E(this._centralLatitude,i,t.right,t.left,r,e.tiltedUpVector),E(this._centralLongitude,i,t.top,t.bottom,"forward",e.leftVector)}};function E(e,t,i,r,s,n,a=5){const o=(0,w.vt)();(0,m.z)(o,i,t);const l=(0,m.H)(o),c=(0,w.vt)();(0,m.z)(c,r,t),(0,m.n)(c,c),(0,m.j)(c,c,l);let h=(0,m.d)(o,c);const d=(0,w.o8)(n);"backward"===s&&((0,m.k)(d,d),h=-(2*Math.PI-h));const u=[],f=Math.ceil(Math.abs(h)/(0,p.kU)(a)),y=(0,v.vt)();(0,_.$0)(y,h/f,d);const g=(0,w.vt)();(0,m.c)(g,o);const b=(0,w.vt)();(0,m.c)(b,i);for(let e=0;e<f;e++){const e=(0,w.vt)();(0,m.c)(e,b),(0,m.h)(g,g,y),(0,m.g)(b,t,g);const i=(0,w.vt)();(0,m.c)(i,b),u.push([e,i])}e.geometry=u}(0,r._)([(0,o.MZ)()],S.prototype,"view",void 0),(0,r._)([(0,o.MZ)()],S.prototype,"analysisViewData",void 0),(0,r._)([(0,o.MZ)()],S.prototype,"viewshedComputedData",void 0),(0,r._)([(0,o.MZ)()],S.prototype,"visible",void 0),(0,r._)([(0,o.MZ)()],S.prototype,"_color",null),(0,r._)([(0,o.MZ)()],S.prototype,"_offsetScale",null),S=(0,r._)([(0,l.$)("esri.views.3d.analysis.Viewshed.ViewshedVisualization")],S);const T=S;let P=class extends s.A{get visible(){return this.analysisViewData.visible}constructor(e){super(e)}initialize(){const e=this.analysisViewData,t=(0,a.LF)((()=>this.analysisViewData.viewshedComputedDataHandles),(({viewshedComputedData:t})=>{const i=new T({view:this.view,viewshedComputedData:t,analysisViewData:e});return{visualization:i,remove:()=>i.destroy()}}));this._viewshedVisualizations=t,this.addHandles([(0,h.DQ)(t),(0,a.wB)((()=>this.visible),(e=>this._viewshedVisualizations.forEach((({visualization:t})=>t.visible=e))))])}};(0,r._)([(0,o.MZ)({constructOnly:!0})],P.prototype,"analysisViewData",void 0),(0,r._)([(0,o.MZ)({constructOnly:!0,nonNullable:!0})],P.prototype,"view",void 0),(0,r._)([(0,o.MZ)({constructOnly:!0})],P.prototype,"isDecoration",void 0),(0,r._)([(0,o.MZ)()],P.prototype,"visible",null),P=(0,r._)([(0,l.$)("esri.views.3d.analysis.Viewshed.ViewshedAnalysisVisualization")],P);i(3313);var F,H=i(1912);let x=F=class extends s.A{constructor(e){super(e)}get observer(){return this.viewshed.observer??new H.A}get farDistance(){return this.viewshed.farDistance}get farDistanceRenderSpace(){return this.farDistance/this.metersPerUnit}get heading(){return this.viewshed.heading}get tilt(){return this.viewshed.tilt}get tiltParallelToSurface(){return this.tilt-90}get horizontalFieldOfView(){return this.viewshed.horizontalFieldOfView}get verticalFieldOfView(){return this.viewshed.verticalFieldOfView}get observerRenderSpace(){return this._pointToRenderSpace(this.observer,(0,w.vt)())}get target(){const e=this.targetRenderSpace;return this.renderSpaceToPoint(e,this.observer.spatialReference)}get targetRenderSpace(){const{leftVector:e,northVector:t,upVector:i}=this,r=this.observerRenderSpace,s=this.farDistanceRenderSpace,n=(0,w.vt)();return(0,m.j)(n,t,s),Z(n,-(0,p.kU)(this.heading),i,n),Z(n,-(0,p.kU)(this.tiltParallelToSurface),e,n),(0,m.g)(n,r,n),n}get targetDirection(){const e=(0,m.z)((0,w.vt)(),this.targetRenderSpace,this.observerRenderSpace);return(0,m.n)(e,e)}get tiltedUpVector(){const e=Z(this.upVector,-(0,p.kU)(this.tiltParallelToSurface),this.leftVector,(0,w.vt)());return(0,m.n)(e,e)}get _basis(){return this.renderCoordsHelper.basisMatrixAtPosition(this.observerRenderSpace,(0,v.vt)())}get upVector(){const e=this._basis;return(0,w.fA)(e[8],e[9],e[10])}get northVector(){const e=this._basis;return(0,w.fA)(e[4],e[5],e[6])}get leftVector(){const e=this.upVector,t=Z(this.northVector,-(0,p.kU)(this.heading),e,(0,w.vt)());return(0,m.b)(t,e,t)}get rightVector(){return(0,m.k)((0,w.vt)(),this.leftVector)}clone(){return new F({renderCoordsHelper:this.renderCoordsHelper,viewshed:this.viewshed.clone()})}isValid(){return this.viewshed.isValid()}get metersPerUnit(){return this.renderCoordsHelper.spatialReference.metersPerUnit}pointOnSphere(e,t,i){const{observerRenderSpace:r,targetRenderSpace:s}=this,n=(0,m.z)(k,s,r);return Z(n,-(0,p.kU)(t),this.leftVector,n),Z(n,-(0,p.kU)(e),this.tiltedUpVector,n),(0,m.g)(i,n,r)}cornerPoints(e,t){const i=this.observerRenderSpace,r=this.horizontalFieldOfView/2,s=this.verticalFieldOfView/2,n=this.pointOnSphere(-r,s,X),a=this.pointOnSphere(r,s,Y),o=this.pointOnSphere(-r,-s,q),l=this.pointOnSphere(r,-s,K),c=(0,m.z)(N,n,i),h=(0,m.z)(B,a,i),d=(0,m.z)(W,o,i),u=(0,m.z)($,l,i),{horizontalFieldOfView:p}=this,_=L;G(c,h,n,o,i,e,p,t.topLeft,t.bottomLeft,_);const v=I;G(u,d,a,l,i,e,p,t.topRight,t.bottomRight,v),(0,m.j)(t.center,(0,m.g)(t.center,v,_),.5)}arcCentersPoints(e,t){const i=this.horizontalFieldOfView/2,r=this.verticalFieldOfView/2,s=this.pointOnSphere(0,r,t.top),n=this.pointOnSphere(0,-r,t.bottom),a=this.pointOnSphere(-i,0,t.left),o=this.pointOnSphere(i,0,t.right),{observerRenderSpace:l}=this;U(s,l,e),U(n,l,e),U(a,l,e),U(o,l,e)}parallelCenterPoints(e){const t=this.observerRenderSpace,i=this.farDistanceRenderSpace*Math.sin((0,p.kU)(this.verticalFieldOfView/2)),r=(0,m.j)(k,this.tiltedUpVector,i);(0,m.g)(e.top,t,r),(0,m.z)(e.bottom,t,r)}renderSpaceToPoint(e,t){const i=k;return this.renderCoordsHelper.fromRenderCoords(e,i,t),new H.A(i[0],i[1],i[2],t)}_pointToRenderSpace(e,t){const i=(0,w.ci)(e.toArray());return this.renderCoordsHelper.toRenderCoords(i,e.spatialReference,t),t}};function G(e,t,i,r,s,n,a,o,l,c){const h=function(e,t,i,r){const s=(0,m.b)(r,e,t);return(0,m.n)(s,s),(0,m.j)(s,s,i),s}(e,t,n,j);(0,m.g)(c,s,h),z(i,e,h,n,a,o),z(r,e,h,n,a,l)}function Z(e,t,i,r){return(0,_.$0)(J,t,i),(0,m.h)(r,e,J)}function z(e,t,i,r,s,n){const a=(0,m.n)(k,t);return(0,m.j)(a,a,r),(0,m.g)(n,e,a),0!==s&&360!==s&&(0,m.g)(n,n,i),n}function U(e,t,i){const r=(0,m.z)(k,e,t);(0,m.n)(r,r),(0,m.j)(r,r,i),(0,m.g)(e,e,r)}(0,r._)([(0,o.MZ)()],x.prototype,"renderCoordsHelper",void 0),(0,r._)([(0,o.MZ)()],x.prototype,"viewshed",void 0),(0,r._)([(0,o.MZ)()],x.prototype,"observer",null),(0,r._)([(0,o.MZ)()],x.prototype,"farDistance",null),(0,r._)([(0,o.MZ)()],x.prototype,"farDistanceRenderSpace",null),(0,r._)([(0,o.MZ)()],x.prototype,"heading",null),(0,r._)([(0,o.MZ)()],x.prototype,"tilt",null),(0,r._)([(0,o.MZ)()],x.prototype,"tiltParallelToSurface",null),(0,r._)([(0,o.MZ)()],x.prototype,"horizontalFieldOfView",null),(0,r._)([(0,o.MZ)()],x.prototype,"verticalFieldOfView",null),(0,r._)([(0,o.MZ)()],x.prototype,"observerRenderSpace",null),(0,r._)([(0,o.MZ)()],x.prototype,"target",null),(0,r._)([(0,o.MZ)()],x.prototype,"targetRenderSpace",null),(0,r._)([(0,o.MZ)()],x.prototype,"targetDirection",null),(0,r._)([(0,o.MZ)()],x.prototype,"tiltedUpVector",null),(0,r._)([(0,o.MZ)()],x.prototype,"_basis",null),(0,r._)([(0,o.MZ)()],x.prototype,"upVector",null),(0,r._)([(0,o.MZ)()],x.prototype,"northVector",null),(0,r._)([(0,o.MZ)()],x.prototype,"leftVector",null),(0,r._)([(0,o.MZ)()],x.prototype,"rightVector",null),(0,r._)([(0,o.MZ)()],x.prototype,"isValid",null),(0,r._)([(0,o.MZ)()],x.prototype,"metersPerUnit",null),x=F=(0,r._)([(0,l.$)("esri.views.3d.analysis.Viewshed.ViewshedComputedData")],x);const k=(0,w.vt)(),j=(0,w.vt)(),L=(0,w.vt)(),I=(0,w.vt)(),N=(0,w.vt)(),B=(0,w.vt)(),W=(0,w.vt)(),$=(0,w.vt)(),X=(0,w.vt)(),Y=(0,w.vt)(),q=(0,w.vt)(),K=(0,w.vt)(),J=(0,v.vt)();var Q=i(14755),ee=i(80575),te=i(77380),ie=i(8636);let re=class extends((0,Q.O)(s.A)){constructor(e){super(e),this.observer=null,this.farDistance=1e3,this.heading=0,this.tilt=90,this.horizontalFieldOfView=45,this.verticalFieldOfView=45}isValid(){return null!=this.observer&&this.farDistance>0}equals(e){return(0,n.CM)(this.observer,e.observer)&&this.farDistance===e.farDistance&&this.heading===e.heading&&this.tilt===e.tilt&&this.horizontalFieldOfView===e.horizontalFieldOfView&&this.verticalFieldOfView===e.verticalFieldOfView}};(0,r._)([(0,o.MZ)({type:H.A})],re.prototype,"observer",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0}})],re.prototype,"farDistance",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0}),(0,te.w)((e=>ee.ie.normalize((0,ie.GB)(e))))],re.prototype,"heading",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:180}})],re.prototype,"tilt",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:360}})],re.prototype,"horizontalFieldOfView",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:180}})],re.prototype,"verticalFieldOfView",void 0),(0,r._)([(0,o.MZ)()],re.prototype,"isValid",null),re=(0,r._)([(0,l.$)("esri.analysis.Viewshed")],re);const se=re;var ne=i(87368),ae=i(3223),oe=i(34561),le=i(84456),ce=i(56802),he=i(7775),de=i(62530);const ue=de.aj,pe=de.UF*ue,_e=.0025,ve=Math.sin((0,p.kU)(2)),me=de.UF/1.5;var we=i(12014),fe=i(49190),ye=i(6305),ge=i(8363),be=i(74316),Ve=i(26421),Me=i(16596),De=i(66019),Oe=i(10715);class Re extends ge.c{constructor(e){super(),this._handles=new ce.A,this._interactive=!0,this._tool=e.tool,this._view=e.view,this._focusedArcMaterial=this._createArcMaterial(!0),this._unfocusedArcMaterial=this._createArcMaterial(!1),this._createManipulators(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles=(0,n.pR)(this._handles),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulators=null}get interactive(){return this._interactive}set interactive(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}createDragPipeline(e,t){const i=Object.values(this._manipulators);return(0,h.vE)(i.map((({manipulator:i,side:r})=>(0,De.Xt)(i,((i,s,n,a,o)=>{const l=function(e,{observerRenderSpace:t,targetDirection:i,tiltedUpVector:r,rightVector:s}){const n=Ae(e)?s:r;return(0,he.f)(t,i,n)}(r,t);Ae(r)?t.horizontalFieldOfView:t.verticalFieldOfView;const c=s.next((e=>({...e,manipulatorType:ye.r.SCALE,side:r}))),h=M(c,this._view,l);e(i,h,n)})))))}updateManipulatorsTransform(e){this._forEachManipulatorInfo((t=>this._updateArcManipulatorTransform(t,e)))}updateManipulatorVisuals(e){this._forEachManipulatorInfo((t=>this._updateArcManipulatorVisuals(t,e)))}_updateArcManipulatorVisuals({manipulator:e,side:t},i){const r=[];if(null!=i){if("left"===t&&(i.horizontalFieldOfView<1||i.horizontalFieldOfView>359)||"bottom"===t&&i.verticalFieldOfView<1)return e.renderObjects=[],void(e.collisionType={type:"line",paths:[]});const[s,n]=function(e,t,i){const{horizontalFieldOfView:r,verticalFieldOfView:s}=t,n=Ae(e),a=(0,p.kU)((0,p.qE)((n?s:r)/2,0,15)),o=n?1:Math.max(Math.sin((0,p.kU)(90-s/2)),.1),l=Ce(-a/2,a/2,o,[-o,0,0]);return[(0,be.Z8)(i,l),l]}(t,i,this._unfocusedArcMaterial);r.push(new fe.M(s,Oe.p7.Unfocused),new fe.M(s.instantiate({material:this._focusedArcMaterial}),Oe.p7.Focused)),e.collisionType={type:"line",paths:[n]}}e.renderObjects=r,e.radius=10}_updateArcManipulatorTransform({manipulator:e,side:t},i){const r=i.horizontalFieldOfView,s=(0,p.kU)(i.verticalFieldOfView/2),n=(0,p.kU)(r/2),a=Ae(t);e.location=i.observer;const o=(0,v.vt)(),l=e=>{(0,_.lw)(o,e,o)};l((0,_.i1)(Ee,(0,p.kU)(-90))),a||l((0,_.hM)(Ee,s));const c=i.farDistanceRenderSpace;l((0,_.CV)(Ee,(0,m.s)(Te,c,c,c))),l((0,_.N9)(Ee,function(e){return function(e){switch(e){case"left":return 0;case"bottom":return 1;case"right":return 2;case"top":return 3}}(e)*Se}(t))),l(V(i,Ee));const h=(0,m.z)(Te,i.targetRenderSpace,i.observerRenderSpace);let d,u;if(l((0,_.kN)(Ee,h)),a){if(d=n,u=i.tiltedUpVector,0!==r&&360!==r){const e=D(i,this._view);d+=2*Math.tan(e/(2*i.farDistance))}}else u=i.rightVector,d=s;d*="right"===t||"bottom"===t?-1:1;const w=(0,_.$0)(Ee,d,u);null!=w&&l(w),e.modelTransform=o}_updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator((t=>{t.interactive=!e&&this.interactive||t.grabbing}))}_createManipulators(){const e=this._createArcManipulator("left"),t=this._createArcManipulator("right"),i=this._createArcManipulator("top"),r=this._createArcManipulator("bottom");this._manipulators={left:e,right:t,top:i,bottom:r};const s=[[r.manipulator,i.manipulator],[e.manipulator,t.manipulator]];s.push(...s.map((([e,t])=>[t,e]))),this._handles.add(s.map((([e,t])=>e.events.on("focus-changed",(e=>{const i="focus"===e.action;t.hovering=i})))))}_createArcManipulator(e){const t={manipulator:new we.q({view:this._view,autoScaleRenderObjects:!1,worldSized:!0}),side:e};return this._updateArcManipulatorVisuals(t),t}_createArcMaterial(e){const t=e?pe:ue,i=new Me.W({renderOccluded:R.m$.OccludeAndTransparent,isDecoration:!0,width:t});return this._handles.add((0,a.wB)((()=>d.A.toUnitRGBA(this._view.effectiveTheme.accentColor)),(e=>i.setParameters({color:e})),a.Vh)),i}forEachManipulator(e){Object.values(this._manipulators).forEach((({manipulator:t})=>e(t,ye.r.SCALE)))}_forEachManipulatorInfo(e){Object.values(this._manipulators).forEach((t=>e(t)))}}function Ce(e,t,i,r=[0,0,0],s=10){(0,Ve.vA)(s>1,"createArcPolylineGeometry() needs at least 2 for numVertices");const n=t-e,[a,o,l]=r;if(n<=0||i<=0){const e=.001;return[(0,w.fA)(a,o,l+e),(0,w.fA)(a,o,o+-e)]}const c=[],h=n/s;for(let r=0;r<s;r++){let n=e+r*h;r===s-1&&(n=t);const d=Math.cos(n)*i,u=Math.sin(n)*i,p=(0,w.fA)(d+a,o,u+l);c.push(p)}return c}function Ae(e){return"left"===e||"right"===e}const Se=Math.PI/2,Ee=(0,v.vt)(),Te=(0,w.vt)();var Pe=i(63918),Fe=i(10875),He=i(29239);class xe extends we.q{constructor(e,t,i,r){super({view:e,autoScaleRenderObjects:!1,worldSized:!0,radius:5}),this._handles=new ce.A,this._setupManipulatorVisual(t,i,r)}destroy(){this._handles.remove(),super.destroy()}_setupManipulatorVisual(e,t,i){const r=this._createMaterial(),s=(0,p.kU)(t),n=e?1:Math.sin(s),a=e?Ce(0,s,n,[-n,0,0]):[(0,w.fA)(0,0,0),(0,w.fA)(0,0,n)],o=(0,be.Nb)(r,a,i,16,!1),l=(0,be.Nb)(r,a,i*de.UF,16,!1),c=Ge(!1,r,i),h=Ge(!0,r,i),d=(0,v.vt)();(0,_.kN)(d,a[a.length-1]),(0,_.lK)(d,d,(0,_.hM)(ze,Math.PI/2)),(0,_.lK)(d,d,(0,_.i1)(ze,Math.PI/2)),e&&(0,_.lK)(d,d,(0,_.hM)(ze,-s)),c.transformation=d,h.transformation=d,this.renderObjects=[new fe.M(o,Oe.p7.Unfocused),new fe.M(l,Oe.p7.Focused),new fe.M(c,Oe.p7.Unfocused),new fe.M(h,Oe.p7.Focused)];const u=(0,w.fA)(0,Ze(!0),0),f=(0,m.h)(u,u,d),y=[...a,f];this.collisionType={type:"line",paths:[y]}}_createMaterial(){const e=new He.v({cullFace:Fe.s2.Back,renderOccluded:R.m$.OccludeAndTransparent,isDecoration:!0,writeLinearDepth:!0});return this._handles.add((0,a.wB)((()=>d.A.toUnitRGBA(this.view.effectiveTheme.accentColor)),(t=>e.setParameters({color:t})),a.Vh)),e}}function Ge(e,t,i){const r=Ze(e);let s=2*i;e&&(s*=de.UF);const n=r/2;return(0,be._B)(t,r,n,n,s,0)}function Ze(e){let t=ve;return e&&(t*=me),t}const ze=(0,v.vt)();class Ue extends ge.c{constructor(e){super(),this._handles=new ce.A,this._interactive=!0,this._tool=e.tool,this._view=e.view,this._manipulatorHeading=new xe(this._view,!0,5,_e),this._manipulatorTilt=new xe(this._view,!0,5,_e),this._manipulatorDistance=new xe(this._view,!1,5,_e),this.forEachManipulator((e=>{this._tool.manipulators.add(e),this._handles.add(e.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))}))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._manipulatorHeading=null,this._manipulatorTilt=null,this._manipulatorDistance=null,this._tool=null,this._view=null}get interactive(){return this._interactive}set interactive(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}createHeadingDragPipeline(e,t){return(0,De.Xt)(this._manipulatorHeading,((i,r,s,n,a)=>{const{_view:o}=this,l=Math.sin((0,p.kU)(t.tiltParallelToSurface))*t.farDistanceRenderSpace,c=(0,m.g)(Ie,t.observerRenderSpace,(0,m.j)(Ne,t.upVector,l)),h=(0,m.b)(Ne,t.northVector,t.upVector),d=M(r,o,(0,he.f)(c,t.northVector,h)).next((e=>({...e,manipulatorType:ye.r.ROTATE})));e(i,d,s)}))}createTiltDragPipeline(e,t){return(0,De.Xt)(this._manipulatorTilt,((i,r,s,n,a)=>{const o=(0,he.f)(t.observerRenderSpace,t.targetDirection,t.tiltedUpVector),l=M(r,this._view,o).next((e=>({...e,manipulatorType:ye.r.ROTATE})));e(i,l,s)}))}createDistanceDragPipeline(e,t){return(0,De.Xt)(this._manipulatorDistance,((i,r,s,n,a)=>{const o=(0,Pe.fA)(t.observerRenderSpace,t.targetDirection),l=r.next((0,De.Tp)(this._view,i.location)).next((0,b.ov)(this._view,o)).next((e=>({...e,manipulatorType:ye.r.SCALE})));e(i,l,s)}))}updateManipulators(e){const{target:t}=e;this._manipulatorHeading.location=t,this._manipulatorTilt.location=t,this._manipulatorDistance.location=t;const i=(0,v.vt)(),r=e=>{(0,_.lw)(i,e,i)},s=function(e){const t=1,{verticalFieldOfView:i,horizontalFieldOfView:r}=e,s=i>180,n=r>180,a=e.farDistanceRenderSpace;if(s&&n)return Math.max(t,a);e.arcCentersPoints(a,ke);const{left:o,right:l,top:c,bottom:h}=ke,d=1.9*(s?(0,m.p)(o,l):n?(0,m.p)(h,o):Math.sqrt(Math.min((0,m.a)(h,c),(0,m.a)(o,l))));return Math.max(t,Math.min(a,d))}(e);r((0,_.CV)(je,(0,m.s)(Ie,s,s,s))),r(V(e,je));const n=_e*de.UF*s,a=(0,m.j)(Ie,e.targetDirection,n);r((0,_.kN)(je,a));const o=(0,_.N9)(je,-Be);(0,_.lK)(o,o,(0,_.i1)(Le,-Be)),this._manipulatorHeading.modelTransform=(0,_.lK)((0,v.vt)(),i,o);const l=(0,_.i1)(je,Be);(0,_.lK)(l,l,(0,_.N9)(Le,Math.PI)),this._manipulatorTilt.modelTransform=(0,_.lw)((0,v.vt)(),i,l),this._manipulatorDistance.modelTransform=i}_updateManipulatorInteractivity(){const e=!this.grabbing;this.forEachManipulator((t=>{t.interactive=e&&this._interactive||t.grabbing}))}forEachManipulator(e){e(this._manipulatorHeading,ye.r.ROTATE),e(this._manipulatorTilt,ye.r.ROTATE),e(this._manipulatorDistance,ye.r.SCALE)}}const ke={top:(0,w.vt)(),bottom:(0,w.vt)(),left:(0,w.vt)(),right:(0,w.vt)()},je=(0,v.vt)(),Le=(0,v.vt)(),Ie=(0,w.vt)(),Ne=(0,w.vt)(),Be=Math.PI/2;i(40634),i(49095),i(97629),i(62991);class We extends we.q{constructor(e,t){super({view:e,autoScaleRenderObjects:!1,worldSized:!1,radius:5,interactive:!1}),this._handles=new ce.A;const i=(0,g.UM)(this._color);this.renderObjects=[new fe.M((0,be.CM)(i,5,32,32))],t.manipulators.add(this),this._handles.add([(0,a.wB)((()=>this._color),(e=>{i.setParameters({color:e})}),a.Vh)])}destroy(){this._handles.remove(),super.destroy()}get _color(){return d.A.toUnitRGBA(this.view.effectiveTheme.accentColor)}}(0,r._)([(0,o.MZ)()],We.prototype,"_color",null);var $e=i(68816),Xe=i(77228),Ye=i(30491),qe=i(33330),Ke=i(95351),Je=i(13243);const Qe=Symbol("dragHandles"),et=Symbol("hideManipulators");let tt=class extends s.A{constructor(e){super(e),this._moveManipulation=null,this._observerManipulator=null,this._fieldOfViewManipulation=null,this._scaleOrientManipulation=null,this._moveHelperVisualElement=null,this._settings=new $e.w({getTheme:()=>this.view.effectiveTheme}),this._grabbing=!1,this.viewshedComputedData=null}initialize(){this._moveManipulation=this._createMoveManipulation(),this._fieldOfViewManipulation=new Re({view:this.view,tool:this.parentTool}),this._scaleOrientManipulation=new Ue({view:this.view,tool:this.parentTool}),this._observerManipulator=new We(this.view,this.parentTool),this._createMoveHelperVisuals(),this.addHandles([(0,a.wB)((()=>{const{observer:e}=this;return{observer:e,array:e?.toArray()}}),(({observer:e})=>{null!=e&&(this._moveManipulation.location=e,this._observerManipulator.location=e)}),a.pc),(0,a.wB)((()=>{const{viewshedComputedData:e}=this;return{viewshedComputedData:e,observer:e?.observer}}),(({viewshedComputedData:e,observer:t},i)=>{this._grabbing&&t!==i?.observer||(this.removeHandles(Qe),e?.isValid()&&this.addHandles([this._buildObserverDragPipeline(e),this._buildFOVDragPipeline(e),this._buildScaleOrientDragPipeline(e)].filter(ae.Ru),Qe))}),a.Vh),(0,a.wB)((()=>{const e=this.viewshedComputedData;return e?.isValid()?{viewshedCompData:e,target:e.targetRenderSpace,hFOV:e.horizontalFieldOfView,vFOV:e.verticalFieldOfView}:null}),(e=>{null!=e&&this._fieldOfViewManipulation.updateManipulatorsTransform(e.viewshedCompData)}),a.Vh),(0,a.wB)((()=>{const e=this.viewshedComputedData;return e?.isValid()?{viewshedCompData:e,hFOV:e.horizontalFieldOfView,vFOV:e.verticalFieldOfView,tilt:e.tilt}:null}),(e=>{null!=e&&this._fieldOfViewManipulation.updateManipulatorVisuals(e.viewshedCompData)}),a.Vh),(0,a.wB)((()=>this.analysisViewData.visible&&(this.viewshedComputedData?.isValid()??!1)&&!this.parentTool.placingTarget),(e=>this._updateManipulationAvailability(e)),a.Vh),(0,a.wB)((()=>{const e=this.viewshedComputedData;if(!e?.isValid())return null;const{observer:t,target:i,verticalFieldOfView:r,horizontalFieldOfView:s}=e;return{viewshedCompData:e,observer:t,target:i,verticalFieldOfView:r,horizontalFieldOfView:s}}),(e=>{null!=e&&this._scaleOrientManipulation.updateManipulators(e.viewshedCompData)}),a.Vh),(0,a.wB)((()=>this.viewshedComputedData?.observerRenderSpace),(e=>{null!=e&&this._updateMoveHelperVisualsLocation(e)}),a.Vh)]);this._forEachManipulator((e=>{this.addHandles([e.events.on("focus-changed",(()=>this._updateManipulatorVisibility())),e.events.on("grab-changed",(e=>{this._grabbing="start"===e.action}))])}))}destroy(){this._moveManipulation=(0,n.pR)(this._moveManipulation),this._fieldOfViewManipulation=(0,n.pR)(this._fieldOfViewManipulation),this._scaleOrientManipulation=(0,n.pR)(this._scaleOrientManipulation),this.parentTool.manipulators.remove(this._observerManipulator),this._observerManipulator=(0,n.pR)(this._observerManipulator),this._destroyMoveHelperVisuals()}get viewshed(){return this.viewshedComputedData?.viewshed}get grabbing(){return this._grabbing}get observer(){return this.viewshed?.observer}set observer(e){const t=this.viewshed;null!=t&&(t.observer=e)}get discManipulator(){return this._moveManipulation.xyManipulation.discManipulator}onManipulatorSelectionChanged(){this._updateManipulatorVisibility()}hasManipulator(e){let t=!1;return this._forEachManipulator((i=>{t=t||i===e})),t}_someManipulatorSelected(){return this._moveManipulation.selected||this._fieldOfViewManipulation.selected||this._scaleOrientManipulation.selected}_someManipulatorHovering(){return this._moveManipulation.hovering||this._fieldOfViewManipulation.hovering||this._scaleOrientManipulation.hovering}_createMoveManipulation(){return new Ye.v({view:this.view,tool:this.parentTool,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:Xe.HJ})}_buildObserverDragPipeline(e){const t=e.observer;return null==t?null:this._moveManipulation.createDragPipeline(((t,i,r,s,n)=>{s=s.next((0,De.VG)(this,["observer"]));const a=e.observer.clone();if(null==a)return{steps:r,cancel:s};const o=Je.p.fromGeometry(a,(0,le.yX)(this.view.viewingMode));return{steps:r.next((0,De.Wp)({operations:o})).next((e=>(this.observer=(0,oe.project)(o.data.geometry,a.spatialReference),e))),cancel:s}}),{mode:"absolute-height",offset:0},t.spatialReference,void 0)}_buildFOVDragPipeline(e){let t=0,i=0;return this._fieldOfViewManipulation.createDragPipeline(((r,s,n)=>{if(null==e)return{steps:s,cancel:n};const a=e.viewshed;return n=n.next((0,De.VG)(e,["horizontalFieldOfView","verticalFieldOfView"])),{steps:s.next((r=>{"start"===r.action&&(t=e.horizontalFieldOfView,i=e.verticalFieldOfView);const s=r.deltaAngle;let n=0;switch(r.side){case"left":n=t/2-s;break;case"right":n=t/2+s;break;case"top":n=i+2*s;break;case"bottom":n=i-2*s}return Ae(r.side)?(n=ee.ie.normalize(n),n=n>270?0:n>180?180:n,a.horizontalFieldOfView=2*n):a.verticalFieldOfView=n,r})),cancel:n}}),e)}_buildScaleOrientDragPipeline(e){let t=0,i=0;const r=(t,i)=>(r,s,n)=>{if(null==e)return{steps:s,cancel:n};const a=e.viewshed;return n=n.next((0,De.VG)(a,[t])),{steps:s=s.next(i(a,e)),cancel:n}};return(0,h.vE)([this._scaleOrientManipulation.createHeadingDragPipeline(r("heading",((t,r)=>r=>("start"===r.action&&(i=e.heading),t.heading=ee.ie.normalize(i+r.deltaAngle),r))),e),this._scaleOrientManipulation.createTiltDragPipeline(r("tilt",((i,r)=>r=>{"start"===r.action&&(t=e.tilt);let s=t+r.deltaAngle;return s<-90?s=180:s>270&&(s=0),i.tilt=rt.clamp(s),r})),e),this._scaleOrientManipulation.createDistanceDragPipeline(r("farDistance",((e,t)=>i=>{const r=(0,m.z)(it,i.renderEnd,t.observerRenderSpace),s=(0,m.H)(r)*t.metersPerUnit,n=(0,m.m)(r,t.targetDirection)<0?1:s;return e.farDistance=n,i})),e)])}_updateManipulationAvailability(e){this._moveManipulation.available=e,this._fieldOfViewManipulation.available=e,this._scaleOrientManipulation.available=e,this._observerManipulator.available=e}_updateManipulatorVisibility(){const e=this._someManipulatorSelected()||this._someManipulatorHovering()&&null==this.view.activeTool;if(e)this.removeHandles(et);else{const e=[],t=t=>{e.push(t.disableDisplay())};this._forEachManipulator(t),this.addHandles(e,et)}this._updateMoveHelperVisualsVisibility(e)}_forEachManipulator(e){this._moveManipulation.forEachManipulator(e),this._fieldOfViewManipulation.forEachManipulator(e),this._scaleOrientManipulation.forEachManipulator(e),e(this._observerManipulator)}_createMoveHelperVisuals(){this._destroyMoveHelperVisuals();const e=new Ke.o({view:this.view,attached:!0,style:{glowWidth:this._settings.visualElements.heightPlane.glowWidth,innerWidth:this._settings.visualElements.heightPlane.innerWidth},isDecoration:!0}),t=new qe.U({view:this.view,extensionType:this._settings.visualElements.zVerticalLine.extensionType,attached:!0,innerWidth:1,writeDepthEnabled:!1,renderOccluded:R.m$.OccludeAndTransparent,isDecoration:!0});this._moveHelperVisualElement={laserline:e,verticalLine:t},this.addHandles([(0,a.wB)((()=>this._settings.visualElements.zVerticalLine),(e=>e.apply(t)),a.pc),(0,a.wB)((()=>this._settings.visualElements.heightPlane),(t=>t.apply(e)),a.pc)])}_updateMoveHelperVisualsVisibility(e){e=this.analysisViewData.visible&&e;const t=this._moveHelperVisualElement;null!=t&&(t.verticalLine.visible=e,t.laserline.visible=e)}_updateMoveHelperVisualsLocation(e){const t=this._moveHelperVisualElement;if(null==t)return;const{laserline:i,verticalLine:r}=t;i.heightManifoldTarget=e,i.intersectsWorldUpAtLocation=e,null!=e&&r.setStartEndFromWorldDownAtLocation(e)}_destroyMoveHelperVisuals(){const e=this._moveHelperVisualElement;null!=e&&(e.laserline.destroy(),e.verticalLine.destroy(),this._moveHelperVisualElement=null)}get test(){return{moveManipulation:this._moveManipulation,fieldOfViewManipulation:this._fieldOfViewManipulation,scaleOrientManipulation:this._scaleOrientManipulation,moveHelperVisualElements:this._moveHelperVisualElement,viewshedComputedData:this.viewshedComputedData}}};(0,r._)([(0,o.MZ)({constructOnly:!0})],tt.prototype,"analysis",void 0),(0,r._)([(0,o.MZ)({constructOnly:!0})],tt.prototype,"analysisViewData",void 0),(0,r._)([(0,o.MZ)({constructOnly:!0})],tt.prototype,"parentTool",void 0),(0,r._)([(0,o.MZ)({constructOnly:!0,nonNullable:!0})],tt.prototype,"view",void 0),(0,r._)([(0,o.MZ)()],tt.prototype,"viewshed",null),(0,r._)([(0,o.MZ)()],tt.prototype,"_grabbing",void 0),(0,r._)([(0,o.MZ)()],tt.prototype,"grabbing",null),(0,r._)([(0,o.MZ)()],tt.prototype,"viewshedComputedData",void 0),(0,r._)([(0,o.MZ)()],tt.prototype,"observer",null),tt=(0,r._)([(0,l.$)("esri.views.3d.analysis.Viewshed.ViewshedSubTool")],tt);const it=(0,w.vt)(),rt=new ee.hr(0,180);var st,nt=i(68574),at=i(92750),ot=i(57966),lt=i(20405);let ct=st=class extends nt.k{constructor(e){super(e),this.removeIncompleteOnCancel=!1,this.automaticManipulatorSelection=!1,this._stagedViewshed=null,this._stagedViewshedComputedData=null,this._creating=!1,this._selectedManipulator=null,this._selectedManipulatorSubTool=null}initialize(){this._intersector=(0,ot.T)(this.view.state.viewingMode);const e=this.analysisViewData.viewshedComputedDataHandles;this.addHandles([(0,a.wB)((()=>e.some((e=>e.viewshedComputedData.isValid()))),(e=>{e&&this.finishToolCreation()}),a.pc),(0,a.wB)((()=>this._stagedViewshed),(e=>{this._stagedViewshedComputedData=null!=e?this.analysisViewData.viewshedComputedDataHandles.find((t=>t.viewshedComputedData.viewshed===e))?.viewshedComputedData:null}),a.pc),(0,a.wB)((()=>this.firstGrabbedManipulator),(e=>{null!=e&&this._selectManipulator(e)}),a.OH),(0,a.wB)((()=>this.analysisViewData.visible),(e=>{e||this._selectManipulator(null)})),(0,a.wB)((()=>this.view.activeTool),(e=>{e!==this&&null!=e&&this._selectManipulator(null)}))]),this.subToolHandles=(0,a.LF)((()=>e),(({viewshedComputedData:e})=>{const t=new tt({analysis:this.analysis,analysisViewData:this.analysisViewData,parentTool:this,view:this.view,viewshedComputedData:e});return{subTool:t,remove:()=>{this._selectedManipulatorSubTool===t&&this._selectManipulator(null),t.destroy()}}}))}destroy(){this.subToolHandles=(0,n.pR)(this.subToolHandles)}onDeactivate(){this.removeStaged()}get cursor(){return this.creating?"crosshair":null}_selectManipulator(e){const t=this._selectedManipulator;null!=t&&(t.selected=!1,this._selectedManipulator=null,this._selectedManipulatorSubTool?.onManipulatorSelectionChanged(),this._selectedManipulatorSubTool=null),null!=e&&(e.selected=!0,this._selectedManipulator=e,this._selectedManipulatorSubTool=this.subToolHandles.find((t=>t.subTool.hasManipulator(e)))?.subTool,this._selectedManipulatorSubTool?.onManipulatorSelectionChanged())}get selectedViewshed(){return this._selectedManipulatorSubTool?.viewshed}set selectedViewshed(e){this.selectViewshed(e)}get selectedViewshedComputedData(){return this._selectedManipulatorSubTool?.viewshedComputedData}get stagedViewshed(){return this._stagedViewshed}get grabbing(){return this.subToolHandles.some((({subTool:e})=>e.grabbing))}get creating(){return this._creating&&this.active}get placingTarget(){return null!=this._stagedViewshed}createViewsheds(){this._creating=!0}onManipulatorSelectionChanged(){this.subToolHandles.forEach((e=>e.subTool.onManipulatorSelectionChanged()))}onInputEvent(e){switch(e.type){case"immediate-click":this._clickDeselectHandler();break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":at.NE.cancel===e.key?this._cancelKeyHandler(e):at.NE.delete.includes(e.key)&&this._deleteKeyHandler()}}onInputEventAfter(e){"immediate-click"===e.type&&this._clickPlacementHandler(e)}_clickDeselectHandler(){this.hasFocusedManipulators||this._selectManipulator(null)}_clickPlacementHandler(e){if(!this.creating||this.hasFocusedManipulators)return;const t=this._stagedViewshed,i=this._intersectScreen(e,mt);if(null!=i){if(null==t){i.mapPoint.z=(i.mapPoint.z??0)+2;const e=new se({observer:i.mapPoint.clone()});this.analysis.viewsheds.add(e),this._stagedViewshed=e,this._updateStagedViewshed(i.scenePoint)}else{this._updateStagedViewshed(i.scenePoint);const e=this._stagedViewshed;this._stagedViewshed=null,this.selectViewshed(e)}e.stopPropagation()}}_doubleClickHandler(e){this.creating&&(this.removeStaged(),this._selectManipulator(null),this._creating=!1,this.view.activeTool=null,e.stopPropagation())}_pointerMoveHandler(e){if(!this.creating||null==this._stagedViewshed)return;const t=this._intersectScreen(e,mt);null!=t&&this._updateStagedViewshed(t.scenePoint)}_cancelKeyHandler(e){if(this.creating){if(this.removeStaged())return this._selectManipulator(null),void e.stopPropagation();this._creating=!1}else if(!this.grabbing)return this.selectViewshed(null),void e.stopPropagation()}_deleteKeyHandler(){this.creating&&this.removeStaged(),null!=this.selectedViewshed&&this.analysis.viewsheds.remove(this.selectedViewshed)}_updateStagedViewshed(e){const t=this._stagedViewshed,i=this._stagedViewshedComputedData;if(null==t||null==i)return;const{heading:r,tilt:s,farDistance:n}=function(e,t,i){const r=t.observerRenderSpace,s=(0,m.z)(ht,i,r),n=(0,m.H)(s)*t.metersPerUnit,a=e.renderCoordsHelper.basisMatrixAtPosition(r,_t),o=(0,m.s)(dt,a[8],a[9],a[10]),l=(0,ne.O_)(r,o,vt),c=(0,ne._I)(l,i,ut),h=(0,m.z)(c,c,r),d=(0,p.KJ)((0,m.d)(s,h))*((0,m.m)(o,s)<0?-1:1)+90,u=(0,m.s)(pt,a[4],a[5],a[6]),_=(0,p.KJ)((0,m.d)(u,h)),v=(0,m.s)(pt,a[0],a[1],a[2]);return{heading:(0,m.m)(h,v)<0?360-_:_,tilt:d,farDistance:n}}(this.view,i,e);t.farDistance=n,t.tilt=s,t.heading=r}removeStaged(){return null!=this._stagedViewshed&&(this.analysis.viewsheds.remove(this._stagedViewshed),this._stagedViewshed=null,!0)}selectViewshed(e){if(null!=e)for(const e of this.view.tools.items)e!==this&&e instanceof st&&e.selectViewshed(null);const t=this.subToolHandles.find((t=>t.subTool.viewshed===e))?.subTool;this._selectManipulator(t?.discManipulator)}_intersectScreen(e,t){const i=(0,lt.sC)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(i,this._intersector);const r=this._intersector.results.min,s=t.scenePoint;if(!r.getIntersectionPoint(s))return null;const n=t.mapPoint;return n.spatialReference=this.view.spatialReference,this.view.renderCoordsHelper.fromRenderCoords(s,n),null==n?null:t}get test(){return{subTools:this.subToolHandles.map((e=>e.subTool.test)),selectedSubTool:this._selectedManipulatorSubTool?.test,stagedViewshed:this._stagedViewshed}}};(0,r._)([(0,o.MZ)({constructOnly:!0})],ct.prototype,"view",void 0),(0,r._)([(0,o.MZ)()],ct.prototype,"analysisViewData",void 0),(0,r._)([(0,o.MZ)()],ct.prototype,"removeIncompleteOnCancel",void 0),(0,r._)([(0,o.MZ)()],ct.prototype,"automaticManipulatorSelection",void 0),(0,r._)([(0,o.MZ)({constructOnly:!0})],ct.prototype,"analysis",void 0),(0,r._)([(0,o.MZ)()],ct.prototype,"subToolHandles",void 0),(0,r._)([(0,o.MZ)()],ct.prototype,"_stagedViewshed",void 0),(0,r._)([(0,o.MZ)()],ct.prototype,"_stagedViewshedComputedData",void 0),(0,r._)([(0,o.MZ)()],ct.prototype,"_creating",void 0),(0,r._)([(0,o.MZ)({readOnly:!0})],ct.prototype,"cursor",null),(0,r._)([(0,o.MZ)()],ct.prototype,"_selectedManipulator",void 0),(0,r._)([(0,o.MZ)()],ct.prototype,"_selectedManipulatorSubTool",void 0),(0,r._)([(0,o.MZ)()],ct.prototype,"selectedViewshed",null),(0,r._)([(0,o.MZ)()],ct.prototype,"selectedViewshedComputedData",null),(0,r._)([(0,o.MZ)()],ct.prototype,"grabbing",null),(0,r._)([(0,o.MZ)()],ct.prototype,"creating",null),(0,r._)([(0,o.MZ)()],ct.prototype,"placingTarget",null),ct=st=(0,r._)([(0,l.$)("esri.views.3d.analysis.Viewshed.ViewshedTool")],ct);const ht=(0,w.vt)(),dt=(0,w.vt)(),ut=(0,w.vt)(),pt=(0,w.vt)(),_t=(0,v.vt)(),vt=(0,ne.vt)(),mt={mapPoint:new H.A,scenePoint:(0,w.vt)()},wt=ct;var ft=i(30912),yt=i(5495);let gt=class extends((0,c.P)(s.A)){constructor(e){super(e),this.type="viewshed-view-3d",this.analysis=null,this.tool=null,this.viewshedComputedDataHandles=null,this._placementTask=null}get selectedViewshed(){return this.tool?.selectedViewshed}set selectedViewshed(e){const{tool:t}=this;null!=t&&(t.selectedViewshed=e)}get selectedViewshedComputedData(){return this.tool?.selectedViewshedComputedData}initialize(){this._initializeUpdateHandle(),this.viewshedComputedDataHandles=(0,a.LF)((()=>this.analysis.viewsheds),(e=>{const t=new x({renderCoordsHelper:this.view.renderCoordsHelper,viewshed:e}),i=Symbol();return this.addHandles((0,a.wB)((()=>t.isValid()),((e,i)=>{this.visible&&(e?this._addViewshedsToRenderer(t):i&&this._removeViewshedsFromRenderer(t))}),a.Vh)),{viewshedComputedData:t,remove:()=>{this.removeHandles(i),this._removeViewshedsFromRenderer(t),t.destroy()}}})),this._analysisVisualization=new P({view:this.view,analysisViewData:this,isDecoration:!this.parent}),this.addHandles([(0,a.wB)((()=>this.visible),(e=>{const t=this.viewshedComputedDataHandles.map((e=>e.viewshedComputedData)).filter((e=>e.isValid()));e?this._addViewshedsToRenderer(t):this._removeViewshedsFromRenderer(t)})),(0,a.wB)((()=>this.view.renderCoordsHelper),(e=>{this.viewshedComputedDataHandles.forEach((({viewshedComputedData:t})=>t.renderCoordsHelper=e))})),(0,yt.Hd)(this,wt)])}destroy(){this._placementTask=(0,n.DC)(this._placementTask),(0,yt.aS)(this),this._analysisVisualization=(0,n.pR)(this._analysisVisualization),this._removeViewshedsFromRenderer(this.viewshedComputedDataHandles.map((e=>e.viewshedComputedData)))}async createViewsheds(e){return this._placementTask=(0,n.DC)(this._placementTask),this._placementTask=(0,yt.JY)(this,e),null!=this.tool&&this.tool.createViewsheds(),await this._placementTask.promise}_initializeUpdateHandle(){const e=this.view._stage.renderer.plugins.plugins.find((e=>e instanceof ft.S));e&&(this._updateHandleInRenderer=e.updateViewsheds.bind(e))}_addViewshedsToRenderer(e){this._updateHandleInRenderer({adds:e})}_removeViewshedsFromRenderer(e){this._updateHandleInRenderer({removes:e})}};(0,r._)([(0,o.MZ)({readOnly:!0})],gt.prototype,"type",void 0),(0,r._)([(0,o.MZ)({constructOnly:!0,nonNullable:!0})],gt.prototype,"analysis",void 0),(0,r._)([(0,o.MZ)()],gt.prototype,"tool",void 0),(0,r._)([(0,o.MZ)()],gt.prototype,"selectedViewshed",null),(0,r._)([(0,o.MZ)()],gt.prototype,"selectedViewshedComputedData",null),(0,r._)([(0,o.MZ)()],gt.prototype,"viewshedComputedDataHandles",void 0),(0,r._)([(0,o.MZ)()],gt.prototype,"_analysisVisualization",void 0),(0,r._)([(0,o.MZ)()],gt.prototype,"_placementTask",void 0),gt=(0,r._)([(0,l.$)("esri.views.3d.analysis.ViewshedAnalysisView3D")],gt);const bt=gt},61506:(e,t,i)=>{i.d(t,{AA:()=>y,L2:()=>M,Og:()=>r,PW:()=>V,U0:()=>g,iv:()=>D,mg:()=>R,ov:()=>O,xk:()=>A,z7:()=>C});i(3313);var r,s=i(23572),n=i(80347),a=i(19913),o=i(34561),l=i(87368),c=i(63918),h=i(74695),d=i(11631),u=i(19541),p=i(86300),_=i(57809),v=i(30165),m=i(72559),w=i(66019),f=i(1912);function y(e,t){return b(e,(()=>t))}function g(e){return b(e,(e=>e.plane))}function b(e,t){const i=(0,a.vt)(),r=(0,a.vt)();let n=!1;return a=>{const o=t(a);if("start"===a.action){const t=(0,s.WA)(a.screenStart,(0,s.PR)(d.oG.get())),r=(0,p.Z4)(e.state.camera,t,T);null!=r&&(n=(0,l.Ui)(o,r,i))}if(!n)return null;const c=(0,s.WA)(a.screenEnd,(0,s.PR)(d.oG.get())),h=(0,p.Z4)(e.state.camera,c,T);return null==h?null:(0,l.Ui)(o,h,r)?{...a,renderStart:i,renderEnd:r,plane:o,ray:h}:null}}function V(e,t,i,r=null,n=null){return function(e,t,i=0,r=null,n=null){let a=null;return l=>{if("start"===l.action&&(a=e.sceneIntersectionHelper.intersectElevationFromScreen((0,s.gs)(l.screenStart.x,l.screenStart.y),t,i,n),null!=a&&null!=r&&!(0,o.projectPoint)(a,a,r)))return null;if(null==a)return null;const c=e.sceneIntersectionHelper.intersectElevationFromScreen((0,s.gs)(l.screenEnd.x,l.screenEnd.y),t,i,n);return null==c||null!=r&&!(0,o.projectPoint)(c,c,r)?null:{...l,mapStart:a,mapEnd:c}}}(e,i,(0,u.id)(t,e,i),r,n)}function M(e,t,i,r){const s=i.toMap(e.screenStart);return null!=s?V(t,s,i.elevationInfo,r):null}function D(e,t,i){let r=null;const s=new w.rh;return s.next(y(e,function(e,t){const i=S,r=E,s=(0,l.vt)();e.renderCoordsHelper.worldUpAtPosition(t,i);const a=(0,n.b)((0,l.Qj)(s),i,(0,n.f)(r,t,e.state.camera.eye));return(0,n.b)(a,a,i),(0,l.O_)(t,a,s)}(e,t))).next(function(e,t){const i=(0,a.vt)(),r=(0,n.l)(t);e.renderCoordsHelper.worldUpAtPosition(t,i);const s=(0,a.vt)(),o=(0,a.vt)(),l=s=>((0,n.f)(s,s,t),(0,h._I)(i,s,s),"global"===e.viewingMode&&(0,n.l)(s)*Math.sign((0,n.m)(i,s))<.001-r&&(0,n.f)(s,(0,n.j)(s,i,.001),t),(0,n.g)(s,s,t),s);return e=>(e.renderStart=l((0,n.c)(s,e.renderStart)),e.renderEnd=l((0,n.c)(o,e.renderEnd)),e)}(e,t)).next(R(e,i)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,r=e})),e=>(r=null,s.execute(e),r)}function O(e,t){const i=i=>{const r=(0,s.WA)(i,(0,s.PR)(d.oG.get())),n=(0,p.Z4)(e.state.camera,r,T);return null==n?null:(0,c.Zb)(t,n,S,E)[1]};return e=>{const t=i(e.screenStart);if(null==t)return null;const r=i(e.screenEnd);return null==r?null:{...e,renderStart:t,renderEnd:r}}}function R(e,t){const i=e.renderCoordsHelper;return e=>{const r=i.fromRenderCoords(e.renderStart,new f.A({spatialReference:t})),s=i.fromRenderCoords(e.renderEnd,new f.A({spatialReference:t}));return null!=r&&null!=s?{...e,mapStart:r,mapEnd:s}:null}}function C(e){let t=null;return i=>{switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":null!=t&&(t.remove(),t=null)}return i}}function A(e,t=null){const i=(0,_.hz)(e.state.viewingMode);i.options.selectionMode=!0,i.options.store=v.oH.MIN,i.options.hud=!1;const n=(0,s.gs)(),o={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},l=(0,a.vt)(),c=t??e.spatialReference,h=t=>{e.map.ground&&e.map.ground.opacity<1?o.exclude.add(m.fo):o.exclude.delete(m.fo),e.sceneIntersectionHelper.intersectIntersectorScreen((0,s.WA)(t,n),i,o);const a=i.results.min;let h;if(a.getIntersectionPoint(l))h=a.intersector===v.dz.TERRAIN?r.GROUND:r.OTHER;else{if(!i.results.ground.getIntersectionPoint(l))return null;h=r.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(l,new f.A({spatialReference:c})),surfaceType:h}};let d;return e=>{if("start"===e.action){const t=h(e.screenStart);d=null!=t?t.location:null}if(null==d)return null;const t=h(e.screenEnd);return null!=t?.location?{...e,mapStart:d,mapEnd:t.location,surfaceType:t.surfaceType}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(r||(r={}));const S=(0,a.vt)(),E=(0,a.vt)(),T=(0,c.vt)()},14788:(e,t,i)=>{i.d(t,{X:()=>y});var r=i(82392),s=i(73783),n=i(23377),a=i(81482),o=(i(6273),i(80861),i(67498),i(26325)),l=i(161),c=i(80561),h=i(34402);class d{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=l.O7.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;const t=this._resources?.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),t=new u({view:this._resourceFactory.view,renderGroup:this._renderGroup}),i=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new u({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:e,geometriesAdded:!1},i&&(this._resources.drapeSourceRenderer=i.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){null!=this._resources?.drapeSourceRenderer&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,c.q.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){null!=this._resources?.drapeSourceRenderer&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,c.q.UPDATE),this._resources.geometriesAdded=!0))}}let u=class extends((0,n.sA)(s.A)){constructor(e){super(e),this.drapeSourceType=l.Om.Features,this.updatePolicy=h.q.SYNC,this.renderGroup=l.O7.Outline}};(0,r._)([(0,a.MZ)({constructOnly:!0})],u.prototype,"view",void 0),(0,r._)([(0,a.MZ)({readOnly:!0})],u.prototype,"drapeSourceType",void 0),(0,r._)([(0,a.MZ)()],u.prototype,"renderGroup",void 0),u=(0,r._)([(0,o.$)("esri.views.3d.interactive.visualElements.DrapedVisualElementResources")],u);var p=i(51467),_=i(61985),v=i(61723),m=i(54909),w=i(5415);class f{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(null==this._resources||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type!==v.X.Mesh&&t.type!==v.X.Line&&t.type!==v.X.Point||e.remove(t)})),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach((t=>{t.type!==v.X.Mesh&&t.type!==v.X.Line&&t.type!==v.X.Point||e.add(t)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,i=t._stage;if(!i)return;const r=new w.x(i,{pickable:!1,updatePolicy:h.q.SYNC}),s=new m.B({castShadow:!1}),n=e.createResources(s,r);n.forEach((e=>{i.add(e),e.type===v.X.Texture&&e.load(i.renderView.renderingContext)})),i.add(s),r.add(s);const a=e.cameraChanged,o=a?(0,_.wB)((()=>t.state.camera),(e=>a(e)),_.Vh):null;this._resources={layer:r,object:s,external:n,cameraHandle:o},this._syncVisible()}_destroyResources(){if(null==this._resources)return;const e=this._resourceFactory.view._stage;e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach((t=>{e.remove(t),t.type===v.X.Texture&&t.unload()}))),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class y extends p.B{constructor(e){super(e),this._isDraped=!1,this.object3dResources=new f(this.createObject3DResourceFactory(e.view)),this.drapedResources=new d(this.createDrapedResourceFactory(e.view)),this.isDraped=e.isDraped??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}},33330:(e,t,i)=>{i.d(t,{A:()=>O,U:()=>y});i(6273);var r=i(80347),s=i(19913),n=i(74772),a=i(53357),o=i(45876),l=i(74224),c=i(94669),h=i(63918),d=i(14788),u=i(95351),p=i(14583),_=i(74316),v=i(31272),m=i(35537),w=i(33763),f=i(16596);class y extends d.X{constructor(e){super(e),this._ray=(0,h.vt)(),this._isWorldDown=!1,this._start=(0,s.vt)(),this._end=(0,s.fA)(1,0,0),this._width=1,this._color=(0,a.fA)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,a.fA)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=O.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=v.m$.OccludeAndTransparent,this._fadedExtensions=C,this._laserline=new u.o({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:g,recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:g,recreateGeometry:e=>this._recreateDrapedGeometry(e)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,r.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,r.f)(this._end,e,this._end),(0,h.Cr)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,r.e)(this._start,e)||((0,r.c)(this._start,e),(0,h.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,r.e)(this._end,e)||((0,r.c)(this._end,e),(0,h.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,n.a)(e,this._color)||((0,n.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,n.a)(e,this._innerColor)||((0,n.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){null!=e&&null!=this._stippleOffColor&&(0,n.a)(e,this._stippleOffColor)||(this._stippleOffColor=null!=e?(0,a.o8)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===v.m$.OccludeAndTransparentStencil?v.m$.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=e??C,this.recreateGeometry()}_updateMaterial(){const{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new f.W(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const r=this._createGeometry(e);i.push(r),t.addGeometry(r),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new f.W(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new m.$(t)}_createGeometry(e){const t=this.extensionType===O.FADED,i=t?[(0,s.vt)(),(0,s.vt)(),(0,s.vt)(),(0,s.vt)()]:[(0,s.vt)(),(0,s.vt)()];return(0,_.Z8)(e,i,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===O.FADED?this._updateLineSegmentFinite(D):this._updateLineSegmentInfinite(this._extensionType,D)}_updateLineSegmentFinite(e){return(0,c.Cr)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch((0,o.$e)(this._ray,b),e){case O.LINE:b.c0=-Number.MAX_VALUE;break;case O.RAY:case O.GROUND_RAY:{const e=this._ray.origin,t=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground")??0,i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&(0,r.k)(b.ray.direction,b.ray.direction),this._extensionType===O.GROUND_RAY&&null!=t&&(b.c1=Math.abs(i-t));break}}if(!(0,l.ig)(i.frustum,b))return this._updateLineSegmentFinite(t);const s=(0,o.j1)(b,V),n=(0,o.mO)(b,M);return(0,c.Cr)(s,n,t)}_updateVertexAttributesObject3D(e,t){const i=e.geometries[0].getMutableAttribute(w.r.POSITION)?.data;if(!i)return;let r=0;for(const e of this._lineVertices(t))i[r++]=e[0],i[r++]=e[1],i[r++]=e[2];e.geometryVertexAttributeUpdated(e.geometries[0],w.r.POSITION)}_updateVertexAttributesDraped(e,t){const i=e.getMutableAttribute(w.r.POSITION)?.data;if(!i)return;let r=0;for(const e of this._lineVertices(t))i[r++]=e[0],i[r++]=e[1],i[r++]=p.bi;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===O.FADED?(yield(0,c.sd)(e,-this.fadedExtensions.start,V),yield(0,c.sd)(e,0,V),yield(0,c.sd)(e,1,V),yield(0,c.sd)(e,1+this.fadedExtensions.end,V)):(yield(0,c.sd)(e,0,V),yield(0,c.sd)(e,1,V))}}function g(e){e.geometries=[]}const b=(0,o.vt)(),V=(0,s.vt)(),M=(0,s.vt)(),D=(0,c.vt)();var O;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(O||(O={}));const R=1/3,C={start:R,end:R}},9921:(e,t,i)=>{i.d(t,{t:()=>u});var r=i(25336),s=i(26110),n=i(80347),a=i(19913),o=i(76982),l=i(87795),c=i(41410),h=i(31272),d=i(16596);class u extends l.X{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._hasExternalMaterial=null!=t,this._material=null!=t?t:new d.W({width:1,color:(0,o.fA)(1,0,1,1),stippleOffColor:null,stipplePattern:null,stipplePreferContinuous:!0,isClosed:!1,falloff:0,innerColor:null,innerWidth:1,hasPolygonOffset:!1,renderOccluded:h.m$.OccludeAndTransparent,isDecoration:!!e.isDecoration,writeDepth:!0}),this.applyProperties(e)}setGeometryFromRenderSpacePoint(e,t=1e3){this.geometry=[[[e[0]-t,e[1],e[2]],[e[0]+t,e[1],e[2]]],[[e[0],e[1]-t,e[2]],[e[0],e[1]+t,e[2]]],[[e[0],e[1],e[2]-t],[e[0],e[1],e[2]+t]]]}setGeometryFromExtent(e){const t=this.view.spatialReference,i=(0,a.vt)(),r=(0,a.vt)(),s=100,o=[];(0,n.s)(i,e[0],e[1],s),this.view.renderCoordsHelper.toRenderCoords(i,t,r),o.push([r[0],r[1],r[2]]),(0,n.s)(i,e[2],e[1],s),this.view.renderCoordsHelper.toRenderCoords(i,t,r),o.push([r[0],r[1],r[2]]),(0,n.s)(i,e[2],e[3],s),this.view.renderCoordsHelper.toRenderCoords(i,t,r),o.push([r[0],r[1],r[2]]),(0,n.s)(i,e[0],e[3],s),this.view.renderCoordsHelper.toRenderCoords(i,t,r),o.push([r[0],r[1],r[2]]),(0,n.s)(i,e[0],e[1],s),this.view.renderCoordsHelper.toRenderCoords(i,t,r),o.push([r[0],r[1],r[2]]),(0,n.s)(i,e[0],e[1],s),this.view.renderCoordsHelper.toRenderCoords(i,t,r),o.push([r[0],r[1],r[2]]),this.geometry=[o]}setGeometryFromFrustum(e){const t=[];e.lines.forEach((e=>{t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}setGeometryFromBoundedPlane(e){const t=[],i=e.origin,r=e.basis1,s=e.basis2,n=.5,o=(0,a.vt)(),l=(0,a.vt)(),c=(0,a.vt)(),h=(0,a.vt)();o[0]=i[0]-r[0]*n-s[0]*n,o[1]=i[1]-r[1]*n-s[1]*n,o[2]=i[2]-r[2]*n-s[2]*n,l[0]=i[0]-r[0]*n+s[0]*n,l[1]=i[1]-r[1]*n+s[1]*n,l[2]=i[2]-r[2]*n+s[2]*n,c[0]=i[0]+r[0]*n+s[0]*n,c[1]=i[1]+r[1]*n+s[1]*n,c[2]=i[2]+r[2]*n+s[2]*n,h[0]=i[0]+r[0]*n-s[0]*n,h[1]=i[1]+r[1]*n-s[1]*n,h[2]=i[2]+r[2]*n-s[2]*n,t.push([o[0],o[1],o[2]]),t.push([l[0],l[1],l[2]]),t.push([c[0],c[1],c[2]]),t.push([h[0],h[1],h[2]]),t.push([o[0],o[1],o[2]]),this.geometry=[t]}setGeometryFromSegment(e){const t=e.endRenderSpace;this.transform=(0,r.kN)(p,t);const{points:i}=e.createRenderGeometry(t,this.view.renderCoordsHelper);this.geometry=[i]}setGeometryFromSegments(e,t=a.uY){this.transform=(0,r.kN)(p,t),this.geometry=e.map((e=>e.createRenderGeometry(t,this.view.renderCoordsHelper).points))}getTransformedGeometry(){return null==this._geometry?null:this._geometry.map((e=>e.map((e=>(0,n.h)((0,a.vt)(),e,this.transform)))))}get renderOccluded(){return this._material.parameters.renderOccluded}set renderOccluded(e){this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._material.parameters.width}set width(e){this._material.setParameters({width:e})}get color(){return this._material.parameters.color}set color(e){const t=1===e[3];this._material.setParameters({color:(0,o.o8)(e),writeDepth:t})}get innerWidth(){return this._material.parameters.innerWidth}set innerWidth(e){this._material.setParameters({innerWidth:e})}get innerColor(){return this._material.parameters.innerColor}set innerColor(e){this._material.setParameters({innerColor:null!=e?(0,o.o8)(e):null})}get stipplePattern(){return this._material.parameters.stipplePattern}set stipplePattern(e){null!=this._material&&this._material.setParameters({stipplePattern:e})}get stippleOffColor(){return this._material.parameters.stippleOffColor}set stippleOffColor(e){this._material.setParameters({stippleOffColor:null!=e?(0,o.o8)(e):null})}get stipplePreferContinuous(){return this._material.parameters.stipplePreferContinuous}set stipplePreferContinuous(e){this._material.setParameters({stipplePreferContinuous:e})}get falloff(){return this._material.parameters.falloff}set falloff(e){this._material.setParameters({falloff:e})}get polygonOffset(){return this._material.parameters.hasPolygonOffset}set polygonOffset(e){this._material.setParameters({hasPolygonOffset:e})}createExternalResources(){}destroyExternalResources(){}createGeometries(e){for(const t of(0,c.z)(this.geometry)){const i=(0,c.t)(this._material,t);e.addGeometry(i)}}forEachExternalMaterial(e){this._hasExternalMaterial||e(this._material)}}const p=(0,s.vt)()},5495:(e,t,i)=>{i.d(t,{Hd:()=>l,JY:()=>o,aS:()=>c});var r=i(3132),s=i(57725),n=i(37623),a=i(61985);function o(e,t){e.interactive=!0;const{tool:i,view:o}=e;o.activeTool=i;let l=(0,n.u7)(t,(()=>{o.activeTool===i&&(o.activeTool=null)}));return(0,r.UT)((async e=>{await(0,a.C_)((()=>null==i||!i.active),e),l=(0,s.xt)(l)}),t)}function l(e,t){return(0,a.wB)((()=>e.interactive),(()=>function(e,t){e.interactive?function(e,t){c(e);const{view:i,analysis:r}=e,s=new t({view:i,analysis:r,analysisViewData:e});e.tool=s,i.tools.add(s)}(e,t):c(e)}(e,t)),a.pc)}function c(e){const{view:t,tool:i}=e;null!=i&&(t.tools.remove(i),e.tool=null)}},68574:(e,t,i)=>{i.d(t,{k:()=>o});var r=i(82392),s=i(61985),n=(i(80861),i(6273),i(67498),i(62991),i(26325)),a=i(6364);let o=class extends a.g{constructor(e){super(e)}initialize(){this.addHandles((0,s.wB)((()=>this.analysisViewData.visible),(e=>this.visible=e),s.pc))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};o=(0,r._)([(0,n.$)("esri.views.interactive.AnalysisToolBase")],o)},57966:(e,t,i)=>{i.d(t,{T:()=>n});var r=i(57809),s=i(30165);function n(e){const t=(0,r.hz)(e);return t.options.store=s.oH.MIN,t.options.hud=!1,t}}}]);