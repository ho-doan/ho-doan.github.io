"use strict";(self.webpackChunkarcgis_node=self.webpackChunkarcgis_node||[]).push([[6280],{39990:(e,t,i)=>{function n(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function o(e,t){return"number"==typeof e?e:e?.stops?.length?function(e){let t=0,i=0;for(let n=0;n<e.length;n++){const o=e[n].size;"number"==typeof o&&(t+=o,i++)}return t/i}(e.stops):t}function r(e,t){if(!t)return e;const i=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:i,minSize:n}=t;return(o(i,e)+o(n,e))/2}));let n=0;const r=i.length;if(0===r)return e;for(let e=0;e<r;e++)n+=i[e];const s=Math.floor(n/r);return Math.max(s,e)}function s(e){const t=e?.renderer,i=e?.pointerType,o="touch"===i?9:6;if(!t)return o;const s="visualVariables"in t?r(o,t.visualVariables):o;if("simple"===t.type)return n(s,t.symbol);if("unique-value"===t.type){let e=s;return t.uniqueValueInfos?.forEach((t=>{e=n(e,t.symbol)})),e}if("class-breaks"===t.type){let e=s;return t.classBreakInfos.forEach((t=>{e=n(e,t.symbol)})),e}return"dot-density"===t.type||t.type,s}i.d(t,{o:()=>s})},5896:(e,t,i)=>{i.d(t,{J:()=>y});i(3313);var n=i(20857),o=(i(3438),i(70214)),r=i(23572),s=i(53334),a=i(56560),l=i(19913),d=i(85953),h=i(93617),p=i(51879),c=i(36598),u=i(1912),_=i(38648),v=i(60936),m=i(68231),g=i(84655);class y extends c.b{constructor(e){super(),this._graphicsLayer=e,this._symbolPairingsByType=new Map}visualizeIntersectionPoint(e,t){return this._visualizeSnappingIndicator(new u.A({x:e.intersectionPoint[0],y:e.intersectionPoint[1],spatialReference:t.spatialReference}),this._getOrCreateSymbol("intersectionPoint",t.view.effectiveTheme.accentColor))}visualizePoint(e,t){return this._visualizeSnappingIndicator(new u.A({x:e.point[0],y:e.point[1],spatialReference:t.spatialReference}),this._getOrCreateSymbol("point",t.view.effectiveTheme.accentColor))}visualizeLine(e,t){return this._visualizeSnappingIndicator(new _.A({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.spatialReference}),this._getOrCreateSymbol("line",t.view.effectiveTheme.accentColor))}visualizeParallelSign(e,t){return this._visualizeSnappingIndicator(new _.A({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.spatialReference}),this._getOrCreateSymbol("parallelSign",t.view.effectiveTheme.accentColor))}visualizeRightAngleQuad(e,t){const i=(0,a.vt)(),n=(0,a.vt)(),o=(0,l.vt)();(0,s.Re)(i,(0,h.Xz)(e.centerVertex),(0,h.Xz)(e.previousVertex)),(0,s.Re)(n,(0,h.Xz)(e.nextVertex),(0,h.Xz)(e.previousVertex)),(0,s.$A)(o,i,n);const r="rightAngleQuad"+(o[2]<0?45:225);return this._visualizeSnappingIndicator(new _.A({paths:[[e.previousVertex,e.centerVertex,e.nextVertex]],spatialReference:t.spatialReference}),this._getOrCreateSymbol(r,t.view.effectiveTheme.accentColor))}_visualizeSnappingIndicator(e,t){const i=new n.A({geometry:e,symbol:t});return this._graphicsLayer.add(i),(0,o.hA)((()=>{this._graphicsLayer.remove(i)}))}_getOrCreateSymbol(e,t){const i=this._symbolPairingsByType;return i.get(e)?.color!==t&&i.set(e,{color:t,symbol:w(e,t)}),i.get(e).symbol}}function w(e,t){const i=[...t.toRgb(),255*t.a];switch(e){case"point":return new m.A({outline:{width:.5,color:[0,0,0,1]},size:10,color:t});case"intersectionPoint":return new m.A({outline:new g.A({width:1.5,color:t}),size:15,color:[0,0,0,0]});case"line":return new v.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:d.uT.Butt,joinStyle:d.wd.Round,miterLimit:10,width:(0,r.PN)(p.N.lineHintWidthTarget),color:i}]}}});case"parallelSign":return new v.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:i}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:i}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}});case"rightAngleQuad45":case"rightAngleQuad225":{const n="rightAngleQuad45"===e?45:225;return new v.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:(0,r.PN)(p.N.rightAngleHintSize),rotation:n,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:(0,r.PN)(p.N.rightAngleHintOutlineSize),color:i},{type:"CIMSolidFill",enable:!0,color:[...t.toRgb(),255*t.a*.4]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}})}}}},67907:(e,t,i)=>{i.d(t,{A:()=>B});var n,o=i(82392),r=i(73783),s=(i(6273),i(81482)),a=(i(80861),i(67498),i(26325)),l=(i(3313),i(62991),i(57888)),d=i(15565),h=i(57725),p=i(37623),c=i(23572),u=i(11682),_=i(82320),v=i(84456),m=i(5896),g=i(19793),y=i(17071),w=i(13243),f=i(28535),x=i(15797);let b=n=class extends l.A.EventedAccessor{constructor(e){super(e),this._hasZ=null,this._cursorScreenPoint=null,this._activePointerId=null,this._stagedVertexUnsnapped=null,this._lastVertexUnsnapped=null,this.interactiveUndoDisabled=!1,this.history=[],this.redoHistory=[],this.snapToScene=!1,this.view=null,this.elevationInfo=null,this.defaultZ=0,this._coordinateHelper=(0,g.BV)(!!e.hasZ,!1,e.view.spatialReference),this._snappingManager=e.snappingManager,this._editGeometryOperations=new w.p(new y.ZE(e.editGeometryType??"polygon",this._coordinateHelper),v.RT.Local),this._snappingGraphicsLayer=new u.A({id:n.SNAPPING_GRAPHICS_LAYER_ID,listMode:"hide",internal:!0}),this._snappingContext=new f.e({editGeometryOperations:this._editGeometryOperations,elevationInfo:{mode:"on-the-ground",offset:0},pointer:"mouse",visualizer:new m.J(this._snappingGraphicsLayer)}),this._activeComponent=new y.uA(e.view.spatialReference,v.RT.Local),this._editGeometryOperations.data.components.push(this._activeComponent)}normalizeCtorArgs(e){const t={...e};return delete t.editGeometryType,delete t.snappingManager,t}initialize(){this._snappingOperation=new x.O({view:this.view}),"2d"===this.view.type&&this.view.map.layers.add(this._snappingGraphicsLayer)}destroy(){this.view.map.layers.remove(this._snappingGraphicsLayer),this._snappingGraphicsLayer.destroy(),null!=this._snappingManager&&this._snappingManager.doneSnapping(),this._snappingOperation=(0,h.pR)(this._snappingOperation),this._editGeometryOperations.destroy()}get _committedVertices(){return this._editGeometryOperations.data.components[0].vertices.map((e=>e.pos))}get vertices(){return null!=this._stagedVertex?[...this._committedVertices,this._coordinateHelper.pointToArray(this._stagedVertex)]:this._committedVertices}get hasZ(){return null!=this._hasZ?this._hasZ:"3d"===this.view.type}set hasZ(e){this._hasZ=e,this.notifyChange("hasZ")}get _stagedVertex(){return this._snappingOperation.stagedPoint}set _stagedVertex(e){this._snappingOperation.stagedPoint=(0,d.o8)(e)}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this.canUndo&&this._editGeometryOperations.undo()}redo(){this.canRedo&&this._editGeometryOperations.redo()}getCoordsFromScreenPoint(e){const t=e&&this.screenToMap(e);return null==t?null:t.hasZ?[t.x,t.y,t.z]:[t.x,t.y]}getCoordsAndPointFromScreenPoint(e){const t=this.screenToMap(e);return null==t?null:t.hasZ?{vertex:[t.x,t.y,t.z],mapPoint:t}:{vertex:[t.x,t.y],mapPoint:t}}screenToMap(e){let t=null;if("3d"===this.view.type)if(this.hasZ){const i=this.elevationInfo??P;t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,c.gs)(e.x,e.y),i,this._getGeometryZValue())}else{const i=this.elevationInfo??O;t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,c.gs)(e.x,e.y),i,0),null!=t&&(t.z=void 0)}else t=this.view.toMap(e),null!=t&&(t.z=this.hasZ?this._getGeometryZValue():void 0);return t}_pushCursorVertex(e,t){const i=(0,_.T)(e[0],e[1],void 0,this.view.spatialReference);this._stagedVertexUnsnapped=i;const n=this._snappingManager;if(null==n)return this._stagedVertex=i,void t();(0,p.QZ)(this._snappingOperation.snap({point:i},n,this._snappingContext)).then((()=>{t()}))}_popCursorVertex(){this._stagedVertexUnsnapped=null,this._stagedVertex=null}_getGeometryZValue(){return this.defaultZ}_abortSnapping(){this._snappingOperation.abort()}_isDuplicateOfLastVertex(e){const t=this._editGeometryOperations.data.components[0].getLastVertex()?.pos;if(t&&e[0]===t[0]&&e[1]===t[1])return!0;const{x:i,y:n}=this._coordinateHelper.vectorToDehydratedPoint(e);return null!=this._lastVertexUnsnapped&&i===this._lastVertexUnsnapped.x&&n===this._lastVertexUnsnapped.y}_shouldHandlePointerEvent(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&(null==this._activePointerId||this._activePointerId===e.pointerId)}_vertexAddHandler(e){const t=null!=this._stagedVertex?this._coordinateHelper.pointToArray(this._stagedVertex):this.getCoordsFromScreenPoint(this._cursorScreenPoint);null!=t&&this._addVertex(t,e.native)}_drawCompleteHandler(e){this._completeDrawing(e.native)}};b.SNAPPING_GRAPHICS_LAYER_ID="DrawAction-snapping-graphics-layer",(0,o._)([(0,s.MZ)({readOnly:!0})],b.prototype,"vertices",null),(0,o._)([(0,s.MZ)({type:Boolean,nonNullable:!0})],b.prototype,"interactiveUndoDisabled",void 0),(0,o._)([(0,s.MZ)({readOnly:!0})],b.prototype,"history",void 0),(0,o._)([(0,s.MZ)({readOnly:!0})],b.prototype,"redoHistory",void 0),(0,o._)([(0,s.MZ)()],b.prototype,"snapToScene",void 0),(0,o._)([(0,s.MZ)()],b.prototype,"view",void 0),(0,o._)([(0,s.MZ)()],b.prototype,"elevationInfo",void 0),(0,o._)([(0,s.MZ)({nonNullable:!0})],b.prototype,"defaultZ",void 0),(0,o._)([(0,s.MZ)()],b.prototype,"hasZ",null),(0,o._)([(0,s.MZ)()],b.prototype,"_snappingOperation",void 0),(0,o._)([(0,s.MZ)()],b.prototype,"_stagedVertex",null),b=n=(0,o._)([(0,a.$)("esri.views.draw.DrawAction")],b);const P={mode:"absolute-height",offset:0},O={mode:"on-the-ground",offset:0};const S=b;class T{constructor(e,t,i){this.view=e,this.vertexIndex=t,this.vertices=i,this.defaultPrevented=!1,this.type="vertex-add"}preventDefault(){this.defaultPrevented=!0}}class V{constructor(e,t,i){this.view=e,this.vertexIndex=t,this.vertices=i,this.defaultPrevented=!1,this.type="vertex-remove"}preventDefault(){this.defaultPrevented=!0}}class M{constructor(e,t,i,n=null){this.view=e,this.vertexIndex=t,this.vertices=i,this.mapPoint=n,this.coordinates=null,this.defaultPrevented=!1,this.type="cursor-update",this.coordinates=1===i.length?i[0]:null}preventDefault(){this.defaultPrevented=!0}}class C{constructor(e){this.vertices=e,this.coordinates=null,this.defaultPrevented=!1,this.type="draw-complete",this.coordinates=1===e.length?e[0]:null}preventDefault(){this.defaultPrevented=!0}}var E=i(82795),A=i(92750),H=i(20405),Z=i(1912);const I=Symbol("view-handles"),L=Symbol("undo-redo-handles");let D=class extends S{constructor(e){super(e),this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1}initialize(){this._addViewHandles(),this._addUndoRedoHandles()}destroy(){this._removeViewHandles(),this._removeUndoRedoHandles(),this.emit("destroy")}undo(){super.undo(),this.notifyChange("vertices")}redo(){super.redo(),this.notifyChange("vertices")}complete(){this._completeDrawing()}_addViewHandles(){this._removeViewHandles(),this.addHandles([this.view.on("click",(e=>{e.stopPropagation()}),E.o.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,H.ZV)(e),"touch"===e.pointerType&&this._updateCursor())}),E.o.TOOL),this.view.on("pointer-move",(e=>{this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._abortSnapping(),this._cursorScreenPoint=(0,H.ZV)(e),"touch"!==e.pointerType&&this._updateCursor()}),E.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._addVertexOnPointerUp=!1)}),E.o.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp)this._vertexAddHandler(e);else{const t="touch"===e.pointerType;this._updateCursor(t)}}),E.o.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),E.o.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),E.o.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),E.o.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t===A.NE.vertexAdd&&!i&&this._cursorScreenPoint?(e.stopPropagation(),this._abortSnapping(),this._vertexAddHandler(e)):t!==A.NE.complete||i?t!==A.NE.undo||this.interactiveUndoDisabled||i?t!==A.NE.redo||this.interactiveUndoDisabled||i?t!==A.NE.pan||i||e.stopPropagation():(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e))}),E.o.TOOL),this.view.on("key-up",(e=>{e.key===A.NE.pan&&e.stopPropagation()}),E.o.TOOL)],I)}_addUndoRedoHandles(){this._removeUndoRedoHandles(),this.addHandles([this._editGeometryOperations.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new V(this.view,e.vertices[0].index,t))}})),this._editGeometryOperations.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._committedVertices.length-1,t=new T(this.view,e,this.vertices);this.emit("vertex-add",t),t.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new T(this.view,e.vertices[0].index,t))}}))],L)}_removeViewHandles(){this.removeHandles(I)}_removeUndoRedoHandles(){this.removeHandles(L)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||this._editGeometryOperations.appendVertex(t)}_updateCursor(e=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==t||e||this._pushCursorVertex(t.vertex,(()=>this.emit("cursor-update",new M(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new Z.A(this._stagedVertex):null))))}_completeDrawing(){if(this._activePointerId=null,this._popCursorVertex(),this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping(),this.vertices.length<1)return;const e=new C(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this._removeViewHandles()}};D=(0,o._)([(0,a.$)("esri.views.draw.MultipointDrawAction")],D);var k=i(19541),R=i(64737),z=i(99517),U=i(6364);let G=class extends(l.A.EventedMixin(U.g)){constructor(e){super(e),this.defaultZ=0,this.elevationInfo=null,this.hasZ=!0,this.mode=null,this.snapToScene=null,this.type="draw-3d"}initialize(){const e=this.view,t=(0,k.bK)(this.hasZ,this.elevationInfo);this.drawOperation=new R.O0({view:e,manipulators:this.manipulators,geometryType:this.geometryType,drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:"3d"===e.type?new z.IX(e,t):null,elevationDrawSurface:"3d"===e.type?new z.rT(t,this.defaultZ,e):null,hasM:!1,elevationInfo:t}),this.addHandles([this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e)))]),this.finishToolCreation()}destroy(){this.drawOperation=(0,h.pR)(this.drawOperation),this._set("view",null)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}get updating(){return this.drawOperation?.updating??!1}completeCreateOperation(){this.drawOperation.complete()}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}getVertexCoords(){return this.drawOperation.geometryIncludingUncommittedVertices}onInputEvent(e){this.drawOperation.onInputEvent(e)}canRedo(){return this.drawOperation.canRedo}canUndo(){return this.drawOperation.canUndo}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}onComplete(e){this.emit("complete",e)}onCursorUpdate(e){this.emit("cursor-update",e)}onVertexAdd(e){this.emit("vertex-add",e)}onVertexRemove(e){this.emit("vertex-remove",e)}onVertexUpdate(e){this.emit("vertex-update",e)}};(0,o._)([(0,s.MZ)({constructOnly:!0,nonNullable:!0})],G.prototype,"defaultZ",void 0),(0,o._)([(0,s.MZ)()],G.prototype,"drawOperation",void 0),(0,o._)([(0,s.MZ)({constructOnly:!0})],G.prototype,"elevationInfo",void 0),(0,o._)([(0,s.MZ)({value:!0})],G.prototype,"enabled",null),(0,o._)([(0,s.MZ)({constructOnly:!0})],G.prototype,"geometryType",void 0),(0,o._)([(0,s.MZ)({constructOnly:!0})],G.prototype,"hasZ",void 0),(0,o._)([(0,s.MZ)({constructOnly:!0})],G.prototype,"mode",void 0),(0,o._)([(0,s.MZ)()],G.prototype,"snapToScene",void 0),(0,o._)([(0,s.MZ)({readOnly:!0})],G.prototype,"type",void 0),(0,o._)([(0,s.MZ)({readOnly:!0})],G.prototype,"updating",null),(0,o._)([(0,s.MZ)({constructOnly:!0,nonNullable:!0})],G.prototype,"view",void 0),G=(0,o._)([(0,a.$)("esri.views.draw.DrawTool")],G);let N=class extends S{constructor(e){super(e),this._addVertexOnPointerUp=!1,this._drawTool=null}initialize(){this._addViewHandles(),"3d"===this.view.type&&this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}complete(){this._completeDrawing()}_addViewHandles(){this._addViewHandles2DOnly(),this.addHandles([this.view.on("key-down",(e=>{e.key===A.NE.complete&&(this._drawTool?this.complete():(this._abortSnapping(),this._vertexAddHandler(e)))}),E.o.TOOL)])}_addViewHandles2DOnly(){"2d"===this.view.type&&this.addHandles([this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,H.ZV)(e),"touch"===e.pointerType&&this._updateCursor())}),E.o.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),this._cursorScreenPoint=(0,H.ZV)(e),"touch"!==e.pointerType&&this._updateCursor()}),E.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._addVertexOnPointerUp=!1)}),E.o.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp)e.stopPropagation(),this._vertexAddHandler(e);else{const t="touch"===e.pointerType;this._updateCursor(t)}}),E.o.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),E.o.TOOL)])}_addDrawTool(){const e=new G({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"point",mode:"click"});this._drawTool=e,this.view.addAndActivateTool(e),this.addHandles([e.on("cursor-update",(t=>{1===t.vertices.length&&this.emit("cursor-update",new M(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("complete",(t=>{this.emit("draw-complete",new C(e.getVertexCoords())),this._removeDrawTool(),this.removeAllHandles()}))])}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t),this.notifyChange("vertices"),this._completeDrawing())}_updateCursor(e=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==t||e||this._pushCursorVertex(t.vertex,(()=>this.emit("cursor-update",new M(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new Z.A(this._stagedVertex):null))))}_completeDrawing(){if(this._drawTool)return void this._drawTool.completeCreateOperation();this._activePointerId=null,this._popCursorVertex(),this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping();const e=new C(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}};N=(0,o._)([(0,a.$)("esri.views.draw.PointDrawAction")],N);var F=i(43410);let K=class extends S{constructor(e){super(e),this._panEnabled=!1,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this._drawTool=null,this.mode=F.t}initialize(){this._addViewHandles(),"3d"===this.view.type&&this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}get _dragEnabled(){return"freehand"===this.mode||"hybrid"===this.mode}get _clickEnabled(){return"click"===this.mode||"hybrid"===this.mode}undo(){this._drawTool?this._drawTool.undo():(super.undo(),this.notifyChange("vertices"))}redo(){this._drawTool?this._drawTool.redo():(super.redo(),this.notifyChange("vertices"))}canUndo(){return this._drawTool?.canUndo()??super.canUndo()}canRedo(){return this._drawTool?.canRedo()??super.canRedo()}complete(){this._completeDrawing()}_getGeometryZValue(){return this.hasZ&&this.vertices.length>0?this.vertices[0][2]:this.defaultZ}_addViewHandles(){this._addViewHandles2DOnly(),this.addHandles(this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t!==A.NE.vertexAdd||i?t!==A.NE.complete||i?t!==A.NE.undo||this.interactiveUndoDisabled||i?t!==A.NE.redo||this.interactiveUndoDisabled||i||(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e)):(e.stopPropagation(),this._handleVertexAddKey(e))}),E.o.TOOL))}_addViewHandles2DOnly(){"2d"===this.view.type&&(this.addHandles([this.view.on("click",(e=>{e.stopPropagation()}),E.o.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,H.ZV)(e),"touch"===e.pointerType&&this._updateCursor())}),E.o.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._cursorScreenPoint=(0,H.ZV)(e),"touch"!==e.pointerType&&this._updateCursor()}),E.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._cursorScreenPoint=(0,H.ZV)(e),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(e):this._addVertexOnPointerUp=!1)}),E.o.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp){if(!this._clickEnabled)return 1===this.vertices.length&&this.vertices.pop(),void this._drawCompleteHandler(e);this._vertexAddHandler(e)}else{const t="touch"===e.pointerType;this._updateCursor(t)}}),E.o.TOOL),this.view.on("drag",(e=>{this._dragEnabled&&null!=this._activePointerId&&!this._panEnabled&&e.stopPropagation()}),E.o.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),E.o.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),E.o.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),E.o.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t!==A.NE.pan||i||(e.stopPropagation(),this._panEnabled=!0)}),E.o.TOOL),this.view.on("key-up",(e=>{e.key===A.NE.pan&&(e.stopPropagation(),this._panEnabled=!1)}),E.o.TOOL)]),this._addUndoRedoHandles())}_handleVertexAddKey(e){this._drawTool?this._drawTool.drawOperation.commitStagedVertex():this._cursorScreenPoint&&(this._abortSnapping(),this._vertexAddHandler(e))}_addUndoRedoHandles(){this.addHandles([this._editGeometryOperations.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new V(this.view,e.vertices[0].index,t))}})),this._editGeometryOperations.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._committedVertices.length-1,t=new T(this.view,e,this.vertices);this.emit("vertex-add",t),t.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new T(this.view,e.vertices[0].index,t))}}))])}_addDrawTool(){const e=new G({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polygon",mode:this.mode});this._drawTool=e,this.view.addAndActivateTool(e),e.on("vertex-add",(t=>{if(1===t.vertices.length){const{view:i}=this,n=t.vertices[0].vertexIndex,o=e.getVertexCoords();this.emit("vertex-add",new T(i,n,o)),"undo"!==t.operation&&"redo"!==t.operation||this.emit(t.operation,new T(i,n,o))}})),e.on("vertex-remove",(t=>{if(1===t.vertices.length){const{view:i}=this,n=t.vertices[0].vertexIndex,o=e.getVertexCoords();this.emit("vertex-remove",new V(i,n,o)),"undo"!==t.operation&&"redo"!==t.operation||this.emit(t.operation,new V(i,n,o))}})),e.on("cursor-update",(t=>{1===t.vertices.length&&this.emit("cursor-update",new M(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("complete",(t=>{this.emit("draw-complete",new C(e.getVertexCoords())),this._removeDrawTool(),this.removeAllHandles()}))}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t))}_updateCursor(e=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==t||e||this._pushCursorVertex(t.vertex,(()=>this.emit("cursor-update",new M(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new Z.A(this._stagedVertex):null))))}_completeDrawing(){if(this._drawTool)return void this._drawTool.completeCreateOperation();if(this._activePointerId=null,this._popCursorVertex(),this._committedVertices.length<3)return;this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping();const e=new C(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}};(0,o._)([(0,s.MZ)()],K.prototype,"_dragEnabled",null),(0,o._)([(0,s.MZ)()],K.prototype,"_clickEnabled",null),(0,o._)([(0,s.MZ)({type:F.x})],K.prototype,"mode",void 0),K=(0,o._)([(0,a.$)("esri.views.draw.PolygonDrawAction")],K);let $=class extends S{constructor(e){super(e),this._panEnabled=!1,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this._drawTool=null,this.mode=F.t}initialize(){this._addViewHandles(),"3d"===this.view.type&&this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}get _clickEnabled(){return"click"===this.mode||"hybrid"===this.mode}get _dragEnabled(){return"freehand"===this.mode||"hybrid"===this.mode}undo(){this._drawTool?this._drawTool.undo():(super.undo(),this.notifyChange("vertices"))}redo(){this._drawTool?this._drawTool.redo():(super.redo(),this.notifyChange("vertices"))}canUndo(){return this._drawTool?.canUndo()??super.canUndo()}canRedo(){return this._drawTool?.canRedo()??super.canRedo()}complete(){this._completeDrawing()}_addViewHandles(){this._addViewHandles2DOnly(),this.addHandles([this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t!==A.NE.vertexAdd||i?t!==A.NE.complete||i?t!==A.NE.undo||this.interactiveUndoDisabled||i?t!==A.NE.redo||this.interactiveUndoDisabled||i||(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e)):(e.stopPropagation(),this._handleVertexAddKey(e))}),E.o.TOOL)])}_addViewHandles2DOnly(){"2d"===this.view.type&&(this.addHandles([this.view.on("click",(e=>{e.stopPropagation()}),E.o.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&!this._panEnabled&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,H.ZV)(e),"touch"===e.pointerType&&this._updateCursor())}),E.o.TOOL),this.view.on("pointer-move",(e=>{this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._abortSnapping(),this._cursorScreenPoint=(0,H.ZV)(e),"touch"!==e.pointerType&&this._updateCursor()}),E.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._cursorScreenPoint=(0,H.ZV)(e),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(e):this._addVertexOnPointerUp=!1)}),E.o.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp){if(!this._clickEnabled)return 1===this.vertices.length&&this.vertices.pop(),void this._drawCompleteHandler(e);this._vertexAddHandler(e)}else{const t="touch"===e.pointerType;this._updateCursor(t)}}),E.o.TOOL),this.view.on("drag",(e=>{this._dragEnabled&&null!=this._activePointerId&&!this._panEnabled&&e.stopPropagation()}),E.o.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),E.o.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),E.o.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),E.o.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t!==A.NE.pan||i||(e.stopPropagation(),this._panEnabled=!0)}),E.o.TOOL),this.view.on("key-up",(e=>{e.key===A.NE.pan&&(e.stopPropagation(),this._panEnabled=!1)}),E.o.TOOL)]),this._addUndoRedoHandles())}_handleVertexAddKey(e){this._drawTool?this._drawTool.drawOperation.commitStagedVertex():this._cursorScreenPoint&&(this._abortSnapping(),this._vertexAddHandler(e))}_addUndoRedoHandles(){this.addHandles([this._editGeometryOperations.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new V(this.view,e.vertices[0].index,t))}})),this._editGeometryOperations.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._committedVertices.length-1,t=new T(this.view,e,this.vertices);this.emit("vertex-add",t),t.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new T(this.view,e.vertices[0].index,t))}}))])}_addDrawTool(){const e=new G({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polyline",mode:this.mode});this._drawTool=e,this.view.addAndActivateTool(e),this.addHandles([e.on("vertex-add",(t=>{if(1!==t.vertices.length)return;const{view:i}=this,n=t.vertices[0].vertexIndex,o=e.getVertexCoords();this.emit("vertex-add",new T(i,n,o)),"undo"!==t.operation&&"redo"!==t.operation||this.emit(t.operation,new T(i,n,o))})),e.on("vertex-remove",(t=>{if(1!==t.vertices.length)return;const{view:i}=this,n=t.vertices[0].vertexIndex,o=e.getVertexCoords();this.emit("vertex-remove",new V(i,n,o)),"undo"!==t.operation&&"redo"!==t.operation||this.emit(t.operation,new V(i,n,o))})),e.on("cursor-update",(t=>{1===t.vertices.length&&this.emit("cursor-update",new M(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("complete",(t=>{this.emit("draw-complete",new C(e.getVertexCoords())),this._removeDrawTool(),this.removeAllHandles()}))])}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t))}_updateCursor(e=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==t||e||this._pushCursorVertex(t.vertex,(()=>this.emit("cursor-update",new M(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new Z.A(this._stagedVertex):null))))}_completeDrawing(){if(this._drawTool)return void this._drawTool.completeCreateOperation();if(this._activePointerId=null,this._popCursorVertex(),this._committedVertices.length<2)return;this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping();const e=new C(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}};(0,o._)([(0,s.MZ)()],$.prototype,"_clickEnabled",null),(0,o._)([(0,s.MZ)()],$.prototype,"_dragEnabled",null),(0,o._)([(0,s.MZ)({type:F.x})],$.prototype,"mode",void 0),$=(0,o._)([(0,a.$)("esri.views.draw.PolylineDrawAction")],$);var W=i(56122);let X=class extends S{constructor(e){super(e),this._isDragging=!1,this._panEnabled=!1,this._addVertexOnPointerUp=!1,this._drawTool=null,this.viewAlignedCoordinateSystem=null,this.mode="freehand"}initialize(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}complete(){this._completeDrawing()}_getGeometryZValue(){return this.hasZ&&this.vertices.length>0?this.vertices[0][2]:this.defaultZ}_addViewHandles(){"click"===this.mode?this.addHandles(this._getClickModeViewHandles()):this.addHandles(this._getDragModeViewHandles())}_getDragModeViewHandles(){return[this.view.on("immediate-click",(e=>{e.stopPropagation(),e.mapPoint&&!this._panEnabled&&null!=this.getCoordsFromScreenPoint((0,H.ZV)(e))&&(this._vertexAddHandler(e),this._drawCompleteHandler(e))}),E.o.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._panEnabled||(this._resetGeometry(),this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,H.ZV)(e),this._activePointerId=e.pointerId,this._vertexAddHandler(e),this._isDragging=!1,"touch"===e.pointerType&&this._updateCursor()))}),E.o.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),null==this._activePointerId&&"touch"!==e.pointerType&&(this._cursorScreenPoint=(0,H.ZV)(e),this._updateCursor())}),E.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._isDragging=!0,this._cursorScreenPoint=(0,H.ZV)(e),this._updateCursor())}),E.o.TOOL),this.view.on("pointer-up",(e=>{this._shouldHandlePointerEvent(e)&&this._addVertexOnPointerUp&&(this._abortSnapping(),this._activePointerId=null,this._isDragging&&this._vertexAddHandler(e),2===this._committedVertices.length&&this._drawCompleteHandler(e),this._isDragging=!1)}),E.o.TOOL),this.view.on("key-down",(e=>{e.key===A.NE.complete&&this._cursorScreenPoint?(this._abortSnapping(),this._vertexAddHandler(e),this._drawCompleteHandler(e)):e.key===A.NE.pan&&(this._panEnabled=!0)}),E.o.TOOL),this.view.on("key-up",(e=>{e.key===A.NE.pan&&(this._panEnabled=!1)}),E.o.TOOL),this.view.on("drag",(e=>{null!=this._activePointerId&&e.stopPropagation()}),E.o.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),E.o.TOOL)]}_getClickModeViewHandles(){return[this.view.on("pointer-down",(e=>{this._abortSnapping(),this._cursorScreenPoint=(0,H.ZV)(e),this._activePointerId=e.pointerId,this._isDragging=!1,"touch"===e.pointerType&&this._updateCursor()}),E.o.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),this._cursorScreenPoint=(0,H.ZV)(e),null==this._activePointerId&&"touch"!==e.pointerType&&this._updateCursor()}),E.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._isDragging=!0)}),E.o.TOOL),this.view.on("pointer-up",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=null,e.stopPropagation(),this._isDragging||this._vertexAddHandler(e),2!==this.vertices.length||this._isDragging||this._drawCompleteHandler(e),this._isDragging=!1)}),E.o.TOOL),this.view.on("key-down",(e=>{e.key===A.NE.vertexAdd&&this._cursorScreenPoint&&(this._vertexAddHandler(e),2===this.vertices.length&&this._drawCompleteHandler(e)),e.key===A.NE.complete&&this._cursorScreenPoint&&2===this.vertices.length&&(this._vertexAddHandler(e),this._drawCompleteHandler(e))}),E.o.TOOL)]}_addDrawTool(){const e=new G({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"segment",mode:this.mode});this._drawTool=e,this.view.addAndActivateTool(e),this.addHandles([e.on("vertex-add",(t=>{1===t.vertices.length&&this.emit("vertex-add",new T(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("cursor-update",(t=>{1===t.vertices.length&&this.emit("cursor-update",new M(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("complete",(t=>{this.emit("draw-complete",new C(e.getVertexCoords())),this._removeDrawTool()})),this.view.on("key-down",(t=>{t.key!==A.NE.vertexAdd||t.repeat||"click"!==this.mode?t.key!==A.NE.complete||t.repeat||e.completeCreateOperation():e.drawOperation.numCommittedVertices>0?e.completeCreateOperation():e.drawOperation.commitStagedVertex()}),E.o.TOOL)])}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);if(this._isDuplicateOfLastVertex(t))return;this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t),1===this._committedVertices.length&&(this.viewAlignedCoordinateSystem=(0,W.ZP)(this.view,this._committedVertices[0]));const i=this._committedVertices.length-1,n=new T(this.view,i,this.vertices);this.emit("vertex-add",n)}_updateCursor(){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const e=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null!=e&&this._pushCursorVertex(e.vertex,(()=>this.emit("cursor-update",new M(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new Z.A(this._stagedVertex):null))))}_completeDrawing(){if(this._drawTool)return this._drawTool.completeCreateOperation(),void this.removeAllHandles();if(this._activePointerId=null,this._popCursorVertex(),this._cursorScreenPoint=null,this._isDragging=!1,this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping(),this.vertices.length<1)return;const e=new C(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}_resetGeometry(){this._editGeometryOperations.destroy(),this._editGeometryOperations=new w.p(new y.ZE("polygon",this._coordinateHelper),v.RT.Local),this._activeComponent=new y.uA(this._coordinateHelper.spatialReference,v.RT.Local),this._editGeometryOperations.data.components.push(this._activeComponent)}};(0,o._)([(0,s.MZ)({type:["freehand","click"]})],X.prototype,"mode",void 0),X=(0,o._)([(0,a.$)("esri.views.draw.SegmentDrawAction")],X);let q=class extends r.A{constructor(){super(...arguments),this.activeAction=null,this.type="draw",this.view=null}destroy(){this.activeAction&&(this.activeAction.destroy(),this.activeAction=null)}create(e,t){this.reset();const i={view:this.view,...t};switch(e){case"point":i.editGeometryType="point",this.activeAction=new N(i);break;case"polyline":i.editGeometryType="polyline",this.activeAction=new $(i);break;case"multipoint":i.editGeometryType="polygon",this.activeAction=new D(i);break;case"polygon":i.editGeometryType="polygon",this.activeAction=new K(i);break;case"rectangle":case"circle":case"ellipse":case"triangle":i.editGeometryType="polygon",this.activeAction=new X(i)}return this.activeAction}complete(){this.activeAction&&this.activeAction.complete(),this.activeAction=null}reset(){this.activeAction&&this.activeAction.destroy(),this.activeAction=null}};(0,o._)([(0,s.MZ)()],q.prototype,"activeAction",void 0),(0,o._)([(0,s.MZ)({readOnly:!0})],q.prototype,"type",void 0),(0,o._)([(0,s.MZ)()],q.prototype,"view",void 0),q=(0,o._)([(0,a.$)("esri.views.draw.Draw")],q);const B=q},83423:(e,t,i)=>{i.d(t,{l:()=>f});var n=i(82392),o=i(73783),r=i(57888),s=i(61985),a=i(23572),l=i(81482),d=(i(6273),i(80861),i(67498),i(26325)),h=i(53334),p=i(80347),c=i(19913),u=i(34561),_=i(64159),v=i(19541),m=i(61793),g=i(44223),y=i(99842),w=i(17467);let f=class extends o.A{set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}get elevationInfo(){const{layer:e}=this.graphic,t=e&&"elevationInfo"in e?e.elevationInfo:null,i=(0,v.ky)(this.graphic),n=t?t.offset:0;return new g.A({mode:i,offset:n})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new r.A.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){const t=this.graphic;if(!1===t.visible)return null;const i=t.geometry;if(null==i)return null;const n=this._get("focusedSymbol"),o=null!=n?n:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,i,o):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),null!=this.layer&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),null!=this.layer&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=(0,s.wB)((()=>this.graphic?.symbol),(e=>{null!=e&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&null!=this.focusedSymbol&&(this.graphic.symbol=this.focusedSymbol))}),s.OH)}detachSymbolChanged(){null!=this._graphicSymbolChangedHandle&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&null!=this.focusedSymbol?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,i,n){if(null==(n=n||(0,m.SF)(i)))return null;let o=this._circleCollisionCache;if("point"===i.type&&"cim"===n.type&&"CIMPointSymbol"===n.data.symbol?.type&&n.data.symbol.symbolLayers){const{offsetX:o,offsetY:r,size:s}=(0,y.T)(n),l=(0,a.WA)(t,b),d=s/2,p=e.toScreen(i),c=p.x+o,u=p.y+r;return(0,h.hG)(l,[c,u])<d*d?1:null}if("point"!==i.type||"simple-marker"!==n.type)return(0,w.t)(t,i,e)?1:null;if(null==o||!o.originalPoint.equals(i)){const t=i,r=e.spatialReference;if((0,u.canProjectWithoutEngine)(t.spatialReference,r)){const e=(0,u.project)(t,r);o={originalPoint:t.clone(),mapPoint:e,radiusPx:(0,a.Lz)(n.size)},this._circleCollisionCache=o}}if(null!=o){const i=(0,a.WA)(t,b),r=e.toScreen?.(o.mapPoint);if(!r)return null;const s=o.radiusPx,l=r.x+(0,a.Lz)(n.xoffset),d=r.y-(0,a.Lz)(n.yoffset);return(0,h.hG)(i,[l,d])<s*s?1:null}return null}_intersectDistance3D(e,t,i){const n=e.toMap(t,{include:[i]});return n&&(0,_.g)(n,x,e.renderSpatialReference)?(0,p.p)(x,e.state.camera.eye):null}};(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],f.prototype,"graphic",null),(0,n._)([(0,l.MZ)()],f.prototype,"elevationInfo",null),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],f.prototype,"view",void 0),(0,n._)([(0,l.MZ)({value:null})],f.prototype,"focusedSymbol",null),(0,n._)([(0,l.MZ)({constructOnly:!0})],f.prototype,"layer",void 0),(0,n._)([(0,l.MZ)()],f.prototype,"interactive",void 0),(0,n._)([(0,l.MZ)()],f.prototype,"selectable",void 0),(0,n._)([(0,l.MZ)()],f.prototype,"grabbable",void 0),(0,n._)([(0,l.MZ)({value:!1})],f.prototype,"grabbing",null),(0,n._)([(0,l.MZ)()],f.prototype,"dragging",void 0),(0,n._)([(0,l.MZ)()],f.prototype,"hovering",null),(0,n._)([(0,l.MZ)({value:!1})],f.prototype,"selected",null),(0,n._)([(0,l.MZ)()],f.prototype,"cursor",void 0),f=(0,n._)([(0,d.$)("esri.views.interactive.GraphicManipulator")],f);const x=(0,c.vt)(),b=(0,a.gs)()},6364:(e,t,i)=>{i.d(t,{g:()=>h});var n=i(82392),o=i(73783),r=(i(6273),i(80861),i(37623)),s=i(81482),a=(i(67498),i(26325)),l=i(10715),d=i(31879);let h=class extends o.A{constructor(e){super(e),this.manipulators=new d.t,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[l.PK.MANAGER,!0],[l.PK.USER,!0]]),this._creationFinishedResolver=(0,r.Tw)()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(l.PK.USER)}set editable(e){this.setEditableFlag(l.PK.USER,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){null!=this.view&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===l.PK.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(l.PK.USER)&&this.getEditableFlag(l.PK.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};(0,n._)([(0,s.MZ)({constructOnly:!0})],h.prototype,"view",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],h.prototype,"active",null),(0,n._)([(0,s.MZ)({value:!0})],h.prototype,"visible",null),(0,n._)([(0,s.MZ)({value:!0})],h.prototype,"editable",null),(0,n._)([(0,s.MZ)({readOnly:!0})],h.prototype,"manipulators",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],h.prototype,"updating",null),(0,n._)([(0,s.MZ)()],h.prototype,"cursor",null),(0,n._)([(0,s.MZ)({readOnly:!0})],h.prototype,"automaticManipulatorSelection",void 0),(0,n._)([(0,s.MZ)()],h.prototype,"hasFocusedManipulators",null),(0,n._)([(0,s.MZ)()],h.prototype,"hasGrabbedManipulators",void 0),(0,n._)([(0,s.MZ)()],h.prototype,"hasHoveredManipulators",void 0),(0,n._)([(0,s.MZ)()],h.prototype,"firstGrabbedManipulator",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],h.prototype,"created",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],h.prototype,"removeIncompleteOnCancel",void 0),h=(0,n._)([(0,a.$)("esri.views.interactive.InteractiveToolBase")],h)},31879:(e,t,i)=>{i.d(t,{t:()=>s});var n,o,r=i(40377);(o=n||(n={}))[o.WhenToolEditable=0]="WhenToolEditable",o[o.WhenToolNotEditable=1]="WhenToolNotEditable",o[o.Always=2]="Always";class s{constructor(){this._isToolEditable=!0,this._manipulators=new r.A,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=n.WhenToolEditable){this.addMany([e],t)}addMany(e,t=n.WhenToolEditable){for(const i of e){const e={manipulator:i,visibilityPredicate:t,attached:!1};this._manipulators.add(e),this._attached&&this._updateManipulatorAttachment(e)}}remove(e){for(let t=0;t<this._manipulators.length;t++)if(this._manipulators.at(t).manipulator===e){const e=this._manipulators.splice(t,1)[0];this._detachManipulator(e);break}}removeAll(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((e=>{this._updateManipulatorAttachment(e)})),this._attached=!0}detach(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach((({manipulator:e})=>e.destroy())),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,(e=>{t(e)}))}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach((t=>e.push(t.manipulator))),e}intersect(e,t){let i=null,n=Number.MAX_VALUE;return this._manipulators.forEach((({manipulator:o,attached:r})=>{if(!r||!o.interactive)return;const s=o.intersectionDistance(e,t);null!=s&&s<n&&(n=s,i=o)})),i}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===n.Always||(this._isToolEditable?e.visibilityPredicate===n.WhenToolEditable:e.visibilityPredicate===n.WhenToolNotEditable)}}},66019:(e,t,i)=>{i.d(t,{EX:()=>b,RS:()=>C,Tp:()=>O,VG:()=>w,Wp:()=>_,Xt:()=>c,an:()=>u,bl:()=>y,dp:()=>f,mc:()=>x,pg:()=>V,rh:()=>T,sO:()=>P,y$:()=>g});var n=i(3223),o=(i(6273),i(15565)),r=i(4506),s=i(23572),a=i(34561),l=i(28364),d=i(96124),h=i(19541),p=i(13243);function c(e,t){return e.events.on("drag",function(e,t){let i=null,n=null;return o=>{if("cancel"===o.action)return void(null!=n&&(n.execute({action:"cancel"}),i=null,n=null));const r={action:o.action,screenStart:o.start,screenEnd:o.screenPoint};"start"===o.action&&null==i&&(i=new T,n=new T,t(e,i,n,o.pointerType,r)),null!=i&&i.execute(r),"end"===o.action&&null!=i&&(i=null,n=null)}}(e,t))}function u(e,t){const i=[e.x,e.y,e.z??0],n=t,o=[Math.cos(n),Math.sin(n)],r=Math.sqrt(o[0]*o[0]+o[1]*o[1]);if(0===r)return null;o[0]/=r,o[1]/=r;const s=e=>{const t=(e.x-i[0])*o[0]+(e.y-i[1])*o[1];e.x=i[0]+t*o[0],e.y=i[1]+t*o[1]};return e=>(s(e.mapStart),s(e.mapEnd),{...e,axis:o})}function _(e){let t=null;return i=>{if("start"===i.action&&(t=function(e,t){const i=e.operations;if(!i)return null;const n=i.data.geometry,o=(0,d.RS)(t);if(n.spatialReference.equals(o))return m(e,i,(()=>{}));if("mesh"!==n.type){const t=v(n,o);if(null==t)return null;const r=n.spatialReference;return m(e,p.p.fromGeometry(t,i.viewingMode),(()=>{const e=(0,a.project)(n,r);i.trySetGeometry(e)}))}if((0,l.CK)(n)){const t=v(n.origin,o);if(!t)return null;const r=n.spatialReference,s=p.p.fromGeometry(t,i.viewingMode);return m(e,i,(()=>{const e=(0,a.project)(s.data.geometry,r),t=e.x-n.origin.x,o=e.y-n.origin.y,l=(e.z??0)-(n.origin.z??0);i.move(t,o,l)}))}return null}(e,i.mapStart.spatialReference)),null==t)return null;const n=i.mapEnd.x-i.mapStart.x,o=i.mapEnd.y-i.mapStart.y,r=(i.mapEnd.z??0)-(i.mapStart.z??0);return t.move(n,o,r,i.action),{...i,translationX:n,translationY:o,translationZ:r}}}function v(e,t){return null==e?null:e.spatialReference.equals(t)?e.clone():(0,a.project)(e,t)}function m(e,t,i){let n=0,o=0,r=0;return{move:(s,a,l,d)=>{"start"===d&&(n=0,o=0,r=0);const h=s-n,p=a-o,c=l-r;t.move(h,p,c),n+=h,o+=p,r+=c,i(),"end"===d&&e.endInteraction?.()}}}function g(e,t=null,i){let n=null;const o=null==t||e.spatialReference?.equals(t)?e=>e:e=>null!=e?(0,a.project)(e,t):e,r={exclude:[],...i};return t=>{if("start"===t.action&&(n=o(e.toMap(t.screenStart,r))),null==n)return null;const i=o(e.toMap(t.screenEnd,r));return null!=i?{...t,mapStart:n,mapEnd:i}:null}}function y(e){const t=e.map((e=>_(e))).filter(n.Ru);return e=>{const i=e.mapEnd.x-e.mapStart.x,n=e.mapEnd.y-e.mapStart.y,o=e.mapEnd.z-e.mapStart.z;return t.forEach((t=>t(e))),{...e,translationX:i,translationY:n,translationZ:o}}}function w(e,t){const i=new Map;for(const n of t)i.set(n,(0,o.o8)(e[n]));return t=>(i.forEach(((t,i)=>{e[i]=t})),t)}function f(e){const t=e.operations?.createResetState();return e=>(t?.remove(),e)}function x(e){const t=e.map((e=>f(e))).filter((e=>null!=e));return e=>(t.forEach((t=>t(e))),e)}function b(){let e=0,t=0,i=0;return n=>{"start"===n.action&&(e=n.mapStart.x,t=n.mapStart.y,i=n.mapStart.z);const o=n.mapEnd.x-e,r=n.mapEnd.y-t,s=n.mapEnd.z-i;return e=n.mapEnd.x,t=n.mapEnd.y,i=n.mapEnd.z,{...n,mapDeltaX:o,mapDeltaY:r,mapDeltaZ:s,mapDeltaSpatialReference:n.mapStart.spatialReference}}}function P(){let e=0,t=0;return i=>{"start"===i.action&&(e=i.screenStart.x,t=i.screenStart.y);const n=i.screenEnd.x-e,o=i.screenEnd.y-t;return e=i.screenEnd.x,t=i.screenEnd.y,{...i,screenDeltaX:n,screenDeltaY:o}}}function O(e,t){let i=null,n=0,o=0;return a=>{if("start"===a.action&&(i=e.toScreen?.(t),null!=i&&(i.x<0||i.x>e.width||i.y<0||i.y>e.height?i=null:(n=a.screenStart.x-i.x,o=a.screenStart.y-i.y))),null==i)return null;const l=(0,r.qE)(a.screenEnd.x-n,0,e.width),d=(0,r.qE)(a.screenEnd.y-o,0,e.height),h=(0,s.tc)(l,d);return a.screenStart=i,a.screenEnd=h,a}}const S=()=>{};class T{constructor(){this.execute=S}next(e,t=new T){return null!=e&&(this.execute=i=>{const n=e(i);null!=n&&t.execute(n)}),t}}function V(e,t,i=[]){if("2d"===e.type)return e=>e;let n=null;return o=>{"start"===o.action&&(n=e.toMap(o.screenStart,{exclude:i}),null!=n&&(n.z=(0,h.id)(n,e,t)));const r=e.toMap(o.screenEnd,{exclude:i});null!=r&&(r.z=(0,h.id)(r,e,t));const s=null!=n&&null!=r?{sceneStart:n,sceneEnd:r}:null;return{...o,scenePoints:s}}}function M(e,t,i){const n=t.elevationProvider.getElevation(e.x,e.y,e.z??0,e.spatialReference,"scene")??0,o=(0,d.EL)(e);return o.z=n,o.hasZ=!0,o.z=(0,h.id)(o,t,i),o}function C(e,t){if("2d"===e.type)return e=>e;let i=null;return n=>{"start"===n.action&&(i=M(n.mapStart,e,t));const o=M(n.mapEnd,e,t),r=null!=i&&null!=o?{sceneStart:i,sceneEnd:o}:null;return{...n,scenePoints:r}}}},28535:(e,t,i)=>{i.d(t,{e:()=>n});class n{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.feature=e.feature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ,this.drawConstraints=e.drawConstraints}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}}},51720:(e,t,i)=>{i.d(t,{L:()=>c});var n=i(57725),o=i(37623),r=i(61985),s=i(92801),a=i(96124),l=i(19541),d=i(66019),h=i(28535),p=i(49437);function c({predicate:e=()=>!0,snappingManager:t,snappingContext:i,updatingHandles:a,useZ:c=!0}){const g=new d.rh;if(null==t)return{snappingStep:[m,g],cancelSnapping:m};let y,w=null,f=null,x=null;const b=()=>{w=(0,n.DC)(w),t.doneSnapping(),f?.frameTask.remove(),f=null,y=(0,n.xt)(y),x=null},P=(O=t,S=c,T=g,(0,o.sg)((async({frameTask:e,point:t,scenePoint:i,context:n,event:o,delta:r,getLastState:a},l)=>{const d=await e.schedule((()=>O.snap({point:t,scenePoint:i,context:n,signal:l})),l);if(d.valid){let i=await e.schedule((()=>d.apply()),l);const h=a();null!=h.point&&t!==h.point&&(i=O.update({point:h.point,scenePoint:h.scenePoint,context:n})),null!=h.updatePoint&&(0,s.CI)(i,h.updatePoint)||(v(o.mapEnd,i,r,S),T.execute(o))}})));var O,S,T;let V=null,M=null,C=null;return{snappingStep:[n=>{if(!e(n))return n;const{action:s}=n;if("start"===s){const{info:e}=n,o=function(e){return"3d"===e.type?e.resourceController.scheduler.registerTask(p.W6.SNAPPING):p.nu}(t.view);if(f=function(e,t,i){return{context:new h.e({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:null!=t.info?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:null!=t.snapOrigin?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:null!=t.scenePoints?t.scenePoints.sceneStart:null,frameTask:i}}(i,n,o),f.context.selfSnappingZ=null,!c&&null!=e){const t=function(e,t){if(!e.hasZ())return null;const i=t.vertices;let n=null;for(const t of i){const i=e.getZ(t.pos);if(null!=n&&null!=i&&Math.abs(i-n)>1e-6)return null;null==n&&(n=i)}return n}(i.coordinateHelper,e.handle.component);null!=t&&(f.context.selfSnappingZ={value:t,elevationInfo:i.elevationInfo??l.qt})}}if(null!=f){const{context:e,originalScenePos:i,originalPos:l}=f,{mapEnd:d,mapStart:h,scenePoints:p}=n,m=u(l,_(d,h)),g=_(h,l),b={...n,action:"update"},O=f.context,S=function(e,t){return null==e||null==t?null:u(e,_(t.sceneEnd,t.sceneStart))}(i,p),T=t.update({point:m,scenePoint:S,context:e});if(C=T,v(d,T,g,c),V=m,M=S,"end"!==s){const{frameTask:e}=f;null==w&&(w=new AbortController),x=t=>{a.addPromise((0,o.QZ)(P({frameTask:e,event:b,context:O,point:m,scenePoint:S,delta:g,getLastState:()=>({point:V,scenePoint:M,updatePoint:t.forceUpdate?null:C})},w.signal)))},x({forceUpdate:!1}),null==y&&(y=(0,r.wB)((()=>t.options.effectiveEnabled),(()=>x?.({forceUpdate:!0}))))}}return"end"===s&&b(),n},g],cancelSnapping:e=>(b(),e)}}function u(e,[t,i,n]){const o=(0,a.EL)(e);return o.x+=t,o.y+=i,o.hasZ&&(o.z+=n),o}function _(e,t){const i=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,i]}function v(e,t,[i,n,o],r){e.x=t.x+i,e.y=t.y+n,r&&e.hasZ&&t.hasZ&&(e.z=t.z+o)}function m(e){return e}},54500:(e,t,i)=>{i.d(t,{X:()=>u});var n=i(70214),o=i(71709),r=i(40377),s=i(61985),a=i(90876),l=i(51879),d=i(60586);var h=i(15464),p=i(40105);const c=new Map;function u(e){if(!c.has(e)){const t=function(e,t){const i=new d.A({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:t?.distance??l.N.distance,touchSensitivityMultiplier:t?.touchSensitivityMultiplier??l.N.touchSensitivityMultiplier});return{...(0,s.wB)((()=>e.map?.allLayers?.toArray()??[]),(e=>{i.featureSources=new r.A(e.map((e=>new a.A({layer:e}))))}),s.Vh),options:i}}(e,{distance:10}),i=function(e,t){return new p.g({view:e,options:t,snappingEnginesFactory:(t,i)=>[new h.f({view:e,spatialReference:e.spatialReference,options:i})]})}(e,t.options);c.set(e,{referenceCount:0,snappingManager:i,remove:()=>{t.remove(),i.destroy()}})}const t=c.get(e);t.referenceCount++;const i=(0,n.hA)((()=>{return i=e,(n=t).referenceCount--,void(n.referenceCount>0||(0,o.d)((()=>{0===n.referenceCount&&(n.remove(),c.delete(i))})));var i,n}));return{snappingManager:t.snappingManager,...i}}},36598:(e,t,i)=>{i.d(t,{b:()=>d});var n=i(70214),o=i(46997),r=i(56142),s=i(27411),a=i(25674),l=i(43457);class d{draw(e,t){const i=function(e){const t=[];for(const i of e){let e=!0;for(const n of t)if(i.equals(n)){e=!1;break}e&&t.push(i)}return t}(e),d=this.sortUniqueHints(i),h=[];for(const e of d)e instanceof o.v&&h.push(this.visualizeIntersectionPoint(e,t)),e instanceof r.c&&h.push(this.visualizeLine(e,t)),e instanceof s.r&&h.push(this.visualizeParallelSign(e,t)),e instanceof l.l&&h.push(this.visualizeRightAngleQuad(e,t)),e instanceof a._&&h.push(this.visualizePoint(e,t));return(0,n.vE)(h)}sortUniqueHints(e){return e}}},25674:(e,t,i)=>{i.d(t,{_:()=>r});var n=i(80347),o=i(12288);class r extends o.m{constructor(e,t,i){super(t,i),this.point=e}equals(e){return e instanceof r&&(0,n.e)(this.point,e.point)}}},99842:(e,t,i)=>{i.d(t,{T:()=>o});var n=i(23572);function o(e){let t=0,i=0,o=0;return e?("cim"===e.type&&e.data.symbol&&"symbolLayers"in e.data.symbol&&e.data.symbol.symbolLayers&&e.data.symbol.symbolLayers.map((e=>{"CIMVectorMarker"===e.type&&e.anchorPoint&&(Math.abs(e.anchorPoint.x)>t&&(t=e.anchorPoint.x),Math.abs(e.anchorPoint.y)>i&&(i=e.anchorPoint.y),null!=e.size&&e.size>o&&(o=e.size))})),t=(0,n.Lz)(t),i=(0,n.Lz)(i),o=(0,n.Lz)(o),{offsetX:t,offsetY:i,size:o}):{offsetX:t,offsetY:i,size:o}}},17467:(e,t,i)=>{i.d(t,{V:()=>s,t:()=>a});i(3313);var n=i(5262),o=i(39990),r=i(8e3);function s(e,t,i,o=new r.A){let s=0;if("2d"===i.type)s=t*(i.resolution??0);else if("3d"===i.type){const o=i.overlayPixelSizeInMapUnits(e),r=i.basemapSpatialReference;s=null==r||r.equals(i.spatialReference)?t*o:(0,n.GA)(r)/(0,n.GA)(i.spatialReference)}const a=e.x-s,l=e.y-s,d=e.x+s,h=e.y+s,{spatialReference:p}=i;return o.xmin=Math.min(a,d),o.ymin=Math.min(l,h),o.xmax=Math.max(a,d),o.ymax=Math.max(l,h),o.spatialReference=p,o}function a(e,t,i){const n=i.toMap(e);return null!=n&&s(n,(0,o.o)(),i,l).intersects(t)}const l=new r.A},74219:(e,t,i)=>{i.d(t,{j:()=>d});var n=i(82392),o=i(73783),r=i(80861),s=i(61985),a=i(81482),l=(i(6273),i(67498),i(26325));let d=class extends o.A{constructor(e){super(e),this.tool=null,this._loggedUnsupportedErrorOnce=!1,null!=e?.visible&&(this.visible=e.visible)}initialize(){this.addHandles((0,s.wB)((()=>({ready:null!=this.view&&this.view.ready,supported:this.supported})),(({ready:e,supported:t})=>{!e||t||this._loggedUnsupportedErrorOnce||(this.logError(this.unsupportedErrorMessage),this._loggedUnsupportedErrorOnce=!0)}),s.pc))}destroy(){this.removeTool(),this.view=null}get active(){return null!=this.tool&&this.tool.active}get disabled(){return null==this.view||!this.view.ready||!this.supported}get supported(){return null==this.view||this.view.type===this.supportedViewType}get view(){return this._get("view")}set view(e){if(e===this.view)return;this.removeTool(),this._set("view",e);const t="tools";this.removeHandles(t),null!=e&&this.addHandles(e.tools.on("after-remove",(e=>{e.item===this.tool&&this._set("tool",null)})),t)}set visible(e){this._set("visible",e),null!=this.tool&&(this.tool.visible=e)}createTool(e={interactive:!1}){if(this.removeTool(),null==this.view||!this.view.ready||!this.supported)return;const t=this.constructTool();t.created?(this._set("tool",t),this.view.tools.add(t)):e.interactive?(this._set("tool",t),this.view.addAndActivateTool(t),(0,s.z7)((()=>t.created),(()=>{t.active&&null!=this.view&&(this.view.activeTool=null)}),{initial:!0,once:!0})):t.destroy()}removeTool(){const e=this.tool;if(null==e)return;const t=this.view?.tools;null!=t?t.remove(e):e.destroy(),this._set("tool",null)}logError(...e){r.A.getLogger(this).error(...e)}};(0,n._)([(0,a.MZ)({constructOnly:!0})],d.prototype,"tool",void 0),(0,n._)([(0,a.MZ)()],d.prototype,"active",null),(0,n._)([(0,a.MZ)()],d.prototype,"disabled",null),(0,n._)([(0,a.MZ)()],d.prototype,"supported",null),(0,n._)([(0,a.MZ)({value:null})],d.prototype,"view",null),(0,n._)([(0,a.MZ)({type:Boolean,value:!0})],d.prototype,"visible",null),d=(0,n._)([(0,l.$)("esri.widgets.support.InteractiveToolViewModel")],d)},2070:(e,t,i)=>{i.d(t,{I:()=>c});var n=i(82392),o=i(81482),r=(i(6273),i(80861),i(67498),i(26325)),s=i(52239),a=i(9737),l=i(27273),d=(i(33510),i(2110));const h="esri-measurement-widget-content",p={base:h,actions:`${h}__actions`,error:`${h}__error`,hint:`${h}__hint`,hintText:`${h}__hint-text`,panelError:`${h}__panel--error`,settings:`${h}__settings`,measurement:`${h}__measurement`,measurementItem:`${h}__measurement-item`,measurementItemDisabled:`${h}__measurement-item--disabled`,measurementItemTitle:`${h}__measurement-item__title`,measurementItemValue:`${h}__measurement-item__value`};let c=class extends s.A{constructor(e,t){super(e,t)}loadDependencies(){return(0,a.W)({button:()=>Promise.all([i.e(2006),i.e(2282),i.e(6283),i.e(5399)]).then(i.bind(i,45399))})}render(){return(0,d.K)("div",{class:p.base},this._renderContent())}_renderContent(){const{supported:e,active:t,state:i}=this;switch(i){case"disabled":case"ready":return e?t?this._renderHint():this._renderActions():this._renderUnsupportedMessage();case"measuring":case"measured":return[this._renderSettings(),this._renderMeasurement(),this._renderActions()]}}_renderUnsupportedMessage(){return(0,d.K)("section",{class:p.error,key:"unsupported"},(0,d.K)("p",null,this.messages.unsupported))}_renderHint(){const{messages:e}=this;return(0,d.K)("section",{class:p.hint,key:"hint"},(0,d.K)("p",{class:p.hintText},e.hint))}_renderSettings(){return(0,d.K)("div",{class:p.settings,key:"settings"},(0,d.K)(l.t,{options:this.unitOptions,selectLabel:this.messages.unit,value:this.unit,onChange:this.onUnitChange}))}_renderMeasurement(){return(0,d.K)("section",{class:p.measurement,key:"measurement"},this.measurementItems.map((e=>this._renderMeasurementItem(e))))}_renderMeasurementItem({key:e,title:t,value:i}){return(0,d.K)("div",{class:this.classes(p.measurementItem,null==i&&p.measurementItemDisabled),key:e},(0,d.K)("span",{class:p.measurementItemTitle},t),(0,d.K)("span",{"aria-live":"polite",class:p.measurementItemValue},i??this.messages.notApplicable))}_renderActions(){const{messages:e}=this;return(0,d.K)("div",{class:p.actions},(0,d.K)("calcite-button",{class:this.newMeasurementButtonClass,disabled:"disabled"===this.state,onclick:this.onNewMeasurementClick},e.newMeasurement))}};(0,n._)([(0,o.MZ)()],c.prototype,"active",void 0),(0,n._)([(0,o.MZ)()],c.prototype,"measurementItems",void 0),(0,n._)([(0,o.MZ)()],c.prototype,"messages",void 0),(0,n._)([(0,o.MZ)()],c.prototype,"newMeasurementButtonClass",void 0),(0,n._)([(0,o.MZ)()],c.prototype,"onNewMeasurementClick",void 0),(0,n._)([(0,o.MZ)()],c.prototype,"onUnitChange",void 0),(0,n._)([(0,o.MZ)()],c.prototype,"state",void 0),(0,n._)([(0,o.MZ)()],c.prototype,"supported",void 0),(0,n._)([(0,o.MZ)()],c.prototype,"unit",void 0),(0,n._)([(0,o.MZ)()],c.prototype,"unitOptions",void 0),c=(0,n._)([(0,r.$)("esri.widgets.support.MeasurementWidgetContent")],c)}}]);