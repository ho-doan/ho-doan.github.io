"use strict";(self.webpackChunkarcgis_node=self.webpackChunkarcgis_node||[]).push([[2546],{73357:(e,t,i)=>{i.d(t,{M:()=>u,b:()=>c});var s=i(21586),r=i(92121),n=i(19635),o=i(41014),a=i(92624),l=i(33763);function c(e){const t=new a.N5,{vertex:i,fragment:c}=t;(0,s.NB)(i,e),i.uniforms.add(new n.m("width",(e=>e.width))),t.attributes.add(l.r.POSITION,"vec3"),t.attributes.add(l.r.NORMAL,"vec3"),t.attributes.add(l.r.UV0,"vec2"),t.attributes.add(l.r.LENGTH,"float"),t.varyings.add("vtc","vec2"),t.varyings.add("vlength","float"),t.varyings.add("vradius","float"),i.code.add(o.H`void main(void) {
vec3 bitangent = normal;
vtc = uv0;
vlength = length;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;
}`),c.uniforms.add(new n.m("outlineSize",(e=>e.outlineSize)),new r.E("outlineColor",(e=>e.outlineColor)),new n.m("stripeLength",(e=>e.stripeLength)),new r.E("stripeEvenColor",(e=>e.stripeEvenColor)),new r.E("stripeOddColor",(e=>e.stripeOddColor)));const u=1/Math.sqrt(2);return c.code.add(o.H`
    const float INV_SQRT2 = ${o.H.float(u)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      fragColor = color;
    }
  `),t}const u=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}))},40165:(e,t,i)=>{i.r(t),i.d(t,{default:()=>De});var s=i(82392),r=i(73783),n=(i(6273),i(57725)),o=i(81482),a=i(80861),l=(i(67498),i(26325)),c=i(93516),u=i(14793),d=i(62169),h=i(61985),_=i(5751),p=i(68489),g=i(34664),m=i(7540);let v=class extends r.A{constructor(e){super(e)}initialize(){this.addHandles([(0,h.wB)((()=>({viewData:this.viewData,startPoint:this.analysis.startPoint})),(({viewData:e,startPoint:t})=>{e.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(t)}),h.pc),(0,h.wB)((()=>({viewData:this.viewData,endPoint:this.analysis.endPoint})),(({viewData:e,endPoint:t})=>{e.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(t)}),h.pc),(0,h.wB)((()=>({result:this._computedResult,viewData:this.viewData})),(({result:e,viewData:t})=>{t.result=e}),h.pc)])}_applyProjectionAndElevationAlignment(e){if(null==e)return e;const{spatialReference:t,elevationProvider:i}=this.view;return(0,_.B)(e,t,i)??((0,_.V)(this.analysis,e.spatialReference,a.A.getLogger(this)),null)}get _computedResult(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,measurementMode:i}=this.viewData;if(null==e||null==t)return null;const s=(0,p.NH)(e,t),r=(0,g.Og)(e,t);if(null==s)return null;let n,o;switch(i){case d.G.Auto:o=null!=r?"geodesic":"euclidean",n=r??s.horizontal;break;case d.G.Geodesic:if(null==r)return null;o="geodesic",n=r;break;case d.G.Euclidean:o="euclidean",n=s.horizontal}return{mode:o,directDistance:s.direct,horizontalDistance:n,verticalDistance:s.vertical,distance:i===d.G.Euclidean||s.horizontal.value<=m.U7?s.direct:r??s.horizontal}}};(0,s._)([(0,o.MZ)()],v.prototype,"view",void 0),(0,s._)([(0,o.MZ)()],v.prototype,"analysis",void 0),(0,s._)([(0,o.MZ)()],v.prototype,"viewData",void 0),(0,s._)([(0,o.MZ)()],v.prototype,"_computedResult",null),v=(0,s._)([(0,l.$)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],v);i(39553);var y,w,b,M=i(60861),f=i(4506),O=i(37902),R=i(7743),P=i(23572),L=i(5262),S=i(53334),A=i(80347),C=i(19913);(b=y||(y={}))[b.None=0]="None",b[b.Direct=1]="Direct",b[b.Triangle=2]="Triangle",b[b.ProjectedGeodesic=3]="ProjectedGeodesic",function(e){e[e.Auto=0]="Auto",e[e.AboveSegment=1]="AboveSegment",e[e.BelowSegment=2]="BelowSegment"}(w||(w={}));var E=i(41384),z=i(9921),V=i(56802),D=i(26110),G=i(74772),T=i(76982),x=i(11631),j=i(87795),Z=i(87475),N=i(60799),H=i(74316),k=i(31272),q=i(7724),B=i(77788),F=i(76687),Q=i(15449),I=i(33763),W=i(21979),U=i(19362),$=i(51662),X=i(8445),J=i(24441),Y=i(7782),K=i(18693),ee=i(73357),te=i(68716),ie=i(15651);class se extends U.w{constructor(e,t,i){super(e,t,i)}initializeProgram(e){return new J.B(e.rctx,se.shader.get().build(this.configuration),ne)}_setPipelineState(e){const t=e===Y.y.NONE,i=this.configuration;return(0,ie.Ey)({blending:i.transparent?t?X.V0:(0,X.ez)(e):null,polygonOffset:this.configuration.polygonOffsetEnabled?{factor:0,units:-4}:null,depthTest:{func:te.MT.LESS},depthWrite:ie.kn,colorWrite:ie.wE})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return te.WR.TRIANGLE_STRIP}}se.shader=new W.$(ee.M,(()=>i.e(6973).then(i.bind(i,36973))));class re extends K.E{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1,this.transparencyPassType=Y.y.NONE}}(0,s._)([(0,$.W)()],re.prototype,"polygonOffsetEnabled",void 0),(0,s._)([(0,$.W)()],re.prototype,"transparent",void 0),(0,s._)([(0,$.W)({count:Y.y.COUNT})],re.prototype,"transparencyPassType",void 0);const ne=new Map([[I.r.POSITION,0],[I.r.NORMAL,1],[I.r.UV0,2],[I.r.LENGTH,3]]);class oe extends k.im{constructor(e){super(e,new le),this._vertexAttributeLocations=ne,this.produces=new Map([[Q.N.OPAQUE_MATERIAL,e=>!this._transparent&&e===B.V.Color],[Q.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>this._transparent&&e===B.V.Color]]),this._configuration=new re}getConfiguration(e,t){return this._configuration.polygonOffsetEnabled=this.parameters.polygonOffset,this._configuration.transparent=this._transparent,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration}intersect(){}createGLMaterial(e){return new ae(e)}createBufferWriter(){return new ge}get _transparent(){const{parameters:e}=this;return e.outlineColor[3]<1||e.stripeEvenColor[3]<1||e.stripeOddColor[3]<1}}class ae extends F.A{beginSlot(e){return this.ensureTechnique(se,e)}}class le extends k.qA{constructor(){super(...arguments),this.width=32,this.outlineSize=.2,this.outlineColor=(0,T.fA)(1,.5,0,1),this.stripeEvenColor=(0,T.fA)(1,1,1,1),this.stripeOddColor=(0,T.fA)(1,.5,0,1),this.stripeLength=1,this.polygonOffset=!1}}const ce=(0,q.BP)().vec3f(I.r.POSITION).vec3f(I.r.NORMAL).vec2f(I.r.UV0).f32(I.r.LENGTH),ue=(0,C.vt)(),de=(0,C.vt)(),he=(0,C.vt)(),_e=(0,C.vt)(),pe=(0,C.vt)();class ge{constructor(){this.vertexBufferLayout=ce}elementCount(e){return 2*(e.attributes.get(I.r.POSITION).indices.length/2+1)}write(e,t,i,s,r){const{data:n,indices:o}=i.attributes.get(I.r.POSITION),a=i.attributes.get(I.r.NORMAL).data,l=n.length/3;o&&o.length!==2*(l-1)&&console.warn("MeasurementArrowMaterial does not support indices");const c=ue,u=de,d=he,h=_e,_=pe,p=s.position,g=s.normal,m=s.uv0;let v=0;for(let i=0;i<l;++i){const s=3*i;if((0,A.s)(c,n[s],n[s+1],n[s+2]),i<l-1){const e=3*(i+1);(0,A.s)(u,n[e],n[e+1],n[e+2]),(0,A.s)(_,a[e],a[e+1],a[e+2]),(0,A.n)(_,_),(0,A.f)(d,u,c),(0,A.n)(d,d),(0,A.b)(h,_,d),(0,A.n)(h,h)}const o=(0,A.p)(c,u);e&&t&&((0,A.h)(c,c,e),(0,A.h)(u,u,e),(0,A.h)(h,h,t));const y=r+2*i,w=y+1;p.setVec(y,c),p.setVec(w,c),g.setVec(y,h),g.setVec(w,h),m.set(y,0,v),m.set(y,1,-1),m.set(w,0,v),m.set(w,1,1),i<l-1&&(v+=o)}const y=s.length;for(let e=0;e<2*l;++e)y.set(r+e,v)}}class me extends j.X{constructor(e){super(e),this._arrowWidth=16,this._arrowSubdivisions=128,this._origin=(0,C.vt)(),this._originTransform=(0,D.vt)(),this._arrowCenter=(0,C.vt)(),this._renderOccluded=k.m$.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._color=(0,T.vt)(),this._contrastColor=(0,T.vt)(),this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){if(this._stripesEnabled=e,this.attached){const e=this._stripesEnabled?this._contrastColor:this._color;this._arrowMaterial.setParameters({stripeEvenColor:e})}}get color(){return this._color}set color(e){(0,M.we)(e,this._color)||((0,G.c)(this._color,e),this._updateArrowColor())}get contrastColor(){return this._contrastColor}set contrastColor(e){(0,M.we)(e,this._color)||((0,G.c)(this._contrastColor,e),this._updateArrowColor())}createExternalResources(){const e=this._color,t=this._contrastColor,i=this._stripesEnabled?t:e;this._arrowMaterial=new oe({outlineColor:e,stripeEvenColor:i,stripeOddColor:e,renderOccluded:this.renderOccluded,polygonOffset:!0,isDecoration:this.isDecoration}),this._handles=new V.A,this._handles.add((0,h.wB)((()=>this.view.state.camera),(()=>{this._viewChanged()})))}destroyExternalResources(){this._arrowMaterial=null,this._handles=(0,n.pR)(this._handles)}forEachExternalMaterial(e){e(this._arrowMaterial)}createGeometries(e){if(null==this._geometry?.startRenderSpace||null==this._geometry.endRenderSpace)return;const t=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);t.transformation=this._originTransform,e.addGeometry(t),this._viewChanged()}_createArrowGeometry(e,t,i,s){const r=this.view,n=r.renderCoordsHelper,o=[],a=[],l=(e,t)=>{const s=x.rq.get();(0,A.f)(s,e,i),o.push(s),a.push(t)};if("euclidean"===s.type){s.eval(.5,this._arrowCenter);const i=x.rq.get();if(n.worldUpAtPosition(this._arrowCenter,i),function(e,t,i){const s=(0,A.z)(ve,t,e),r=(0,A.b)(ve,s,i);return 0===(0,A.H)(r)}(e,t,i)){const{heading:t,tilt:s}=r.camera,{direction:n}=(0,Z.ZC)(r,e,t,s,ye);(0,A.c)(i,n)}l(e,i),l(t,i)}else{s.eval(.5,this._arrowCenter);const e=this._arrowSubdivisions+1&-2;for(let t=0;t<e;++t){const i=t/(e-1),r=x.rq.get(),o=x.rq.get();s.eval(i,r),n.worldUpAtPosition(r,o),l(r,o)}}return(0,H.Z8)(this._arrowMaterial,o,a)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&null!=this._geometry){const e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._arrowWidth*e})}}_updateArrowColor(){if(!this.attached)return;const e=this._color,t=this._contrastColor,i=this._stripesEnabled?t:e,s=e,r=e;this._arrowMaterial.setParameters({stripeEvenColor:i,outlineColor:s,stripeOddColor:r})}}const ve=(0,C.vt)(),ye=(0,N.N)();var we=i(57657),be=i(58274),Me=i(51310),fe=i(5073),Oe=i(4631),Re=i(10709);let Pe=class extends r.A{get _parameters(){const e=this.view.effectiveTheme,{accentColor:t,textColor:i}=e,s=(0,M.QP)(t),r=(0,M.f6)(t,.75),n=(0,M.QP)((0,M.bJ)(t)),o=(0,M.bJ)(i,M.pW.Low);return{accentColor:s,contrastColor:n,translucentAccentColor:r,triangleLineWidth:3,geodesicProjectionLineWidth:2,guideLineWidth:2,guideStippleLengthPixels:3,directLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12,textColor:i,textBackgroundColor:(0,M._L)(o,.6),textCalloutColor:(0,M._L)(o,.5)}}get visible(){return this.analysisView.visible}get viewMode(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView;if(null==e||null==t||e.equals(t))return y.None;const i=this.analysisView.result;if(null==i)return y.Direct;if("geodesic"===this.actualVisualizedMeasurement)return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?y.ProjectedGeodesic:y.Direct;const{verticalDistance:s,horizontalDistance:r}=i,n=s.value,o=r.value;return Math.min(n/o,o/n)<this.triangleCollapseRatioThreshold?y.Direct:y.Triangle}get actualVisualizedMeasurement(){const{measurementMode:e,result:t}=this.analysisView;switch(e){case d.G.Auto:return null!=t&&t.horizontalDistance.value>m.U7?"geodesic":"euclidean";case d.G.Euclidean:return"euclidean";case d.G.Geodesic:return"geodesic"}}get allowVisualElementsOrientationChange(){return null==this._triangleOrientationOverride}set allowVisualElementsOrientationChange(e){null==this._triangleOrientationOverride!==e&&(null==this._triangleOrientationOverride?this._triangleOrientationOverride=this._actualVisualElementsOrientation:this._triangleOrientationOverride=null)}get labels(){return"geodesic"===this.actualVisualizedMeasurement?{direct:null,horizontal:this._segmentLabel,vertical:this._verticalLabel}:{direct:this._segmentLabel,horizontal:this._horizontalLabel,vertical:this._verticalLabel}}constructor(e){super(e),this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=(0,C.vt)(),this._endPosition=(0,C.vt)(),this._cornerPosition=(0,C.vt)(),this._startPositionAtSeaLevel=(0,C.vt)(),this._endPositionAtSeaLevel=(0,C.vt)(),this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=w.Auto,this.triangleCollapseRatioThreshold=.03}initialize(){const e=this._parameters,t={attached:!0,view:this.view,isDecoration:!0},{guideLineWidth:i,guideStippleLengthPixels:s,triangleLineWidth:r,geodesicProjectionLineWidth:n,directLabelFontSize:o,verticalLabelFontSize:a,horizontalLabelFontSize:l}=e;this._segmentVisualElement=new me({...t,geometry:null,renderOccluded:k.m$.OccludeAndTransparent}),this._triangleVisualElement=new z.t({...t,width:r,renderOccluded:k.m$.OccludeAndTransparent}),this._rightAngleQuad=new we.n({...t,renderOccluded:k.m$.OccludeAndTransparent});const c={...t,polygonOffset:!0,renderOccluded:k.m$.OccludeAndTransparent};this._projectedGeodesicLine=new z.t({...c,width:n,stipplePattern:(0,Me.wk)(s)}),this._geodesicStartHint=new z.t({...c,width:i,stipplePattern:(0,Me.wk)(s)}),this._geodesicEndHint=new z.t({...c,width:i,stipplePattern:(0,Me.wk)(s)}),this._segmentLabel=new E.N({...t,fontSize:o}),this._verticalLabel=new E.N({...t,fontSize:a}),this._horizontalLabel=new E.N({...t,fontSize:l}),this.addHandles([(0,h.wB)((()=>{const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView,i=this.view;return{view:i,camera:i.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}}),(e=>this._updateGeometryAndViewMode(e)),h.pc),(0,h.wB)((()=>({visible:this.visible,viewMode:this.viewMode})),(e=>this._updateVisualElementVisibility(e)),h.pc),(0,h.wB)((()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement})),(e=>this._updateLabelText(e)),h.pc),(0,h.wB)((()=>({visible:this.visible,viewMode:this.viewMode})),(e=>this._updateLabelVisibility(e)),h.pc),(0,h.wB)((()=>this._measurementArrowStripeLength),(e=>this._updateSegmentStripeLength(e)),h.pc),(0,Oe.oQ)((async()=>this._updateMessageBundle())),(0,h.wB)((()=>this._parameters),(({textBackgroundColor:e,textCalloutColor:t,textColor:i,translucentAccentColor:s,accentColor:r,contrastColor:n})=>{const{_segmentLabel:o,_verticalLabel:a,_horizontalLabel:l,_triangleVisualElement:c,_rightAngleQuad:u,_projectedGeodesicLine:d,_geodesicStartHint:h,_geodesicEndHint:_,_segmentVisualElement:p}=this;o.backgroundColor=e,o.calloutColor=t,o.textColor=i,a.backgroundColor=e,a.calloutColor=t,a.textColor=i,l.backgroundColor=e,l.calloutColor=t,l.textColor=i,c.color=s,u.color=s,d.color=s,h.color=s,_.color=s,p.color=r,p.contrastColor=n}),h.Vh)]),this._updateMessageBundle()}destroy(){this._segmentVisualElement=(0,n.pR)(this._segmentVisualElement),this._triangleVisualElement=(0,n.pR)(this._triangleVisualElement),this._rightAngleQuad=(0,n.pR)(this._rightAngleQuad),this._projectedGeodesicLine=(0,n.pR)(this._projectedGeodesicLine),this._geodesicStartHint=(0,n.pR)(this._geodesicStartHint),this._geodesicEndHint=(0,n.pR)(this._geodesicEndHint),this._segmentLabel=(0,n.pR)(this._segmentLabel),this._verticalLabel=(0,n.pR)(this._verticalLabel),this._horizontalLabel=(0,n.pR)(this._horizontalLabel),this.set("view",null)}_updateVisualElementVisibility({visible:e,viewMode:t}){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,e)switch(t){case y.None:break;case y.Direct:this._segmentVisualElement.visible=!0;break;case y.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case y.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode({view:e,camera:t,viewMode:i,elevationAlignedStartPoint:s,elevationAlignedEndPoint:r,orientation:n,visualizedMeasurement:o,stripeLength:a}){const l=e.renderCoordsHelper;if(null==l||null==s||null==r||s.equals(r))return;let c=this._startPosition,u=this._endPosition;l.toRenderCoords(s,c),l.toRenderCoords(r,u);const d=n===w.AboveSegment?1:-1,h=d*(l.getAltitude(u)-l.getAltitude(c));h<0&&(c=this._endPosition,u=this._startPosition);const _="geodesic"===o?new be.J(this._startPosition,this._endPosition,l.spatialReference):new be.C(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=_,this._updateSegmentStripeLength(a),i){case y.Direct:this._updateSegment(_,n);break;case y.Triangle:this._updateSegmentAndTriangle({view:e,camera:t,segment:_,orientation:n,startPosition:c,endPosition:u,deltaSign:d,altitudeDelta:h});break;case y.ProjectedGeodesic:this._updateSegmentAndProjection({view:e,orientation:n,startPosition:c,endPosition:u})}}_updateSegment(e,t){this._segmentLabel.anchor=t===w.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}_updateSegmentAndTriangle({view:{renderCoordsHelper:e},camera:t,segment:i,orientation:s,startPosition:r,endPosition:n,deltaSign:o,altitudeDelta:a}){const l=this._cornerPosition;e.worldUpAtPosition(r,l),(0,A.j)(l,l,o*Math.abs(a)),(0,A.g)(l,l,r),this._triangleVisualElement.geometry=[[[r[0],r[1],r[2]],[l[0],l[1],l[2]],[n[0],n[1],n[2]]]],this._rightAngleQuad.geometry={previous:r,center:l,next:n};const c=new be.C(r,l),u=new be.C(l,n),d=function(e,t,i,s,r){const n=Se,o=Ae;r.projectToRenderScreen(i,n),r.projectToRenderScreen(t,o);const a={segment:"bottom",horizontal:"top",vertical:n[0]<o[0]?"left":"right"};{const s=Ce,n=Ee;if((0,fe.QO)(e,i,r,s),(0,fe.QO)(e,t,r,n),(0,S.Om)(s,n)>=Le){const e=Math.sign(s[1])===Math.sign(n[1]);a.segment=e?(0,E.R)(a.vertical):a.vertical}else{const e=ze;(0,fe.QO)(i,t,r,e),(0,S.Om)(e,n)>=Le&&(a.segment=Math.sign(e[0])===Math.sign(n[0])?(0,E.R)(a.horizontal):a.horizontal)}}if(s===w.BelowSegment){const e=e=>"top"===e?"bottom":"top";a.segment=e(a.segment),a.horizontal=e(a.horizontal),a.vertical=e(a.vertical)}return a}(r,n,l,s,t);this._segmentLabel.anchor=d.segment,this._segmentLabel.geometry={type:"segment",segment:i,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:c,sampleLocation:"center"},this._verticalLabel.anchor=d.vertical,this._horizontalLabel.geometry={type:"segment",segment:u,sampleLocation:"center"},this._horizontalLabel.anchor=d.horizontal}_updateSegmentAndProjection({view:{renderCoordsHelper:e},orientation:t,startPosition:i,endPosition:s}){e.setAltitude(this._startPositionAtSeaLevel,0,i),e.setAltitude(this._endPositionAtSeaLevel,0,s);const r=new be.J(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,e.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(r),this._geodesicStartHint.setGeometryFromSegment(new be.C(this._startPositionAtSeaLevel,i)),this._geodesicEndHint.setGeometryFromSegment(new be.C(this._endPositionAtSeaLevel,s)),this._segmentLabel.geometry={type:"segment",segment:r,sampleLocation:"center"},this._segmentLabel.anchor=t===w.AboveSegment?"top":"bottom"}_updateLabelText({text:e,visualizedMeasurement:t}){null!=e?(this._segmentLabel.text="euclidean"===t?e.directDistance:e.horizontalDistance,this._horizontalLabel.text=e.horizontalDistance,this._verticalLabel.text=e.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility({visible:e,viewMode:t}){const i=this._segmentLabel,s=this._horizontalLabel,r=this._verticalLabel;if(i.visible=!1,s.visible=!1,r.visible=!1,e)switch(t){case y.Direct:i.visible=!0;break;case y.Triangle:i.visible=!0,s.visible=!0,r.visible=!0;break;case y.ProjectedGeodesic:i.visible=!0;case y.None:}}get _labelsText(){if(this.destroyed)return null;const e=this.messages,t=this.analysisView.result;if(null==t||null==e)return null;const{directDistance:i,horizontalDistance:s,verticalDistance:r}=t,n=this.analysisView.unit,o=e=>({directDistance:"",horizontalDistance:"",verticalDistance:"",...e});switch(n){case"metric":return o({directDistance:i&&(0,O.Ee)(e,i),horizontalDistance:s&&(0,O.Ee)(e,s),verticalDistance:r&&(0,O.W4)(e,r)});case"imperial":return o({directDistance:i&&(0,O.tr)(e,i),horizontalDistance:s&&(0,O.tr)(e,s),verticalDistance:r&&(0,O.t_)(e,r)});default:return o({directDistance:i&&(0,O.zJ)(e,i,n),horizontalDistance:s&&(0,O.zJ)(e,s,n),verticalDistance:r&&(0,O.zJ)(e,r,n)})}}_updateSegmentStripeLength(e){const t=this._segmentVisualElement;null!=e?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}get _actualVisualElementsOrientation(){if(null!=this._triangleOrientationOverride)return this._triangleOrientationOverride;const e=this.visualElementOrientation;return e===w.Auto?this.view.state.camera.aboveGround?w.AboveSegment:w.BelowSegment:e}_requiresGeodesicGuideAt(e){const t=this.view;if(!t?.state)return!1;const i=t.state.camera,s=t.renderCoordsHelper;if(!s)return!1;const r=i.computeScreenPixelSizeAt(e);return s.getAltitude(e)/r>=10}get _measurementArrowStripeLength(){const{result:e,unit:t}=this.analysisView;if(null==e)return null;let i=null;const s=e.directDistance;switch(t){case"metric":i=s&&(0,R.kM)(s,"meters");break;case"imperial":i=s&&(0,R.kM)(s,(0,L.OU)(s.value,s.unit));break;default:i=s&&(0,R.kM)(s,t)}return null==i?null:(0,f.Vr)(i.value/30)*(0,L.oU)(1,i.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,(0,Re.ud)("esri/core/t9n/Units").then((e=>{this.messages=e})).finally((()=>{this.loadingMessages=!1}))}get testData(){}};(0,s._)([(0,o.MZ)()],Pe.prototype,"_parameters",null),(0,s._)([(0,o.MZ)()],Pe.prototype,"_triangleOrientationOverride",void 0),(0,s._)([(0,o.MZ)()],Pe.prototype,"messages",void 0),(0,s._)([(0,o.MZ)()],Pe.prototype,"view",void 0),(0,s._)([(0,o.MZ)()],Pe.prototype,"analysis",void 0),(0,s._)([(0,o.MZ)()],Pe.prototype,"analysisView",void 0),(0,s._)([(0,o.MZ)()],Pe.prototype,"loadingMessages",void 0),(0,s._)([(0,o.MZ)()],Pe.prototype,"visible",null),(0,s._)([(0,o.MZ)()],Pe.prototype,"viewMode",null),(0,s._)([(0,o.MZ)()],Pe.prototype,"actualVisualizedMeasurement",null),(0,s._)([(0,o.MZ)()],Pe.prototype,"visualElementOrientation",void 0),(0,s._)([(0,o.MZ)()],Pe.prototype,"triangleCollapseRatioThreshold",void 0),(0,s._)([(0,o.MZ)()],Pe.prototype,"allowVisualElementsOrientationChange",null),(0,s._)([(0,o.MZ)()],Pe.prototype,"labels",null),(0,s._)([(0,o.MZ)()],Pe.prototype,"_labelsText",null),(0,s._)([(0,o.MZ)()],Pe.prototype,"_actualVisualElementsOrientation",null),(0,s._)([(0,o.MZ)()],Pe.prototype,"_measurementArrowStripeLength",null),Pe=(0,s._)([(0,l.$)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],Pe);const Le=Math.cos((0,f.kU)(12)),Se=(0,P.r_)(),Ae=(0,P.r_)(),Ce=(0,P.QG)(),Ee=(0,P.QG)(),ze=(0,P.QG)();let Ve=class extends((0,u.P)(r.A)){constructor(e){super(e),this.type="direct-line-measurement-view-3d",this.analysis=null,this.result=null,this.measurementMode=d.G.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){const e=this.view,t=this.analysis;this._analysisVisualization=new Pe({view:e,analysis:t,analysisView:this}),this._analysisController=new v({view:e,analysis:t,viewData:this})}destroy(){this._analysisController=(0,n.pR)(this._analysisController),this._analysisVisualization=(0,n.pR)(this._analysisVisualization)}get updating(){return!!this._analysisVisualization?.loadingMessages}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(e){this._analysisVisualization.visualElementOrientation=e}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(e){this._analysisVisualization.allowVisualElementsOrientationChange=e}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._analysisVisualization.triangleCollapseRatioThreshold=e}get directLabelText(){return this._analysisVisualization.labels.direct?.text??""}get horizontalLabelText(){return this._analysisVisualization.labels.horizontal?.text??""}get verticalLabelText(){return this._analysisVisualization.labels.vertical?.text??""}get unit(){return this.analysis.unit??this._defaultUnit}get testData(){}};(0,s._)([(0,o.MZ)()],Ve.prototype,"updating",null),(0,s._)([(0,o.MZ)({readOnly:!0})],Ve.prototype,"type",void 0),(0,s._)([(0,o.MZ)({constructOnly:!0,nonNullable:!0})],Ve.prototype,"analysis",void 0),(0,s._)([(0,o.MZ)()],Ve.prototype,"result",void 0),(0,s._)([(0,o.MZ)()],Ve.prototype,"measurementMode",void 0),(0,s._)([(0,o.MZ)()],Ve.prototype,"elevationAlignedStartPoint",void 0),(0,s._)([(0,o.MZ)()],Ve.prototype,"elevationAlignedEndPoint",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],Ve.prototype,"viewMode",null),(0,s._)([(0,o.MZ)({readOnly:!0})],Ve.prototype,"actualVisualizedMeasurement",null),(0,s._)([(0,o.MZ)()],Ve.prototype,"visualElementOrientation",null),(0,s._)([(0,o.MZ)()],Ve.prototype,"allowVisualElementsOrientationChange",null),(0,s._)([(0,o.MZ)()],Ve.prototype,"triangleCollapseRatioThreshold",null),(0,s._)([(0,o.MZ)({readOnly:!0})],Ve.prototype,"directLabelText",null),(0,s._)([(0,o.MZ)({readOnly:!0})],Ve.prototype,"horizontalLabelText",null),(0,s._)([(0,o.MZ)({readOnly:!0})],Ve.prototype,"verticalLabelText",null),(0,s._)([(0,o.MZ)()],Ve.prototype,"_analysisVisualization",void 0),(0,s._)([(0,o.MZ)()],Ve.prototype,"_analysisController",void 0),(0,s._)([(0,o.MZ)()],Ve.prototype,"unit",null),(0,s._)([(0,o.MZ)(c.q)],Ve.prototype,"_defaultUnit",void 0),Ve=(0,s._)([(0,l.$)("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],Ve);const De=Ve},14788:(e,t,i)=>{i.d(t,{X:()=>w});var s=i(82392),r=i(73783),n=i(23377),o=i(81482),a=(i(6273),i(80861),i(67498),i(26325)),l=i(161),c=i(80561),u=i(34402);class d{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=l.O7.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;const t=this._resources?.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),t=new h({view:this._resourceFactory.view,renderGroup:this._renderGroup}),i=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new h({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:e,geometriesAdded:!1},i&&(this._resources.drapeSourceRenderer=i.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){null!=this._resources?.drapeSourceRenderer&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,c.q.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){null!=this._resources?.drapeSourceRenderer&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,c.q.UPDATE),this._resources.geometriesAdded=!0))}}let h=class extends((0,n.sA)(r.A)){constructor(e){super(e),this.drapeSourceType=l.Om.Features,this.updatePolicy=u.q.SYNC,this.renderGroup=l.O7.Outline}};(0,s._)([(0,o.MZ)({constructOnly:!0})],h.prototype,"view",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],h.prototype,"drapeSourceType",void 0),(0,s._)([(0,o.MZ)()],h.prototype,"renderGroup",void 0),h=(0,s._)([(0,a.$)("esri.views.3d.interactive.visualElements.DrapedVisualElementResources")],h);var _=i(51467),p=i(61985),g=i(61723),m=i(54909),v=i(5415);class y{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(null==this._resources||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type!==g.X.Mesh&&t.type!==g.X.Line&&t.type!==g.X.Point||e.remove(t)})),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach((t=>{t.type!==g.X.Mesh&&t.type!==g.X.Line&&t.type!==g.X.Point||e.add(t)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,i=t._stage;if(!i)return;const s=new v.x(i,{pickable:!1,updatePolicy:u.q.SYNC}),r=new m.B({castShadow:!1}),n=e.createResources(r,s);n.forEach((e=>{i.add(e),e.type===g.X.Texture&&e.load(i.renderView.renderingContext)})),i.add(r),s.add(r);const o=e.cameraChanged,a=o?(0,p.wB)((()=>t.state.camera),(e=>o(e)),p.Vh):null;this._resources={layer:s,object:r,external:n,cameraHandle:a},this._syncVisible()}_destroyResources(){if(null==this._resources)return;const e=this._resourceFactory.view._stage;e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach((t=>{e.remove(t),t.type===g.X.Texture&&t.unload()}))),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class w extends _.B{constructor(e){super(e),this._isDraped=!1,this.object3dResources=new y(this.createObject3DResourceFactory(e.view)),this.drapedResources=new d(this.createDrapedResourceFactory(e.view)),this.isDraped=e.isDraped??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}},57657:(e,t,i)=>{i.d(t,{n:()=>f});var s=i(61985),r=i(25336),n=i(26110),o=i(80347),a=i(19913),l=i(74772),c=i(76982),u=i(11631),d=i(82320),h=i(14788),_=i(14583),p=i(10941),g=i(53633),m=i(74316),v=i(31272),y=i(35537),w=i(33763),b=i(29239),M=i(16596);class f extends h.X{constructor(e){super(e),this._maxSize=0,this._position=(0,a.vt)(),this._up=(0,a.vt)(),this._right=(0,a.vt)(),this._renderOccluded=v.m$.OccludeAndTransparent,this._color=(0,c.fA)(1,0,0,1),this._outlineColor=(0,c.fA)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=v.m$.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:O}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,l.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,l.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min((0,o.p)(t,e),(0,o.p)(t,i))/3,(0,o.n)(this._up,(0,o.f)(this._up,e,t)),(0,o.n)(this._right,(0,o.f)(this._right,i,t)),(0,o.c)(this._position,t),this.recreateGeometry()}_createObject3DResources(e){const t=new b.v(this._quadMaterialParameters),i=0===this._outlineSize?void 0:new M.W(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,i),{quadMaterial:t,outlineMaterial:i,forEach:e=>{e(t),i&&e(i)}}}_createObject3DGeometries(e,t,i){if((0,o.e)(this._up,a.uY)&&(0,o.e)(this._right,a.uY))return;const s=this._createGeometries(t,i);for(const t of s)e.addGeometry(t);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new b.v(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new M.W(this._outlineMaterialParameters),i=this._createGeometries(e,t).map((e=>new y.$(e)));return this._setTransformDraped(i),{quadMaterial:e,outlineMaterial:t,geometries:i,pixelRatioHandle:(0,s.wB)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_createGeometries(e,t){const{up:i,right:s,corner:r}=this._getVertices(),n=function(e,t,i,s){return new g.V(s,[[w.r.POSITION,new p.n([0,0,0,...t,...e,...i],[0,1,2,1,2,3],3,!0)]])}(i,s,r,e);return t?[n,(0,m.Z8)(t,[i,r,s])]:[n]}_getVertices(){let e=this._up,t=this._right;const i=(0,o.g)(u.rq.get(),e,t);return this.isDraped&&(e=(0,o.c)(u.rq.get(),e),t=(0,o.c)(u.rq.get(),t),e[2]=0,t[2]=0,i[2]=0),{up:e,right:t,corner:i}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(e=this.object3dResources.object){if(!e)return;const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),s=Math.min(this._maxSize,i);(0,r.kN)(R,this._position),(0,r.hs)(R,R,[s,s,s]),e.transformation=R}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{_position:s,_size:n}=this,a=(0,o.c)(u.rq.get(),s);a[2]=_.bi;const l=P;l.spatialReference=t.renderer.spatialReference,l.x=a[0],l.y=a[1];const c=n*(this.view.overlayPixelSizeInMapUnits(l)*i),d=Math.min(this._maxSize,c);(0,r.kN)(R,a),(0,r.hs)(R,R,[d,d,1]);for(const t of e)t.transformation=R}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){this.object3dResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters),this.drapedResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){this.object3dResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters),this.drapedResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters)}}function O(e){e.pixelRatioHandle.remove(),e.geometries=[]}const R=(0,n.vt)(),P=(0,d.T)(0,0,void 0,null)}}]);