"use strict";(self.webpackChunkarcgis_node=self.webpackChunkarcgis_node||[]).push([[4218],{21120:(e,t,n)=>{n.d(t,{w:()=>o});var i=n(3223),r=(n(6273),n(41785)),s=n(79207);class o{constructor(e=9,t){this._compareMinX=h,this._compareMinY=u,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),b.prune(),w.prune(),I.prune(),M.prune()}all(e){a(this._data,e)}search(e,t){let n=this._data;const i=this._toBBox;if(_(e,n))for(b.clear();n;){for(let r=0,s=n.children.length;r<s;r++){const s=n.children[r],o=n.leaf?i(s):s;_(e,o)&&(n.leaf?t(s):g(e,o)?a(s,t):b.push(s))}n=b.pop()}}collides(e){let t=this._data;const n=this._toBBox;if(!_(e,t))return!1;for(b.clear();t;){for(let i=0,r=t.children.length;i<r;i++){const r=t.children[i],s=t.leaf?n(r):r;if(_(e,s)){if(t.leaf||g(e,s))return!0;b.push(r)}}t=b.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,n=e.length;t<n;t++)this.insert(e[t]);return this}let t=this._build(e.slice(0,e.length),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new A([]),this}remove(e){if(!e)return this;let t,n=this._data,r=null,s=0,o=!1;const a=this._toBBox(e);for(I.clear(),M.clear();n||I.length>0;){if(n||(n=I.pop(),r=I.data[I.length-1],s=M.pop()??0,o=!0),n.leaf&&(t=(0,i.qh)(n.children,e,n.children.length,n.indexHint),-1!==t))return n.children.splice(t,1),I.push(n),this._condense(I),this;o||n.leaf||!g(n,a)?r?(s++,n=r.children[s],o=!1):n=null:(I.push(n),M.push(s),s=0,r=n,n=n.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,n,i){const r=n-t+1;let s=this._maxEntries;if(r<=s){const i=new A(e.slice(t,n+1));return l(i,this._toBBox),i}i||(i=Math.ceil(Math.log(r)/Math.log(s)),s=Math.ceil(r/s**(i-1)));const o=new v([]);o.height=i;const a=Math.ceil(r/s),d=a*Math.ceil(Math.sqrt(s));T(e,t,n,d,this._compareMinX);for(let r=t;r<=n;r+=d){const t=Math.min(r+d-1,n);T(e,r,t,a,this._compareMinY);for(let n=r;n<=t;n+=a){const r=Math.min(n+a-1,t);o.children.push(this._build(e,n,r,i-1))}}return l(o,this._toBBox),o}_insert(e,t,n){const i=this._toBBox,r=n?e:i(e);I.clear();const s=function(e,t,n,i){for(;i.push(t),!0!==t.leaf&&i.length-1!==n;){let n,i=1/0,r=1/0;for(let s=0,o=t.children.length;s<o;s++){const o=t.children[s],a=c(o),l=m(e,o)-a;l<r?(r=l,i=a<i?a:i,n=o):l===r&&a<i&&(i=a,n=o)}t=n||t.children[0]}return t}(r,this._data,t,I);for(s.children.push(e),p(s,r);t>=0&&I.data[t].children.length>this._maxEntries;)this._split(I,t),t--;!function(e,t,n){for(let i=n;i>=0;i--)p(t.data[i],e)}(r,I,t)}_split(e,t){const n=e.data[t],i=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,i);const s=this._chooseSplitIndex(n,r,i);if(!s)return;const o=n.children.splice(s,n.children.length-s),a=n.leaf?new A(o):new v(o);a.height=n.height,l(n,this._toBBox),l(a,this._toBBox),t?e.data[t-1].children.push(a):this._splitRoot(n,a)}_splitRoot(e,t){this._data=new v([e,t]),this._data.height=e.height+1,l(this._data,this._toBBox)}_chooseSplitIndex(e,t,n){let i,r,s;i=r=1/0;for(let o=t;o<=n-t;o++){const t=d(e,0,o,this._toBBox),a=d(e,o,n,this._toBBox),l=f(t,a),p=c(t)+c(a);l<i?(i=l,s=o,r=p<r?p:r):l===i&&p<r&&(r=p,s=o)}return s}_chooseSplitAxis(e,t,n){const i=e.leaf?this._compareMinX:h,r=e.leaf?this._compareMinY:u;this._allDistMargin(e,t,n,i)<this._allDistMargin(e,t,n,r)&&e.children.sort(i)}_allDistMargin(e,t,n,i){e.children.sort(i);const r=this._toBBox,s=d(e,0,t,r),o=d(e,n-t,n,r);let a=y(s)+y(o);for(let i=t;i<n-t;i++){const t=e.children[i];p(s,e.leaf?r(t):t),a+=y(s)}for(let i=n-t-1;i>=t;i--){const t=e.children[i];p(o,e.leaf?r(t):t),a+=y(o)}return a}_condense(e){for(let t=e.length-1;t>=0;t--){const n=e.data[t];if(0===n.children.length)if(t>0){const r=e.data[t-1],s=r.children;s.splice((0,i.qh)(s,n,s.length,r.indexHint),1)}else this.clear();else l(n,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function a(e,t){let n=e;for(w.clear();n;){if(!0===n.leaf)for(const e of n.children)t(e);else w.pushArray(n.children);n=w.pop()??null}}function l(e,t){d(e,0,e.children.length,t,e)}function d(e,t,n,i,r){r||(r=new A([])),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let s,o=t;o<n;o++)s=e.children[o],p(r,e.leaf?i(s):s);return r}function p(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function h(e,t){return e.minX-t.minX}function u(e,t){return e.minY-t.minY}function c(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function y(e){return e.maxX-e.minX+(e.maxY-e.minY)}function m(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function f(e,t){const n=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),r=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,r-n)*Math.max(0,s-i)}function g(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function _(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function T(e,t,n,i,r){const o=[t,n];for(;o.length;){const t=o.pop(),n=o.pop();if(t-n<=i)continue;const a=n+Math.ceil((t-n)/i/2)*i;(0,s.q)(e,a,n,t,r),o.push(n,a,a,t)}}const b=new r.A,w=new r.A,I=new r.A,M=new r.A({deallocator:void 0});class x{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class E extends x{constructor(){super(...arguments),this.height=1,this.indexHint=new i.vW}}class A extends E{constructor(e){super(),this.children=e,this.leaf=!0}}class v extends E{constructor(e){super(),this.children=e,this.leaf=!1}}},64411:(e,t,n)=>{n.d(t,{F:()=>l});var i=n(6273),r=n(21120),s=n(2532);const o={minX:0,minY:0,maxX:0,maxY:0};function a(e,t,n){(function(e){o.minX=e[0],o.minY=e[1],o.maxX=e[2],o.maxY=e[3]})(t),e.search(o,n)}class l{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new r.w(9,(0,i.A)("esri-csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const e=new Array(this._idByBounds.size);let t=0;this._idByBounds.forEach(((n,i)=>{e[t++]=i})),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter((e=>this._idByBounds.has(e)))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const e=(0,s.Ie)();for(const t of this._boundsById.values())t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){const t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}forEachInBounds(e,t){this._loadIndex(),a(this._index,e,(e=>t(this._idByBounds.get(e))))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,t){if(!this._indexInvalid){const t=this._boundsById.get(e);t&&(this._index.remove(t),this._idByBounds.delete(t))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},91582:(e,t,n)=>{n.d(t,{A:()=>y});var i=n(3223),r=n(62991),s=n(57888),o=n(80861),a=n(46373),l=n(2532),d=n(5525),p=n(64411),h=n(84880),u=n(60105);const c=(0,a.vt)();class y{constructor(e){this.geometryInfo=e,this._boundsStore=new p.F,this._featuresById=new Map,this._markedIds=new Set,this.events=new s.A,this.featureAdapter=u.T}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let e=0;return this._featuresById.forEach((t=>{null!=t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(e){if(null==this.fullBounds)return null;const[t,n,i,r]=this.fullBounds;return{xmin:t,ymin:n,xmax:i,ymax:r,spatialReference:(0,h.ag)(e)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}upsertMany(e){const t=e.map((e=>this._upsert(e)));return this._emitChanged(),t.filter(i.Ru)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t){for(const n of e){const e=this._boundsStore.get(n.objectId);e&&t((0,a.Jt)(c,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach((t=>e(t)))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,(e=>{t(this._featuresById.get(e))}))}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let e=!1;this._featuresById.forEach(((t,n)=>{this._markedIds.has(n)||(e=!0,this._remove(t))})),this._markedIds.clear(),e&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(e){if(!e)return;const t=e.objectId;if(null==t)return void o.A.getLogger("esri.layers.graphics.data.FeatureStore").error(new r.A("featurestore:invalid-feature","feature id is missing",{feature:e}));const n=this._featuresById.get(t);let i;if(this._markedIds.add(t),n?(e.displayId=n.displayId,i=this._boundsStore.get(t),this._boundsStore.delete(t)):null!=this.onFeatureAdd&&this.onFeatureAdd(e),!e.geometry?.coords?.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);i=(0,d.jQ)(null!=i?i:(0,l.vt)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=i&&this._boundsStore.set(t,i),this._featuresById.set(t,e)}_upsert(e){const t=e?.objectId;if(null==t)return o.A.getLogger("esri.layers.graphics.data.FeatureStore").error(new r.A("featurestore:invalid-feature","feature id is missing",{feature:e})),null;const n=this._featuresById.get(t);if(!n)return this._add(e),e;this._markedIds.add(t);const{geometry:i,attributes:s}=e;for(const e in s)n.attributes[e]=s[e];return i&&(n.geometry=i,this._boundsStore.set(t,(0,d.jQ)((0,l.vt)(),i,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null)),n}_remove(e){null!=this.onFeatureRemove&&this.onFeatureRemove(e);const t=e.objectId;return this._markedIds.delete(t),this._boundsStore.delete(t),this._featuresById.delete(t),e}}},77159:(e,t,n)=>{n.d(t,{F0:()=>a,Vx:()=>p,e2:()=>u,f:()=>c});var i=n(6273),r=n(15565),s=n(52557),o=n(51103);function a(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?o.Cb:"esriGeometryPolyline"===e?o.yM:o.WR}}}const l=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let d=1;function p(e,t){if((0,i.A)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let n=`this${h(t)} = null;`;for(const t in e)n+=`this${h(t)} = ${JSON.stringify(e[t])};`;const i=new Function(`\n      return class AttributesClass$${d++} {\n        constructor() {\n          ${n};\n        }\n      }\n    `)();return()=>new i}catch(n){return()=>({[t]:null,...e})}}function h(e){return l.test(e)?`.${e}`:`["${e}"]`}function u(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,r.o8)(e)}}]}function c(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:s.F,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},54979:(e,t,n)=>{n.d(t,{PB:()=>S,d4:()=>v,ZL:()=>E,sZ:()=>A,yC:()=>M,Vr:()=>x});var i=n(82392),r=(n(3313),n(73783)),s=n(62991),o=n(80861),a=n(80294),l=n(80189),d=n(81482),p=(n(6273),n(67498),n(26325)),h=n(65648),u=n(34561),c=n(67488),y=n(5525),m=n(85747),f=n(56053);class g{constructor(){this._featureLookup=new Map}static getInstance(){return g.instance||(g.instance=new g),g.instance}static resetInstance(){g.instance&&(g.instance=null)}deleteFromStore(e){e.forEach((e=>{this._featureLookup.delete(e)}))}readFromStoreByList(e){const t=[];return e.forEach((e=>{const n=this.readFromStoreById(e);n&&t.push(n)})),t}readFromStoreById(e){return this._featureLookup.get(e)??null}writeToStore(e,t,n){const i=[];return e.forEach((e=>{if(!e?.id)return;e.properties||(e.properties=[]);let r,s=null;if(n&&e.properties[n]&&(s=(0,y.Ux)(e.properties[n])),"originId"in e&&"destinationId"in e&&(e.properties.ESRI__ORIGIN_ID=e.originId,e.properties.ESRI__DESTINATION_ID=e.destinationId),e.properties[t]=e.id,e.id&&this._featureLookup.has(e.id)&&this._featureLookup.get(e.id).attributes){const i=this._featureLookup.get(e.id),o=JSON.parse(JSON.stringify(Object.assign(i.attributes,e.properties)));n&&e.properties[n]&&(o[n]=(0,f.rS)(e.properties[n])),r=new m.Om(s?JSON.parse(JSON.stringify(s)):i?.geometry?JSON.parse(JSON.stringify(i.geometry)):null,o,null,e.properties[t])}else r=new m.Om(s?JSON.parse(JSON.stringify(s)):null,e.properties,null,e.properties[t]);this._featureLookup.set(e.id,r),i.push(r)})),i}}var _=n(88181),T=n(48911),b=n(23783),w=n(10591),I=n(8e3);const M="ESRI__ID",x="ESRI__ORIGIN_ID",E="ESRI__DESTINATION_ID",A="ESRI__LAYOUT_GEOMETRY",v="ESRI__AGGREGATION_COUNT";let S=class extends r.A{constructor(e){super(e),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;const t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach((n=>{n.name&&(t.set(n.name,"entity"),this._processingCacheUpdatesLookup.set(n.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(n.name),n.properties?.forEach((e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(n.name,{name:e.name??"",geometryType:e.geometryType})})))})),e.knowledgeGraph.dataModel.relationshipTypes?.forEach((n=>{n.name&&(t.set(n.name,"relationship"),this._processingCacheUpdatesLookup.set(n.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(n.name),n.properties?.forEach((e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(n.name,{name:e.name??"",geometryType:e.geometryType})})))})),e.inclusionModeDefinition?.namedTypeDefinitions.forEach(((n,i)=>{if("entity"===t.get(i))this.entityTypeNames.add(i);else{if("relationship"!==t.get(i))return o.A.getLogger(this).warn(`A named type, ${i}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(i);this.relationshipTypeNames.add(i)}const r=new Map;n.members?.forEach((e=>{(0,a.tE)(this.memberIdTypeLookup,e.id,(()=>new Set)).add(i);const t=this.getById(e.id);t&&r.set(e.id,t)})),this.sublayerCaches.set(i,r)}))}addToLayer(e){e.forEach((({typeName:e,id:t})=>{if(!this.inclusionModeDefinition)throw new s.A("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){const n=this.inclusionModeDefinition.namedTypeDefinitions.get(e);n.members||(n.members=new Map),n.members.set(t,{id:t}),(0,a.tE)(this.memberIdTypeLookup,t,(()=>new Set)).add(e)}}else{const n=new Map;n.set(t,{id:t}),this.inclusionModeDefinition.namedTypeDefinitions.set(e,{useAllData:!1,members:n}),(0,a.tE)(this.memberIdTypeLookup,t,(()=>new Set)).add(e)}}))}getById(e){return g.getInstance().readFromStoreById(e)}async getData(e,t,n){if(t.objectType.name&&this.inclusionModeDefinition?.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let i;if(i=e||new w.A({where:"1=1",outFields:["*"]}),"link-chart"===t.parentCompositeLayer.type){const e=t.parentCompositeLayer,n=this._processingCacheUpdatesLookup.get(t.objectType.name??""),r=i.outFields;r&&1===r.length&&r[0]===M&&"1=1"===i.where||await Promise.all(n??[]);const s=this.sublayerCaches.has(t.objectType.name??"")?Array.from(this.sublayerCaches.get(t.objectType.name)?.values()):[],o=[];return s.forEach((n=>{this.relationshipTypeNames.has(t.objectType.name)?n.geometry=e.relationshipLinkChartDiagramLookup.get(n.attributes[t.objectIdField]):n.geometry=e.entityLinkChartDiagramLookup.get(n.attributes[t.objectIdField]),n.attributes[A]=n.geometry,o.push(n)})),o}return this.retrieveDataFromService(i,t,n)}async getConnectedRecordIds(e,t){const n=[];let i="";const r=[],s=new Map;if(e.forEach((e=>{if(this.memberIdTypeLookup.has(e))for(const t of this.memberIdTypeLookup.get(e)){if(!this.entityTypeNames.has(t))return;s.has(t)?s.get(t)?.push(e):s.set(t,[e])}})),t&&0!==t?.length){for(const e of t)i=i+e+"|";i=i.slice(0,-1)}return s.forEach(((e,s)=>{let a;a=t&&0!==t?.length?`MATCH (n:${s})-[r:${i}]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]`:`MATCH (n:${s})-[r]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]`;const l=new Promise((t=>{(async()=>{const t=(await(0,T.executeQueryStreaming)(this.knowledgeGraph,new b.A({openCypherQuery:a,bindParameters:{ids:e}}))).resultRowsStream.getReader();try{for(;;){const{done:e,value:i}=await t.read();if(e)break;for(let e=0;e<i.length;e++){const t=i[e];n.push({id:t[0],typeName:t[1]}),n.push({id:t[2],typeName:t[3]})}}}catch(e){if("AbortError"!==e.name)throw e;o.A.getLogger(this).info("Request aborted as expected")}})().then((()=>{t()}))}));r.push(l)})),this.refreshCacheContent(),await Promise.all(r),n}async getAttachedRelationships(e,t){const n=[],i=(await(0,T.executeQueryStreaming)(this.knowledgeGraph,new b.A({openCypherQuery:"MATCH (n)-[r]->(m) WHERE id(n) IN $nodeIds AND id(m) in $nodeIds AND NOT id(r) IN $relationshipExclusionIds return id(r), type(r)",bindParameters:{nodeIds:e,relationshipExclusionIds:t}}))).resultRowsStream.getReader();try{for(;;){const{done:e,value:t}=await i.read();if(e)break;for(let e=0;e<t.length;e++){const i=t[e];n.push({id:i[0],typeName:i[1]})}}}catch(e){if("AbortError"!==e.name)throw e;o.A.getLogger(this).info("Request aborted as expected")}return n}async refreshCacheContent(e,t,n,i=!0){const r=g.getInstance(),o=[],l=new Map,d=new Map;this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&d.set(e.name,e)})),this.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&d.set(e.name,e)})),e||this.inclusionModeDefinition?e?e.forEach((e=>{if(this.memberIdTypeLookup.has(e))for(const t of this.memberIdTypeLookup.get(e))l.has(t)?l.get(t)?.push(e):l.set(t,[e])})):this.inclusionModeDefinition?.namedTypeDefinitions?.forEach(((e,t)=>{e.useAllData?l.set(t,null):e.members&&e.members.forEach((e=>{l.has(t)&&null!==l.get(t)?l.get(t)?.push(e.id):l.set(t,[e.id])}))})):(this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&l.set(e.name,null)})),this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&l.set(e.name,null)})));for(const[e,p]of l){const l=new Promise((o=>{(async()=>{const o=new Set,l=[];let h,u="",c=!1;if(t||d.get(e)?.properties?.forEach((e=>{e.name&&o.add(e.name)})),n&&this.geographicLookup.has(e)){const t=this.geographicLookup.get(e)?.name;t&&o.add(t)}if(this.entityTypeNames.has(e))u=`MATCH (n:${e}) ${p?"WHERE id(n) IN $ids ":""}return ID(n)`,o.forEach((e=>{u+=`, n.${e}`,l.push(e)}));else{if(!this.relationshipTypeNames.has(e))throw new s.A("knowledge-graph:layer-data-manager",`The graph type of ${e} could not be determined. Was this type set in the KG data model and inclusion definition?`);c=!0,u=`MATCH ()-[n:${e}]->() ${p?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,o.forEach((e=>{u+=`, n.${e}`,l.push(e)}))}h=new b.A(p?{openCypherQuery:u,bindParameters:{ids:p}}:{openCypherQuery:u});const y=(await(0,T.executeQueryStreaming)(this.knowledgeGraph,h)).resultRowsStream.getReader();for(;;){const{done:t,value:n}=await y.read();if(t)break;const s=[];for(let e=0;e<n.length;e++){const t=n[e];let i=0,r=0;const o={properties:{}};for(o.id=t[i],i++,r++,c&&(o.originId=t[i],i++,r++,o.destinationId=t[i],i++,r++,(0,a.tE)(this.nodeConnectionsLookup,o.originId,(()=>new Set)).add(o.id),(0,a.tE)(this.nodeConnectionsLookup,o.destinationId,(()=>new Set)).add(o.id),(0,a.tE)(this.relationshipConnectionsLookup,o.id,(()=>[o.originId,o.destinationId])));i<t.length;i++)o.properties[l[i-r]]=t[i];s.push(o)}const o=r.writeToStore(s,M,this.geographicLookup.get(e)?.name);this.sublayerCaches.has(e)||this.sublayerCaches.set(e,new Map),i&&!this.inclusionModeDefinition?.namedTypeDefinitions.has(e)&&this.inclusionModeDefinition?.namedTypeDefinitions.set(e,{useAllData:!1,members:new Map}),i&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(e).members&&(this.inclusionModeDefinition.namedTypeDefinitions.get(e).members=new Map);const d=this.sublayerCaches.get(e);o.forEach((t=>{d?.set(t.attributes[M],t),i&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(e).members.has(t.attributes[M])&&(this.inclusionModeDefinition?.namedTypeDefinitions.get(e).members.set(t.attributes[M],{id:t.attributes[M]}),(0,a.tE)(this.memberIdTypeLookup,t.attributes[M],(()=>new Set)).add(e))}))}})().then((()=>{o(null)}))}));o.push(l),this._processingCacheUpdatesLookup.get(e)?.push(l)}await Promise.all(o)}removeFromLayer(e){const t=new Set,n=new Set(e.map((e=>e.id)));for(const n of e)t.add(n.typeName),1===this.memberIdTypeLookup.get(n.id)?.size?this.memberIdTypeLookup.delete(n.id):this.memberIdTypeLookup.get(n.id)?.delete(n.typeName),this.inclusionModeDefinition?.namedTypeDefinitions.forEach(((e,t)=>{t===n.typeName&&e.members?.has(n.id)&&e.members.delete(n.id)}));t.forEach((e=>{this.sublayerCaches.get(e)?.forEach(((t,i)=>{n.has(i)&&this.sublayerCaches.get(e)?.delete(i)}))}))}async retrieveDataFromService(e,t,n){const i=g.getInstance(),r=new Set,o=[];let a,d="",p=[];const y="relationship"===t.graphType,m=this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,f=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let w=!m&&f?Array.from(f).sort():null;if(this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&null!=e.objectIds&&(w=e.objectIds);else if(null!=e.objectIds&&w&&w.length>0){const t=e.objectIds;e.objectIds=w.filter((e=>t.includes(e)))}else if(null!=e.objectIds)w=e.objectIds;else{if(this.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=w}if(null!=e.outFields){const n=e.outFields;n.includes("*")?t.fields.forEach((e=>{r.add(e.name)})):n.forEach((e=>{e!==M&&e!==t.geometryFieldName&&r.add(e)}))}if(null!=e.geometry){const n=e.geometry;let i;const p=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,m=p?.spatialReference,f=p?.serviceCapabilities?.geometryCapabilities;let g=f?.geometryMaxBoundingRectangleSizeX,T=f?.geometryMaxBoundingRectangleSizeY;if(n?.extent?.spatialReference&&!n.spatialReference?.isWGS84?(await(0,u.initializeProjection)(n.extent.spatialReference,c.KK),i=(0,u.project)(n.extent,c.KK)):i=n.extent,g&&T&&m){if(4326!==m.wkid){const e=new I.A({spatialReference:m,xmax:g,ymax:T}),t=(0,u.project)(e,c.KK);g=t.xmax,T=t.ymax}if(i.xmax-i.xmin>g)throw new s.A("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${g}° latitude, limit exceeded`);if(i.ymax-i.ymin>T)throw new s.A("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${T}° longitude, limit exceeded`)}if(null!=e.where&&"1=1"!==e.where){const n=await(0,l.G)(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach((e=>{n.fieldNames.includes(e.name)&&r.add(e.name)}))}d=y?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&r.add(t.geometryFieldName),r.forEach((e=>{d+=`, n.${e}`,o.push(e)})),a=new b.A({openCypherQuery:d,bindParameters:{param_filter_geom:new h.A({rings:(0,_.DX)(i)})}})}else{let n="";if(null!=e.where&&"1=1"!==e.where){const i=await(0,l.G)(e.where,t.fieldsIndex);t.fields.forEach((e=>{i.fieldNames.includes(e.name)&&r.add(e.name)}));const s=new Set(["column-reference","string","number","binary-expression"]),o=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]);let a=!1;const d=e=>{if("column-reference"===e.type)return`n.${e.column}`;if("string"===e.type)return`'${e.value}'`;if("number"===e.type)return`${e.value}`;if("binary-expression"===e.type&&s.has(e.left.type)&&s.has(e.right.type)&&o.has(e.operator))return`${d(e.left)} ${e.operator} ${d(e.right)}`;if("binary-expression"===e.type&&"LIKE"===e.operator){let t="";if("function"===e.left.type&&"column-reference"===e.left.args.value[0].type)t+=`lower(n.${e.left.args.value[0].column})`;else{if("column-reference"!==e.left.type)return a=!0,"";t+=`lower(n.${e.left.column})`}if(t+=" CONTAINS (","string"!==e.right.type)return a=!0,"";{let n=e.right.value;"%"===n.charAt(0)&&(n=n.slice(1)),"%"===n.charAt(n.length-1)&&(n=n.slice(0,-1)),t+=`'${n.toLowerCase()}')`}return t}return a=!0,""};n=d(i.parseTree),a&&(n="")}let i="";i=y?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let s=!1;w&&(s=!0,i+=" WHERE ID(n) IN $ids"),n&&(i+=s?" AND":" WHERE",i+=` ${n}`),i+=" return ID(n)",y&&(i+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&r.add(t.geometryFieldName),r.forEach((e=>{i+=`, n.${e}`,o.push(e)})),a=new b.A(w?{openCypherQuery:i,bindParameters:{ids:w}}:{openCypherQuery:i})}const x=(await(0,T.executeQueryStreaming)(t.parentCompositeLayer.dataManager.knowledgeGraph,a,n)).resultRowsStream.getReader();for(;;){const{done:e,value:n}=await x.read();if(e)break;const r=[];for(let e=0;e<n.length;e++){const t=n[e];let i=0,s=0;const a={properties:{}};for(a.id=t[i],i++,s++,y&&(a.originId=t[i],i++,s++,a.destinationId=t[i],i++,s++);i<t.length;i++)a.properties[o[i-s]]=t[i];r.push(a)}p=p.concat(i.writeToStore(r,M,t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return p}};(0,i._)([(0,d.MZ)()],S.prototype,"knowledgeGraph",void 0),(0,i._)([(0,d.MZ)()],S.prototype,"inclusionModeDefinition",void 0),(0,i._)([(0,d.MZ)()],S.prototype,"entityTypeNames",void 0),(0,i._)([(0,d.MZ)()],S.prototype,"relationshipTypeNames",void 0),(0,i._)([(0,d.MZ)()],S.prototype,"geographicLookup",void 0),(0,i._)([(0,d.MZ)()],S.prototype,"sublayerCaches",void 0),(0,i._)([(0,d.MZ)()],S.prototype,"nodeConnectionsLookup",void 0),(0,i._)([(0,d.MZ)()],S.prototype,"relationshipConnectionsLookup",void 0),(0,i._)([(0,d.MZ)()],S.prototype,"memberIdTypeLookup",void 0),S=(0,i._)([(0,p.$)("esri.layers.knowledgeGraph.KnowledgeGraphLayerDataManager")],S)},76115:(e,t,n)=>{n.d(t,{A:()=>H});var i=n(82392),r=(n(3313),n(20879)),s=(n(42957),n(8499),n(72502),n(2394),n(52721),n(46243),n(79645),n(1851),n(29221)),o=n(83015),a=n(15565),l=n(67214),d=(n(73462),n(81482)),p=(n(6273),n(80861),n(26325)),h=n(48524),u=n(91101),c=n(34561),y=n(44153),m=n(67488),f=n(45449),g=n(91582),_=n(52790),T=n(77159),b=n(54979);n(67498);const w=(0,n(83693).p)(),I=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,i._)([(0,d.MZ)(w.fields)],t.prototype,"fields",void 0),(0,i._)([(0,d.MZ)(w.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=(0,i._)([(0,p.$)("esri.layers.knowledgeGraph.KnowledgeGraphSublayerBase")],t),t};var M=n(20923),x=n(23091),E=n(71519),A=n(87917),v=n(51177),S=n(22111),D=n(2960),N=n(9014),L=n(46190),B=n(45352),R=n(46227),k=n(15724),C=n(6488),j=n(74704),O=n(10591),F=n(95610),q=n(15331),Z=n(8e3),G=n(65648),Y=n(38648),$=n(54483);function Q(e){if(!e.json)return e;e.json.write=X(e.json.write);const t=e.json.origins;if(!t)return e;let n;for(n in t){const e=t[n];e&&(e.write=X(e.write))}return e}function X(e){return"object"==typeof e&&e?(!1!==e.enabled&&(e.overridePolicy=function(e){const{target:t,writer:n,overridePolicy:i,...r}=e;return function(e,t){const n=U.call(this,e,t);return n.enabled?{...r,...n}:n}}(e)),e):!0===e?P():e}function P(){return{overridePolicy:U}}function U(e,t){const n=!!this.geometryType;let i={enabled:n};return n&&(i={...i,...J.call(this,e,t)}),i}function J(e,t){return{ignoreOrigin:this.originIdOf(t)>u.Gr.DEFAULTS}}let V=class extends(I((0,E.J)((0,x.F)((0,M.dM)((0,A.f)((0,D.e)((0,S.j)((0,v.J)((0,l.P)(f.A)))))))))){constructor(e){super(e),this.blendMode="normal",this.capabilities=(0,T.f)(!1,!1),this.charts=null,this.definitionExpression=null,this.displayField="",this.effect=null,this.elevationInfo=null,this.featureEffect=null,this.graphType=null,this.labelsVisible=!0,this.labelingInfo=null,this.layerType=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.objectIdField=b.yC,this.objectType=null,this.opacity=1,this.orderBy=null,this.parentCompositeLayer=null,this.persistenceEnabled=!0,this.popupEnabled=!0,this.popupTemplate=null,this.refreshInterval=0,this.source={openPorts:()=>this.load().then((()=>{const e=new MessageChannel;return new q.A(e.port1,{channel:e,client:{queryFeatures:(e,t={})=>{const n=O.A.fromJSON(e);return this.queryFeaturesJSON(n,t)}}}),[e.port2]}))},this.title=null,this.type="knowledge-graph-sublayer",this.useViewTime=!0,this.visible=!0}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){const t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}get fields(){const e=[];return this.objectType?.properties?.forEach((t=>{const n="esriFieldTypeOID"===t.fieldType?"esriFieldTypeInteger":t.fieldType;e.push(B.A.fromJSON({name:t.name,type:n,alias:t.alias,defaultValue:t.defaultValue,editable:t.editable,nullable:t.nullable}))})),e.push(B.A.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),B.A.fromJSON({name:b.d4,type:"esriFieldTypeInteger",alias:b.d4,editable:!1})),e}get geometryType(){if("link-chart"===this.parentCompositeLayer?.type)return"relationship"===this.graphType?"polyline":"point";const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.geometryType;return t&&"esriGeometryNull"!==t?$.g.fromJSON(t):null}get geometryFieldName(){if("link-chart"===this.parentCompositeLayer?.type)return b.sZ;const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name);return e?.name??null}get graphTypeName(){return this.objectType?.name}get hasM(){const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name,n=t?this.objectType?.properties?.[t]:null;return n?.hasM??!1}get hasZ(){const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name,n=t?this.objectType?.properties?.[t]:null;return n?.hasZ??!1}set renderer(e){(0,R.yp)(e,this.fieldsIndex),this._set("renderer",e)}get renderer(){return this._isOverridden("renderer")?this._get("renderer"):"link-chart"===this.parentCompositeLayer?.type?"relationship"===this.graphType?(0,s.r)((0,T.F0)($.g.toJSON("polyline")).renderer):(0,s.r)((0,T.F0)($.g.toJSON("point")).renderer):(0,s.r)((0,T.F0)($.g.toJSON(this.geometryType)).renderer)}get spatialReference(){return this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel?.spatialReference??y.A.WGS84}writeTitle(e,t){t.title=e??"Layer"}createPopupTemplate(e){return(0,F.tn)(this,e)}createQuery(){return new O.A({where:"1=1",outFields:["*"]})}getField(e){for(let t=0;t<this.fields.length;t++)if(this.fields[t].name===e)return this.fields[t];return null}getFieldDomain(e,t){return null}async queryFeatures(e,t){const{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(e),r=j.A.fromJSON(await i.executeQuery(n.toJSON(),t?.signal));return r.features.forEach((e=>{e.sourceLayer=this})),r}async queryFeaturesJSON(e,t){const{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(e);return await i.executeQuery(n.toJSON(),t?.signal)}async queryFeatureCount(e,t){const{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(e);return i.executeQueryForCount(n.toJSON(),t?.signal)}async queryExtent(e={},t){const n={...e,returnGeometry:!0},{resolvedQuery:i,queryEngine:r}=await this._setupQueryObjects(n),s=await r.executeQueryForExtent(i.toJSON(),t?.signal);let o;return o=null!=s.extent?.xmin&&null!=s.extent?.xmax&&null!=s.extent?.ymin&&null!=s.extent?.ymax?new Z.A(s.extent):new Z.A,{count:s.count,extent:o}}async queryObjectIds(e,t){const n=O.A.from(e);let i;if("link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)i=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(n,this,t);i=this.loadQueryEngine(e)}return i.executeQueryForIds(n.toJSON(),t?.signal)}loadQueryEngine(e){const t=new g.A({geometryType:$.g.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),n=new _.d({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:$.g.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:t});return n.featureStore.addMany(e),n}async refreshCachedQueryEngine(){const e=await this.parentCompositeLayer.dataManager.getData(new O.A({where:"1=1",outFields:[b.yC]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}async _setupQueryObjects(e,t){const n=O.A.from(e),i=n.geometry;let r;if(i&&!i.spatialReference?.isWGS84&&(await(0,c.initializeProjection)(i.spatialReference,m.KK),n.geometry=(0,c.project)(i instanceof G.A||i instanceof Y.A?i:i.extent,m.KK)),"link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)r=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(n,this,t);r=this.loadQueryEngine(e)}return{resolvedQuery:n,queryEngine:r}}};(0,i._)([(0,d.MZ)(Q((0,a.o8)(M.sU)))],V.prototype,"blendMode",void 0),(0,i._)([(0,d.MZ)()],V.prototype,"capabilities",void 0),(0,i._)([(0,d.MZ)({json:{origins:{"web-scene":{write:!1}},write:P()}})],V.prototype,"charts",void 0),(0,i._)([(0,d.MZ)({readOnly:!0})],V.prototype,"defaultPopupTemplate",null),(0,i._)([(0,d.MZ)({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],V.prototype,"definitionExpression",void 0),(0,i._)([(0,d.MZ)()],V.prototype,"displayField",void 0),(0,i._)([(0,d.MZ)(Q((0,a.o8)(M.LF)))],V.prototype,"effect",void 0),(0,i._)([(0,d.MZ)()],V.prototype,"elevationInfo",void 0),(0,i._)([(0,d.MZ)(Q((0,a.o8)(x.Y)))],V.prototype,"featureEffect",void 0),(0,i._)([(0,d.MZ)(Q((0,a.o8)(L.d)))],V.prototype,"featureReduction",null),(0,i._)([(0,d.MZ)()],V.prototype,"fields",null),(0,i._)([(0,d.MZ)()],V.prototype,"geometryType",null),(0,i._)([(0,d.MZ)()],V.prototype,"geometryFieldName",null),(0,i._)([(0,d.MZ)({type:["entity","relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],V.prototype,"graphType",void 0),(0,i._)([(0,d.MZ)({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],V.prototype,"graphTypeName",null),(0,i._)([(0,d.MZ)()],V.prototype,"hasM",null),(0,i._)([(0,d.MZ)()],V.prototype,"hasZ",null),(0,i._)([(0,d.MZ)({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],V.prototype,"id",void 0),(0,i._)([(0,d.MZ)(Q((0,a.o8)(N.kF)))],V.prototype,"labelsVisible",void 0),(0,i._)([(0,d.MZ)({type:[k.A],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:C.w,write:P()}})],V.prototype,"labelingInfo",void 0),(0,i._)([(0,d.MZ)({readOnly:!0,json:{read:!1,write:{writer(e,t){t.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"},isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],V.prototype,"layerType",void 0),(0,i._)([(0,d.MZ)(Q((0,a.o8)(N.fV)))],V.prototype,"legendEnabled",void 0),(0,i._)([(0,d.MZ)(Q((0,a.o8)(N.hG)))],V.prototype,"maxScale",void 0),(0,i._)([(0,d.MZ)(Q((0,a.o8)(N.hn)))],V.prototype,"minScale",void 0),(0,i._)([(0,d.MZ)()],V.prototype,"objectIdField",void 0),(0,i._)([(0,d.MZ)()],V.prototype,"objectType",void 0),(0,i._)([(0,d.MZ)(Q((0,a.o8)(N.ke)))],V.prototype,"opacity",void 0),(0,i._)([(0,d.MZ)(Q((0,a.o8)(A.n)))],V.prototype,"orderBy",void 0),(0,i._)([(0,d.MZ)()],V.prototype,"parentCompositeLayer",void 0),(0,i._)([(0,d.MZ)(Q((0,a.o8)(N.M6)))],V.prototype,"popupEnabled",void 0),(0,i._)([(0,d.MZ)({type:r.A,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],V.prototype,"popupTemplate",void 0),(0,i._)([(0,d.MZ)({type:Number,json:{write:{overridePolicy:J}}})],V.prototype,"refreshInterval",void 0),(0,i._)([(0,d.MZ)({types:o.H,json:{name:"layerDefinition.drawingInfo.renderer",write:P()}})],V.prototype,"renderer",null),(0,i._)([(0,d.MZ)()],V.prototype,"source",void 0),(0,i._)([(0,d.MZ)()],V.prototype,"spatialReference",null),(0,i._)([(0,d.MZ)({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],V.prototype,"title",void 0),(0,i._)([(0,h.K)("title")],V.prototype,"writeTitle",null),(0,i._)([(0,d.MZ)({json:{read:!1}})],V.prototype,"type",void 0),(0,i._)([(0,d.MZ)(Q((0,a.o8)(D.B)))],V.prototype,"useViewTime",void 0),(0,i._)([(0,d.MZ)({type:Boolean,json:{name:"visibility",write:P()}})],V.prototype,"visible",void 0),V=(0,i._)([(0,p.$)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],V);const H=V},88181:(e,t,n)=>{n.d(t,{DX:()=>f,_s:()=>_,aq:()=>g,fe:()=>T});var i,r=n(38116),s=n(62991),o=n(80294),a=(n(5525),n(48911)),l=n(23783);n(3313),n(44153);!function(e){e.ELEMENTUID="ELEMENTUID",e.TYPENAME="TYPENAME"}(i||(i={}));i.ELEMENTUID,i.TYPENAME;var d,p;!function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME"}(d||(d={})),function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME",e[e.FROMUID=2]="FROMUID",e[e.TOUID=3]="TOUID"}(p||(p={}));var h,u,c,y,m=n(24780);n(13949);function f(e){if(!e.spatialReference.isWGS84)throw new s.A("knowledge-graph:layer-support-utils","The extentToInBoundsRings function only supports WGS84 spatial references.");return e.clone().normalize().map((e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]))}async function g(e,t){const n=[],i=new Map,r=[];if(t.dataModel?.relationshipTypes)for(const e of t.dataModel.relationshipTypes)e.name&&i.set(e.name,[]);for(const t of e)i.has(t.typeName)&&i.get(t.typeName)?.push(t.id);for(const[e,s]of i){if(s.length<1)continue;const i=new l.A({openCypherQuery:`MATCH (n)-[r:${e}]->(m) WHERE id(r) in $ids RETURN id(n), labels(n)[0], id(m), labels(m)[0]`,bindParameters:{ids:s}});r.push((0,a.executeQueryStreaming)(t,i).then((async e=>{const t=e.resultRowsStream.getReader();for(;;){const{done:e,value:i}=await t.read();if(e)break;for(const e of i)n.push({id:e[0],typeName:e[1]}),n.push({id:e[2],typeName:e[3]})}})))}return await Promise.all(r),n}async function _(e,t){t??=!1;const n={generateAllSublayers:t,namedTypeDefinitions:new Map};return await b(e).then((e=>{w(e,n)})),n}async function T(e){const t=await(0,m.I)(),n=new t.MapOfObjectIdentifierSets;!function(e,t,n){for(const[i,r]of n.namedTypeDefinitions){if(!r.members||r.useAllData)continue;const n=r.members.keys(),s=new t.GlobalIdArray,o=new t.ObjectIdentifierSet;for(const e of n)s.add_globalid(e);o.set_globalid_array(s),s.delete(),e.put_identifier_set(i,o),o.delete()}}(n,t,e);const i=new t.MapOfObjectIdentifierSetsEncoder;try{i.set_map_of_identifier_sets(n),i.encode();const e=i.get_encoding_result();if(0!==e.error.error_code)throw new s.A("knowledge-graph:layer-support-utils",e.error.error_message);const t=structuredClone(e.get_byte_buffer());return i.delete(),t}finally{n.delete()}}async function b(e){const t=await(0,r.A)(e,{responseType:"array-buffer"}),n=await t.data;return async function(e){const t=new((await(0,m.I)()).MapOfObjectIdentifierSetsDecoder),n=t.decode(new Uint8Array(e)),i=new Map;if(0!==n.error_code)throw new s.A("knowledge-graph:layer-support-utils",n.error_message);const r=t.get_map_of_identifier_sets(),o=r.keys,a=o.size();for(let e=0;e<a;e++){const t=o.get(e),n=r.query_identifier_set(t),a=[];if(n.id_array_type.value===y.GLOBALID_ARRAY){const e=n.get_globalid_array(),t=e.count();for(let n=0;n<t;n++)a.push(e.get_globalid_at(n))}else{if(n.id_array_type.value!==y.IDENTIFIER_ARRAY)throw new s.A("knowledge-graph:layer-support-utils","Tried to encode an unexpected ID Array type.");{const e=n.get_identifier_array(),t=e.count();for(let n=0;n<t;n++)a.push(e.get_identifier_at(n).toString())}}i.set(t,a)}return t.delete(),i}(new Uint8Array(n))}function w(e,t){for(const[n,i]of e){const e=(0,o.tE)(t.namedTypeDefinitions,n,(()=>({useAllData:!1,members:new Map})));for(const t of i)e.members.has(t)||e.members.set(t,{id:t})}return t}!function(e){e[e.featureResult=0]="featureResult",e[e.countResult=1]="countResult",e[e.idsResult=2]="idsResult"}(h||(h={})),function(e){e[e.upperLeft=0]="upperLeft",e[e.lowerLeft=1]="lowerLeft"}(u||(u={})),function(e){e[e.sqlTypeBigInt=0]="sqlTypeBigInt",e[e.sqlTypeBinary=1]="sqlTypeBinary",e[e.sqlTypeBit=2]="sqlTypeBit",e[e.sqlTypeChar=3]="sqlTypeChar",e[e.sqlTypeDate=4]="sqlTypeDate",e[e.sqlTypeDecimal=5]="sqlTypeDecimal",e[e.sqlTypeDouble=6]="sqlTypeDouble",e[e.sqlTypeFloat=7]="sqlTypeFloat",e[e.sqlTypeGeometry=8]="sqlTypeGeometry",e[e.sqlTypeGUID=9]="sqlTypeGUID",e[e.sqlTypeInteger=10]="sqlTypeInteger",e[e.sqlTypeLongNVarchar=11]="sqlTypeLongNVarchar",e[e.sqlTypeLongVarbinary=12]="sqlTypeLongVarbinary",e[e.sqlTypeLongVarchar=13]="sqlTypeLongVarchar",e[e.sqlTypeNChar=14]="sqlTypeNChar",e[e.sqlTypeNVarChar=15]="sqlTypeNVarChar",e[e.sqlTypeOther=16]="sqlTypeOther",e[e.sqlTypeReal=17]="sqlTypeReal",e[e.sqlTypeSmallInt=18]="sqlTypeSmallInt",e[e.sqlTypeSqlXml=19]="sqlTypeSqlXml",e[e.sqlTypeTime=20]="sqlTypeTime",e[e.sqlTypeTimestamp=21]="sqlTypeTimestamp",e[e.sqlTypeTimestamp2=22]="sqlTypeTimestamp2",e[e.sqlTypeTinyInt=23]="sqlTypeTinyInt",e[e.sqlTypeVarbinary=24]="sqlTypeVarbinary",e[e.sqlTypeVarchar=25]="sqlTypeVarchar"}(c||(c={})),function(e){e[e.OID_ARRAY=0]="OID_ARRAY",e[e.GLOBALID_ARRAY=1]="GLOBALID_ARRAY",e[e.STRING_ARRAY=2]="STRING_ARRAY",e[e.IDENTIFIER_ARRAY=3]="IDENTIFIER_ARRAY"}(y||(y={}))},81114:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(82392),r=(n(3313),n(81482)),s=(n(6273),n(80861),n(67498),n(26325)),o=n(80211),a=n(1912);let l=class extends o.A{constructor(e){super(e),this.layoutGeometry=null}};(0,i._)([(0,r.MZ)({type:a.A,json:{write:!0}})],l.prototype,"layoutGeometry",void 0),l=(0,i._)([(0,s.$)("esri.rest.knowledgeGraph.Entity")],l);const d=l},80211:(e,t,n)=>{n.d(t,{A:()=>l});var i=n(82392),r=n(81482),s=(n(6273),n(80861),n(67498),n(26325)),o=n(92450);let a=class extends o.A{constructor(e){super(e),this.typeName=null,this.id=null}};(0,i._)([(0,r.MZ)({type:String,json:{write:!0}})],a.prototype,"typeName",void 0),(0,i._)([(0,r.MZ)({type:String,json:{write:!0}})],a.prototype,"id",void 0),a=(0,i._)([(0,s.$)("esri.rest.knowledgeGraph.GraphNamedObject")],a);const l=a},92450:(e,t,n)=>{n.d(t,{A:()=>l});var i=n(82392),r=n(84977),s=n(81482),o=(n(6273),n(80861),n(67498),n(26325));let a=class extends r.oY{constructor(e){super(e),this.properties=null}};(0,i._)([(0,s.MZ)({json:{write:!0}})],a.prototype,"properties",void 0),a=(0,i._)([(0,o.$)("esri.rest.knowledgeGraph.GraphObject")],a);const l=a},23783:(e,t,n)=>{n.d(t,{A:()=>p});var i=n(82392),r=n(81482),s=(n(6273),n(80861),n(67498),n(26325)),o=n(73783);let a=class extends o.A{constructor(e){super(e),this.openCypherQuery=""}};(0,i._)([(0,r.MZ)()],a.prototype,"openCypherQuery",void 0),a=(0,i._)([(0,s.$)("esri.rest.knowledgeGraph.GraphQuery")],a);const l=a;let d=class extends l{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null,this.outputSpatialReference=null,this.provenanceBehavior=null}};(0,i._)([(0,r.MZ)()],d.prototype,"bindParameters",void 0),(0,i._)([(0,r.MZ)()],d.prototype,"bindGeometryQuantizationParameters",void 0),(0,i._)([(0,r.MZ)()],d.prototype,"outputQuantizationParameters",void 0),(0,i._)([(0,r.MZ)()],d.prototype,"outputSpatialReference",void 0),(0,i._)([(0,r.MZ)()],d.prototype,"provenanceBehavior",void 0),d=(0,i._)([(0,s.$)("esri.rest.knowledgeGraph.GraphQueryStreaming")],d);const p=d},60097:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(82392),r=(n(80861),n(6273),n(67498),n(62991),n(26325)),s=n(92450);let o=class extends s.A{constructor(e){super(e)}};o=(0,i._)([(0,r.$)("esri.rest.knowledgeGraph.ObjectValue")],o);const a=o},28530:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(82392),r=n(84977),s=n(81482),o=(n(6273),n(80861),n(67498),n(26325)),a=n(92450);let l=class extends r.oY{constructor(e){super(e),this.path=null}};(0,i._)([(0,s.MZ)({type:[a.A],json:{write:!0}})],l.prototype,"path",void 0),l=(0,i._)([(0,o.$)("esri.rest.knowledgeGraph.Path")],l);const d=l},95324:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(82392),r=(n(3313),n(81482)),s=(n(6273),n(80861),n(67498),n(26325)),o=n(80211),a=n(38648);let l=class extends o.A{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};(0,i._)([(0,r.MZ)({type:String,json:{write:!0}})],l.prototype,"originId",void 0),(0,i._)([(0,r.MZ)({type:String,json:{write:!0}})],l.prototype,"destinationId",void 0),(0,i._)([(0,r.MZ)({type:a.A,json:{write:!0}})],l.prototype,"layoutGeometry",void 0),l=(0,i._)([(0,s.$)("esri.rest.knowledgeGraph.Relationship")],l);const d=l}}]);