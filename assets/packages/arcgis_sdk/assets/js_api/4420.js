"use strict";(self.webpackChunkarcgis_node=self.webpackChunkarcgis_node||[]).push([[4420],{47425:(e,t,i)=>{i.d(t,{DO:()=>W,FT:()=>q,Hh:()=>R,OM:()=>D,Ps:()=>H,Wo:()=>A,_I:()=>k,_l:()=>I,dK:()=>X,eh:()=>J,l0:()=>j,t$:()=>Y,uk:()=>F,vI:()=>S,xh:()=>f});i(3313);var n,r,s=i(3223),a=i(62991),o=i(5262),l=i(89349),h=i(34561),c=i(67488),u=i(8e3),p=i(1912),d=i(65648),m=i(44153);function f(e,t,i){return!(0,h.canProjectWithoutEngine)(e,t,i)}function x(e,t,i){const n=f(e,t,i);if(n&&!(0,h.isLoaded)())throw new a.A("rasterprojectionhelper-project","projection engine is not loaded");return n}(r=n||(n={}))[r.None=0]="None",r[r.North=1]="North",r[r.South=2]="South",r[r.Both=3]="Both";const g=(e,t,i,n=0)=>{if(1===i[0])return[0,0];let r=1,s=-1,a=1,o=-1;for(let t=0;t<e.length;t+=2)isNaN(e[t])||(r=r>e[t]?e[t]:r,s=s>e[t]?s:e[t],a=a>e[t+1]?e[t+1]:a,o=o>e[t+1]?o:e[t+1]);const{cols:l,rows:h}=t,c=(s-r)/l/i[0],u=(o-a)/h/i[1],p=2*n;let d=0,m=!1,f=[0,0];for(let t=0;t<l-3;t++){for(let i=0;i<h-3;i++){const n=t*h*2+2*i,r=(e[n]+e[n+4]+e[n+4*h]+e[n+4*h+4])/4,s=(e[n+1]+e[n+5]+e[n+4*h+1]+e[n+4*h+5])/4,a=Math.abs((r-e[n+2*h+2])/c),o=Math.abs((s-e[n+2*h+3])/u);if(a+o>d&&(d=a+o,f=[a,o]),p&&d>p){m=!0;break}}if(m)break}return f},y={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},w=32,_=4,v=_,M=new Map,b=new Map,P=500;async function R(){(0,h.isLoaded)()||await(0,h.load)()}function S(e,t,i){return x(e.spatialReference,t),i?(0,h.getTransformation)(t,e.spatialReference,e):(0,h.getTransformation)(e.spatialReference,t,e)}function A(e,t,i,n=null){const r=e.spatialReference;if(r.equals(t))return e;x(r,t,n);const s=i.center,a=new u.A({xmin:s.x-e.x/2,xmax:s.x+e.x/2,ymin:s.y-e.y/2,ymax:s.y+e.y/2,spatialReference:r}),l=(0,h.project)(a,t,n),c=q(t);let p;if(null==l||null!=c&&l.width>=c){const i=(0,o.GA)(r)/(0,o.GA)(t);p={x:e.x*i,y:e.y*i}}else p={x:l.width,y:l.height};return p}function E(e,t=.01){return(0,o.GA)(e)?t/(0,o.GA)(e):0}function k(e,t,i=null,n=!0){const r=e.spatialReference;if(r.equals(t))return e;x(r,t,i);const s=(0,h.project)(e,t,i);return n&&s?(T([e],[s],r,t),s):s}function T(e,t,i,n){const r=L(i,!0),s=L(n,!0),a=E(i,P),o=E(n,P);if(a&&null!=r&&null!=s)for(let i=0;i<e.length;i++){const n=t[i];if(!n)continue;const{x:l}=e[i],{x:h}=n;h>=s[1]-o&&Math.abs(l-r[0])<a?n.x-=s[1]-s[0]:h<=s[0]+o&&Math.abs(l-r[1])<a&&(n.x+=s[1]-s[0])}}function z(e){const{inSR:t,outSR:i,datumTransformation:n,preferPE:r}=e;if(t.equals(i)){const{points:t}=V(e,null);return t}if(t.isWebMercator&&i.isWGS84||t.isWGS84&&i.isWebMercator)return function(e){const{cols:t,rows:i,xres:n,yres:r,usePixelCenter:s,inSR:a,outSR:o}=e;let{xmin:l,ymax:c}=e;s&&(l+=n/2,c-=r/2);const u=[],d=[],m=Math.max(t,i);for(let e=0;e<m;e++){const s=l+n*Math.min(t,e),m=c-r*Math.min(i,e),f=(0,h.project)(new p.A({x:s,y:m,spatialReference:a}),o);e<=t&&u.push(f.x),e<=i&&d.push(f.y)}const f=[];for(let e=0;e<t;e++)for(let t=0;t<i;t++)f.push([u[e],d[t]]);return f}(e);if(x(t,i,n)&&r){if(t.isGeographic)return G(e);if(null!=C(t))return G(e)}return function(e){const{points:t}=V(e,null),{inSR:i,outSR:n,datumTransformation:r}=e,s=t.map((e=>new p.A(e[0],e[1],i))),a=(0,h.project)(s,n,r);return r&&T(s,a,i,n),a.map((e=>e?[e.x,e.y]:[NaN,NaN]))}(e)}function G(e){const{inSR:t,outSR:i,datumTransformation:n}=e,r=C(t),{points:s,mask:a}=V(e,r);if(!t.isGeographic){const e=t.wkid?l.P.coordsys(t.wkid):l.P.fromString(t.isGeographic?l.a.PE_TYPE_GEOGCS:l.a.PE_TYPE_PROJCS,t.wkt2||t.wkt);l.g.projToGeog(e,s.length,s)}if(null!=n&&n.steps.length){let e;const t=179.9955;if(i.isGeographic&&(e=s.map((([e])=>e>t?1:e<-t?-1:0))),n.steps.forEach((e=>{const t=e.wkid?l.P.geogtran(e.wkid):l.P.fromString(l.a.PE_TYPE_GEOGTRAN,e.wkt);l.h.geogToGeog(t,s.length,s,null,e.isInverse?l.a.PE_TRANSFORM_2_TO_1:l.a.PE_TRANSFORM_1_TO_2)})),e)for(let i=0;i<s.length;i++){const n=e[i],r=s[i][0],a=r>t?1:r<-t?-1:0;n&&a&&n!==a&&(s[i][0]=n>0?r+360:r-360)}}if(!i.isGeographic){const e=C(i,!0),t=null!=e&&e.isEnvelope?[e.bbox[1],e.bbox[3]]:[-90,90];!function(e,t){const[i,n]=t;for(let t=0;t<e.length;t++){const r=e[t][1];(r<i||r>n)&&(e[t]=[NaN,NaN])}}(s,t);const n=i.wkid?l.P.coordsys(i.wkid):l.P.fromString(i.isGeographic?l.a.PE_TYPE_GEOGCS:l.a.PE_TYPE_PROJCS,i.wkt2||i.wkt);l.g.geogToProj(n,s.length,s)}let o=s;if(a&&s.length!==a.length){o=[];for(let e=0,t=0;e<a.length;e++)a[e]?o.push(s[t++]):o.push([NaN,NaN])}return o}function C(e,t=!1){let i=e.wkid||e.wkt2||e.wkt;if(!i||e.isGeographic)return null;if(i=String(i),M.has(i)){const e=M.get(i);return t?e?.gcs:e?.pcs}const n=e.wkid?l.P.coordsys(e.wkid):l.P.fromString(e.isGeographic?l.a.PE_TYPE_GEOGCS:l.a.PE_TYPE_PROJCS,e.wkt2||e.wkt),r=N(n,E(e,1e-4)),s=N(n,0,!0);return M.set(i,{pcs:r,gcs:s}),t?s:r}function N(e,t=0,i=!1){const n=l.j.generate(e),r=i?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!n||!r?.length)return null;let s=!1,a=r.find((e=>1===e.getInclusive()&&1===e.getKind()));if(!a){if(a=r.find((e=>1===e.getInclusive()&&0===e.getKind())),!a)return null;s=!0}const o=i?0:(2===n.getNorthPoleLocation()?1:0)|(2===n.getSouthPoleLocation()?2:0),h=n.isPannableRectangle(),c=a.getCoord();if(s)return{isEnvelope:s,isPannable:h,vertices:c,coef:null,bbox:[c[0][0]-t,c[0][1]-t,c[1][0]+t,c[1][1]+t],poleLocation:o};let u=0;const p=[];let[d,m]=c[0],[f,x]=c[0];for(let e=0,t=c.length;e<t;e++){u++,u===t&&(u=0);const[i,n]=c[e],[r,s]=c[u];if(s===n)p.push([i,r,n,s,2]);else{const e=(r-i)/(s-n||1e-4),t=i-e*n;n<s?p.push([e,t,n,s,0]):p.push([e,t,s,n,1])}d=d<i?d:i,m=m<n?m:n,f=f>i?f:i,x=x>n?x:n}return{isEnvelope:!1,isPannable:h,vertices:c,coef:p,bbox:[d,m,f,x],poleLocation:o}}function V(e,t){const i=[],{cols:n,rows:r,xres:s,yres:a,usePixelCenter:o}=e;let{xmin:l,ymax:h}=e;if(o&&(l+=s/2,h-=a/2),null==t){for(let e=0;e<n;e++)for(let t=0;t<r;t++)i.push([l+s*e,h-a*t]);return{points:i}}const c=new Uint8Array(n*r);if(t.isEnvelope){const{bbox:[e,o,u,p]}=t;for(let d=0,m=0;d<n;d++){const n=l+s*d,f=t.isPannable||n>=e&&n<=u;for(let e=0;e<r;e++,m++){const t=h-a*e;f&&t>=o&&t<=p&&(i.push([n,t]),c[m]=1)}}return{points:i,mask:c}}const u=t.coef,p=[];for(let e=0;e<r;e++){const t=h-a*e,i=[],n=[];for(let e=0;e<u.length;e++){const[r,s,a,o,l]=u[e];if(t===a&&a===o)i.push(r),i.push(s),n.push(2),n.push(2);else if(t>=a&&t<=o){const e=r*t+s;i.push(e),n.push(l)}}let r=i;if(i.length>2){let e=2===n[0]?0:n[0],t=i[0];r=[];for(let s=1;s<n.length;s++)2===n[s]&&s!==n.length-1||(n[s]!==e&&(r.push(0===e?Math.min(t,i[s-1]):Math.max(t,i[s-1])),e=n[s],t=i[s]),s===n.length-1&&r.push(0===n[s]?Math.min(t,i[s]):Math.max(t,i[s])));r.sort(((e,t)=>e-t))}else i[0]>i[1]&&(r=[i[1],i[0]]);p.push(r)}for(let e=0,t=0;e<n;e++){const n=l+s*e;for(let e=0;e<r;e++,t++){const r=h-a*e,s=p[e];if(2===s.length)n>=s[0]&&n<=s[1]&&(i.push([n,r]),c[t]=1);else if(s.length>2){let e=!1;for(let t=0;t<s.length;t+=2)if(n>=s[t]&&n<=s[t+1]){e=!0;break}e&&(i.push([n,r]),c[t]=1)}}}return{points:i,mask:c}}function B(e,t){const i=q(e[0].spatialReference);if(e.length<2||null==i)return e[0];if(t=t??E(e[0].spatialReference),1===(e=e.filter((e=>e.width>t))).length)return e[0];let{xmin:n,xmax:r,ymin:s,ymax:a}=e[0];for(let t=1;t<e.length;t++){const n=e[t];r=n.xmax+i*t,s=Math.min(s,n.ymin),a=Math.max(a,n.ymax)}return new u.A({xmin:n,xmax:r,ymin:s,ymax:a,spatialReference:e[0].spatialReference})}function I(e,t,i=null,r=!0){const a=e.spatialReference;if(a.equals(t))return e;const o=D(e),l=q(a,!0),c=q(t);if(0===o||null==l||null==c){const s=Z(e,t,i,r);if(null==l&&null!=c&&Math.abs(s.width-c)<E(t)&&(0,h.isLoaded)()){const i=C(a);if(null!=i&&i.poleLocation===n.None&&e.width<(i.bbox[2]-i.bbox[0])/2)return function(e,t){const i=q(t);if(null==i)return null;let{xmin:n,ymin:r,xmax:s,ymax:a}=e;const o=e.spatialReference,l=new d.A({spatialReference:o,rings:[[[n,r],[s,r],[s,a],[n,a],[n,r]]]}),c=(0,h.project)(l,t);if(2!==c.rings.length||!c.rings[0].length||!c.rings[1].length)return null;const{rings:p}=c,m=E(o),f=new u.A({spatialReference:t});for(let e=0;e<2;e++){n=s=p[e][0][0],r=a=p[e][0][1];for(let t=0;t<p[e].length;t++)n=n>p[e][t][0]?p[e][t][0]:n,s=s<p[e][t][0]?p[e][t][0]:s,r=r>p[e][t][1]?p[e][t][1]:r,a=a<p[e][t][1]?p[e][t][1]:a;if(0===e)f.ymin=r,f.ymax=a,f.xmin=n,f.xmax=s;else if(f.ymin=Math.min(f.ymin,r),f.ymax=Math.max(f.ymax,a),Math.abs(s-i/2)<m)f.xmin=n,f.xmax=f.xmax+i;else{if(!(Math.abs(n+i/2)<m))return null;f.xmax=s+i}}return f}(e,t)||s}return s}const p=e.clone().normalize();if(1===p.length&&e.xmax<l&&e.xmax-l/2>E(a)){const{xmin:t,xmax:i}=e;for(let n=0;n<=o;n++){const r=0===n?t:-l/2,s=n===o?i-l*n:l/2;p[n]=new u.A({xmin:r,xmax:s,ymin:e.ymin,ymax:e.ymax,spatialReference:a})}}return B(p.map((e=>Z(e,t,i,r))).filter(s.Ru))}function F(e,t,i){if("extent"===e.type){const{xmin:t,ymin:i,xmax:n,ymax:r,spatialReference:s}=e;e=new d.A({rings:[[[t,r],[n,r],[n,i],[t,i],[t,r]]],spatialReference:s})}return e.spatialReference.equals(t)?e:(x(e.spatialReference,t,i),(0,h.project)(e,t,i))}function Z(e,t,i=null,n=!0,r=!0){const s=e.spatialReference;if(s.equals(t)||!t)return e;x(s,t,i);const a=(0,h.project)(e,t,i);if(r&&t.isWebMercator&&a&&(a.ymax=Math.min(20037508.342787,a.ymax),a.ymin=Math.max(-20037508.342787,a.ymin),a.ymin>=a.ymax))return null;if(!n||!a)return a;const o=L(s,!0),l=L(t,!0);if(null==o||null==l)return a;const c=E(s,.001),u=E(s,P),d=E(t,.001);if(Math.abs(a.xmin-l[0])<d&&Math.abs(a.xmax-l[1])<d){const n=Math.abs(e.xmin-o[0]),r=Math.abs(o[1]-e.xmax);if(n<c&&r>u){a.xmin=l[0];const n=[];n.push(new p.A(e.xmax,e.ymin,s)),n.push(new p.A(e.xmax,(e.ymin+e.ymax)/2,s)),n.push(new p.A(e.xmax,e.ymax,s));const r=n.map((e=>k(e,t,i))).filter((e=>!isNaN(e?.x))).map((e=>e.x));a.xmax=Math.max.apply(null,r)}if(r<c&&n>u){a.xmax=l[1];const n=[];n.push(new p.A(e.xmin,e.ymin,s)),n.push(new p.A(e.xmin,(e.ymin+e.ymax)/2,s)),n.push(new p.A(e.xmin,e.ymax,s));const r=n.map((e=>k(e,t,i))).filter((e=>!isNaN(e?.x))).map((e=>e.x));a.xmin=Math.min.apply(null,r)}}else{const e=E(t,.001);Math.abs(a.xmin-l[0])<e&&(a.xmin=l[0]),Math.abs(a.xmax-l[1])<e&&(a.xmax=l[1])}return a}function q(e,t=!1){if(!e)return null;const i=t?20037508.342787:20037508.342788905;return e.isWebMercator?2*i:e.wkid&&e.isGeographic?360:2*y[e.wkid]||null}function L(e,t=!1){if(e.isGeographic)return[-180,180];const i=q(e,t);return null!=i?[-i/2,i/2]:null}function O(e,t,i,n){let r=(e-t)/i;return r-Math.floor(r)!=0?r=Math.floor(r):n&&(r-=1),r}function D(e,t=!1){const i=q(e.spatialReference);if(null==i)return 0;const n=t?0:-i/2,r=E(e.spatialReference),s=!t&&Math.abs(e.xmax-i/2)<r?i/2:e.xmax,a=!t&&Math.abs(e.xmin+i/2)<r?-i/2:e.xmin;return O(s,n,i,!0)-O(a,n,i,!1)}function W(e){const t=e.storageInfo.origin.x,i=q(e.spatialReference,!0);if(null==i)return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const n=i/2,{nativePixelSize:r,storageInfo:s,extent:a}=e,{maximumPyramidLevel:o,blockWidth:l,pyramidScalingFactor:h}=s;let c=r.x;const u=[],p=null!=e.transform&&"gcs-shift"===e.transform.type,d=t+(p?0:n),m=p?i-t:n-t;for(let e=0;e<=o;e++){const e=(a.xmax-t)/c/l,i=e-Math.floor(e)==0?e:Math.ceil(e),n=m/c/l,r=n-Math.floor(n)==0?n:Math.ceil(n),s=Math.floor(d/c/l),o=Math.round(d/c)%l,p=(l-Math.round(m/c)%l)%l;u.push({resolutionX:c,blockWidth:l,datasetColumnCount:i,worldColumnCountFromOrigin:r,leftMargin:o,rightPadding:p,originColumnOffset:s}),c*=h}return{originX:t,halfWorldWidth:n,pyramidsInfo:u,hasGCSSShiftTransform:p}}function j(e){const t=e.isAdaptive&&null==e.spacing;let i=e.spacing||[w,w],n=U(e),r={cols:n.size[0]+1,rows:n.size[1]+1};const s=n.outofBoundPointCount>0&&n.outofBoundPointCount<n.offsets.length/2;let a=n.outofBoundPointCount===n.offsets.length/2||t&&s?[0,0]:g(n.offsets,r,i,v);const o=(a[0]+a[1])/2,h=e.projectedExtent.spatialReference,c=e.srcBufferExtent.spatialReference;if(t&&(s||o>v)&&(f(h,c,e.datumTransformation)&&(h.isGeographic||C(h)),i=[_,_],n=U({...e,spacing:i}),r={cols:n.size[0]+1,rows:n.size[1]+1},a=g(n.offsets,r,i,v)),n.error=a,i[0]>1&&(n.coefficients=$(n.offsets,r,s)),e.includeGCSGrid&&!h.isGeographic&&!h.isWebMercator)if(c.isGeographic)n.gcsGrid={offsets:n.offsets,coefficients:n.coefficients,spacing:i};else{const t=C(h);if(null!=t&&!t.isEnvelope){const t=function(e){if(!e||e.isGeographic)return e;const t=String(e.wkid||e.wkt2||e.wkt);let i;return b.has(t)?i=b.get(t):(i=(e.wkid?l.P.coordsys(e.wkid):l.P.fromString(l.a.PE_TYPE_PROJCS,e.wkt2||e.wkt)).getGeogcs().getCode(),b.set(t,i)),new m.A({wkid:i})}(h),a=I(e.projectedExtent,t),{offsets:o}=U({...e,srcBufferExtent:a,spacing:i}),c=$(o,r,s);n.gcsGrid={offsets:o,coefficients:c,spacing:i}}}return n}function U(e){const{projectedExtent:t,srcBufferExtent:i,pixelSize:n,datumTransformation:r,rasterTransform:s}=e,a=t.spatialReference,o=i.spatialReference,l=x(a,o),{xmin:h,ymin:c,xmax:u,ymax:d}=t,m=q(o),f=null!=m&&(e.hasWrapAround||"gcs-shift"===s?.type),g=e.spacing||[w,w],y=g[0]*n.x,v=g[1]*n.y,M=1===g[0],b=Math.ceil((u-h)/y-.1/g[0])+(M?0:1),R=Math.ceil((d-c)/v-.1/g[1])+(M?0:1),S=z({cols:b,rows:R,xmin:h,ymax:d,xres:y,yres:v,inSR:a,outSR:o,datumTransformation:r,preferPE:g[0]<=_,usePixelCenter:M}),A=[];let k,T=0;const G=M?-1:NaN,{xmin:N,xmax:V,ymax:B,width:I,height:F}=i,Z=E(o,P),L=null!=m&&N>0&&V>m/2;let O=!1;if(l){const e=C(a);O=null!=e&&e.poleLocation>0}for(let e=0;e<b;e++){const t=[];for(let i=0;i<R;i++){let n=S[e*R+i];if(f&&n[0]>V&&n[0]>m/2-Z?n[0]-=m:f&&0===e&&n[0]<0&&L&&!s&&(n[0]+=m),!n||isNaN(n[0])||isNaN(n[1]))A.push(G),A.push(G),t.push(null),T++;else{if(s){const e=s.inverseTransform(new p.A({x:n[0],y:n[1],spatialReference:o}));n=[e.x,e.y]}t.push(n),e>0&&f&&k[i]&&n[0]<k[i][0]&&(n[0]+=m,O&&n[0]>V&&n[0]>m&&(n[0]-=m)),A.push((n[0]-N)/I),A.push((B-n[1])/F)}}k=t}return{offsets:A,error:null,coefficients:null,outofBoundPointCount:T,spacing:g,size:M?[b,R]:[b-1,R-1]}}function $(e,t,i){const{cols:n,rows:r}=t,s=new Float32Array((n-1)*(r-1)*2*6),a=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),o=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let t=0;t<n-1;t++){for(let i=0;i<r-1;i++){let l=t*r*2+2*i;const h=e[l],c=e[l+1],u=e[l+2],p=e[l+3];l+=2*r;const d=e[l],m=e[l+1],f=e[l+2],x=e[l+3];let g=0,y=12*(i*(n-1)+t);for(let e=0;e<3;e++)s[y++]=a[g++]*h+a[g++]*u+a[g++]*f;g=0;for(let e=0;e<3;e++)s[y++]=a[g++]*c+a[g++]*p+a[g++]*x;g=0;for(let e=0;e<3;e++)s[y++]=o[g++]*h+o[g++]*d+o[g++]*f;g=0;for(let e=0;e<3;e++)s[y++]=o[g++]*c+o[g++]*m+o[g++]*x}if(i)for(let e=0;e<s.length;e++)isNaN(s[e])&&(s[e]=-1)}return s}function H(e){const{spatialReference:t}=e,i=(0,c.Vp)(t);if(!i)return e;const[n,r]=i.valid,s=r-n;let a=0;if(e.xmin<n){const t=n-e.xmin;a=Math.ceil(t/s)}else if(e.xmin>r){const t=e.xmin-r;a=-Math.ceil(t/s)}return new u.A({spatialReference:e.spatialReference,xmin:e.xmin+a*s,ymin:e.ymin,xmax:e.xmax+a*s,ymax:e.ymax})}function Y(e,t,i){const{storageInfo:n,pixelSize:r}=t;let s=0,a=!1;const{pyramidResolutions:l}=n,h="mixed"===n.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,n.tileInfo.dpi/96)):1,c=(e.x+e.y)/2/h;if(null!=l&&l.length){const e=l[l.length-1],n=(e.x+e.y)/2,h=(r.x+r.y)/2;if(c<=h)s=0;else if(c>=n)s=l.length,a=c/n>8;else{let e,t=h;for(let n=1;n<=l.length;n++){if(e=(l[n-1].x+l[n-1].y)/2,c<=e){c===e?s=n:"down"===i?(s=n-1,a=c/t>8):s="up"===i||c-t>e-c||c/t>2?n:n-1;break}t=e}}const u=0===s?r:l[s-1];return a&&Math.min(u.x,u.y)*(0,o.GA)(t.spatialReference)>19567&&(a=!1),{pyramidLevel:s,pyramidResolution:new p.A({x:u.x,y:u.y,spatialReference:t.spatialReference}),excessiveReading:a}}const u=Math.log(e.x/r.x)/Math.LN2,d=Math.log(e.y/r.y)/Math.LN2,m=t.storageInfo.maximumPyramidLevel||0;s="down"===i?Math.floor(Math.min(u,d)):"up"===i?Math.ceil(Math.max(u,d)):Math.round((u+d)/2),s<0?s=0:s>m&&(a=s>m+3,s=m);const f=2**s;return{pyramidLevel:s,pyramidResolution:new p.A({x:f*t.nativePixelSize.x,y:f*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:a}}function J(e,t){const{pixelSize:i,extent:n}=e,r=S(n,t,!1);return I(function(e,t){const i=e.clone().normalize();return 1===i.length?i[0]:B(i,t)}(n,(i.x+i.y)/16),t,r)}function X(e,t,i){const n=i?.tileSize??512,r=i?.alignGlobalDatasetWithAGOL??!0,s=!!i?.limitToSrcResolution,{extent:a,spatialReference:l,pixelSize:h}=e,c=A(new p.A({x:h.x,y:h.y,spatialReference:l}),t,a);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const u=(c.x+c.y)/2,d=(0,o.GA)(t),m=u*d*96*39.37,f=t.isGeographic?256/n*295828763.7958547:256/n*591657527.591555;let x="vector-magdir"===e.dataType||"vector-uv"===e.dataType;const g=J(e,t),y=Math.min(Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),Math.ceil(Math.log(f/2/m)/Math.LN2));if(!x&&r&&(t.isGeographic||t.isWebMercator)){const i=q(t);if(x=D(g)>0||null!=i&&g.width>i/4,!x&&null!=i){let t=-1;if(y<3)t=2**y*u*n;else if(e.storageInfo){const{maximumPyramidLevel:i=0,pyramidScalingFactor:r=2}=e.storageInfo;t=r**i*u*n}const r=Math.ceil(i/t);x=1===r||2===r&&i/2-g.xmax<t}}let w,_=m;const v=1.001,M=Math.min(2,Math.max(1.414,e.storageInfo?.pyramidScalingFactor||2));if(x){_=f;const e=t.isGeographic?1341104507446289e-21:.29858214164761665,i=e*(96*d*39.37),n=t.isGeographic?4326:3857;w=A(new p.A({x:e,y:e,spatialReference:{wkid:n}}),l,g),w.x*=_/i,w.y*=_/i}else{w={x:h.x,y:h.y};let e=0;for(;_<f*(v/2)&&e<y;)e++,_*=M,w.x*=M,w.y*=M;Math.max(_,f)/Math.min(_,f)<=v&&(_=f)}const b=[_],P=[{x:w.x,y:w.y}],R=Math.min(70.5310735,m)/v;for(;_>=R;)_/=M,w.x/=M,w.y/=M,b.push(_),P.push({x:w.x,y:w.y});if(s){const e=.001*h.x;let t=P.findIndex((t=>t.x>=h.x-e&&t.x<=h.x+e));t>-1?(P.length=t+1,b.length=t+1):(t=P.findIndex((t=>t.x<=h.x+e)),t>0&&(P.length=t,b.length=t))}return{projectedPixelSize:c,scales:b,srcResolutions:P,isCustomTilingScheme:!x}}},3596:(e,t,i)=>{i.d(t,{l:()=>a});var n=i(90804),r=i(57122),s=i(47764);class a extends s.A{constructor(){super(...arguments),this._hasCrossfade=!1}get requiresDedicatedFBO(){return super.requiresDedicatedFBO||this._hasCrossfade}beforeRender(e){super.beforeRender(e),this._manageFade()}prepareRenderPasses(e){const t=e.registerRenderPass({name:"bitmap",brushes:[n.d.bitmap],target:()=>this.children,drawPhase:r.S5.MAP});return[...super.prepareRenderPasses(e),t]}_manageFade(){this.children.reduce(((e,t)=>e+(t.inFadeTransition?1:0)),0)>=2?(this.children.forEach((e=>e.blendFunction="additive")),this._hasCrossfade=!0):(this.children.forEach((e=>e.blendFunction="standard")),this._hasCrossfade=!1)}}},24420:(e,t,i)=>{i.r(t),i.d(t,{default:()=>W});var n=i(82392),r=i(20857),s=i(40377),a=i(70214),o=i(6273),l=i(61985),h=i(81482),c=i(80861),u=(i(67498),i(26325)),p=i(52796),d=i(3335),m=i(7511),f=i(70947),x=i(21109),g=i(73783),y=i(37623),w=i(86924),_=i(3596),v=i(62921),M=i(68440),b=i(7444);let P=class extends g.A{constructor(){super(...arguments),this.attached=!1,this.container=new v.m,this.updateRequested=!1,this.type="imagery",this._bitmapView=new _.l}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(e){this.strategy.update(e).catch((e=>{(0,y.zf)(e)||c.A.getLogger(this).error(e)}))}hitTest(e){return new r.A({attributes:{},geometry:e.clone(),layer:this.layer})}attach(){this.container.addChild(this._bitmapView);const e=this.layer.version>=10,t=this.layer.version>=10.1?this.layer.imageMaxHeight:2048,i=this.layer.version>=10.1?this.layer.imageMaxWidth:2048;this.strategy=new b.A({container:this._bitmapView,imageNormalizationSupported:e,imageMaxHeight:t,imageMaxWidth:i,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()})}detach(){this.strategy.destroy(),this._bitmapView.removeAllChildren(),this.container.removeAllChildren(),this.updateRequested=!1}redraw(){this.strategy.updateExports((async e=>{const{source:t}=e;if(!t||t instanceof ImageBitmap)return;const i=await this.layer.applyRenderer({extent:t.extent,pixelBlock:t.originalPixelBlock??t.pixelBlock});t.filter=e=>this.layer.pixelFilter?this.layer.applyFilter(e):{...i,extent:t.extent}})).catch((e=>{(0,y.zf)(e)||c.A.getLogger(this).error(e)}))}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}isUpdating(){return this.strategy.updating||this.updateRequested}getPixelData(){if(this.updating)return null;const e=this.strategy.bitmaps;if(1===e.length&&e[0].source)return{extent:e[0].source.extent,pixelBlock:e[0].source.originalPixelBlock};if(e.length>1){const t=this.view.extent,i=e.map((e=>e.source)).filter((e=>e.extent&&e.extent.intersects(t))).map((e=>({extent:e.extent,pixelBlock:e.originalPixelBlock}))),n=(0,w.LY)(i,t);return null!=n?{extent:n.extent,pixelBlock:n.pixelBlock}:null}return null}async _fetchImage(e,t,i,n){(n=n||{}).timeExtent=this.timeExtent,n.requestAsImageElement=!0,n.returnImageBitmap=!0;const r=await this.layer.fetchImage(e,t,i,n);if(r.imageBitmap)return r.imageBitmap;const s=await this.layer.applyRenderer(r.pixelData,{signal:n.signal}),a=new M.A(s.pixelBlock,s.extent?.clone(),r.pixelData.pixelBlock);return a.filter=e=>this.layer.applyFilter(e),a}};(0,n._)([(0,h.MZ)()],P.prototype,"attached",void 0),(0,n._)([(0,h.MZ)()],P.prototype,"container",void 0),(0,n._)([(0,h.MZ)()],P.prototype,"layer",void 0),(0,n._)([(0,h.MZ)()],P.prototype,"strategy",void 0),(0,n._)([(0,h.MZ)()],P.prototype,"timeExtent",void 0),(0,n._)([(0,h.MZ)()],P.prototype,"view",void 0),(0,n._)([(0,h.MZ)()],P.prototype,"updateRequested",void 0),(0,n._)([(0,h.MZ)()],P.prototype,"updating",null),(0,n._)([(0,h.MZ)()],P.prototype,"type",void 0),P=(0,n._)([(0,u.$)("esri.views.2d.layers.imagery.ImageryView2D")],P);const R=P;var S=i(38116),A=i(8e3),E=i(67488),k=i(47425),T=i(20503),z=i(72332),G=i(57122),C=i(47764);class N extends C.A{constructor(){super(...arguments),this.symbolTypes=["triangle"]}prepareRenderPasses(e){const t=e.registerRenderPass({name:"imagery (vf)",brushes:[z.A],target:()=>this.children,drawPhase:G.S5.MAP});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&e.drawPhase===G.S5.MAP&&this.symbolTypes.forEach((t=>{e.renderPass=t,super.doRender(e)}))}}var V=i(27947);let B=class extends g.A{constructor(e){super(e),this._loading=null,this.update=(0,y.sg)(((e,t)=>this._update(e,t).catch((e=>{(0,y.zf)(e)||c.A.getLogger(this).error(e)}))))}get updating(){return!!this._loading}redraw(e){if(!this.container.children.length)return;const t=this.container.children[0];t.symbolizerParameters=e,t.invalidateVAO(),this.container.symbolTypes="wind_speed"===e.style?["scalar","triangle"]:"simple_scalar"===e.style?["scalar"]:["triangle"],this.container.requestRender()}async _update(e,t,i){if(!e.stationary)return;const{extent:n,spatialReference:r}=e.state,s=new A.A({xmin:n.xmin,ymin:n.ymin,xmax:n.xmax,ymax:n.ymax,spatialReference:r}),[a,o]=e.state.size;this._loading=this.fetchPixels(s,a,o,i);const l=await this._loading;this._addToDisplay(l,t,e.state),this._loading=null}_addToDisplay(e,t,i){if(null==e.pixelBlock)return this.container.children.forEach((e=>e.destroy())),void this.container.removeAllChildren();const{extent:n,pixelBlock:r}=e,s=new V.X(r);s.offset=[0,0],s.symbolizerParameters=t,s.rawPixelData=e,s.invalidateVAO(),s.x=n.xmin,s.y=n.ymax,s.pixelRatio=i.pixelRatio,s.rotation=i.rotation,s.resolution=i.resolution,s.width=r.width*t.symbolTileSize,s.height=r.height*t.symbolTileSize,this.container.children.forEach((e=>e.destroy())),this.container.removeAllChildren(),this.container.symbolTypes="wind_speed"===t.style?["scalar","triangle"]:"simple_scalar"===t.style?["scalar"]:["triangle"],this.container.addChild(s)}};(0,n._)([(0,h.MZ)()],B.prototype,"fetchPixels",void 0),(0,n._)([(0,h.MZ)()],B.prototype,"container",void 0),(0,n._)([(0,h.MZ)()],B.prototype,"_loading",void 0),(0,n._)([(0,h.MZ)()],B.prototype,"updating",null),B=(0,n._)([(0,u.$)("esri.views.2d.layers.imagery.ImageryVFStrategy")],B);const I=B;let F=class extends g.A{constructor(){super(...arguments),this.attached=!1,this.container=new N,this.type="imageryVF",this._dataParameters={exportParametersVersion:0,bbox:"",symbolTileSize:0,time:""},this._fetchpixels=async(e,t,i,n)=>{const r=await this._projectFullExtentPromise,{symbolTileSize:s}=this.layer.renderer,{extent:a,width:o,height:l}=(0,T.$Q)(e,t,i,s,r);if(null!=r&&!r.intersects(e))return{extent:a,pixelBlock:null};const h={bbox:`${a.xmin}, ${a.ymin}, ${a.xmax}, ${a.ymax}`,exportParametersVersion:this.layer.exportImageServiceParameters.version,symbolTileSize:s,time:JSON.stringify(this.timeExtent||"")};if(this._canReuseVectorFieldData(h)){const e=this.getPixelData();if(null!=e&&`${e.extent.xmin}, ${e.extent.ymin}, ${e.extent.xmax}, ${e.extent.ymax}`===h.bbox)return e}const{pixelData:c}=await this.layer.fetchImage(a,o,l,{timeExtent:this.timeExtent,requestAsImageElement:!1,signal:n});this._dataParameters=h;const u=c?.pixelBlock;return null==u?{extent:a,pixelBlock:null}:{extent:a,pixelBlock:"vector-uv"===this.layer.rasterInfo.dataType?(0,T.FI)(u,"vector-uv"):u}}}get updating(){return!this.attached||this._strategy.updating}attach(){this._projectFullExtentPromise=this._getProjectedFullExtent(this.view.spatialReference),this._strategy=new I({container:this.container,fetchPixels:this._fetchpixels}),this.addHandles((0,l.wB)((()=>this.layer.renderer),(e=>this._updateSymbolizerParams(e)),l.pc),"attach")}detach(){this._strategy.destroy(),this.container.children.forEach((e=>e.destroy())),this.container.removeAllChildren(),this.removeHandles("attach"),this._strategy=this.container=this._projectFullExtentPromise=null}getPixelData(){const e=this.container.children[0]?.rawPixelData;if(this.updating||!e)return null;const{extent:t,pixelBlock:i}=e;return{extent:t,pixelBlock:i}}hitTest(e){return new r.A({attributes:{},geometry:e.clone(),layer:this.layer})}update(e){this._strategy.update(e,this._symbolizerParams).catch((e=>{(0,y.zf)(e)||c.A.getLogger(this).error(e)}))}redraw(){const{renderer:e}=this.layer;e&&(this._updateSymbolizerParams(e),this._strategy.redraw(this._symbolizerParams))}_canReuseVectorFieldData(e){const t=this._dataParameters.exportParametersVersion===e.exportParametersVersion,i=this._dataParameters.time===e.time,n=this._dataParameters.symbolTileSize===e.symbolTileSize,r=this._dataParameters.bbox===e.bbox;return t&&i&&n&&r}async _getProjectedFullExtent(e){try{return(0,k._l)(this.layer.fullExtent,e)}catch(t){try{const t=(await(0,S.A)(this.layer.url,{query:{option:"footprints",outSR:(0,E.YX)(e),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;return t?A.A.fromJSON(t):null}catch{return null}}}_updateSymbolizerParams(e){"vector-field"===e.type&&(this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null}))}};(0,n._)([(0,h.MZ)()],F.prototype,"attached",void 0),(0,n._)([(0,h.MZ)()],F.prototype,"container",void 0),(0,n._)([(0,h.MZ)()],F.prototype,"layer",void 0),(0,n._)([(0,h.MZ)()],F.prototype,"timeExtent",void 0),(0,n._)([(0,h.MZ)()],F.prototype,"type",void 0),(0,n._)([(0,h.MZ)()],F.prototype,"view",void 0),(0,n._)([(0,h.MZ)()],F.prototype,"updating",null),F=(0,n._)([(0,u.$)("esri.views.2d.layers.imagery.VectorFieldView2D")],F);const Z=F;var q=i(4827),L=i(24775),O=i(30386);let D=class extends((0,q.A)((0,O.A)((0,m.e)(L.A)))){constructor(){super(...arguments),this._exportImageVersion=-1,this._highlightGraphics=new p.Y,this._highlightView=void 0,this.layer=null,this.subview=null}get pixelData(){const{subview:e}=this;return this.updating||!e?null:"getPixelData"in e?e.getPixelData():null}update(e){this.subview?.update(e)}attach(){this.layer.increaseRasterJobHandlerUsage(),this._setSubView(),this.view&&(this._highlightView=new f.A({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new x.A(this.view.featuresTilingScheme)}),this.container.addChild(this._highlightView.container)),this.addAttachHandles([(0,l.wB)((()=>this.layer.exportImageServiceParameters.version),(e=>{e&&this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())}),l.OH),(0,l.wB)((()=>this.timeExtent),(e=>{const{subview:t}=this;t&&(t.timeExtent=e,"redraw"in t?this.requestUpdate():t.redrawOrRefetch())}),l.OH),this.layer.on("redraw",(()=>{const{subview:e}=this;e&&("redraw"in e?e.redraw():e.redrawOrRefetch())})),(0,l.wB)((()=>this.layer.renderer),(()=>this._setSubView()))])}detach(){this.layer.decreaseRasterJobHandlerUsage(),this.container.removeAllChildren(),this._detachSubview(this.subview),this.subview?.destroy(),this.subview=null,this._highlightView?.destroy(),this._exportImageVersion=-1}viewChange(){}moveEnd(){this.requestUpdate()}highlight(e,t){if(!((Array.isArray(e)?e[0]:s.A.isCollection(e)?e.at(0):e)instanceof r.A))return(0,a.hA)();let i=[];return Array.isArray(e)||s.A.isCollection(e)?i=e.map((e=>e.clone())):e instanceof r.A&&(i=[e.clone()]),this._highlightGraphics.addMany(i),(0,a.hA)((()=>this._highlightGraphics.removeMany(i)))}async doRefresh(){this.requestUpdate()}isUpdating(){const e=!this.subview||this.subview.updating||!!this._highlightView?.updating;return(0,o.A)("esri-2d-log-updating")&&console.log(`Updating ImageryLayerView2D (${this.layer.id}): ${e}\n-> subview ${!this.subview||this.subview.updating}\n-> higlightView ${this._highlightView?.updating}\n`),e}_setSubView(){if(!this.view)return;const e=this.layer.renderer?.type;let t="imagery";if("vector-field"===e?t="imageryVF":"flow"===e&&(t="flow"),this.subview){const{type:e}=this.subview;if(e===t)return this._attachSubview(this.subview),void("flow"===e?this.subview.redrawOrRefetch():"imagery"===e&&"lerc"===this.layer.format?this.subview.redraw():this.requestUpdate());this._detachSubview(this.subview),this.subview?.destroy()}this.subview="imagery"===t?new R({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):"imageryVF"===t?new Z({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new d.A({layer:this.layer,layerView:this}),this._attachSubview(this.subview),this.requestUpdate()}_attachSubview(e){e&&!e.attached&&(e.attach(),e.attached=!0,this.container.addChildAt(e.container,0))}_detachSubview(e){e?.attached&&(this.container.removeChild(e.container),e.detach(),e.attached=!1)}};(0,n._)([(0,h.MZ)()],D.prototype,"pixelData",null),(0,n._)([(0,h.MZ)()],D.prototype,"subview",void 0),D=(0,n._)([(0,u.$)("esri.views.2d.layers.ImageryLayerView2D")],D);const W=D},7444:(e,t,i)=>{i.d(t,{A:()=>S});var n=i(82392),r=i(73783),s=(i(6273),i(37623)),a=i(81482),o=(i(80861),i(67498),i(26325)),l=i(2532),h=i(67488),c=i(26574);const u=Math.PI/180;function p(e){return e*u}function d(e,t){const i=p(t.rotation),n=Math.abs(Math.cos(i)),r=Math.abs(Math.sin(i)),[s,a]=t.size;return e[0]=Math.round(a*r+s*n),e[1]=Math.round(a*n+s*r),e}var m=i(97047),f=i(62516),x=i(39156);const g=(0,l.vt)(),y=[0,0],w=new x.A(0,0,0,0),_=2048,v=2048,M=!1,b=!1,P=!1;let R=class extends r.A{constructor(e){super(e),this._imagePromise=null,this.bitmaps=[],this.hidpi=P,this.imageMaxWidth=_,this.imageMaxHeight=v,this.imageRotationSupported=M,this.imageNormalizationSupported=b,this.update=(0,s.sg)((async(e,t)=>{if((0,s.Te)(t),!e.stationary||this.destroyed)return;const i=e.state,n=(0,h.Vp)(i.spatialReference),r=this.hidpi?e.pixelRatio:1,a=i.worldScreenWidth>0,o=a&&this.imageNormalizationSupported&&i.worldScreenWidth<i.size[0],l=Math.round((this.imageMaxWidth??0)/r),c=Math.round((this.imageMaxHeight??0)/r);o?(y[0]=i.worldScreenWidth,y[1]=i.size[1]):this.imageRotationSupported?(y[0]=i.size[0],y[1]=i.size[1]):d(y,i);const u=Math.floor(y[0])>l||Math.floor(y[1])>c,p=n&&(i.extent.xmin<n.valid[0]||i.extent.xmax>n.valid[1]),m=!this.imageNormalizationSupported&&p,f=!u&&!m,x=this.imageRotationSupported?i.rotation:0,g=this.container.children.slice();if(f){const e=o?i.paddedViewState.center:i.center;this._imagePromise=this._singleExport(i,y,e,i.resolution,x,r,t)}else{let e=Math.min(l,c);a&&(e=Math.min(i.worldScreenWidth,e),e=Math.round(i.worldScreenWidth/Math.ceil(i.worldScreenWidth/e))),this._imagePromise=this._tiledExport(i,e,r,t)}try{const e=await this._imagePromise??[];(0,s.Te)(t);const i=[];if(this._imagePromise=null,this.destroyed)return;this.bitmaps=e;for(const t of g)e.includes(t)||i.push(t.fadeOut().then((()=>{t.remove(),t.destroy()})));for(const t of e)i.push(t.fadeIn());await Promise.all(i)}catch(e){this._imagePromise=null,(0,s.QP)(e)}}),5e3),this.updateExports=(0,s.sg)((async e=>{const t=[];for(const i of this.container.children){if(!i.visible||!i.stage)return;t.push(e(i).then((()=>{i.invalidateTexture(),i.requestRender()})))}this._imagePromise=(0,s.Lx)(t).then((()=>this._imagePromise=null)),await this._imagePromise}))}destroy(){this.bitmaps.forEach((e=>e.destroy())),this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}async _export(e,t,i,n,r,a){const o=await this.fetchSource(e,Math.floor(t*r),Math.floor(i*r),{rotation:n,pixelRatio:r,signal:a});(0,s.Te)(a);const l=new m.mb(null,!0);return l.x=e.xmin,l.y=e.ymax,l.resolution=e.width/t,l.rotation=n,l.pixelRatio=r,l.opacity=0,this.container.addChild(l),await l.setSourceAsync(o,a),(0,s.Te)(a),l}async _singleExport(e,t,i,n,r,s,a){!function(e,t,i,n){const[r,s]=t,[a,o]=n,l=.5*i;e[0]=r-l*a,e[1]=s-l*o,e[2]=r+l*a,e[3]=s+l*o}(g,i,n,t);const o=(0,l.w1)(g,e.spatialReference);return[await this._export(o,t[0],t[1],r,s,a)]}_tiledExport(e,t,i,n){const r=c.A.create({size:t,spatialReference:e.spatialReference,scales:[e.scale]}),s=new f.A(r),a=s.getTileCoverage(e);if(!a)return null;const o=[];return a.forEach(((r,a,h,c)=>{w.set(r,a,h,0),s.getTileBounds(g,w);const u=(0,l.w1)(g,e.spatialReference);o.push(this._export(u,t,t,0,i,n).then((e=>(0!==c&&(w.set(r,a,h,c),s.getTileBounds(g,w),e.x=g[0],e.y=g[3]),e))))})),Promise.all(o)}};(0,n._)([(0,a.MZ)()],R.prototype,"_imagePromise",void 0),(0,n._)([(0,a.MZ)()],R.prototype,"bitmaps",void 0),(0,n._)([(0,a.MZ)()],R.prototype,"container",void 0),(0,n._)([(0,a.MZ)()],R.prototype,"fetchSource",void 0),(0,n._)([(0,a.MZ)()],R.prototype,"hidpi",void 0),(0,n._)([(0,a.MZ)()],R.prototype,"imageMaxWidth",void 0),(0,n._)([(0,a.MZ)()],R.prototype,"imageMaxHeight",void 0),(0,n._)([(0,a.MZ)()],R.prototype,"imageRotationSupported",void 0),(0,n._)([(0,a.MZ)()],R.prototype,"imageNormalizationSupported",void 0),(0,n._)([(0,a.MZ)()],R.prototype,"requestUpdate",void 0),(0,n._)([(0,a.MZ)()],R.prototype,"updating",null),R=(0,n._)([(0,o.$)("esri.views.2d.layers.support.ExportStrategy")],R);const S=R},4827:(e,t,i)=>{i.d(t,{A:()=>p});var n=i(82392),r=i(62991),s=i(37623),a=i(81482),o=(i(6273),i(80861),i(67498),i(26325)),l=i(1912),h=i(7198),c=i(10591),u=i(96444);const p=e=>{let t=class extends e{constructor(){super(...arguments),this.view=null}get timeExtent(){return(0,h.F)(this.layer,this.view?.timeExtent,this._get("timeExtent"))}async fetchPopupFeaturesAtLocation(e,t){const{layer:i}=this;if(!e)throw new r.A("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i});const{popupEnabled:n}=i,a=(0,u.D8)(i,t);if(!n||null==a)return[];const o=await a.getRequiredFields();(0,s.Te)(t);const h=new c.A;h.timeExtent=this.timeExtent,h.geometry=e,h.outFields=o,h.outSpatialReference=e.spatialReference;const{resolution:p,spatialReference:d}=this.view,m="2d"===this.view.type?new l.A(p,p,d):new l.A(.5*p,.5*p,d),{returnTopmostRaster:f,showNoDataRecords:x}=a.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},g={returnDomainValues:!0,returnTopmostRaster:f,pixelSize:m,showNoDataRecords:x,signal:t?.signal};return i.queryVisibleRasters(h,g).then((e=>e))}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return(0,n._)([(0,a.MZ)()],t.prototype,"layer",void 0),(0,n._)([(0,a.MZ)()],t.prototype,"suspended",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],t.prototype,"timeExtent",null),(0,n._)([(0,a.MZ)()],t.prototype,"view",void 0),t=(0,n._)([(0,o.$)("esri.views.layers.ImageryLayerView")],t),t}}}]);