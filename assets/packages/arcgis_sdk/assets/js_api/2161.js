"use strict";(self.webpackChunkarcgis_node=self.webpackChunkarcgis_node||[]).push([[2161],{72161:(t,e,n)=>{n.r(e),n.d(e,{default:()=>_});var o=n(82392),s=n(37623),i=(n(80861),n(6273),n(67498),n(62991),n(26325)),d=n(80347),c=n(19913),r=n(94669),a=n(69891),u=n(935),h=n(24735);function g(t,e,n){const o=(0,a.c)(),s=(0,a.g)(o);return(0,d.r)(s,s,t,.5),(0,d.r)(s,s,e,.5),o[3]=(0,d.p)(s,t),(0,d.g)(s,s,n),o}let p=class{constructor(){this._idToComponent=new Map,this._components=new u.A((t=>t.bounds)),this._edges=new u.A((t=>t.bounds)),this._tmpLineSegment=(0,r.vt)(),this._tmpP1=(0,c.vt)(),this._tmpP2=(0,c.vt)(),this._tmpP3=(0,c.vt)(),this.remoteClient=null}async fetchCandidates(t,e){await Promise.resolve(),(0,s.Te)(e),await this._ensureEdgeLocations(t,e);const n=[];return this._edges.forEachNeighbor((e=>(this._addCandidates(t,e,n),n.length<1e3)),t.bounds),{result:{candidates:n}}}async _ensureEdgeLocations(t,e){const n=[];if(this._components.forEachNeighbor((t=>{if(null==t.info){const{id:e,uid:o}=t;n.push({id:e,uid:o})}return!0}),t.bounds),!n.length)return;const o={components:n},s=await this.remoteClient.invoke("fetchAllEdgeLocations",o,e??{});for(const t of s.components)this._setFetchEdgeLocations(t)}async add(t){const e=new l(t.id,t.bounds);return this._idToComponent.set(e.id,e),this._components.add([e]),{result:{}}}async remove(t){const e=this._idToComponent.get(t.id);if(e){const t=[];this._edges.forEachNeighbor((n=>(n.component===e&&t.push(n),!0)),e.bounds),this._edges.remove(t),this._components.remove([e]),this._idToComponent.delete(e.id)}return{result:{}}}_setFetchEdgeLocations(t){const e=this._idToComponent.get(t.id);if(null==e||t.uid!==e.uid)return;const n=h.HY.createView(t.locations),o=new Array(n.count),s=(0,c.vt)(),i=(0,c.vt)();for(let d=0;d<n.count;d++){n.position0.getVec(d,s),n.position1.getVec(d,i);const c=g(s,i,t.origin),r=new f(e,d,c);o[d]=r}this._edges.add(o);const{objectIds:d,origin:r}=t;e.info={locations:n,objectIds:d,origin:r}}_addCandidates(t,e,n){const{info:o}=e.component,{origin:s,objectIds:i}=o,c=o.locations,r=c.position0.getVec(e.index,this._tmpP1),a=c.position1.getVec(e.index,this._tmpP2);(0,d.g)(r,r,s),(0,d.g)(a,a,s);const u=i[c.componentIndex.get(e.index)];this._addEdgeCandidate(t,u,r,a,n),m(t,u,r,n),m(t,u,a,n)}_addEdgeCandidate(t,e,n,o,s){if(!t.returnEdge)return;const i=(0,a.g)(t.bounds),u=(0,r.Cr)(n,o,this._tmpLineSegment),h=(0,r._I)(u,i,this._tmpP3);(0,a.n)(t.bounds,h)&&s.push({type:"edge",objectId:e,target:(0,c.o8)(h),distance:(0,d.p)(i,h),start:(0,c.o8)(n),end:(0,c.o8)(o)})}};p=(0,o._)([(0,i.$)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],p);const _=p;function m(t,e,n,o){if(!t.returnVertex||!(0,a.n)(t.bounds,n))return;const s=(0,a.g)(t.bounds);o.push({type:"vertex",objectId:e,target:(0,c.o8)(n),distance:(0,d.p)(s,n)})}class l{constructor(t,e){this.id=t,this.bounds=e,this.info=null,this.uid=++l.uid}}l.uid=0;class f{constructor(t,e,n){this.component=t,this.index=e,this.bounds=n}}}}]);