"use strict";(self.webpackChunkarcgis_node=self.webpackChunkarcgis_node||[]).push([[5814],{15814:(e,t,i)=>{i.r(t),i.d(t,{default:()=>N});var r=i(82392),s=i(20857),n=i(80861),l=i(57725),o=i(12056),a=i(61985),d=i(81482),u=(i(6273),i(67498),i(26325)),c=i(76984),h=i(51216),p=i(57179),g=i(10591),y=i(96316),f=i(9327),_=i(20558),F=i(93766),b=i(73217),m=i(62338),w=i(1608),I=i(36466),v=i(43681),E=i(71506),x=i(23149),O=i(81091),A=i(37734),M=i(81238),j=i(22840),S=i(88155),C=i(53013),L=i(65839),D=i(65956),H=i(30367),R=i(96444),P=i(96383),V=i(49437);const Z=(0,j.p)();let q=class extends((0,f.n)((0,L.P)((0,M.E)((0,S.R)((0,F.w)(H.A)))))){constructor(){super(...arguments),this.type="scene-layer-3d",this._setVisibilityHiddenObjectIds=new o.A,this.progressiveLoadFactor=1,this._elevationContext="scene",this._isIntegratedMesh=!1,this._supportsLabeling=!0,this._pendingEditsQueue=Promise.resolve(),this._interactiveEditingSessions=new Map,this._queryEngine=null}get i3slayer(){return this.layer}tryRecycleWith(e,t){return e.url===this.layer.url&&this.i3sOverrides.isEmpty?e.load(t).then((()=>{(0,A.bv)(this.layer,e,this.i3sOverrides),this.layer=e,this.i3sOverrides.destroy();const t=this.view.resourceController?.memoryController;this.i3sOverrides=new v.n({view:this.view,layer:e,memoryController:t}),this.resetHighlights()})):null}get layerPopupEnabledAndHasTemplate(){return this.layer.popupEnabled&&(0,R.d0)(this.layer,this.view.popup?.defaultPopupTemplateEnabled)}get filter(){return this._get("filter")}set filter(e){this._set("filter",w._.checkSupport(e)?e:null)}get viewFilter(){const e=this.mergedFilter,t=this.layerFilter;if(null==e&&null==t)return null;const i=this._get("viewFilter");return null==i?new w._({layerFilter:t,viewFilter:e,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:e=>this._loadAsyncModule(e),addSqlFilter:(e,t)=>this.addSqlFilter(e,t,this.logError),addTimeFilter:(e,t)=>this.addTimeFilter(e,t)}):(i.viewFilter=e,i.layerFilter=t,i)}get requiredFields(){return this._fieldsHelper?.requiredFields??[]}get _floorFilterClause(){const e=(0,p.E)(this);return null!=e?c.WhereClause.create(e,this.layer.fieldsIndex):null}get _excludeObjectIdsSorted(){const e=this.layer.excludeObjectIds.toArray();return e.length?e.sort(((e,t)=>e-t)):null}get _setVisibilityHiddenObjectIdsSorted(){return this._setVisibilityHiddenObjectIds.size?Array.from(this._setVisibilityHiddenObjectIds).sort(((e,t)=>e-t)):null}get lodFactor(){return this.view?.qualitySettings?.sceneService?.object?.lodFactor??1}get lodCrossfadeUncoveredDuration(){return this.view?.qualitySettings?.fadeDuration??0}get updatingProgressValue(){return this._controller?.updatingProgress??0}get visibleAtCurrentScale(){return(0,P.E5)(this.i3slayer.effectiveScaleRange,this.view.terrainScale)}initialize(){this._fieldsHelper=new C.z({layerView:this}),this._updatingHandles.add((()=>this.layer.rangeInfos),(e=>this._rangeInfosChanged(e)),a.Vh),this._updatingHandles.add((()=>this.layer.renderer),(e=>this._updatingHandles.addPromise(this._rendererChange(e))),a.Vh);const e=()=>this._filterChange();this._updatingHandles.add((()=>this.parsedDefinitionExpression),e),this._updatingHandles.add((()=>this.mergedFilter),e),this._updatingHandles.add((()=>this._floorFilterClause),e),this._updatingHandles.add((()=>this._excludeObjectIdsSorted),e),this._updatingHandles.add((()=>this._setVisibilityHiddenObjectIdsSorted),e),this._updatingHandles.add((()=>this.viewFilter?.sortedObjectIds),e),this._updatingHandles.add((()=>this.viewFilter?.parsedWhereClause),e),this._updatingHandles.add((()=>this.getTimeFilterDependencies()),e),this._updatingHandles.add((()=>[this.viewFilter?.parsedGeometry,this.mergedFilter?.spatialRelationship,this.layer.filter?.spatialRelationship]),(()=>this._geometryFilterChange())),(0,y.Vo)()&&this.i3sOverrides.is3DOFL&&this._updatingHandles.add((()=>this.i3sOverrides.sortedGeometryChangedObjectIds),e),this.addHandles(this.layer.on("apply-edits",(e=>this._updatingHandles.addPromise(e.result)))),this.addHandles(this.layer.on("edits",(e=>{const t=this._pendingEditsQueue.then((()=>this._handleEdits(e))).then();this._pendingEditsQueue=t,this._updatingHandles.addPromise(t)})))}destroy(){this._fieldsHelper=(0,l.pR)(this._fieldsHelper)}_rangeInfosChanged(e){null!=e&&e.length>0&&n.A.getLogger(this).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}createQuery(){const e={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return this.mergedFilter?.createQuery(e)??new g.A(e)}queryExtent(e,t){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e),t?.signal)}queryFeatureCount(e,t){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e),t?.signal)}queryFeatures(e,t){return this._ensureQueryEngine().executeQuery(this._ensureQuery(e),t?.signal).then((e=>{if(!e?.features)return e;const t=this.layer;for(const i of e.features)i.layer=t,i.sourceLayer=t;return e}))}queryObjectIds(e,t){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e),t?.signal)}_ensureQueryEngine(){return this._queryEngine||(this._queryEngine=this._createQueryEngine()),this._queryEngine}_createQueryEngine(){const e=(0,m.V7)(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new E._({layerView:this,priority:V.W6.FEATURE_QUERY_ENGINE,spatialIndex:new O.D({featureAdapter:new x.n({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo??[],getFeatureExtent:e}),forAllFeatures:(e,t)=>this._forAllFeatures(((t,i,r)=>e({id:t,index:i,meta:r})),t,_.fe.QUERYABLE),getFeatureExtent:e,sourceSpatialReference:(0,A.Rm)(this.layer),viewSpatialReference:this.view.spatialReference})})}highlight(e){const t=this._highlights;if(e instanceof g.A){const{set:i,handle:r}=t.acquireSet();return this.queryObjectIds(e).then((e=>t.setFeatureIds(i,e))),r}return super.highlight(e)}createInteractiveEditSession(e){return(0,b.bh)(this._attributeEditingContext,e)}_createLayerGraphic(e){return new s.A({attributes:e,layer:this.layer,sourceLayer:this.layer})}getFilters(){const e=super.getFilters();(0,y.Vo)()&&this.i3sOverrides.is3DOFL&&this.i3sOverrides.sortedGeometryChangedObjectIds.length>0&&e.push(((e,t)=>{t.node.index>=0&&(0,A.Be)(this.i3sOverrides.sortedGeometryChangedObjectIds,!1,e)}));const t=this._setVisibilityHiddenObjectIdsSorted;null!=t&&e.push((e=>(0,A.Be)(t,!1,e)));const i=this._excludeObjectIdsSorted;return null!=i&&e.push((e=>(0,A.Be)(i,!1,e))),this._floorFilterClause&&this.addSqlFilter(e,this._floorFilterClause,this.logError),this.addSqlFilter(e,this.parsedDefinitionExpression,this.logError),null!=this.viewFilter&&this.viewFilter.addFilters(e,this.view,this._controller.crsIndex,this._collection),e}setVisibility(e,t){t?this._setVisibilityHiddenObjectIds.delete(e):this._setVisibilityHiddenObjectIds.add(e)}isUpdating(){return super.isUpdating()||this.layerFilterUpdating||null!=this.viewFilter&&this.viewFilter.updating||null!=this.i3sOverrides&&this.i3sOverrides.updating}_ensureQuery(e){return this._addDefinitionExpressionToQuery(null==e?this.createQuery():g.A.from(e))}get _attributeEditingContext(){return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),globalIdField:this._getGlobalIdField(),forEachNode:e=>this._forAllNodes((t=>null!=t?e(t.node,t.featureIds):null)),attributeStorageInfo:this.i3slayer.attributeStorageInfo??[],i3sOverrides:this.i3sOverrides,getAttributeData:e=>this.getAttributeData(e),setAttributeData:(e,t)=>this.setAttributeData(e,t),clearMemCache:()=>this.clearMemCache()}}async _handleEdits(e){const t=(0,y.Vo)(),i=this._attributeEditingContext,r=await(0,b.Eu)(i,e);t&&(0,b.r0)(i,r),(0,b.ry)(i,r)}get hasGeometryFilter(){const e=this.viewFilter;return null!=e?.parsedGeometry}computeNodeFiltering(e){const t=this.viewFilter;return null==t||!this.view.spatialReference||t.isMBSGeometryVisible(e,this.view.spatialReference,this._controller.crsIndex)?I.TJ.Unmodified:I.TJ.Culled}};(0,r._)([(0,d.MZ)()],q.prototype,"i3slayer",null),(0,r._)([(0,d.MZ)(D.S)],q.prototype,"updatingProgress",void 0),(0,r._)([(0,d.MZ)({type:h.A})],q.prototype,"filter",null),(0,r._)([(0,d.MZ)({readOnly:!0})],q.prototype,"viewFilter",null),(0,r._)([(0,d.MZ)(Z.requiredFields)],q.prototype,"requiredFields",null),(0,r._)([(0,d.MZ)(Z.availableFields)],q.prototype,"availableFields",void 0),(0,r._)([(0,d.MZ)()],q.prototype,"_fieldsHelper",void 0),(0,r._)([(0,d.MZ)()],q.prototype,"_floorFilterClause",null),(0,r._)([(0,d.MZ)()],q.prototype,"_excludeObjectIdsSorted",null),(0,r._)([(0,d.MZ)()],q.prototype,"_setVisibilityHiddenObjectIds",void 0),(0,r._)([(0,d.MZ)()],q.prototype,"_setVisibilityHiddenObjectIdsSorted",null),(0,r._)([(0,d.MZ)()],q.prototype,"lodFactor",null),(0,r._)([(0,d.MZ)()],q.prototype,"updatingProgressValue",null),(0,r._)([(0,d.MZ)({readOnly:!0})],q.prototype,"visibleAtCurrentScale",null),q=(0,r._)([(0,u.$)("esri.views.3d.layers.SceneLayerView3D")],q);const N=q},73217:(e,t,i)=>{i.d(t,{Eu:()=>h,bh:()=>d,r0:()=>p,ry:()=>g});var r=i(3132),s=i(15565),n=i(5213);const l={setAttribute(){},rollback(){},commit(){}};var o,a;function d(e,t){const i=t.attributes[e.objectIdField];if(null==i)return l;const r=e.sessions.get(i);if(r)return r;const n=(0,s.o8)(t.attributes),a=new Set,d=e.i3sOverrides.createInteractiveEditSession(i),u=new Map,c=(e,t)=>{const r=u.get(e);if(null==r){const r=t.indexOf(i);return u.set(e,r),r}return r};let h=o.EDITING;const p={setAttribute(i,r){if(h!==o.EDITING)return;const s=e.fieldsIndex.get(i);if(!s)return;const l=e.attributeStorageInfo.findIndex((e=>e.name===s.name));if(l<0)return;if(!(i in n))throw new Error(`Attribute "${i}" is not an attribute of the edited feature.`);d.setAttribute(l,r);const u=e.attributeStorageInfo[l];let p=!1;a.add(i),e.forEachNode(((i,s)=>{const n=c(i,s);if(-1===n)return;const l=e.getAttributeData(i.index);if(l){const s=l[u.name];s&&(s[n]=r,e.setAttributeData(i.index,l,t),p=!0)}})),p&&e.clearMemCache()},rollback(){if(h===o.EDITING){for(const e of a)this.setAttribute(e,n[e]);d.remove(),h=o.ROLLED_BACK,e.sessions.delete(i)}},commit(){h===o.EDITING&&(d.remove(),h=o.COMMITTED,e.sessions.delete(i))}};return e.sessions.set(i,p),p}function u(e,t,i){const{gidToFeatureInfo:r,oidToFeatureInfo:s,fieldsIndex:n,objectIdField:l,globalIdField:o,featureOrIdentifierList:a}=i;if(!i.featuresResolved&&null!=a){for(const e of a){const t={feature:null,oid:-1,gid:null};if("attributes"in e){t.feature=e;const i=e.attributes;if(null!=i)for(const e in i){if(-1!==t.oid&&null!=t.gid)break;const r=n.normalizeFieldName(e);r===l&&(t.oid=i[e]??-1),r===o&&(t.gid=i[e])}}else t.oid=e.objectId??-1,t.gid=e.globalId;null!=t.gid&&r.set(t.gid,t),-1!==t.oid&&s.set(t.oid,t)}i.featuresResolved=!0}return(-1!==e?s.get(e):null)??(null!=t?r.get(t):null)}function c(e,t,i,r,s=null,n=!0){const l=[],o={gidToFeatureInfo:new Map,oidToFeatureInfo:new Map,featuresResolved:null==i,fieldsIndex:e.fieldsIndex,objectIdField:e.objectIdField,globalIdField:e.globalIdField,featureOrIdentifierList:i};for(const e of t){if(null!=e.error)continue;const t=e.objectId??-1,i=e.globalId,a=(-1===t||n?u(t,i,o):null)??{feature:null,oid:t,gid:i},d={oid:-1===t?a.oid:t,gid:i??a.gid,feature:a.feature,result:e};if(l.push(d),-1===d.oid&&null!=d.gid&&null!=s&&(d.oid=s.get(d.gid)??-1),-1===d.oid&&null!=d.gid){let e=r.get(d.gid);null==e&&(e=[],r.set(d.gid,e)),e.push(d)}}return l}async function h(e,t){const i=new Map,s=c(e,t.addedFeatures,t.edits?.addFeatures,i),l=c(e,t.updatedFeatures,t.edits?.updateFeatures,i),o=c(e,t.deletedFeatures,t.edits?.deleteFeatures,i,t.globalIdToObjectId,!1);return i.size>0&&await async function(e,t){const i=e.i3sOverrides.layer.associatedLayer;if(null==i?.globalIdField)return;const s=i.createQuery(),{objectIdField:l,globalIdField:o}=i;s.where=Array.from(t.keys()).map((e=>`${o}='${e}'`)).join(" OR "),s.returnGeometry=!1,s.outFields=[l,o],s.cacheHint=!1;const a=await(0,r.DZ)((0,n.SE)(i,s));if(!a.ok)return;const d=a.value.features;for(const e of d){const i=e.attributes[o],r=e.attributes[l];if(null==i||null==r||-1===r)continue;const s=t.get(i);if(null!=s)for(const e of s)e.oid=r}}(e,i),{adds:s.filter((e=>-1!==e.oid)),updates:l.filter((e=>-1!==e.oid)),deletes:o.filter((e=>-1!==e.oid))}}function p(e,t){const i=new Map,r=e=>{for(const{oid:t,feature:r}of e){const e=r?.geometry;"mesh"===e?.type&&i.set(t,e)}};r(t.adds),r(t.updates);for(const e of t.deletes)i.set(e.oid,null);for(const[t,r]of i)e.i3sOverrides.updateGeometry(t,r)}function g(e,t){const i=function(e,t){const i=t.updates;if(!i||0===i.length)return new _;const r=new _,s=new Map;for(let t=0;t<e.attributeStorageInfo.length;t++)s.set(e.attributeStorageInfo[t].name,t);return e.forEachNode(((t,s)=>{for(const n of i){if(null==n.feature)continue;const i=n.feature,l=n.oid,o=s.indexOf(l);for(const s in i.attributes){const n=e.fieldsIndex.normalizeFieldName(s),a=y(r,t.index,n),d=i.attributes[s];a.push({featureIndex:o,featureId:l,value:d})}}})),r}(e,t),r=function(e,t){const i=new Map,r=t.adds;if(!r||0===r.length||null==e.globalIdField)return i;for(const e of r){const t=e.oid,r=e.feature;"mesh"===r?.geometry?.type&&i.set(t,r)}return i}(e,t);if(0===i.size&&0===r.size)return;const s=new Map;for(let t=0;t<e.attributeStorageInfo.length;t++)s.set(e.attributeStorageInfo[t].name,t);let n=!1;i.forEach(((t,i)=>{const r=e.getAttributeData(i);let l=!1;t.forEach(((t,i)=>{const o=null!=r?r[i]:null,a=s.get(i);for(const{featureIndex:i,value:r,featureId:s}of t)o&&(o[i]=r,l=!0,n=!0),e.i3sOverrides.updateAttributeValue(s,a,r)})),l&&e.setAttributeData(i,r,null)})),n&&e.clearMemCache();const{fieldsIndex:l,i3sOverrides:o,objectIdField:a,globalIdField:d}=e,u=o.layer.associatedLayer?.infoFor3D,c=new Set(u?[...Object.values(u.assetMapFieldRoles),...Object.values(u.transformFieldRoles)]:[]);for(const[e,t]of r){o.featureAdded(e);const{attributes:i}=t;for(const t in i){if(t!==a&&t!==d&&c.has(t))continue;const r=l.normalizeFieldName(t),n=null!=r?s.get(r):null;if(null==n)continue;const u=i[t];o.updateAttributeValue(e,n,u)}}}function y(e,t,i){const r=function(e,t){const i=e.get(t);if(i)return i;const r=new f;return e.set(t,r),r}(e,t),s=null!=i&&r.get(i);if(s)return s;const n=new Array;return r.set(i,n),n}(a=o||(o={}))[a.EDITING=0]="EDITING",a[a.ROLLED_BACK=1]="ROLLED_BACK",a[a.COMMITTED=2]="COMMITTED";const f=Map,_=Map},88155:(e,t,i)=>{i.d(t,{R:()=>a});var r=i(82392),s=i(62991),n=(i(80861),i(6273),i(67498),i(26325)),l=i(46227),o=i(96444);const a=e=>{let t=class extends e{_validateFetchPopupFeatures(e){const{layer:t}=this,{popupEnabled:i}=t;if(!i)throw new s.A("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t});if(!(0,o.D8)(t,e))throw new s.A("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t})}async prepareFetchPopupFeatures(e){}async fetchPopupFeaturesFromGraphics(e,t){if(this._validateFetchPopupFeatures(t),0===e.length)return[];const i="scene"===this.layer.type&&null!=this.layer.associatedLayer?this.layer.associatedLayer:this.layer;let r=[];"fieldsIndex"in this.layer&&(r=(0,l.hL)(this.layer.fieldsIndex,await(0,o.TO)(i,(0,o.D8)(this.layer,t)))),await this.prepareFetchPopupFeatures(r);const s=new Set,n=[],a=[];for(const t of e)(0,l.Q1)(r,t,s)?a.push(t):n.push(t);if(0===a.length)return n;const d=new Map;for(let t=0;t<e.length;t++)d.set(e[t].getObjectId()??0,t);const u=await this.whenGraphicAttributes(a,[...s]).catch((()=>a)).then((e=>n.concat(e)));return u.sort(((e,t)=>{const i=e.getObjectId()??0,r=d.get(i)??0,s=t.getObjectId()??0;return r-(d.get(s)??0)})),u}};return t=(0,r._)([(0,n.$)("esri.views.3d.layers.support.PopupSceneLayerView")],t),t}},53013:(e,t,i)=>{i.d(t,{z:()=>p});var r=i(82392),s=i(73783),n=i(80861),l=i(37623),o=i(61985),a=i(81482),d=i(26325);const u=e=>{let t=class extends e{constructor(){super(...arguments),this._numUpdating=0}get updating(){return this._numUpdating>0}autoUpdateAsync(e,t){const i=(0,l.sg)((async t=>{++this._numUpdating;try{const i=await t;this.destroyed||this._set(e,i)}catch(t){n.A.getLogger(this).warn(`Async update of "${String(e)}" failed. Async update functions should not throw exceptions.`)}--this._numUpdating}));return(0,o.wB)(t,i,o.Vh)}};return(0,r._)([(0,a.MZ)({readOnly:!0})],t.prototype,"updating",null),(0,r._)([(0,a.MZ)()],t.prototype,"_numUpdating",void 0),t=(0,r._)([(0,d.$)("esri.core.AsyncUpdate")],t),t};let c=class extends(u(s.A)){};c=(0,r._)([(0,d.$)("esri.core.AsyncUpdate")],c);i(6273),i(67498);var h=i(46227);let p=class extends(u(s.A)){get layer(){return this.layerView.layer}get requiredFields(){const{layerView:{layer:{fieldsIndex:e},definitionExpressionFields:t},rendererFields:i,labelingFields:r,viewFilterFields:s}=this;return(0,h.DB)(e,[...t??[],...i??[],...r??[],...s??[]])}constructor(e){super(e)}initialize(){this.addHandles([this.autoUpdateAsync("rendererFields",(async()=>{const{fieldsIndex:e,renderer:t}=this.layer;return t?this._getFieldsAsync((i=>t.collectRequiredFields(i,e))):null})),this.autoUpdateAsync("labelingFields",(async()=>{const{layer:e}=this;return e.labelsVisible?this._getFieldsAsync((t=>(0,h.Im)(t,e))):null})),this.autoUpdateAsync("viewFilterFields",(()=>{const{layer:e,mergedFilter:t}=this.layerView;return this._getFieldsAsync((i=>(0,h.o)(i,e,t)))}))])}async _getFieldsAsync(e){const t=new Set;try{return await e(t),Array.from(t).sort()}catch(e){return n.A.getLogger(this).error(e),null}}};(0,r._)([(0,a.MZ)()],p.prototype,"layerView",void 0),(0,r._)([(0,a.MZ)()],p.prototype,"layer",null),(0,r._)([(0,a.MZ)()],p.prototype,"requiredFields",null),(0,r._)([(0,a.MZ)()],p.prototype,"rendererFields",void 0),(0,r._)([(0,a.MZ)()],p.prototype,"labelingFields",void 0),(0,r._)([(0,a.MZ)()],p.prototype,"viewFilterFields",void 0),p=(0,r._)([(0,d.$)("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],p)},22840:(e,t,i)=>{i.d(t,{p:()=>s});var r=i(46227);function s(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const{layer:e,layer:{fieldsIndex:t},requiredFields:i}=this;return e.outFields?(0,r.DB)(t,[...(0,r.hL)(t,e.outFields),...i]):(0,r.DB)(t,i)}}}}},30367:(e,t,i)=>{i.d(t,{A:()=>y});var r=i(82392),s=i(3223),n=i(80861),l=i(57725),o=i(10451),a=i(37623),d=i(61985),u=i(81482),c=(i(6273),i(26325)),h=i(34561),p=i(24775);let g=class extends p.A{constructor(){super(...arguments),this.layer=null,this.filter=null,this._geometryEngine=null,this._projectionEngineLoaded=!1,this._abortController=new AbortController}get availableFields(){return[]}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){throw new Error("Not implemented")}get maximumNumberOfFeaturesExceeded(){return!1}get layerFilter(){return(0,o.w$)(this._layerFilter)}get _layerFilter(){const e=this.layer?.filter;if(null==e||e.geometries.length<1)return null;const t=this._geometryEngine;if(null==t||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return o.J7;const i=e.geometries.at(0).spatialReference,r=e.geometries.toArray().map((e=>{try{e=t.simplify(e)}catch(e){return n.A.getLogger(this).warnOncePerTick("Failed to simplify scene filter mask polygon. Polygon will be ignored."),null}if(null==e)return null;if(e.spatialReference.equals(i))return e;try{return(0,h.project)(e,i)}catch(e){return n.A.getLogger(this).warnOncePerTick("Failed to project scene filter mask polygon. Polygon will be ignored."),null}})).filter(s.Ru).sort(((e,t)=>e.extent.xmin-t.extent.xmin)),l=new Set,a=new Array,d=new Array;for(let e of r){const i=e.extent.xmin;if(a.length=0,l.forEach((r=>{if(i>=r.extent.xmax)return d.push(r),void l.delete(r);e.extent.ymin<=r.extent.ymax&&e.extent.ymax>=r.extent.ymin&&t.intersects(e,r)&&a.push(r)})),a.length>0){a.push(e);try{e=t.union(a)}catch(e){n.A.getLogger(this).warnOncePerTick("Failed to unify filter mask polygons. Polygon will be ignored.");continue}a.pop(),a.forEach((e=>l.delete(e)))}l.add(e)}return l.forEach((e=>d.push(e))),d.length>0?{spatialRelationship:e.spatialRelationship,geometries:d}:null}get _filterNeedsProjectionEngine(){const e=this.layer.filter;if(null==e||e.geometries.length<=1)return!1;const t=e.geometries.at(0).spatialReference;return e.geometries.some((({spatialReference:e})=>!e.equals(t)&&!(0,h.canProjectWithoutEngine)(e,t)))}get layerFilterUpdating(){return(0,o.DS)(this._layerFilter)}initialize(){const{signal:e}=this._abortController;(0,d.C_)((()=>this.destroyed||!this._geometryEngine&&this.layer?.filter?.geometries?.length),e).then((async()=>{(0,a.QP)(e),this._geometryEngine=await Promise.resolve().then(i.bind(i,65670))})).catch(a.jH),this._projectionEngineLoaded=(0,h.isLoaded)(),(0,d.C_)((()=>this.destroyed||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine),e).then((async()=>{(0,a.QP)(e),await(0,h.load)(),this._projectionEngineLoaded=!0})).catch(a.jH)}destroy(){this._abortController=(0,l.DC)(this._abortController)}highlight(e){throw new Error("Not implemented")}queryFeatures(e,t){throw new Error("Not implemented")}queryObjectIds(e,t){throw new Error("Not implemented")}queryFeatureCount(e,t){throw new Error("Not implemented")}createQuery(){throw new Error("Not implemented")}queryExtent(e,t){throw new Error("Not implemented")}};(0,r._)([(0,u.MZ)()],g.prototype,"layer",void 0),(0,r._)([(0,u.MZ)()],g.prototype,"availableFields",null),(0,r._)([(0,u.MZ)()],g.prototype,"maximumNumberOfFeatures",null),(0,r._)([(0,u.MZ)({readOnly:!0})],g.prototype,"maximumNumberOfFeaturesExceeded",null),(0,r._)([(0,u.MZ)()],g.prototype,"filter",void 0),(0,r._)([(0,u.MZ)({readOnly:!0})],g.prototype,"layerFilter",null),(0,r._)([(0,u.MZ)({readOnly:!0})],g.prototype,"_layerFilter",null),(0,r._)([(0,u.MZ)()],g.prototype,"_geometryEngine",void 0),(0,r._)([(0,u.MZ)()],g.prototype,"_projectionEngineLoaded",void 0),(0,r._)([(0,u.MZ)()],g.prototype,"_filterNeedsProjectionEngine",null),(0,r._)([(0,u.MZ)()],g.prototype,"layerFilterUpdating",null),g=(0,r._)([(0,c.$)("esri.views.layers.SceneLayerView")],g);const y=g}}]);