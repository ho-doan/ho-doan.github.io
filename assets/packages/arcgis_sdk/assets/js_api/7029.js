"use strict";(self.webpackChunkarcgis_node=self.webpackChunkarcgis_node||[]).push([[7029],{10451:(e,t,r)=>{r.d(t,{DS:()=>s,J7:()=>i,w$:()=>n});const i="updating";function n(e){return"updating"===e?null:e}function s(e){return"updating"===e}},11479:(e,t,r)=>{r.d(t,{A:()=>y});var i,n=r(82392),s=r(62991),o=r(84977),l=r(21750),a=r(81482),u=(r(6273),r(80861),r(67498),r(26325)),d=r(77498),c=r(51216);const f={read:{reader:d.LF},write:{writer:d.M9,overridePolicy(){return{allowNull:null!=this.excludedEffect,isRequired:null==this.excludedEffect}}}},p={read:{reader:d.LF},write:{writer:d.M9,overridePolicy(){return{allowNull:null!=this.includedEffect,isRequired:null==this.includedEffect}}}},h={name:"showExcludedLabels",default:!0};let g=i=class extends o.oY{constructor(e){super(e),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(e,t){const r=super.write(e,t);if(t?.origin){if(r.filter){const e=Object.keys(r.filter);if(e.length>1||"where"!==e[0])return t.messages?.push(new s.A("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}if("showExcludedLabels"in r)return t.messages?.push(new s.A("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return r}clone(){return new i({filter:null!=this.filter?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};(0,n._)([(0,a.MZ)({type:c.A,json:{write:{allowNull:!0,writer(e,t,r,i){const n=e?.write({},i);n&&0!==Object.keys(n).length?(0,l.sM)(r,n,t):(0,l.sM)(r,null,t)}}}})],g.prototype,"filter",void 0),(0,n._)([(0,a.MZ)({json:{read:d.LF,write:{writer:d.M9,allowNull:!0},origins:{"web-map":f,"portal-item":f}}})],g.prototype,"includedEffect",void 0),(0,n._)([(0,a.MZ)({json:{read:d.LF,write:{writer:d.M9,allowNull:!0},origins:{"web-map":p,"portal-item":p}}})],g.prototype,"excludedEffect",void 0),(0,n._)([(0,a.MZ)({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":h,"portal-item":h}}})],g.prototype,"excludedLabelsVisible",void 0),g=i=(0,n._)([(0,u.$)("esri.layers.support.FeatureEffect")],g);const y=g},73217:(e,t,r)=>{r.d(t,{Eu:()=>f,bh:()=>u,r0:()=>p,ry:()=>h});var i=r(3132),n=r(15565),s=r(5213);const o={setAttribute(){},rollback(){},commit(){}};var l,a;function u(e,t){const r=t.attributes[e.objectIdField];if(null==r)return o;const i=e.sessions.get(r);if(i)return i;const s=(0,n.o8)(t.attributes),a=new Set,u=e.i3sOverrides.createInteractiveEditSession(r),d=new Map,c=(e,t)=>{const i=d.get(e);if(null==i){const i=t.indexOf(r);return d.set(e,i),i}return i};let f=l.EDITING;const p={setAttribute(r,i){if(f!==l.EDITING)return;const n=e.fieldsIndex.get(r);if(!n)return;const o=e.attributeStorageInfo.findIndex((e=>e.name===n.name));if(o<0)return;if(!(r in s))throw new Error(`Attribute "${r}" is not an attribute of the edited feature.`);u.setAttribute(o,i);const d=e.attributeStorageInfo[o];let p=!1;a.add(r),e.forEachNode(((r,n)=>{const s=c(r,n);if(-1===s)return;const o=e.getAttributeData(r.index);if(o){const n=o[d.name];n&&(n[s]=i,e.setAttributeData(r.index,o,t),p=!0)}})),p&&e.clearMemCache()},rollback(){if(f===l.EDITING){for(const e of a)this.setAttribute(e,s[e]);u.remove(),f=l.ROLLED_BACK,e.sessions.delete(r)}},commit(){f===l.EDITING&&(u.remove(),f=l.COMMITTED,e.sessions.delete(r))}};return e.sessions.set(r,p),p}function d(e,t,r){const{gidToFeatureInfo:i,oidToFeatureInfo:n,fieldsIndex:s,objectIdField:o,globalIdField:l,featureOrIdentifierList:a}=r;if(!r.featuresResolved&&null!=a){for(const e of a){const t={feature:null,oid:-1,gid:null};if("attributes"in e){t.feature=e;const r=e.attributes;if(null!=r)for(const e in r){if(-1!==t.oid&&null!=t.gid)break;const i=s.normalizeFieldName(e);i===o&&(t.oid=r[e]??-1),i===l&&(t.gid=r[e])}}else t.oid=e.objectId??-1,t.gid=e.globalId;null!=t.gid&&i.set(t.gid,t),-1!==t.oid&&n.set(t.oid,t)}r.featuresResolved=!0}return(-1!==e?n.get(e):null)??(null!=t?i.get(t):null)}function c(e,t,r,i,n=null,s=!0){const o=[],l={gidToFeatureInfo:new Map,oidToFeatureInfo:new Map,featuresResolved:null==r,fieldsIndex:e.fieldsIndex,objectIdField:e.objectIdField,globalIdField:e.globalIdField,featureOrIdentifierList:r};for(const e of t){if(null!=e.error)continue;const t=e.objectId??-1,r=e.globalId,a=(-1===t||s?d(t,r,l):null)??{feature:null,oid:t,gid:r},u={oid:-1===t?a.oid:t,gid:r??a.gid,feature:a.feature,result:e};if(o.push(u),-1===u.oid&&null!=u.gid&&null!=n&&(u.oid=n.get(u.gid)??-1),-1===u.oid&&null!=u.gid){let e=i.get(u.gid);null==e&&(e=[],i.set(u.gid,e)),e.push(u)}}return o}async function f(e,t){const r=new Map,n=c(e,t.addedFeatures,t.edits?.addFeatures,r),o=c(e,t.updatedFeatures,t.edits?.updateFeatures,r),l=c(e,t.deletedFeatures,t.edits?.deleteFeatures,r,t.globalIdToObjectId,!1);return r.size>0&&await async function(e,t){const r=e.i3sOverrides.layer.associatedLayer;if(null==r?.globalIdField)return;const n=r.createQuery(),{objectIdField:o,globalIdField:l}=r;n.where=Array.from(t.keys()).map((e=>`${l}='${e}'`)).join(" OR "),n.returnGeometry=!1,n.outFields=[o,l],n.cacheHint=!1;const a=await(0,i.DZ)((0,s.SE)(r,n));if(!a.ok)return;const u=a.value.features;for(const e of u){const r=e.attributes[l],i=e.attributes[o];if(null==r||null==i||-1===i)continue;const n=t.get(r);if(null!=n)for(const e of n)e.oid=i}}(e,r),{adds:n.filter((e=>-1!==e.oid)),updates:o.filter((e=>-1!==e.oid)),deletes:l.filter((e=>-1!==e.oid))}}function p(e,t){const r=new Map,i=e=>{for(const{oid:t,feature:i}of e){const e=i?.geometry;"mesh"===e?.type&&r.set(t,e)}};i(t.adds),i(t.updates);for(const e of t.deletes)r.set(e.oid,null);for(const[t,i]of r)e.i3sOverrides.updateGeometry(t,i)}function h(e,t){const r=function(e,t){const r=t.updates;if(!r||0===r.length)return new m;const i=new m,n=new Map;for(let t=0;t<e.attributeStorageInfo.length;t++)n.set(e.attributeStorageInfo[t].name,t);return e.forEachNode(((t,n)=>{for(const s of r){if(null==s.feature)continue;const r=s.feature,o=s.oid,l=n.indexOf(o);for(const n in r.attributes){const s=e.fieldsIndex.normalizeFieldName(n),a=g(i,t.index,s),u=r.attributes[n];a.push({featureIndex:l,featureId:o,value:u})}}})),i}(e,t),i=function(e,t){const r=new Map,i=t.adds;if(!i||0===i.length||null==e.globalIdField)return r;for(const e of i){const t=e.oid,i=e.feature;"mesh"===i?.geometry?.type&&r.set(t,i)}return r}(e,t);if(0===r.size&&0===i.size)return;const n=new Map;for(let t=0;t<e.attributeStorageInfo.length;t++)n.set(e.attributeStorageInfo[t].name,t);let s=!1;r.forEach(((t,r)=>{const i=e.getAttributeData(r);let o=!1;t.forEach(((t,r)=>{const l=null!=i?i[r]:null,a=n.get(r);for(const{featureIndex:r,value:i,featureId:n}of t)l&&(l[r]=i,o=!0,s=!0),e.i3sOverrides.updateAttributeValue(n,a,i)})),o&&e.setAttributeData(r,i,null)})),s&&e.clearMemCache();const{fieldsIndex:o,i3sOverrides:l,objectIdField:a,globalIdField:u}=e,d=l.layer.associatedLayer?.infoFor3D,c=new Set(d?[...Object.values(d.assetMapFieldRoles),...Object.values(d.transformFieldRoles)]:[]);for(const[e,t]of i){l.featureAdded(e);const{attributes:r}=t;for(const t in r){if(t!==a&&t!==u&&c.has(t))continue;const i=o.normalizeFieldName(t),s=null!=i?n.get(i):null;if(null==s)continue;const d=r[t];l.updateAttributeValue(e,s,d)}}}function g(e,t,r){const i=function(e,t){const r=e.get(t);if(r)return r;const i=new y;return e.set(t,i),i}(e,t),n=null!=r&&i.get(r);if(n)return n;const s=new Array;return i.set(r,s),s}(a=l||(l={}))[a.EDITING=0]="EDITING",a[a.ROLLED_BACK=1]="ROLLED_BACK",a[a.COMMITTED=2]="COMMITTED";const y=Map,m=Map},81238:(e,t,r)=>{r.d(t,{E:()=>u});var i=r(82392),n=r(80861),s=r(81482),o=(r(6273),r(67498),r(26325)),l=r(76984),a=r(37734);const u=e=>{let t=class extends e{constructor(){super(...arguments),this._definitionExpressionErrors=0,this._maxDefinitionExpressionErrors=20,this.logError=e=>{this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&n.A.getLogger(this).error("Error while evaluating definitionExpression: "+e),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&n.A.getLogger(this).error("Further errors are ignored")}}get parsedDefinitionExpression(){if(!this.i3slayer?.definitionExpression)return null;try{const e=l.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!e.isStandardized)return n.A.getLogger(this).error("definitionExpression is using non standard function"),null;const t=[],r=e.fieldNames;return(0,a.W)(r,this.i3slayer.fields,{missingFields:t}),t.length>0?(n.A.getLogger(this).error(`definitionExpression references unknown fields: ${t.join(", ")}`),null):(this._definitionExpressionErrors=0,e)}catch(e){return n.A.getLogger(this).error("Failed to parse definitionExpression: "+e),null}}get definitionExpressionFields(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:[]}_evaluateClause(e,t){try{return e.testFeature(t)}catch(e){return this.logError(e),!1}}_addDefinitionExpressionToQuery(e){if(!this.parsedDefinitionExpression)return e;const t=this.i3slayer.definitionExpression,r=e.clone();return r.where?r.where=`(${t}) AND (${r.where})`:r.where=t,r}};return(0,i._)([(0,s.MZ)({readOnly:!0})],t.prototype,"parsedDefinitionExpression",null),(0,i._)([(0,s.MZ)({readOnly:!0})],t.prototype,"definitionExpressionFields",null),t=(0,i._)([(0,o.$)("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],t),t}},88155:(e,t,r)=>{r.d(t,{R:()=>a});var i=r(82392),n=r(62991),s=(r(80861),r(6273),r(67498),r(26325)),o=r(46227),l=r(96444);const a=e=>{let t=class extends e{_validateFetchPopupFeatures(e){const{layer:t}=this,{popupEnabled:r}=t;if(!r)throw new n.A("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t});if(!(0,l.D8)(t,e))throw new n.A("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t})}async prepareFetchPopupFeatures(e){}async fetchPopupFeaturesFromGraphics(e,t){if(this._validateFetchPopupFeatures(t),0===e.length)return[];const r="scene"===this.layer.type&&null!=this.layer.associatedLayer?this.layer.associatedLayer:this.layer;let i=[];"fieldsIndex"in this.layer&&(i=(0,o.hL)(this.layer.fieldsIndex,await(0,l.TO)(r,(0,l.D8)(this.layer,t)))),await this.prepareFetchPopupFeatures(i);const n=new Set,s=[],a=[];for(const t of e)(0,o.Q1)(i,t,n)?a.push(t):s.push(t);if(0===a.length)return s;const u=new Map;for(let t=0;t<e.length;t++)u.set(e[t].getObjectId()??0,t);const d=await this.whenGraphicAttributes(a,[...n]).catch((()=>a)).then((e=>s.concat(e)));return d.sort(((e,t)=>{const r=e.getObjectId()??0,i=u.get(r)??0,n=t.getObjectId()??0;return i-(u.get(n)??0)})),d}};return t=(0,i._)([(0,s.$)("esri.views.3d.layers.support.PopupSceneLayerView")],t),t}},53013:(e,t,r)=>{r.d(t,{z:()=>p});var i=r(82392),n=r(73783),s=r(80861),o=r(37623),l=r(61985),a=r(81482),u=r(26325);const d=e=>{let t=class extends e{constructor(){super(...arguments),this._numUpdating=0}get updating(){return this._numUpdating>0}autoUpdateAsync(e,t){const r=(0,o.sg)((async t=>{++this._numUpdating;try{const r=await t;this.destroyed||this._set(e,r)}catch(t){s.A.getLogger(this).warn(`Async update of "${String(e)}" failed. Async update functions should not throw exceptions.`)}--this._numUpdating}));return(0,l.wB)(t,r,l.Vh)}};return(0,i._)([(0,a.MZ)({readOnly:!0})],t.prototype,"updating",null),(0,i._)([(0,a.MZ)()],t.prototype,"_numUpdating",void 0),t=(0,i._)([(0,u.$)("esri.core.AsyncUpdate")],t),t};let c=class extends(d(n.A)){};c=(0,i._)([(0,u.$)("esri.core.AsyncUpdate")],c);r(6273),r(67498);var f=r(46227);let p=class extends(d(n.A)){get layer(){return this.layerView.layer}get requiredFields(){const{layerView:{layer:{fieldsIndex:e},definitionExpressionFields:t},rendererFields:r,labelingFields:i,viewFilterFields:n}=this;return(0,f.DB)(e,[...t??[],...r??[],...i??[],...n??[]])}constructor(e){super(e)}initialize(){this.addHandles([this.autoUpdateAsync("rendererFields",(async()=>{const{fieldsIndex:e,renderer:t}=this.layer;return t?this._getFieldsAsync((r=>t.collectRequiredFields(r,e))):null})),this.autoUpdateAsync("labelingFields",(async()=>{const{layer:e}=this;return e.labelsVisible?this._getFieldsAsync((t=>(0,f.Im)(t,e))):null})),this.autoUpdateAsync("viewFilterFields",(()=>{const{layer:e,mergedFilter:t}=this.layerView;return this._getFieldsAsync((r=>(0,f.o)(r,e,t)))}))])}async _getFieldsAsync(e){const t=new Set;try{return await e(t),Array.from(t).sort()}catch(e){return s.A.getLogger(this).error(e),null}}};(0,i._)([(0,a.MZ)()],p.prototype,"layerView",void 0),(0,i._)([(0,a.MZ)()],p.prototype,"layer",null),(0,i._)([(0,a.MZ)()],p.prototype,"requiredFields",null),(0,i._)([(0,a.MZ)()],p.prototype,"rendererFields",void 0),(0,i._)([(0,a.MZ)()],p.prototype,"labelingFields",void 0),(0,i._)([(0,a.MZ)()],p.prototype,"viewFilterFields",void 0),p=(0,i._)([(0,u.$)("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],p)},65839:(e,t,r)=>{r.d(t,{P:()=>d});var i=r(82392),n=r(81482),s=(r(6273),r(80861),r(67498),r(26325)),o=r(86089),l=r(51216),a=r(7198),u=r(37734);const d=e=>{let t=class extends e{get timeExtent(){return(0,a.F)(this.i3slayer,this.view?.timeExtent,this._get("timeExtent"))}get mergedFilter(){const{filter:e,timeExtent:t}=this;if(null==t)return e;const r=e?.clone()??new l.A;return null!=t&&(r.timeExtent=r.timeExtent?.intersection(t)??t),r}getTimeFilterDependencies(){const{timeInfo:e}=this.i3slayer;if(null==e)return[];const{startField:t,endField:r}=e;return[t,r]}addTimeFilter(e,t){if(null==t)return;const{timeInfo:r}=this.i3slayer;if(null==r)return;const{startField:i,endField:n,useTime:s}=r;if(!s||null==i&&null==n)return;const l=r.toJSON(),a=t.toJSON();e.push(((e,t)=>function(e,t,r,i){const n=t.attributeInfo?.attributeData;if(null==n)return;const{startTimeField:s,endTimeField:l}=r;if(null!=s&&null==n[s]||null!=l&&null==n[l])return;const a=(0,o.I)(r,i,new c(n));if(null==a)return;const{featureIds:d}=t;(0,u.$i)(e,d,a)}(e,t,l,a)))}};return(0,i._)([(0,n.MZ)({readOnly:!0})],t.prototype,"timeExtent",null),(0,i._)([(0,n.MZ)()],t.prototype,"mergedFilter",null),t=(0,i._)([(0,s.$)("esri.views.3d.layers.support.TemporalSceneLayerView")],t),t};class c{constructor(e){this.attributeData=e}getAttribute(e,t){return(0,u.E5)(this.attributeData[t],e)}getAttributeAsTimestamp(e,t){const r=this.getAttribute(e,t);return"string"==typeof r?new Date(r).getTime():"number"==typeof r||null==r?r:null}}},22840:(e,t,r)=>{r.d(t,{p:()=>n});var i=r(46227);function n(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const{layer:e,layer:{fieldsIndex:t},requiredFields:r}=this;return e.outFields?(0,i.DB)(t,[...(0,i.hL)(t,e.outFields),...r]):(0,i.DB)(t,r)}}}}},30367:(e,t,r)=>{r.d(t,{A:()=>g});var i=r(82392),n=r(3223),s=r(80861),o=r(57725),l=r(10451),a=r(37623),u=r(61985),d=r(81482),c=(r(6273),r(26325)),f=r(34561),p=r(24775);let h=class extends p.A{constructor(){super(...arguments),this.layer=null,this.filter=null,this._geometryEngine=null,this._projectionEngineLoaded=!1,this._abortController=new AbortController}get availableFields(){return[]}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){throw new Error("Not implemented")}get maximumNumberOfFeaturesExceeded(){return!1}get layerFilter(){return(0,l.w$)(this._layerFilter)}get _layerFilter(){const e=this.layer?.filter;if(null==e||e.geometries.length<1)return null;const t=this._geometryEngine;if(null==t||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return l.J7;const r=e.geometries.at(0).spatialReference,i=e.geometries.toArray().map((e=>{try{e=t.simplify(e)}catch(e){return s.A.getLogger(this).warnOncePerTick("Failed to simplify scene filter mask polygon. Polygon will be ignored."),null}if(null==e)return null;if(e.spatialReference.equals(r))return e;try{return(0,f.project)(e,r)}catch(e){return s.A.getLogger(this).warnOncePerTick("Failed to project scene filter mask polygon. Polygon will be ignored."),null}})).filter(n.Ru).sort(((e,t)=>e.extent.xmin-t.extent.xmin)),o=new Set,a=new Array,u=new Array;for(let e of i){const r=e.extent.xmin;if(a.length=0,o.forEach((i=>{if(r>=i.extent.xmax)return u.push(i),void o.delete(i);e.extent.ymin<=i.extent.ymax&&e.extent.ymax>=i.extent.ymin&&t.intersects(e,i)&&a.push(i)})),a.length>0){a.push(e);try{e=t.union(a)}catch(e){s.A.getLogger(this).warnOncePerTick("Failed to unify filter mask polygons. Polygon will be ignored.");continue}a.pop(),a.forEach((e=>o.delete(e)))}o.add(e)}return o.forEach((e=>u.push(e))),u.length>0?{spatialRelationship:e.spatialRelationship,geometries:u}:null}get _filterNeedsProjectionEngine(){const e=this.layer.filter;if(null==e||e.geometries.length<=1)return!1;const t=e.geometries.at(0).spatialReference;return e.geometries.some((({spatialReference:e})=>!e.equals(t)&&!(0,f.canProjectWithoutEngine)(e,t)))}get layerFilterUpdating(){return(0,l.DS)(this._layerFilter)}initialize(){const{signal:e}=this._abortController;(0,u.C_)((()=>this.destroyed||!this._geometryEngine&&this.layer?.filter?.geometries?.length),e).then((async()=>{(0,a.QP)(e),this._geometryEngine=await Promise.resolve().then(r.bind(r,65670))})).catch(a.jH),this._projectionEngineLoaded=(0,f.isLoaded)(),(0,u.C_)((()=>this.destroyed||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine),e).then((async()=>{(0,a.QP)(e),await(0,f.load)(),this._projectionEngineLoaded=!0})).catch(a.jH)}destroy(){this._abortController=(0,o.DC)(this._abortController)}highlight(e){throw new Error("Not implemented")}queryFeatures(e,t){throw new Error("Not implemented")}queryObjectIds(e,t){throw new Error("Not implemented")}queryFeatureCount(e,t){throw new Error("Not implemented")}createQuery(){throw new Error("Not implemented")}queryExtent(e,t){throw new Error("Not implemented")}};(0,i._)([(0,d.MZ)()],h.prototype,"layer",void 0),(0,i._)([(0,d.MZ)()],h.prototype,"availableFields",null),(0,i._)([(0,d.MZ)()],h.prototype,"maximumNumberOfFeatures",null),(0,i._)([(0,d.MZ)({readOnly:!0})],h.prototype,"maximumNumberOfFeaturesExceeded",null),(0,i._)([(0,d.MZ)()],h.prototype,"filter",void 0),(0,i._)([(0,d.MZ)({readOnly:!0})],h.prototype,"layerFilter",null),(0,i._)([(0,d.MZ)({readOnly:!0})],h.prototype,"_layerFilter",null),(0,i._)([(0,d.MZ)()],h.prototype,"_geometryEngine",void 0),(0,i._)([(0,d.MZ)()],h.prototype,"_projectionEngineLoaded",void 0),(0,i._)([(0,d.MZ)()],h.prototype,"_filterNeedsProjectionEngine",null),(0,i._)([(0,d.MZ)()],h.prototype,"layerFilterUpdating",null),h=(0,i._)([(0,c.$)("esri.views.layers.SceneLayerView")],h);const g=h}}]);